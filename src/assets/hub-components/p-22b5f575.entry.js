import{r as e,c as t,h as s,H as i,a as o,F as a}from"./p-d4ba4c14.js";import{i as n}from"./p-be5c5009.js";import{b as r}from"./p-fd260f2d.js";import{d as c}from"./p-8cf4bd83.js";import{e as l,g as d,h,f as u,a as p,b as g,d as m,c as b,A as v}from"./p-1ec95626.js";import{g as f,j as y,k as x,l as w,m as C,c as _,p as k,M as O,n as j,W as I,o as R,q as P,i as F}from"./p-fbd5dcee.js";import{b as D}from"./p-783242bc.js";import{S as A,C as T,e as G,f as z,g as E,i as H,d as L,P as M,j as S}from"./p-56b73d71.js";import{C as V}from"./p-7b9982ce.js";import{a as B}from"./p-4ac31396.js";import{S as U}from"./p-e3cddc63.js";import{f as K}from"./p-4db6fd24.js";import{f as N,a as $}from"./p-953effcc.js";import{m as W}from"./p-1b73120f.js";import{r as Q,u as J,f as X,s as q,c as Y,a as Z,b as ee}from"./p-57f04fe1.js";import{C as te,i as se}from"./p-f891d7bd.js";import{T as ie,a as oe}from"./p-98a40899.js";import{f as ae}from"./p-adee2925.js";import{C as ne}from"./p-1fde1b24.js";import{s as re}from"./p-3363f483.js";import{i as ce,e as le}from"./p-6f931af6.js";import{c as de}from"./p-b728aff4.js";import{f as he,u as ue}from"./p-9e418183.js";import{r as pe}from"./p-5b420841.js";import{R as ge}from"./p-2accb2bf.js";import{D as me}from"./p-3bf8d293.js";import{b as be}from"./p-5d16ba9a.js";import"./p-dfe5a97d.js";import"./p-c94c130f.js";import"./p-8e7f4c22.js";import"./p-d763eacf.js";import"./p-377e1b5e.js";import"./p-637ea136.js";import"./p-dcdf7b57.js";import"./p-8ccaf06d.js";import"./p-9b205605.js";import"./p-c8e0e01f.js";import"./p-59fd2498.js";import"./p-97274a47.js";import"./p-3904125b.js";import"./p-3f64a9d9.js";import"./p-a0deb8c6.js";import"./p-30a7cbb2.js";import"./p-90dc0f6f.js";import"./p-dd26efbb.js";import"./p-d1b12a9c.js";import"./p-796574a4.js";import"./p-6dcae6cd.js";import"./p-2acb70a6.js";import"./p-7202c430.js";import"./p-75d6da59.js";import"./p-10274eb9.js";import"./p-ad325ed1.js";import"./p-69555c48.js";import"./p-cea8413b.js";import"./p-e43616ff.js";import"./p-992b9d10.js";import"./p-895b662f.js";import"./p-903ef8af.js";import"./p-35a4fa90.js";import"./p-4a14259a.js";import"./p-87582fe0.js";import"./p-52612356.js";import"./p-af59e67b.js";import"./p-b295a5ae.js";function ve(e,t={},s){const{access:i,groups:o,orgs:a,allowAnonymous:n,channelAcl:r,creator:c}=s;if(r){const s=new te(r,c);return fe(e,t)&&s.canPostToChannel(t)}return fe(e,t)&&function(e,t){const{groups:s=[],orgId:i}=e,{access:o,groups:a=[],orgs:n=[]}=t;return o===A.PUBLIC||(o===A.ORG?ye(a,s)||n.includes(i):ye(a,s))}(t,{access:i,groups:o,orgs:a,allowAnonymous:n})}function fe(e,t){return!!t.username&&e.creator===t.username}function ye(e,t){return e.some((e=>t.some((t=>{const{id:s,typeKeywords:i=[]}=t;return e===s&&!i.includes(T)}))))}function xe(e,t,s={}){return function(e,t){return!!t.username&&e.creator===t.username}(e,s)||function(e,t){const{channelAcl:s,creator:i}=e;return!!s&&new te(s,i).canModerateChannel(t)}(t,s)}const we=Object.freeze(["owner","admin"]);function Ce(e,t){return e.some((e=>t.some((t=>{const{id:s,userMembership:{memberType:i}}=t;return e===s&&we.includes(i)}))))}const _e=class{constructor(s){e(this,s),this.hubTelemetry=t(this,"hubTelemetry",7),this.variant=void 0,this.scale="m",r(this,"handleImpression")}async componentWillLoad(){this.intl=await n.loadIntlForComponent(this.el)}get variantConfig(){return l[this.variant]}handleImpression(){this.hubTelemetry.emit(c.dictionary.category.interaction.action.alert.label.warning.details.discussionsBlocked)}render(){return s(i,{"data-element":"discussions-blocked-notice"},s("calcite-notice",{kind:"warning",open:!0,ref:this.handleImpression,scale:this.scale},s("div",{slot:"title"},this.intl.t(this.variantConfig.title)),s("div",{slot:"message"},this.intl.t(this.variantConfig.message))))}static get assetsDirs(){return["locales"]}get el(){return o(this)}};_e.style=":host{display:block}";const ke=class{constructor(s){e(this,s),this.hubTelemetry=t(this,"hubTelemetry",7),this.arcgisHubDiscussionPopoverBeforeOpen=t(this,"arcgisHubDiscussionPopoverBeforeOpen",7),this.arcgisHubDiscussionPopoverClose=t(this,"arcgisHubDiscussionPopoverClose",7),this.buttonEl=void 0,this.post=void 0,this.postCreator=void 0,this.postCreatorOrg=void 0,this.channel=void 0,this.channelGroups=void 0,this.parent=void 0,this.parentCreator=void 0,this.index=void 0,this.context=void 0,this.isHub=void 0,r(this,"handlePopoverOpened","handleGoToProfile","emitHubTelemetry")}async componentWillLoad(){this.intl=await n.loadIntlForComponent(this.element)}emitHubTelemetry(e){const{post:t,parent:s,channel:i,index:o}=this;this.hubTelemetry.emit(Object.assign(Object.assign({},e),{postId:null==t?void 0:t.id,parentId:null==s?void 0:s.id,channelId:null==i?void 0:i.id,channelAccess:null==i?void 0:i.access,position:o}))}handlePopoverOpened(){this.emitHubTelemetry(c.dictionary.category.interaction.action.open.label.popover.details.details)}handleCalcitePopoverBeforeOpened(){this.arcgisHubDiscussionPopoverBeforeOpen.emit()}handlePopoverClosed(){this.arcgisHubDiscussionPopoverClose.emit()}handleGoToProfile(){this.emitHubTelemetry(c.dictionary.category.navigation.action.view.label.users.details.profile)}renderCreatorAvatar(){const{post:e,postCreator:t,context:i}=this,o=!t&&e?{username:e.creator}:t;return s("calcite-avatar",{"full-name":null==o?void 0:o.fullName,scale:"l",thumbnail:(null==o?void 0:o.thumbnail)&&D(i.session.portal,o,i.session.token),"user-id":null==o?void 0:o.id,username:null==o?void 0:o.username})}renderCreatorDetails(){const{intl:e,post:{creator:t},postCreator:i}=this;let o=e.t("anonymous"),n=e.t("noUser");return(i||t)&&(o=(null==i?void 0:i.fullName)||e.t("privateUser"),n=t),s(a,null,s("b",null,o),s("span",null,n))}renderCreatorExpandedDetails(){const{intl:e,postCreator:t,isHub:i}=this;if(null==t?void 0:t.region){const o=e.formatDisplayName(t.region.toLocaleUpperCase(),{type:"region"});return s(a,null,!1,s("div",null,s("calcite-icon",{icon:"pin",scale:"s","text-label":e.t("location")}),o),i&&s("calcite-button",{appearance:"outline-fill",href:"/people/"+t.username,kind:"neutral",label:e.t("profile"),onClick:this.handleGoToProfile,round:!0,scale:"l",width:"full"},e.t("profile")))}}renderPostDetails(){const{intl:e,post:t,parentCreator:i,channel:o,channelGroups:a}=this,n=i?s("div",null,s("calcite-icon",{icon:"right",scale:"s"}),e.t("replyingTo",{username:i.username})):s("div",null,s("calcite-icon",{icon:"speech-bubble",scale:"s"}),s("span",null,e.t("postedIn",{groupName:f(o,a,e.t("unnamedChannel"))})));let r,c;o.access===A.PRIVATE?(r="lock",c=e.t("visiblePrivate")):o.access===A.ORG?(r="organization",c=e.t("visibleOrg")):o.access===A.PUBLIC&&(r="globe",c=e.t("visibleAll"));const l=new Date(t.createdAt).toLocaleString(e.locale,{day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric"});return s("footer",null,n,s("div",null,s("calcite-icon",{icon:r,scale:"s"}),c),s("div",null,s("calcite-icon",{icon:"clock",scale:"s"}),l))}render(){const{intl:e,postCreator:t}=this;if(t)return s(i,{"data-element":"discussions-popover"},this.buttonEl&&s("calcite-popover",{autoClose:!0,label:e.t("information"),overlayPositioning:"fixed",placement:"top",referenceElement:this.buttonEl},s("div",{class:"popover-body"},s("address",null,this.renderCreatorAvatar(),this.renderCreatorDetails()),this.renderCreatorExpandedDetails()),this.renderPostDetails()),s("button",{ref:e=>{this.buttonEl=e},type:"button"},s("slot",null)))}static get assetsDirs(){return["locales"]}get element(){return o(this)}};ke.style=":host{position:relative;display:block}calcite-popover{width:20rem}calcite-popover[data-popper-placement][data-popper-reference-hidden]{pointer-events:auto;opacity:1}button{grid-row:span 2 / span 2;cursor:pointer;border-style:none;background-color:transparent;padding:0px}address{margin:0px;margin-bottom:1.5rem;display:grid;column-gap:0.75rem;row-gap:0px;font-style:normal;grid-template-columns:44px auto}address:last-child{margin:0px}calcite-avatar{grid-row:span 2 / span 2;height:2.75rem;width:2.75rem}address calcite-icon{grid-row:span 2 / span 2;height:2.75rem;width:2.75rem}address b{font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-bold);color:var(--calcite-ui-text-1)}address span{font-size:var(--calcite-font-size--1);line-height:1rem;color:var(--calcite-ui-text-2)}address span:before{content:'@'}calcite-icon{margin-top:1px;margin-bottom:1px}.popover-body{margin:0px;padding:0.75rem}.popover-body div{margin-bottom:0.5rem;display:flex;align-items:flex-start;gap:0.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;color:var(--calcite-ui-text-2)}.popover-body div+div{margin-bottom:1rem}.popover-body div+div:last-child{margin:0px}footer{padding:0.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;color:var(--calcite-ui-text-1);background-color:var(--calcite-ui-background)}footer div{margin:0px;margin-bottom:0.5rem;display:flex;align-items:flex-start;gap:0.5rem}footer div:nth-of-type(3){margin-bottom:1rem}footer div:last-child{margin:0px}";const Oe=new RegExp("<[a-z-]+( [a-z-]+(=('|\")[\\w- ]+('|\"))?)*( data-mention=('|\")[\\w@\\.-]+('|\"))( [a-z-]+(=('|\")[\\w- ]+('|\"))?)*>@[\\w@\\.-]+</[a-z-]+>","g");async function je(e,t){const{post:s}=e;let{postMentionedUsers:i}=e;if(s){const e=y(s.body);i=(null!=i?i:[]).filter((t=>e.includes(t.userId)));const o=e.filter((e=>!i.find((t=>e===t.userId)))),a=await Promise.all(o.map((async e=>{let s,i,o,a;try{s=await d(e,t),i=null}catch(e){i=e,s=null}try{o=(null==s?void 0:s.orgId)?await h(s.orgId,t):null,a=null}catch(e){a=e,o=null}return{userId:e,user:s,userError:i,org:o,orgError:a}})));i=[...i,...a]}else i=null;return{postMentionedUsers:i}}var Ie,Re,Pe=function(e,t,s,i){var o,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(n=(a<3?o(n):a>3?o(t,s,n):o(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};!function(e){e.Skeleton="skeleton",e.Post="post",e.Reply="reply",e.OutOfContext="outOfContext",e.Editor="editor",e.Deleted="deleted",e.Hidden="hidden"}(Ie||(Ie={})),function(e){e.IN="in",e.OUT="out",e.HIDDEN="hidden"}(Re||(Re={}));const Fe=class{constructor(s){e(this,s),this.arcgisHubDiscussionsPostEdit=t(this,"arcgisHubDiscussionsPostEdit",7),this.arcgisHubDiscussionsPostDelete=t(this,"arcgisHubDiscussionsPostDelete",7),this.arcgisHubDiscussionsPostSelect=t(this,"arcgisHubDiscussionsPostSelect",7),this.arcgisHubDiscussionsGeometryDrawReset=t(this,"arcgisHubDiscussionsGeometryDrawReset",7),this.arcgisHubDiscussionsGeometryDeselect=t(this,"arcgisHubDiscussionsGeometryDeselect",7),this.hubTelemetry=t(this,"hubTelemetry",7),this.arcgisHubDiscussionsPostReady=t(this,"arcgisHubDiscussionsPostReady",7),this.postId=void 0,this.post=void 0,this.postCreator=void 0,this.postCreatorOrg=void 0,this.postError=void 0,this.postMentionedUsers=void 0,this.channelId=void 0,this.channel=void 0,this.channelGroups=void 0,this.parentId=void 0,this.parent=void 0,this.parentCreator=void 0,this.parentCreatorOrg=void 0,this.context=void 0,this.hasMap=void 0,this.isHub=void 0,this.unsavedFeatures=void 0,this.unsavedRelatedFeatures=void 0,this.unsavedExistingFeatures=[],this.preview=void 0,this.index=void 0,this.discussion=void 0,this.entityId=void 0,this.entityType=void 0,this.entity=void 0,this.displayFieldValid=void 0,this.displayFieldValue=void 0,this.displayFieldKey=void 0,this.isMobile=void 0,this.locationId=void 0,this.lead=void 0,this.lastIndex=void 0,this.loading=void 0,this.showLocations=void 0,this.locationDescriptionText=void 0,this.minHeight=null,this.popoverIsOpen=void 0,this.articleClass=null,this.editorClass=Re.HIDDEN,this.renderedEl=null,this.editing=!1,this.errorMessage=null,this.intl=void 0,this.isCopied=void 0,this._loading=!1,r(this,"handleDelete","handleEdit","handleCopyLink","handleCopyTooltipBeforeOpen","handleCopyTooltipClose","handleActionsPopoverBeforeOpenClose","handleToggleVisibility","handleViewThread","handleReply","handleViewReplies","handleLinkClicked","renderDeleted","renderHidden","renderPost","renderReply","renderEditor","renderSkeleton","handleViewPost","handleSetComponentRef","handleAnimationEnd","renderReplyOutOfContext","handleViewAllReplies","handleReplyOutOfContextReadMore")}connectedCallback(){this.addAnimationEventListeners(this.renderedEl)}componentWillLoad(){this.initialize()}disconnectedCallback(){this.removeAnimationEventListeners(this.renderedEl)}handlePostViewAllGeography(){const{postId:e,post:t,postCreator:s,postCreatorOrg:i,channel:o,channelGroups:a,channelId:n}=this;this.arcgisHubDiscussionsPostSelect.emit({parent:t,parentId:e,parentCreator:s,parentCreatorOrg:i,channelId:n,channel:o,channelGroups:a})}handleMultilineEllipsisExpanded(e){this.isReply||(e.preventDefault(),e.stopPropagation(),this.handleViewThread())}handleCalcitePopoverOpen(e){var t;const{open:s}=e.target;e.target!==this.menuPopoverElement&&(null===(t=this.menuPopoverElement)||void 0===t?void 0:t.open)?this.menuPopoverElement.setFocus():e.target===this.menuPopoverElement&&s&&this.emitHubTelemetry(Object.assign(Object.assign({},c.dictionary.category.interaction.action.open.label.popover.details.options),{position:this.index}))}handleReactionChanged(e){e.stopPropagation();const t=e.target;this.post=t.post,this.arcgisHubDiscussionsPostEdit.emit(t.post)}emitHubTelemetry(e){const{postId:t,parentId:s,channel:i,channelId:o}=this;this.hubTelemetry.emit(Object.assign(Object.assign({},e),{postId:t,parentId:s,channelId:o,channelAccess:null==i?void 0:i.access}))}async loadDependencies(){return this._loading=!0,this.fetchDependencies().then((e=>{Object.assign(this,e),this._loading=!1,this.arcgisHubDiscussionsPostReady.emit()}))}fetchDependencies(){return this._fetchDependencies()}async _fetchDependencies(){const{postId:e,postCreator:t,postCreatorOrg:s,parent:i,parentId:o,parentCreator:a,post:n,postMentionedUsers:r,channel:c,channelId:l,context:d,discussion:h,entityId:b,entity:v,entityType:f,displayFieldKey:y,displayFieldValid:x,displayFieldValue:w,isHub:C,locationId:_,channelGroups:k}=this,[O,j]=await Promise.all([u({postId:e,post:n},d.hubRequestOptions),N({isHub:C},d.hubRequestOptions)]),[I,R]=await Promise.all([p(Object.assign({postCreator:t,postCreatorOrg:s},O),d.hubRequestOptions),g(Object.assign({parentId:o,parent:i},O),d.hubRequestOptions)]),[P,F,D,A]=await Promise.all([$(Object.assign(Object.assign({discussion:h,entityId:b,entityType:f,entity:v,displayFieldKey:y,displayFieldValid:x,displayFieldValue:w,locationId:_},O),R),d.hubRequestOptions),K(Object.assign(Object.assign({channelId:l,channel:c,channelGroups:k},O),R),d.hubRequestOptions),m(Object.assign({parentCreator:a},R),d.hubRequestOptions),je(Object.assign({postMentionedUsers:r},O),d.hubRequestOptions)]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},O),I),R),D),F),P),j),A)}async initialize(){this.loadTranslations(),this.context&&this.loadDependencies()}async loadTranslations(){this.intl=await n.loadIntlForComponent(this.element)}computePostBody(){return this.post.body}computePostTitle(){return this.post.title}handleDelete(){const{context:e,postId:t,post:s,menuPopoverElement:i,isReply:o}=this;return this.errorMessage=null,i&&(i.open=!1),Q(Object.assign({postId:t},e.hubRequestOptions)).then((()=>{this.deletedDuringSession=!0,this.emitHubTelemetry(Object.assign(Object.assign({},c.dictionary.category.content.action.delete),{response:c.constants.response.SUCCESS})),this.arcgisHubDiscussionsPostDelete.emit(s)})).catch((e=>{this.errorMessage=o?"deleteFailureReply":"deleteFailure",this.emitHubTelemetry(Object.assign(Object.assign({},c.dictionary.category.content.action.delete),{response:c.constants.response.FAILURE})),console.error("Could not delete post:",e.message)}))}handleEdit(){this.menuPopoverElement&&(this.menuPopoverElement.open=!1),setTimeout((()=>this.transitionEditorView(!0)),100),this.emitHubTelemetry(Object.assign(Object.assign({},c.dictionary.category.interaction.action.open.label.editor),{position:this.index}))}handleCopyLink(){!function(e,t,s){const i={channelId:e,postId:t,discussions:!0};s&&(i.replyId=t,i.postId=s);const o=new URL(globalThis.location.href);Object.entries(i).forEach((([e,t])=>{o.searchParams.set(e,t.toString())})),navigator.clipboard.writeText(o.toString())}(this.channelId,this.postId,this.parentId),this.isCopied=!0,this.copyTooltipRef.open=!0}handleCopyTooltipBeforeOpen(){this.isCopied||(this.copyTooltipRef.open=!1)}handleCopyTooltipClose(){this.isCopied=!1}handleActionsPopoverBeforeOpenClose(){this.isCopied=!1,this.copyTooltipRef&&(this.copyTooltipRef.open=!1)}handleToggleVisibility(){const{context:e,post:t,menuPopoverElement:s}=this;let i,o;return this.errorMessage=null,s&&(s.open=!1),t.status===z.HIDDEN?(i=z.APPROVED,o="show"):(i=z.HIDDEN,o="hide"),J(Object.assign({data:{status:i},postId:t.id},e.hubRequestOptions)).then((e=>X(Object.assign({postId:e.id,data:{relations:[G.REACTIONS,G.REPLIES]}},this.context.hubRequestOptions)))).then((e=>(e.replyCount=e.replies.total,delete e.replies,this.emitHubTelemetry(Object.assign(Object.assign({},c.dictionary.category.content.action.update.label.status.details[o]),{response:c.constants.response.SUCCESS})),this.arcgisHubDiscussionsPostEdit.emit(e),e))).catch((e=>(console.error("Could not update post status:",e.message),this.emitHubTelemetry(Object.assign(Object.assign({},c.dictionary.category.content.action.update.label.status.details[o]),{response:c.constants.response.FAILURE})),null)))}handleViewThread(){const{index:e,postId:t,post:s,postCreator:i,postCreatorOrg:o,channel:a,channelGroups:n,channelId:r}=this;this.arcgisHubDiscussionsPostSelect.emit({parentId:t,parent:s,parentCreator:i,parentCreatorOrg:o,channel:a,channelGroups:n,channelId:r}),void 0!==e&&this.emitHubTelemetry(Object.assign(Object.assign({},c.dictionary.category.interaction.action.open.label.thread),{position:e}))}handleReply(){const{postId:e,post:t,postCreator:s,postCreatorOrg:i,channel:o,channelGroups:a,channelId:n}=this;this.arcgisHubDiscussionsPostSelect.emit({parentId:e,parent:t,parentCreator:s,parentCreatorOrg:i,channel:o,channelGroups:a,channelId:n,scrollTarget:"editor"}),this.emitHubTelemetry(c.dictionary.category.interaction.action.open.label.editor.details.reply)}handleViewReplies(){const{postId:e,post:t,postCreator:s,postCreatorOrg:i,channel:o,channelGroups:a,channelId:n}=this;this.arcgisHubDiscussionsPostSelect.emit({parentId:e,parent:t,parentCreator:s,parentCreatorOrg:i,channel:o,channelGroups:a,channelId:n,scrollTarget:"list"}),this.emitHubTelemetry(c.dictionary.category.interaction.action.open.label.thread.details.bodyAction)}handleLinkClicked(e){const t=e.target;if(["CALCITE-LINK"].includes(t.nodeName)&&!t.hasAttribute("data-mention")){const{postId:e,parentId:s,channel:i,index:o}=this;this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.navigation.action.external.label.link),{details:t.href,postId:e,parentId:s,channelId:i.id,channelAccess:i.access,position:o}))}}capturePostDeepLinkImpression(){this.emitHubTelemetry(Object.assign(Object.assign({},c.dictionary.category.interaction.action.viewed.label.post.details.thread),{response:c.constants.response.SUCCESS}))}capturePostListImpression(){this.emitHubTelemetry(Object.assign(Object.assign({},c.dictionary.category.interaction.action.viewed.label.post.details.postList),{position:this.index}))}capturePostDeletedImpression(){this.emitHubTelemetry(Object.assign(Object.assign({},c.dictionary.category.interaction.action.viewed.label.post.details.thread),{response:c.constants.response.FAILURE}))}capturePostHiddenImpression(){this.emitHubTelemetry(Object.assign(Object.assign({},c.dictionary.category.interaction.action.viewed.label.post.details.thread),{response:c.constants.response.FAILURE}))}handleRenderedElChange(e,t){this.removeAnimationEventListeners(t),this.addAnimationEventListeners(e)}handleContextChanged(e,t){e&&!t&&this.loadDependencies()}addAnimationEventListeners(e){e&&e.addEventListener("animationend",this.handleAnimationEnd)}removeAnimationEventListeners(e){e&&e.removeEventListener("animationend",this.handleAnimationEnd)}handleViewAllReplies(){const{parent:e,parentId:t,parentCreator:s,parentCreatorOrg:i,channel:o,channelId:a,channelGroups:n}=this;this.arcgisHubDiscussionsPostSelect.emit({parent:e,parentId:t,parentCreator:s,parentCreatorOrg:i,channelId:a,channel:o,channelGroups:n})}handleReplyOutOfContextReadMore(){const{parent:e,parentId:t,parentCreator:s,parentCreatorOrg:i,channel:o,channelId:a,channelGroups:n,postId:r,post:c,postCreator:l,postCreatorOrg:d}=this;this.arcgisHubDiscussionsPostSelect.emit({parent:e,parentId:t,parentCreator:s,parentCreatorOrg:i,channelId:a,channel:o,channelGroups:n,postId:r,post:c,postCreator:l,postCreatorOrg:d})}handleViewPost(e){e.stopPropagation();const{parent:t,parentId:s,parentCreator:i,parentCreatorOrg:o,channel:a,channelId:n,channelGroups:r,post:c,postId:l,postCreator:d,postCreatorOrg:h}=this;this.arcgisHubDiscussionsPostSelect.emit({parent:t,parentId:s,parentCreator:i,parentCreatorOrg:o,channelId:n,channel:a,channelGroups:r,post:c,postId:l,postCreator:d,postCreatorOrg:h})}handleSetComponentRef(e){e&&(this.renderedEl=e)}handlePostCanceled(e){e.stopPropagation(),this.transitionEditorView(!1),this.arcgisHubDiscussionsGeometryDeselect.emit(),this.arcgisHubDiscussionsGeometryDrawReset.emit()}async handlePostCreatedOrDeleted(e){var t;if(e.detail.parentId===(null===(t=this.post)||void 0===t?void 0:t.id)){const e=await X(Object.assign({postId:this.post.id,data:{relations:[G.REACTIONS,G.REPLIES]}},this.context.hubRequestOptions));e.replyCount=e.replies.total,delete e.replies,this.arcgisHubDiscussionsPostEdit.emit(e)}}handleAnimationEnd(e){"out-left"===e.animationName?(this.editing=!0,this.editorClass=Re.IN,this.articleClass=Re.HIDDEN):"out-right"===e.animationName?(this.editing=!1,this.editorClass=Re.HIDDEN,this.articleClass=Re.IN):(this.editorClass=null,this.articleClass=null,this.minHeight=null)}handlePostEditedBody(e){var t;(null===(t=this.post)||void 0===t?void 0:t.id)===e.detail.id&&(this.post=e.detail)}handlePostEdited(e){"arcgis-hub-discussions-post-editor"===e.target.nodeName.toLowerCase()&&this.transitionEditorView(!1)}handlePopoverOpen(){this.popoverIsOpen=!0}handlePopoverClose(){this.popoverIsOpen=!1}transitionEditorView(e){var t,s;this.minHeight=null!==(s=null===(t=this.renderedEl)||void 0===t?void 0:t.offsetHeight)&&void 0!==s?s:null,this.editorClass=e?Re.HIDDEN:Re.OUT,this.articleClass=e?Re.OUT:Re.HIDDEN}get isLoading(){return!this.context||this._loading||!this.intl||this.loading}get locationListIsDisabled(){let e=!1;return this.locationDescriptionText&&!this.isMobile?e=!1:this.hasMap&&!this.isMobile||(e=!0),e}get views(){const{renderEditor:e,renderDeleted:t,renderHidden:s,renderPost:i,renderReply:o,renderSkeleton:a,renderReplyOutOfContext:n}=this;return{[Ie.Skeleton]:{render:a},[Ie.Post]:{render:i},[Ie.Reply]:{render:o},[Ie.OutOfContext]:{render:n},[Ie.Editor]:{render:e},[Ie.Deleted]:{render:t},[Ie.Hidden]:{render:s}}}get view(){const{views:e,post:t,postError:s,editing:i,isLoading:o,outOfContext:a,isReply:n}=this,r=null==s?void 0:s.status;let c;return c=o?Ie.Skeleton:404===r?Ie.Deleted:422===r?Ie.Hidden:t?i?Ie.Editor:a?Ie.OutOfContext:n?Ie.Reply:Ie.Post:Ie.Deleted,e[c]}get actionMenuActions(){const{isReply:e,post:t,channel:s,context:i,intl:o,isHub:a}=this,n=[];return!e&&a&&n.push({icon:"link",text:o.t("link"),fn:this.handleCopyLink,ref:e=>{this.copyActionRef=e}}),function(e,t={}){const{channelAcl:s,creator:i}=e;return s?new te(s,i).canModerateChannel(t):function(e,t){const{username:s,groups:i=[]}=e,{access:o,groups:a=[],orgs:n=[],creator:r}=t;return!!s&&(r===s||(o===A.PRIVATE?Ce(a,i):Ce(a,i)||function(e,t){return se(t)&&e.includes(t.orgId)}(n,e)))}(t,e)}(s,i.currentUser)&&n.push(t.status===z.HIDDEN?{icon:"view-visible",text:o.t("show"),fn:this.handleToggleVisibility}:{icon:"view-hide",text:o.t("hide"),fn:this.handleToggleVisibility}),e||((t.creator===i.currentUser.username||ve(t,i.currentUser,s))&&n.push({icon:"pencil",text:o.t("edit"),fn:this.handleEdit}),xe(t,s,i.currentUser)&&n.push({icon:"trash",text:o.t("delete"),fn:this.handleDelete})),n}get creatorFullName(){const{intl:e,post:t,postCreator:s}=this;let i=e.t("anonymous");return(s||(null==t?void 0:t.creator))&&(i=(null==s?void 0:s.fullName)||e.t("privateUser")),i}get outOfContext(){const{index:e,lead:t,isReply:s}=this;return s&&!t&&void 0!==e}get styles(){const{minHeight:e}=this,t={};return e&&(t.minHeight=`${e}px`),t}get isReply(){var e;return Boolean(this.parent||this.parentId||(null===(e=this.post)||void 0===e?void 0:e.parentId))}renderEditor(){const{context:e,hasMap:t,index:i,isHub:o,unsavedFeatures:a,unsavedRelatedFeatures:n,unsavedExistingFeatures:r,post:c,postCreator:l,postCreatorOrg:d,displayFieldKey:h,displayFieldValue:u,displayFieldValid:p,entity:g,discussion:m,entityId:b,entityType:v,isMobile:f,channelId:y,channel:x,channelGroups:w,locationId:C,postId:_,isReply:k,lead:O,lastIndex:j,editorClass:I,parent:R,parentId:P,parentCreator:F,showLocations:D}=this;return s("div",{class:{"arcgis-hub-discussions-post-lead":k&&O,"arcgis-hub-discussions-post-last":k&&i===j,[I]:Boolean(I),"arcgis-hub-discussions-post-editor-container":!0},ref:this.handleSetComponentRef},s("slot",{name:"editor"},s("arcgis-hub-discussions-post-editor",{channel:x,channelGroups:w,channelId:y,context:e,discussion:m,displayFieldKey:h,displayFieldValid:p,displayFieldValue:u,entity:g,entityId:b,entityType:v,hasMap:t,index:i,isHub:o,isMobile:f,locationId:C,parent:R,parentCreator:F,parentId:P,post:c,postCreator:l,postCreatorOrg:d,postId:_,showLocations:D,unsavedExistingFeatures:r,unsavedFeatures:a,unsavedRelatedFeatures:n})))}renderReactions(){const{context:e,post:t,channel:i}=this;if(i.allowReaction)return s("arcgis-hub-discussions-post-reactions",{channel:i,context:e,post:t})}renderMetadata(e,t,i,o,a,n,r,c,l){const{isHub:d,context:h,post:u,postCreator:p,postCreatorOrg:g,parentCreator:m,channel:b,channelGroups:v,index:f,parent:y,handleViewPost:x}=this;return s("slot",{name:"metadata"},s("arcgis-hub-discussions-post-header",{channel:b,channelGroups:v,context:h,iconScale:"l",index:f,isHub:d,metadataOrientation:e,onArcgisHubDiscussionsPostSelect:x,parent:y,parentCreator:m,post:u,postCreator:p,postCreatorOrg:g,showChannelAccessIcon:t,showChannelAvatar:i,showChannelName:o,showCreatorAvatar:a,showPopover:n,showReplyingTo:r,showTimestamp:l,showViewPostAction:c}))}renderPost(){const{intl:e,errorMessage:t,preview:i,post:o,channel:a,index:n,articleClass:r}=this;return void 0===n?this.capturePostDeepLinkImpression():this.capturePostListImpression(),s("article",{class:{[r]:Boolean(r)},ref:this.handleSetComponentRef},s("arcgis-hub-discussions-post-chips",{channel:a,index:n,post:o}),this.renderMetadata("block",!0,!0,!0,!0,!0,!1,!1,!0),s("header",{innerHTML:this.computePostTitle()}),s("arcgis-multiline-ellipsis",{"expand-enabled":i,"expand-icon":"rtl"===e.direction?"arrow-left":"arrow-right",innerHTML:this.computePostBody(),lines:i?4:0,onClick:this.handleLinkClicked}),this.renderGeography(!1,!0),s("footer",null,this.renderReactions(),s("div",{class:"actions"},this.renderTextActions(),this.renderActionMenu())),t&&s("calcite-notice",{closable:!0,kind:"danger",open:!0,scale:"s"},s("div",{slot:"title"},e.t("error")),s("div",{slot:"message"},e.t(t))))}renderTextActions(){const{intl:e,post:t,preview:i}=this;let o;return o=i?t.replyCount>1?"actions.viewMany":"actions.viewOne":t.replyCount>1?"actions.replies":"actions.oneReply",s("calcite-action-group",{id:"text-actions",layout:"horizontal"},i&&s("calcite-action",{class:"text-action-reply",onClick:this.handleReply,scale:"s",text:e.t("actions.reply"),textEnabled:!0}),0!==t.replyCount&&s("calcite-action",{class:"text-action-view-reply",disabled:!i,onClick:this.handleViewReplies,scale:"s",text:e.t(o,{count:t.replyCount}),textEnabled:!0}))}renderActionMenu(){const{intl:e,isReply:t,actionMenuActions:i}=this;if(i.length)return s(a,null,s("calcite-action",{alignment:"center",class:"discussions-post-action-menu",ref:e=>{this.menuActionElement=e},scale:"s",text:e.t("options")},s("calcite-icon",{class:"discussions-post-action-menu-icon",icon:"ellipsis",scale:"s"})),s("calcite-popover",{autoClose:!0,flipPlacements:t?["top","bottom"]:["top-end","bottom-end"],label:e.t("options"),offsetDistance:0,onCalcitePopoverBeforeClose:this.handleActionsPopoverBeforeOpenClose,onCalcitePopoverBeforeOpen:this.handleActionsPopoverBeforeOpenClose,overlayPositioning:"absolute",placement:"bottom-end",pointerDisabled:!0,ref:e=>{this.menuPopoverElement=e},referenceElement:this.menuActionElement},s("calcite-action-group",{layout:"vertical"},i.map((({text:e,fn:t,icon:i,ref:o})=>s("calcite-action",{class:"discussions-post-action-menu-options","data-action":e.toLowerCase(),id:"discussions-post-action-menu-option-"+i,key:i,onClick:t,ref:o,scale:"m",text:e,"text-enabled":"true"},s("calcite-icon",{class:"discussions-post-action-menu-options-icon",icon:i,scale:"s"})))))),i.some((({icon:e})=>"link"===e))&&s("calcite-tooltip",{onCalciteTooltipBeforeOpen:this.handleCopyTooltipBeforeOpen,onCalciteTooltipClose:this.handleCopyTooltipClose,open:!1,placement:"top",ref:e=>{this.copyTooltipRef=e},referenceElement:this.copyActionRef},s("span",null,e.t("copied"))))}renderDeleted(){const{intl:e,deletedDuringSession:t,isReply:i,handleViewAllReplies:o}=this;return t||this.capturePostDeletedImpression(),s("calcite-notice",{kind:"danger",open:!0,scale:"m"},s("div",{slot:"title"},e.t(i?"deleted.title.reply":"deleted.title")),s("div",{slot:"message"},e.t(i?"deleted.message.reply":"deleted.message")),i&&s("calcite-link",{onClick:o,slot:"link"},e.t("delete.action")))}renderHidden(){const{intl:e,isReply:t}=this;return this.capturePostHiddenImpression(),s("calcite-notice",{kind:"warning",open:!0,scale:"m"},s("div",{slot:"title"},e.t(t?"hidden.title.reply":"hidden.title")),s("div",{slot:"message"},e.t("hidden.message")))}renderSkeleton(){return s("arcgis-hub-discussions-post-skeleton",null)}render(){return s(i,{class:{loading:this._loading},"data-element":"discussions-post","data-view":this.view.render.name,style:this.styles},this.view.render())}renderAvatars(){const{context:e,isHub:t,parent:i,parentCreator:o,post:a,postCreator:n,postCreatorOrg:r,channel:c,channelGroups:l,intl:d,index:h,outOfContext:u}=this,{portal:p,token:g}=e.session,m=!n&&a?{username:a.creator}:n;let b=[s("calcite-avatar",{"full-name":null==m?void 0:m.fullName,key:"creator",scale:u?"l":"m",thumbnail:(null==m?void 0:m.thumbnail)&&D(p,m,g),"user-id":null==m?void 0:m.id,username:null==m?void 0:m.username})];return u&&b.push(s("calcite-avatar",{"full-name":f(c,l,d.t("unnamedChannel")),scale:"m"})),o&&(b=s("arcgis-hub-discussions-popover",{channel:c,channelGroups:l,context:e,index:h,isHub:t,parent:i,parentCreator:o,post:a,postCreator:n,postCreatorOrg:r},b)),b}renderActions(){const{intl:e,context:t,channel:i,post:o,isHub:a}=this,n=[];if(a&&n.push({text:e.t("link"),onClick:this.handleCopyLink,ref:e=>{this.copyActionRef=e}}),(o.creator===t.currentUser.username||ve(o,t.currentUser,i))&&n.push({text:e.t("edit"),onClick:this.handleEdit}),xe(o,i,t.currentUser)&&n.push({text:e.t("delete"),onClick:this.handleDelete}),n.length)return s("calcite-action-group",{layout:"horizontal"},n.map((e=>s("calcite-action",{appearance:e.appearance,"data-action":e.text.toLowerCase(),icon:e.icon,key:e.text||e.pin,onClick:e.onClick,onMouseOver:e.onMouseOver,ref:e.ref,scale:"s",text:e.text,"text-enabled":Boolean(e.text)}))),a&&s("calcite-tooltip",{onCalciteTooltipBeforeOpen:this.handleCopyTooltipBeforeOpen,onCalciteTooltipClose:this.handleCopyTooltipClose,open:!1,placement:"top",ref:e=>{this.copyTooltipRef=e},referenceElement:this.copyActionRef},s("span",null,e.t("copied"))))}renderReplyOutOfContext(){const{intl:e,errorMessage:t,index:i,lead:o,lastIndex:a,articleClass:n,handleReplyOutOfContextReadMore:r}=this;return void 0===i?this.capturePostDeepLinkImpression():this.capturePostListImpression(),s("article",{class:{"out-of-context":!0,"arcgis-hub-discussions-post-last":o&&i===a,[n]:Boolean(n)},ref:this.handleSetComponentRef},this.renderMetadata("block",!1,!0,!1,!0,!0,!0,!0,!1),s("div",{class:"reply-body"},s("arcgis-multiline-ellipsis",{"collapse-enabled":!0,"expand-enabled":!0,"expand-icon":"rtl"===e.direction?"arrow-left":"arrow-right",innerHTML:this.computePostBody(),lines:4,onClick:r}),this.renderGeography(!0,!1),this.renderReactions(),s("footer",null,this.renderActions()),t&&s("calcite-notice",{closable:!0,kind:"danger",open:!0,scale:"s"},s("div",{slot:"title"},e.t("error")),s("div",{slot:"message"},e.t(t)))))}renderGeography(e,t){const{hasMap:i,channel:o,channelId:a,parentId:n,displayFieldKey:r,displayFieldValid:c,entity:l,context:d,isMobile:h,locationDescriptionText:u,locationListIsDisabled:p,post:g,postId:m,showLocations:b}=this;if(b)return s("arcgis-hub-discussions-post-geography",{channel:o,channelId:a,context:d,disabled:p,displayFieldKey:r,displayFieldValid:c,expandable:t,hasMap:i,isMobile:h,locationDescriptionText:u,parentId:n,post:g,postId:m,showLocationDescriptionText:!h,toggleable:e,url:null==l?void 0:l.url})}renderReply(){const{intl:e,errorMessage:t,channel:i,post:o,articleClass:a,lead:n,index:r,lastIndex:c}=this,l={"arcgis-hub-discussions-post-lead":n,"arcgis-hub-discussions-post-last":n&&r===c};return a&&(l[a]=!0),void 0===r?this.capturePostDeepLinkImpression():this.capturePostListImpression(),s("article",{class:l,ref:this.handleSetComponentRef},s("arcgis-hub-discussions-post-chips",{channel:i,index:r,post:o}),this.renderAvatars(),s("div",null,this.renderMetadata("inline",!1,!1,!1,!1,!1,!1,!1,!0),s("arcgis-multiline-ellipsis",{"collapse-enabled":!0,"expand-enabled":!0,innerHTML:this.computePostBody(),lines:4}),this.renderGeography(!0,!1),s("footer",null,this.renderReactions(),this.renderActions(),this.renderActionMenu()),t&&s("calcite-notice",{closable:!0,kind:"danger",open:!0,scale:"s"},s("div",{slot:"title"},e.t("error")),s("div",{slot:"message"},e.t(t)))))}static get assetsDirs(){return["locales"]}get element(){return o(this)}static get watchers(){return{renderedEl:["handleRenderedElChange"],context:["handleContextChanged"]}}};var De;Pe([W({delay:300})],Fe.prototype,"fetchDependencies",null),Pe([V({scope:"arcgis-hub-discussions-post-body",getKey(){const{postId:e,post:{body:t}}=this;return null!=t?t:e}}),(De={ignoreTags:["calcite-link"],replaceExisting:!0,tagName:"calcite-link"},function(e,t,s){const{value:i}=s;return Object.assign(Object.assign({},s),{value:function(...e){const t=i.apply(this,e);return B(t,De)}})}),function(e,t,s){const{value:i}=s;return Object.assign(Object.assign({},s),{value:function(...e){return function(e,t,s,i,o,a){const n=(e="",t,s,i,o,a)=>{var r;const c=e.match(Oe);if(c){const[l]=c,d=e.indexOf(l),h=d+l.length,u=d>0?e.substring(0,d):"",p=e.substring(d,d+l.length),g=((e,t)=>{const s=y(e)[0];return t?t.find((e=>e.user.username===s)):null})(p,i);return u+p.replace(l,`<arcgis-hub-discussions-mention-popover\n          access="${g.user.access}"\n          channel-access="${o.access}"\n          channel-id="${o.id}"\n          creator-username="${s.username||t.creator}"\n          full-name="${g.user.fullName}"\n          organization="${g.org?g.org.name:""}"\n          parent-id="${null!==(r=t.parentId)&&void 0!==r?r:""}"\n          portal="${a.portal}"\n          post-id="${t.id}"\n          region="${g.user.region}"\n          thumbnail="${g.user.thumbnail}"\n          token="${a.token}"\n          user-id="${g.user.id}"\n          username="${g.user.username}"\n        >${l}</arcgis-hub-discussions-mention-popover>`)+n(e.substring(h),t,s,i,o,a)}return e};return n(e,t,s,i,o,a)}(i.apply(this,e),this.post,this.postCreator,this.postMentionedUsers,this.channel,this.context.session)}})},U({filterOptions:{whiteList:{"calcite-link":["href","data-mention"]}},extendDefaults:!0})],Fe.prototype,"computePostBody",null),Pe([V({scope:"arcgis-hub-discussions-post-title",getKey(){const{postId:e,post:{title:t}}=this;return null!=t?t:e}}),U()],Fe.prototype,"computePostTitle",null),Pe([b()],Fe.prototype,"capturePostDeepLinkImpression",null),Pe([b()],Fe.prototype,"capturePostListImpression",null),Pe([b()],Fe.prototype,"capturePostDeletedImpression",null),Pe([b()],Fe.prototype,"capturePostHiddenImpression",null),Fe.style='.sc-arcgis-hub-discussions-post-h{display:block;background-color:var(--calcite-ui-foreground-1)}arcgis-hub-discussions-post-header.sc-arcgis-hub-discussions-post,.sc-arcgis-hub-discussions-post-s>[slot="metadata"]{margin-left:1rem;margin-right:1rem;margin-bottom:0.5rem}[parent-id].sc-arcgis-hub-discussions-post-h arcgis-hub-discussions-post-header.sc-arcgis-hub-discussions-post,.sc-arcgis-hub-discussions-post-h[parent-id] .sc-arcgis-hub-discussions-post-s>[slot="metadata"]{margin-left:0px;margin-right:0px}.sc-arcgis-hub-discussions-post-s>[slot="metadata"],.sc-arcgis-hub-discussions-post-s>[slot="editor"]{display:none}.sc-arcgis-hub-discussions-post-h:has(slot-fb[name="metadata"]) .sc-arcgis-hub-discussions-post-s>[slot="metadata"],.sc-arcgis-hub-discussions-post-h:has(slot-fb[name="editor"]) .sc-arcgis-hub-discussions-post-s>[slot="editor"]{display:block}arcgis-hub-discussions-post-chips.sc-arcgis-hub-discussions-post{padding-left:1rem;padding-right:1rem;padding-bottom:0.75rem}header.sc-arcgis-hub-discussions-post{margin-left:1rem;margin-right:1rem;margin-bottom:0.25rem;overflow-wrap:break-word;font-size:var(--calcite-font-size-1);line-height:1.5rem;font-weight:var(--calcite-font-weight-bold);color:var(--calcite-ui-text-1)}arcgis-multiline-ellipsis.sc-arcgis-hub-discussions-post{margin:0px;margin-left:1rem;margin-right:1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}footer.sc-arcgis-hub-discussions-post{display:flex;flex-direction:column}article.sc-arcgis-hub-discussions-post:has(arcgis-hub-discussions-post-geography[data-count="0"]) footer.sc-arcgis-hub-discussions-post:not(:has(arcgis-hub-discussions-post-reactions)){margin-top:0.5rem}footer.sc-arcgis-hub-discussions-post .actions.sc-arcgis-hub-discussions-post{display:flex;justify-content:space-between}footer.sc-arcgis-hub-discussions-post arcgis-hub-discussions-post-reactions.sc-arcgis-hub-discussions-post{margin-left:1rem;margin-right:1rem;margin-top:0.75rem;margin-bottom:0.75rem}arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post{margin-top:0px;margin-bottom:0px;margin-left:0.75rem;margin-right:0.75rem}calcite-notice.sc-arcgis-hub-discussions-post{margin-left:1rem;margin-right:1rem;margin-bottom:1.5rem}footer.sc-arcgis-hub-discussions-post+calcite-notice.sc-arcgis-hub-discussions-post{margin-top:1rem}arcgis-hub-discussions-post-geography[loading].sc-arcgis-hub-discussions-post{margin-left:1rem;margin-right:1rem}#text-actions.sc-arcgis-hub-discussions-post{margin-left:0.5rem}calcite-popover[data-popper-placement][data-popper-reference-hidden].sc-arcgis-hub-discussions-post{pointer-events:auto;opacity:1}calcite-popover.sc-arcgis-hub-discussions-post{pointer-events:auto !important}.discussions-post-action-menu.sc-arcgis-hub-discussions-post:active .discussions-post-action-menu-icon.sc-arcgis-hub-discussions-post{--tw-text-opacity:1;color:rgb(21 21 21 / var(--tw-text-opacity))}.discussions-post-action-menu-options.sc-arcgis-hub-discussions-post:active{--tw-text-opacity:1;color:rgb(21 21 21 / var(--tw-text-opacity))}.discussions-post-action-menu-options.sc-arcgis-hub-discussions-post:active .discussions-post-action-menu-options-icon.sc-arcgis-hub-discussions-post{--tw-text-opacity:1;color:rgb(21 21 21 / var(--tw-text-opacity))}.discussions-post-replies.sc-arcgis-hub-discussions-post:active{--tw-text-opacity:1;color:rgb(21 21 21 / var(--tw-text-opacity))}.discussions-post-replies.sc-arcgis-hub-discussions-post:active .discussions-post-replies-icon.sc-arcgis-hub-discussions-post{--tw-text-opacity:1;color:rgb(21 21 21 / var(--tw-text-opacity))}.actions.sc-arcgis-hub-discussions-post{display:flex;align-items:center}[parent-id].sc-arcgis-hub-discussions-post-h article.sc-arcgis-hub-discussions-post{position:relative;display:grid;grid-template-rows:repeat(1, minmax(0, 1fr));gap:0.75rem;grid-template-columns:2rem auto}[parent-id].sc-arcgis-hub-discussions-post-h arcgis-hub-discussions-post-chips.sc-arcgis-hub-discussions-post{padding-bottom:0px}[parent-id].sc-arcgis-hub-discussions-post-h:has(arcgis-hub-discussions-post-chips:not([data-count="0"])) div.sc-arcgis-hub-discussions-post{grid-row-start:2;grid-row-end:2}[parent-id].sc-arcgis-hub-discussions-post-h article.arcgis-hub-discussions-post-lead.sc-arcgis-hub-discussions-post,[parent-id].sc-arcgis-hub-discussions-post-h .arcgis-hub-discussions-post-lead.sc-arcgis-hub-discussions-post arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post{padding-bottom:1.25rem}[parent-id].sc-arcgis-hub-discussions-post-h arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post{position:relative;z-index:10}[parent-id].sc-arcgis-hub-discussions-post-h article.arcgis-hub-discussions-post-lead.sc-arcgis-hub-discussions-post::before,[parent-id].sc-arcgis-hub-discussions-post-h .arcgis-hub-discussions-post-lead.sc-arcgis-hub-discussions-post arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post::before{position:absolute;top:0px;display:block;height:100%;width:0.125rem;background-color:var(--calcite-ui-foreground-2);left:15px;content:""}[parent-id][index="0"].sc-arcgis-hub-discussions-post-h article.arcgis-hub-discussions-post-lead.sc-arcgis-hub-discussions-post::before,[parent-id][index="0"].sc-arcgis-hub-discussions-post-h .arcgis-hub-discussions-post-lead.sc-arcgis-hub-discussions-post arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post::before{top:2.25rem;height:calc(100% - 2.25rem)}[parent-id][index="0"].sc-arcgis-hub-discussions-post-h article.arcgis-hub-discussions-post-lead.arcgis-hub-discussions-post-last.sc-arcgis-hub-discussions-post::before,[parent-id][index="0"].sc-arcgis-hub-discussions-post-h .arcgis-hub-discussions-post-lead.arcgis-hub-discussions-post-last.sc-arcgis-hub-discussions-post arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post::before{height:0px}[parent-id][index="0"].sc-arcgis-hub-discussions-post-h:has(arcgis-hub-discussions-post-chips[data-count]) article.arcgis-hub-discussions-post-lead.sc-arcgis-hub-discussions-post::before,[parent-id][index="0"].sc-arcgis-hub-discussions-post-h:has(arcgis-hub-discussions-post-chips[data-count]) .arcgis-hub-discussions-post-lead.sc-arcgis-hub-discussions-post arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post::before{top:2.75rem;height:calc(100% - 2.75rem)}[parent-id].sc-arcgis-hub-discussions-post-h:has(arcgis-hub-discussions-post-chips[data-count]) article.arcgis-hub-discussions-post-lead.arcgis-hub-discussions-post-last.sc-arcgis-hub-discussions-post::before,[parent-id].sc-arcgis-hub-discussions-post-h:has(arcgis-hub-discussions-post-chips[data-count]) .arcgis-hub-discussions-post-lead.arcgis-hub-discussions-post-last.sc-arcgis-hub-discussions-post arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post::before{height:2.25rem}[parent-id].sc-arcgis-hub-discussions-post-h:has(arcgis-hub-discussions-post-chips[data-count="0"]) .arcgis-hub-discussions-post-lead.sc-arcgis-hub-discussions-post{padding-top:0.25rem}[parent-id].sc-arcgis-hub-discussions-post-h:has(arcgis-hub-discussions-post-chips[data-count="0"]) article.arcgis-hub-discussions-post-lead.arcgis-hub-discussions-post-last.sc-arcgis-hub-discussions-post::before,[parent-id].sc-arcgis-hub-discussions-post-h:has(arcgis-hub-discussions-post-chips[data-count="0"]) .arcgis-hub-discussions-post-lead.arcgis-hub-discussions-post-last.sc-arcgis-hub-discussions-post arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post::before{height:0px}[parent-id].sc-arcgis-hub-discussions-post-h:has(arcgis-hub-discussions-post-chips) article.arcgis-hub-discussions-post-lead.arcgis-hub-discussions-post-last.sc-arcgis-hub-discussions-post::before,[parent-id].sc-arcgis-hub-discussions-post-h article.arcgis-hub-discussions-post-lead.arcgis-hub-discussions-post-last.sc-arcgis-hub-discussions-post:not(:has(arcgis-hub-discussions-post-chips))::before,[parent-id].sc-arcgis-hub-discussions-post-h:has(arcgis-hub-discussions-post-chips) .arcgis-hub-discussions-post-lead.arcgis-hub-discussions-post-last.sc-arcgis-hub-discussions-post arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post::before,[parent-id].sc-arcgis-hub-discussions-post-h .arcgis-hub-discussions-post-lead.arcgis-hub-discussions-post-last.sc-arcgis-hub-discussions-post:not(:has(arcgis-hub-discussions-post-chips)) arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post::before{height:0px}[parent-id].sc-arcgis-hub-discussions-post-h arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post{margin-left:0px;margin-right:0px}[parent-id].sc-arcgis-hub-discussions-post-h .arcgis-hub-discussions-post-lead.sc-arcgis-hub-discussions-post arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post{padding-bottom:1.5rem}[parent-id].sc-arcgis-hub-discussions-post-h article.arcgis-hub-discussions-post-lead.sc-arcgis-hub-discussions-post arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post::before,[parent-id].sc-arcgis-hub-discussions-post-h .arcgis-hub-discussions-post-lead.sc-arcgis-hub-discussions-post arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post::before{z-index:-10}[parent-id].sc-arcgis-hub-discussions-post-h .arcgis-hub-discussions-post-lead.arcgis-hub-discussions-post-last.sc-arcgis-hub-discussions-post arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post::before,[parent-id][index="0"].sc-arcgis-hub-discussions-post-h:has(arcgis-hub-discussions-post-chips[data-count="0"]) article.arcgis-hub-discussions-post-lead.arcgis-hub-discussions-post-last.sc-arcgis-hub-discussions-post::before{height:0px}[parent-id][index="0"].sc-arcgis-hub-discussions-post-h:has(arcgis-hub-discussions-post-chips[data-count="0"]) article.arcgis-hub-discussions-post-lead.sc-arcgis-hub-discussions-post::before{top:2.25rem;height:calc(100% - 2.25rem)}[parent-id].sc-arcgis-hub-discussions-post-h arcgis-multiline-ellipsis.sc-arcgis-hub-discussions-post{margin-left:0px;margin-right:0px;font-size:var(--calcite-font-size-0);line-height:1.375}[parent-id].sc-arcgis-hub-discussions-post-h calcite-action-group.sc-arcgis-hub-discussions-post{margin-left:-0.5rem}.hidden.sc-arcgis-hub-discussions-post{visibility:hidden}@keyframes in-right{0%{opacity:0;transform:translate3D(-100%, 0, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}article.in.sc-arcgis-hub-discussions-post{animation:in-right 300ms ease-out forwards}@keyframes out-left{0%{opacity:1;transform:translate3D(0, 0, 0)}100%{opacity:0;transform:translate3D(-100%, 0, 0)}}article.out.sc-arcgis-hub-discussions-post{animation:out-left 300ms ease-out forwards}[parent-id].sc-arcgis-hub-discussions-post-h arcgis-hub-discussions-post-editor.sc-arcgis-hub-discussions-post{padding-bottom:1rem}.arcgis-hub-discussions-post-editor-container.sc-arcgis-hub-discussions-post{overflow:visible}@keyframes in-left{0%{opacity:0;transform:translate3D(100%, 0, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}.arcgis-hub-discussions-post-editor-container.in.sc-arcgis-hub-discussions-post{animation:in-left 300ms ease-out forwards}@keyframes out-right{0%{opacity:1;transform:translate3D(0, 0, 0)}100%{opacity:0;transform:translate3D(100%, 0, 0)}}.arcgis-hub-discussions-post-editor-container.out.sc-arcgis-hub-discussions-post{animation:out-right 300ms ease-out forwards}[parent-id].sc-arcgis-hub-discussions-post-h arcgis-hub-discussions-post-editor[post-id][parent-id].sc-arcgis-hub-discussions-post{padding-left:0px;padding-right:0px}[parent-id].sc-arcgis-hub-discussions-post-h arcgis-multiline-ellipsis.sc-arcgis-hub-discussions-post+calcite-notice.sc-arcgis-hub-discussions-post{margin-top:1rem}[parent-id].sc-arcgis-hub-discussions-post-h article.sc-arcgis-hub-discussions-post{padding-top:0.75rem;padding-bottom:0.75rem}[parent-id].sc-arcgis-hub-discussions-post-h article.out-of-context.sc-arcgis-hub-discussions-post{margin-left:1rem;margin-right:1rem;display:grid;gap:0.5rem;font-style:normal;grid-template-columns:1fr}[parent-id].sc-arcgis-hub-discussions-post-h article.out-of-context.sc-arcgis-hub-discussions-post>div.reply-body.sc-arcgis-hub-discussions-post{display:grid;gap:0.25rem}[parent-id].sc-arcgis-hub-discussions-post-h article.out-of-context.sc-arcgis-hub-discussions-post>div.reply-body.sc-arcgis-hub-discussions-post>arcgis-hub-discussions-post-geography.sc-arcgis-hub-discussions-post{margin-left:-1rem}[parent-id].sc-arcgis-hub-discussions-post-h article.out-of-context.sc-arcgis-hub-discussions-post>div.reply-body.sc-arcgis-hub-discussions-post>arcgis-hub-discussions-post-reactions.sc-arcgis-hub-discussions-post{grid-column:span 1 / span 1}[parent-id].sc-arcgis-hub-discussions-post-h arcgis-hub-discussions-popover.sc-arcgis-hub-discussions-post{grid-row:span 2 / span 2;grid-row-start:1;grid-row-end:1}[parent-id].sc-arcgis-hub-discussions-post-h:has(arcgis-hub-discussions-post-chips:not([data-count="0"])) arcgis-hub-discussions-popover.sc-arcgis-hub-discussions-post{grid-row-start:2;grid-row-end:2}[parent-id].sc-arcgis-hub-discussions-post-h arcgis-hub-discussions-post-chips.sc-arcgis-hub-discussions-post{grid-column-start:2;grid-row-start:1;grid-row-end:1;height:1.5rem}[parent-id].sc-arcgis-hub-discussions-post-h calcite-avatar.sc-arcgis-hub-discussions-post{position:relative;margin-top:-0.25rem;padding-top:0.25rem;padding-bottom:0.25rem;background-color:var(--calcite-ui-foreground-1);box-sizing:initial}[parent-id].sc-arcgis-hub-discussions-post-h footer.sc-arcgis-hub-discussions-post{display:grid;grid-template-columns:auto 48px}[parent-id].sc-arcgis-hub-discussions-post-h arcgis-hub-discussions-post-reactions.sc-arcgis-hub-discussions-post{grid-column:span 2 / span 2;margin-top:0.75rem;margin-bottom:0.75rem}[parent-id].sc-arcgis-hub-discussions-post-h calcite-notice.sc-arcgis-hub-discussions-post{margin:0px}';const Ae=class{constructor(s){e(this,s),this.hubTelemetry=t(this,"hubTelemetry",7),this.post=void 0,this.index=void 0,this.channel=void 0,this.activeTooltip=null,r(this,"handleTooltipOpen","renderChip","handleChipMouseEnter","handleChipMouseOut")}async componentWillLoad(){this.intl=await n.loadIntlForComponent(this.element)}handleTooltipOpen(e){const{post:t,channel:s,chipsToRender:i,index:o}=this,{tooltip:{telemetry:a}}=i.find((t=>t.type===e.target.dataset.type));this.hubTelemetry.emit(Object.assign(Object.assign({},a),{postId:t.id,parentId:t.parentId,channelId:s.id,channelAccess:s.access,position:o}))}handleChipMouseEnter(e){this.activeTooltip=e.target.dataset.type}handleChipMouseOut(){this.activeTooltip=null}get chipsToRender(){const{post:e,intl:t}=this,s=[];return e.status===z.HIDDEN&&s.push({appearance:"outline",icon:"view-hide",kind:"neutral",tooltip:{telemetry:c.dictionary.category.interaction.action.open.label.tooltip.details.chipComponentWithStringHidden,text:t.t("chip.hidden.label.moderator")},type:"hidden",value:t.t("chip.hidden.text")}),s}renderChip(e){const{activeTooltip:t,handleTooltipOpen:i}=this;return s(a,null,s("calcite-chip",{appearance:e.appearance,class:"hidden"===e.type&&"end","data-type":e.type,icon:e.icon,id:e.type,kind:e.kind,onMouseEnter:this.handleChipMouseEnter,onMouseOut:this.handleChipMouseOut,scale:"s",value:e.value},e.value),e.tooltip&&s("calcite-tooltip",{"data-type":e.type,label:e.tooltip.text,onCalciteTooltipOpen:i,open:t===e.type,overlayPositioning:"fixed",placement:"bottom",referenceElement:e.type},s("div",{class:"tooltip-body"},e.tooltip.text)))}render(){const{chipsToRender:e,index:t}=this;return s(i,{"data-count":e.length,"data-element":"post-chips","data-index":t},e.map(this.renderChip))}static get assetsDirs(){return["locales"]}get element(){return o(this)}};var Te;Ae.style=':host{display:flex;flex-direction:row;justify-content:flex-start;gap:0.25rem}:host([data-count="0"]){display:none}.end{margin-left:auto}',function(e){e.AUDIENCE="audience",e.CONTENT="content"}(Te||(Te={}));var Ge=function(e,t,s,i){var o,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(n=(a<3?o(n):a>3?o(t,s,n):o(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const ze=class{constructor(s){e(this,s),this.arcgisHubDiscussionsPostEditorReady=t(this,"arcgisHubDiscussionsPostEditorReady",7),this.arcgisHubDiscussionsPostCancel=t(this,"arcgisHubDiscussionsPostCancel",7),this.arcgisHubDiscussionsPostCreate=t(this,"arcgisHubDiscussionsPostCreate",7),this.arcgisHubDiscussionsPostEdit=t(this,"arcgisHubDiscussionsPostEdit",7),this.arcgisHubDiscussionsGeometryDrawCreate=t(this,"arcgisHubDiscussionsGeometryDrawCreate",7),this.arcgisHubDiscussionsGeometryDrawTypeSelect=t(this,"arcgisHubDiscussionsGeometryDrawTypeSelect",7),this.arcgisHubDiscussionsGeometryDrawEdit=t(this,"arcgisHubDiscussionsGeometryDrawEdit",7),this.arcgisHubDiscussionsGeometryDrawReset=t(this,"arcgisHubDiscussionsGeometryDrawReset",7),this.arcgisHubDiscussionsGeometrySelect=t(this,"arcgisHubDiscussionsGeometrySelect",7),this.arcgisHubDiscussionsGeometryDeselect=t(this,"arcgisHubDiscussionsGeometryDeselect",7),this.arcgisHubDiscussionsGeometryClearAll=t(this,"arcgisHubDiscussionsGeometryClearAll",7),this.arcgisHubDiscussionsPostClose=t(this,"arcgisHubDiscussionsPostClose",7),this.hubTelemetry=t(this,"hubTelemetry",7),this.post=void 0,this.postCreator=void 0,this.postCreatorOrg=void 0,this.postId=void 0,this.parent=void 0,this.parentCreator=void 0,this.parentId=void 0,this.channel=void 0,this.channelAccess=void 0,this.channelGroupIds=void 0,this.channelGroups=void 0,this.channelId=void 0,this.entity=void 0,this.entityId=void 0,this.entityType=void 0,this.discussion=void 0,this.displayFieldKey=void 0,this.displayFieldValid=void 0,this.displayFieldValue=void 0,this.locationId=void 0,this.context=void 0,this.hasMap=void 0,this.isHub=void 0,this.unsavedFeatures=[],this.unsavedRelatedFeatures=[],this.unsavedExistingFeatures=[],this.index=void 0,this.isMobile=void 0,this.createParentSaveButtonText=void 0,this.createParentBodyPlaceholderText=void 0,this.showLocations=void 0,this.showHeader=void 0,this.collapsible=void 0,this.collapsed=void 0,this.channelModifiable=void 0,this._unsavedFeatures=[],this._unsavedRelatedFeatures=[],this._unsavedExistingFeatures=[],this.pending=!1,this.loading=void 0,this.titleValue="",this.bodyValue="",this.discussionValue="",this.geometryValue=void 0,this.geometryValueHasChanges=void 0,this.locationActionElement=void 0,this.recentChannelsResults=void 0,this.step=Te.AUDIENCE,this.errorMessage=null,this.confirmCancel=!1,this.addLocationsActiveGeometryType=void 0,this.addLocationsPopoverOpen=void 0,r(this,"handleSubmit","handleCancel","handleCancelOrConfirm","handleConfirmBackButtonClicked","updateTitleValue","handleSelectRecentChannel","handleChannelSelectedFromCombobox","handleBack","focusInput","handleGroupSearchOpened","proceedToContentCreation","setActiveGeometryDrawType","handleReplySubmit","handleHelpPopoverOpen","handleLocationPopoverOpen","handleHelpPopoverClose","handleLocationPopoverClose","handleBodyElementRef","handleTitleElementRef","getMentionQuery")}async componentWillLoad(){const[e]=await Promise.all([n.loadIntlForComponent(this.element),this.initialize(this.context)]);this.intl=e}get isRtl(){return"rtl"===this.intl.direction}get shouldConfirmCancel(){const{titleValue:e,bodyValue:t,post:s,isReply:i}=this;let o;return o=s?i&&t!==s.body:i?t.length>0:e.length>0||t.length>0,o}get postWithLocationEdits(){const{post:e,geometryValue:t,discussionValue:s}=this;let i;return e&&(i=de(e),i.geometry=t,s!==e.discussion&&(i.discussion=s)),i}async fetchDependencies(){const{postId:e,postCreator:t,postCreatorOrg:s,parent:i,parentId:o,post:a,channel:n,channelId:r,context:c,discussion:l,entityId:d,entity:h,entityType:b,displayFieldKey:v,displayFieldValid:f,displayFieldValue:y,isHub:x,channelGroupIds:w,channelAccess:C,locationId:_,parentCreator:k,channelGroups:O}=this,[j,I]=await Promise.all([u({postId:e,post:a},c.hubRequestOptions),N({isHub:x},c.hubRequestOptions)]),[R,P]=await Promise.all([p(Object.assign({postCreator:t,postCreatorOrg:s},j),c.hubRequestOptions),g(Object.assign({parentId:o,parent:i},j),c.hubRequestOptions)]),[F,D,A]=await Promise.all([$(Object.assign(Object.assign({discussion:l,entityId:d,entityType:b,entity:h,displayFieldKey:v,displayFieldValid:f,displayFieldValue:y,locationId:_},j),P),c.hubRequestOptions),K(Object.assign(Object.assign({channelId:r,channel:n,channelGroups:O,channelGroupIds:w,channelAccess:C},j),P),c.hubRequestOptions),m(Object.assign({parentCreator:k},P),c.hubRequestOptions)]);Object.assign(this,j,R,P,A,D,F,I)}async initialize(e,t){var s,i;if((null===(s=null==e?void 0:e.currentUser)||void 0===s?void 0:s.username)!==(null===(i=null==t?void 0:t.currentUser)||void 0===i?void 0:i.username)){this.loading=!0,await this.fetchDependencies();const{post:e,channel:t}=this;if(e){const{title:t,body:s,discussion:i,geometry:o}=e;this.bodyValue=s,e.title&&(this.titleValue=t),this.discussionValue=i;const a=de(o);this.geometryValue=Object.keys(a).length?a:null}t?this.proceedToContentCreation():this.fetchRecentChannelDetails(),this.arcgisHubDiscussionsPostEditorReady.emit(e),this.loading=!1}}async _fetchRecentChannelDetails(){const{context:e}=this;try{const{items:t}=await async function(e,t){const s=await re(Object.assign({data:{num:4,filterBy:E.HAS_USER_POSTS,sortBy:H.LAST_ACTIVITY,sortOrder:L.DESC}},t)),{items:i}=s,o=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(s[i[o]]=e[i[o]])}return s}(s,["items"]),a=await Promise.all(i.map((async s=>{const i=Promise.all(s.groups.map((async e=>{let s;try{s=await ae(e,t)}catch(e){s=null}return s}))),o=q(Object.assign({data:{start:1,num:1,sortBy:M.CREATED_AT,sortOrder:L.DESC,channels:[s.id],creator:e,relations:[G.REACTIONS]}},t)),[a,{items:[n]}]=await Promise.all([i,o]);return{channel:s,channelError:null,channelGroups:a,channelId:s.id,post:n}})));return Object.assign(Object.assign({},o),{items:a.filter((e=>{var t;return!(null===(t=e.channelGroups)||void 0===t?void 0:t.length)||e.channelGroups.every((e=>!e||ce(e)))}))})}(e.currentUser.username,e.hubRequestOptions);return this.hubTelemetry.emit(0===t.length?c.dictionary.category.interaction.action.viewed.label.empty:Object.assign(Object.assign({},c.dictionary.category.interaction.action.viewed.label.recents),{response:c.constants.response.SUCCESS})),t}catch(e){throw this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.interaction.action.viewed.label.recents),{response:c.constants.response.FAILURE})),console.error("Failed to fetch recent channels:",e.message),e}}async fetchRecentChannelDetails(){this.errorMessage=null;try{this.recentChannelsResults=await this._fetchRecentChannelDetails()}catch(e){this.errorMessage="error.load",this.recentChannelsResults=[]}}emitHubTelemetry(e){const{channel:t,channelGroups:s}=this,{groupAccesses:i,groupOrgIds:o}=(null!=s?s:[]).reduce(((e,t)=>t?{groupAccesses:[...e.groupAccesses,t.access],groupOrgIds:[...e.groupOrgIds,t.orgId]}:e),{groupAccesses:[],groupOrgIds:[]});this.hubTelemetry.emit(Object.assign(Object.assign({},e),{channelAccess:t.access,channelId:t.id,groupAccess:i.filter(Boolean).join(", "),groupId:t.groups.join(", "),groupOrgId:o.filter(Boolean).join(", "),orgId:t.orgs.join(", ")}))}formatTimeString(e){const t=Date.now()-new Date(e).valueOf(),s=Math.floor(t/oe.DAY);return this.intl.formatRelativeTime(-s,ie.DAY)}handleSelectRecentChannel(e){const t=e.target.dataset.channelIndex;this.channel=this.recentChannelsResults[t].channel,this.channelGroups=this.recentChannelsResults[t].channelGroups,this.emitHubTelemetry(Object.assign(Object.assign({},c.dictionary.category.interaction.action.select.label.groups.details.recents),{position:t})),this.proceedToContentCreation()}handleChannelSelectedFromCombobox(){this.emitHubTelemetry(c.dictionary.category.interaction.action.select.label.groups),this.proceedToContentCreation()}proceedToContentCreation(){this.step=Te.CONTENT}async handleComboboxChange(e){const{context:t}=this,{selectedItems:s}=e.target;if(s.length){const[{value:e}]=s,[i,{items:[o]}]=await Promise.all([ae(e,t.hubRequestOptions),re(Object.assign({data:{num:1,groups:[e],access:[A.PRIVATE]}},t.hubRequestOptions))]);o?(this.channel=o,this.channelGroups=[i],this.channelId=o.id):(this.channel={access:A.PRIVATE,groups:[i.id],orgs:[t.currentUser.orgId]},this.channelGroups=[i],this.channelId=null),this.emitHubTelemetry(c.dictionary.category.interaction.action.select.label.groups)}else this.emitHubTelemetry(c.dictionary.category.interaction.action.deselect.label.groups),this.channel=null,this.channelGroups=null,this.channelId=null}handleGeometryValueUpdated(){if(this.post){const{post:{geometry:e},geometryValue:t}=this;this.geometryValueHasChanges=JSON.stringify(t)!==JSON.stringify(e)}}mapFeaturePropToState(e){var t;const{postId:s,post:i}=this;if(e.length){const o=null===(t=e[0].properties)||void 0===t?void 0:t.id;(s===o||!i&&!o)&&(this._unsavedFeatures=e.filter((({properties:e})=>!(null==e?void 0:e.pending))),this.resetActiveGeometryDrawType())}else this._unsavedFeatures=[]}mapExistingFeaturePropToState(e){var t;const{postId:s}=this;e.length?s===(null===(t=e[0].properties)||void 0===t?void 0:t.id)&&(this._unsavedExistingFeatures=e,e.forEach((e=>{const{geometry:t,properties:s}=e;t||this.removeFeature(s.index,null,!1)})),this.resetActiveGeometryDrawType()):this._unsavedExistingFeatures=[]}mapRelatedFeaturePropToState(e){const{postId:t}=this;if(e.length){const s=e[0].postId;(t===s||!t&&!s)&&(this._unsavedRelatedFeatures=e,this.resetActiveGeometryDrawType())}else this._unsavedRelatedFeatures=[]}handleAddLocationsActiveGeometryTypeChanged(e){e&&this.arcgisHubDiscussionsGeometryDrawTypeSelect.emit(e)}handleSubmit(e){e.preventDefault();const t=this.postId?this.handleEdit():this.handleCreate();return this.pending=!0,t.finally((()=>{this.pending=!1,this.arcgisHubDiscussionsGeometryClearAll.emit(),this.addLocationsActiveGeometryType=null}))}async handleCreate(){var e;const{context:t,_unsavedFeatures:s,_unsavedRelatedFeatures:i,bodyValue:o,titleValue:a,channelId:n,channelGroups:r,discussion:l,entity:{url:d},arcgisHubDiscussionsPostCreate:h}=this;let{channel:u}=this,p=l;if(i.length){const e=d.split("/").pop(),t=new Set(i.map((e=>e.objectId)));p=x(p,e,Array.from(t))}let g,m=null;s.length&&(m=s.length>1?w(s):s[0].geometry),this.errorMessage=null;const b=(null==u?void 0:u.id)?{channelId:u.id}:{access:(null==u?void 0:u.access)||A.PRIVATE,groups:(null==u?void 0:u.groups)||[]};try{const{id:s}=await Y(Object.assign({data:Object.assign(Object.assign({},b),{discussion:p,title:a.trim()||void 0,body:o.trim(),geometry:m}),mentionUrl:window.location.href},t.hubRequestOptions));g=await X(Object.assign({postId:s,data:{relations:[G.REACTIONS]}},this.context.hubRequestOptions)),g.replyCount=0,u=await he(Object.assign({channelId:g.channelId},t.hubRequestOptions));const i=C(u,r);return u.creator===t.currentUser.username&&u.creator!==i&&await ue(Object.assign({channelId:g.channelId,data:{creator:i}},t.hubRequestOptions)),this.titleValue="",this.bodyValue="",this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.content.action.create.label.post),{response:c.constants.response.SUCCESS,details:null!==(e=g.title)&&void 0!==e?e:null,groupId:u.groups.join(", "),postId:g.id,channelId:u.id,channelAccess:u.access})),h.emit(g),this.focusInput(),g}catch(e){return this.errorMessage="error.create",this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.content.action.create.label.post),{response:c.constants.response.FAILURE,groupId:null==u?void 0:u.groups.join(", "),channelId:n,channelAccess:null==u?void 0:u.access})),console.error("Failed to create post:",e.message),null}}handleEdit(){const{context:e,bodyValue:t,titleValue:s,channelId:i,channel:o,post:a,_unsavedFeatures:n,_unsavedExistingFeatures:r,_unsavedRelatedFeatures:l,arcgisHubDiscussionsPostEdit:d,entity:{url:h}}=this;this.errorMessage=null;let u=this.discussionValue;if(l.length){const e=h.split("/").pop(),t=l.map((e=>e.objectId));u=x(u,e,t)}const p=this.geometryValue&&Object.keys(this.geometryValue).length?_(Object.assign(Object.assign({},a),{geometry:this.geometryValue})):[];r.forEach((e=>{const{properties:{index:t},geometry:s}=e;s&&(p[+t].geometry=s)}));let g=null;const m=[...p,...n];return m.length&&(g=m.length>1?w(m):m[0].geometry.coordinates.length?m[0].geometry:null),Z(Object.assign({postId:a.id,data:{title:s.trim()||null,body:t.trim(),discussion:u,geometry:g},mentionUrl:window.location.href},e.hubRequestOptions)).then((e=>X(Object.assign({postId:e.id,data:{relations:[G.REACTIONS,G.REPLIES]}},this.context.hubRequestOptions)))).then((e=>(this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.content.action.update.label.post),{response:c.constants.response.SUCCESS,postId:a.id,channelId:i,channelAccess:o.access})),e.replyCount=e.replies.total,delete e.replies,d.emit(e),e))).catch((e=>(this.errorMessage="error.edit",this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.content.action.update.label.post),{response:c.constants.response.FAILURE,postId:a.id,channelId:i,channelAccess:o.access})),console.error("Failed to edit post:",e.message),null)))}handleCancel(e){var t,s,i,o,a,n,r,l,d,h,u,p;const{channel:g,post:m,parent:b,channelGroups:v,channelModifiable:f}=this;e.preventDefault(),this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.interaction.action.close.label.editor),{groupId:null!==(s=null===(t=null==v?void 0:v[0])||void 0===t?void 0:t.id)&&void 0!==s?s:null,groupAccess:null!==(i=null==v?void 0:v[0].access)&&void 0!==i?i:null,parentId:null!==(o=null==b?void 0:b.id)&&void 0!==o?o:null,postId:null!==(a=null==m?void 0:m.id)&&void 0!==a?a:null,channelId:null!==(n=null==g?void 0:g.id)&&void 0!==n?n:null,channelAccess:null!==(r=null==g?void 0:g.access)&&void 0!==r?r:null}));const y=this.arcgisHubDiscussionsPostCancel.emit();this.collapse(),this.confirmCancel=!1;const x=de(null==m?void 0:m.geometry);this.geometryValue=Object.keys(x||{}).length?x:null,this.titleValue=null!==(l=null==m?void 0:m.title)&&void 0!==l?l:"",this.bodyValue=null!==(d=null==m?void 0:m.body)&&void 0!==d?d:"",this._unsavedExistingFeatures=null!==(h=this.unsavedExistingFeatures)&&void 0!==h?h:[],this._unsavedFeatures=null!==(u=this.unsavedFeatures)&&void 0!==u?u:[],this._unsavedRelatedFeatures=null!==(p=this.unsavedRelatedFeatures)&&void 0!==p?p:[],y.defaultPrevented||!m&&f&&(this.channelId=null,this.channel=null,this.channelGroups=null,this.step=Te.AUDIENCE)}handleCancelOrConfirm(e){this.shouldConfirmCancel?this.confirmCancel=!0:this.handleCancel(e),this.arcgisHubDiscussionsGeometryClearAll.emit()}handleStepChanged(e,t){e!==t&&e===Te.AUDIENCE?this.fetchRecentChannelDetails():this.recentChannelsResults=void 0}handleConfirmBackButtonClicked(){this.confirmCancel=!1}handleBack(){this.shouldConfirmCancel?this.confirmCancel=!0:(this.emitHubTelemetry(Object.assign({},c.dictionary.category.interaction.action.close.label.editor.details.addPost)),this.channelId=null,this.channelGroups=null,this.channel=null,this.step=Te.AUDIENCE)}handleHelpPopoverOpen(){this.hubTelemetry.emit(c.dictionary.category.interaction.action.open.label.popover.details.help)}handleHelpPopoverClose(){this.hubTelemetry.emit(c.dictionary.category.interaction.action.close.label.popover.details.help)}handleLocationPopoverOpen(){this.addLocationsPopoverOpen=!0}handleLocationPopoverClose(){this.addLocationsPopoverOpen=!1}handleFocusin(){this.expand()}expand(){this.collapsible&&(this.collapsed=!1)}collapse(){this.collapsible&&(this.collapsed=!0)}handleFocusout(){this.collapse()}handleGroupSearchOpened(){this.hubTelemetry.emit(c.dictionary.category.interaction.action.open.label.search)}updateBodyValue(e){this.bodyValue=e.target.value}handleFeatureRemove(e){const{detail:{properties:{relatedFeatureId:t,index:s,unsaved:i}}}=e;this.removeFeature(s,t,i)}removeFeature(e,t,s){var i;if(!s)if(t){const{features:e}=k(this.discussionValue),s=this.entity.url.split("/").pop();e.splice(e.indexOf(t),1),this.discussionValue=x(this.discussionValue.split("?")[0],s,e)}else"GeometryCollection"===(null===(i=this.geometryValue)||void 0===i?void 0:i.type)?(s?this.geometryValue.geometries.splice(e,1):this.geometryValue.geometries[e]=null,this.geometryValue=Object.assign({},this.geometryValue)):this.geometryValue=null}handleDrawDone(){this.arcgisHubDiscussionsGeometryDrawReset.emit(),this.addLocationsActiveGeometryType=null}handleDrawCancel(){this.addLocationsActiveGeometryType=null}updateTitleValue(e){this.titleValue=e.target.value}setActiveGeometryDrawType(e){const{target:t}=e;this.addLocationsActiveGeometryType=t.dataset.type,this.locationPopoverElement.open=!1,this.enableAddLocation()}resetActiveGeometryDrawType(){this.addLocationsActiveGeometryType=void 0}enableAddLocation(){const{post:e,arcgisHubDiscussionsGeometryDrawCreate:t,isReply:s}=this;t.emit({post:e,postType:s?"reply":"post"})}get isTitleValid(){const{titleValue:e}=this;return e.length<=O}get isBodyValid(){const{bodyValue:e}=this,t=e.trim();return t.length>0&&t.length<=j}get hasLocationChanges(){if(this.post){const{post:{discussion:e},discussionValue:t}=this;return Boolean(this._unsavedFeatures.length+this._unsavedRelatedFeatures.length+this._unsavedExistingFeatures.length)||t!==e||this.geometryValueHasChanges}return!1}get titleMessage(){const{titleValue:e,isTitleValid:t,intl:s}=this,{length:i}=e;if(i>=O-5)return t?{status:"idle",text:s.t("post.title.validation.warning")}:{icon:"exclamation-mark-circle",status:"invalid",text:s.t("post.title.validation.error",{characters:i-O})}}get bodyMessage(){const{bodyValue:e,isBodyValid:t,intl:s}=this,{length:i}=e;if(i>=I)return t?{status:"idle",text:s.t("post.body.validation.warning")}:{icon:"exclamation-mark-circle",status:"invalid",text:s.t("post.body.validation.error")}}get isReply(){return Boolean(this.parent||this.parentId)}get blockedNotice(){let e;const{channelGroups:t,entity:s,entityType:i,isReply:o}=this;if(t){const a=!(null==t?void 0:t.length)||t.every((e=>!e||ce(e))),n=ce(s);a||n?a?n||(e="group"===i?o?v.EditReplyGroup:v.EditPostGroup:o?v.EditReplyItem:v.EditPostItem):e=o?v.EditReplyGroup:v.EditPostGroup:e=o?v.EditReply:v.EditPost}return e}getMentionQuery(e){var t;const{channel:s,context:i}=this;return le([e],s,null===(t=i.currentUser)||void 0===t?void 0:t.username)}renderPrimaryActionButton(){const{post:e,isReply:t,intl:i,titleValue:o,bodyValue:a,isBodyValid:n,isTitleValid:r,pending:c,hasLocationChanges:l,blockedNotice:d,createParentSaveButtonText:h}=this;let u,p;t?(p=!n,u=i.t("createReply")):(p=!n||!r,u=h||i.t("post.create"));let g=Boolean(d)||p;return e&&(t?(u=i.t("saveReply"),g=g||a===e.body&&!l):(u=i.t("post.save"),g=g||(!o&&!e.title||o===e.title)&&a===e.body&&!l)),s("calcite-button",{appearance:"solid",class:"hub-discussions-post-editor-post-actions__primary",disabled:g,key:"primary",kind:"brand",label:u,loading:c,round:!0,scale:"l",type:"submit"},u)}renderSecondaryActionButton(){const{post:e,isReply:t,intl:i,handleCancelOrConfirm:o}=this,a=i.t("cancel");if(!t||t&&e)return s("calcite-button",{appearance:"transparent",class:"hub-discussions-post-editor-post-actions__secondary",kind:"neutral",label:a,onClick:o,round:!0,scale:"l",type:"reset"},a)}renderAddLocationsButton(){const{showLocations:e,hasMap:t,blockedNotice:i,addLocationsActiveGeometryType:o,intl:n,addLocationsPopoverOpen:r,handleLocationPopoverOpen:c,handleLocationPopoverClose:l}=this;if(e){const e=[{type:"select",icon:"select"},{type:"point",icon:"pin"},{type:"polyline",icon:"freehand"},{type:"polygon",icon:"freehand-area"}].map((({type:e,icon:t})=>s("calcite-action",{active:o===e,"data-type":e,icon:t,key:e,onClick:this.setActiveGeometryDrawType,text:n.t(`location.action.${e}`),textEnabled:!0})));return s(a,null,s("calcite-action",{active:r,appearance:"solid",class:"add-location-post",disabled:!t||Boolean(i),ref:e=>{this.locationActionElement=e},text:n.t("location.heading")},s("calcite-icon",{class:"add-location-icon",icon:"pin-plus",scale:"s"})),s("calcite-tooltip",{closeOnClick:!0,label:n.t("location.tooltip"),referenceElement:this.locationActionElement},s("span",null,n.t("location.tooltip"))),t&&!i&&s("calcite-popover",{autoClose:!0,label:n.t("location.heading"),onCalcitePopoverClose:l,onCalcitePopoverOpen:c,overlayPositioning:"fixed",pointerDisabled:!0,ref:e=>{this.locationPopoverElement=e},referenceElement:this.locationActionElement},e))}}renderTitleField(){const{collapsible:e,collapsed:t,intl:i,titleValue:o,updateTitleValue:n,titleMessage:r,blockedNotice:c}=this;if(!e||e&&!t)return s(a,null,s("input",{"aria-label":i.t("post.title.label"),class:"hub-discussions-post-editor__title",disabled:Boolean(c),onInput:n,placeholder:i.t("post.title.placeholder"),ref:this.handleTitleElementRef,type:"text",value:o}),r&&s("calcite-input-message",{class:"hub-discussions-post-editor__message",icon:r.icon,scale:"l",status:r.status},r.text))}renderBodyField(){const{createParentBodyPlaceholderText:e,intl:t,bodyValue:i,bodyMessage:o,pending:n,getMentionQuery:r,blockedNotice:c}=this;return s(a,null,s("arcgis-hub-rich-text",{class:"hub-discussions-post-editor__body",disabled:Boolean(c)||n,getMentionQuery:r,label:t.t("post.body.label"),mention:!0,mentionCount:100,placeholder:e||t.t("post.body.placeholder"),ref:this.handleBodyElementRef,"text-transform":!0,toolbar:"",value:i}),o&&s("calcite-input-message",{class:"hub-discussions-post-editor__message",icon:o.icon,scale:"l",status:o.status},o.text))}renderPostHeader(e,t,i,o,a,n,r,c){const{postId:l,post:d,postCreator:h,postCreatorOrg:u,channel:p,channelGroups:g,index:m,isHub:b,context:v}=this;return s("arcgis-hub-discussions-post-header",{channel:p,channelGroups:g,class:"hub-discussions-post-editor__header",context:v,iconScale:e,index:m,isHub:b,post:l&&p&&d,postCreator:l&&p&&h,postCreatorOrg:l&&p&&u,showChannelAccessIcon:o,showChannelAvatar:i,showChannelName:a,showCreatorAvatar:t,showCreatorUsername:r,showPopover:c,showTimestamp:n})}renderContentStep(){const{intl:e,post:t,errorMessage:i,blockedNotice:o,isCollapsed:a,showHeader:n}=this;return this.confirmCancel?this.renderConfirmCancel():s("form",{onSubmit:this.handleSubmit},Boolean(n&&t)&&s("header",null,e.t("editPost")),a?this.renderPostHeader("m",!0):this.renderPostHeader("l",!0,!0,!0,!0,!0,!1,!0),this.renderTitleField(),this.renderBodyField(),this.renderGeographies(),s("div",{class:"hub-discussions-post-editor-post-actions"},this.renderAddLocationsButton(),!a&&this.renderSecondaryActionButton(),this.renderPrimaryActionButton()),o&&s("arcgis-hub-discussions-blocked-notice",{class:"hub-discussions-post-editor__not-discussable-notice",scale:"s",variant:o}),i&&s("calcite-notice",{class:"hub-discussions-post-editor__crud-error",kind:"danger",open:!0,scale:"s"},s("div",{slot:"title"},e.t("error.title")),s("div",{slot:"message"},i&&e.t(i))))}renderHeader(){const{showHeader:e,intl:t,handleCancelOrConfirm:i,handleBack:o,confirmCancel:a,step:n,handleHelpPopoverOpen:r,handleHelpPopoverClose:c}=this;if(e){let e={action:i,icon:"x"};return n===Te.CONTENT&&(e={action:o,icon:"chevron-left"}),s("header",{class:"hub-discussions-post-editor-header"},Boolean(e)&&s("calcite-button",{appearance:"outline-fill",disabled:a,"icon-start":e.icon,kind:"neutral",label:t.t(`header.${n}.back`),onClick:e.action,round:!0,scale:"l",type:"button"}),s("p",{class:"hub-discussions-post-editor-header__title"},t.t(`header.${n}.title`)),s("calcite-button",{appearance:"transparent",disabled:a,"icon-start":"lightbulb",kind:"neutral",label:t.t("header.help"),ref:e=>{this.helpButtonRef=e},round:!0,scale:"l",type:"button"}),s("calcite-popover",{closable:!0,label:t.t("header.help"),onCalcitePopoverClose:c,onCalcitePopoverOpen:r,placement:"bottom-end",referenceElement:this.helpButtonRef},s("p",{class:"hub-discussions-post-editor-header__popover"},t.t(`header.${n}.help`))))}}renderConfirmCancel(){const{intl:e,handleConfirmBackButtonClicked:t,handleCancel:i,isReply:o}=this;return s("div",{class:"hub-discussions-post-editor-cancel-confirm"},s("header",{class:"hub-discussions-post-editor-cancel-confirm__header"},e.t("confirm.header")),s("p",{class:"hub-discussions-post-editor-cancel-confirm__message"},e.t(o?"confirm":"confirm.body")),s("footer",{class:"hub-discussions-post-editor-cancel-confirm__footer"},s("calcite-button",{appearance:"transparent",class:"hub-discussions-post-editor-cancel-confirm__button",kind:"neutral",onClick:t,round:!0,scale:"l"},e.t("confirm.back")),s("calcite-button",{class:"hub-discussions-post-editor-cancel-confirm__button",kind:"danger",onClick:i,round:!0,scale:"l"},e.t("confirm.discard"))))}renderGroupSelectionStep(){const{intl:e,channelGroups:t,handleChannelSelectedFromCombobox:i,context:o}=this;return s(a,null,s("calcite-combobox",{"clear-disabled":!0,label:e.t("groups.label"),placeholder:e.t("groups.placeholder"),scale:"l","selection-mode":"single",value:t?t[0].id:null},o.currentUser.groups.map((e=>{const t=ce(e);return s("calcite-combobox-item",{disabled:!t,icon:t?void 0:"circle-disallowed",key:e.id,textLabel:e.title,value:e.id})}))),(null==t?void 0:t.length)&&s("calcite-button",{class:"hub-discussions-post-editor-groups__action",onClick:i,round:!0,scale:"l",type:"button",width:"full"},e.t("groups.label")),this.renderRecentChannels())}renderRecentChannelDetails(e,t){const{intl:i,handleSelectRecentChannel:o}=this,{post:a,channel:n,channelGroups:r}=e,c=a?i.t("groups.posted",{timeStr:this.formatTimeString(a.createdAt)}):i.t("groups.created",{timeStr:this.formatTimeString(n.createdAt)});return s("li",{class:"hub-discussions-post-editor-recent__item",key:n.id},s("calcite-avatar",{class:"hub-discussions-post-editor-recent__avatar","full-name":f(n,r,i.t("unnamedChannel")),scale:"l"}),s("b",{class:"hub-discussions-post-editor-recent__title"},f(n,r,i.t("unnamedChannel"))),s("i",{class:"hub-discussions-post-editor-recent__last-activity"},c),s("calcite-button",{appearance:"outline-fill",class:"hub-discussions-post-editor-recent__action","data-channel-index":t,"icon-start":"chevron-right",kind:"neutral",onClick:o,round:!0,scale:"l",type:"button"}))}renderRecentChannelSkeleton(e){return s("li",{class:"hub-discussions-post-editor-recent__skeleton",key:`skeleton-${e}`},s("arcgis-skeleton-loader",{active:!0,rows:0,showFooter:!1,showHeading:!1,showThumbnail:!1},s("div",null),s("div",null,s("div",null),s("div",null))))}renderRecentChannelsEmpty(){const{intl:e}=this;return s("calcite-notice",{class:"hub-discussions-post-editor__empty",open:!0,scale:"m"},s("div",{slot:"title"},e.t("empty.title")),s("div",{slot:"message"},e.t("empty.message")),s("calcite-link",{href:"https://doc.arcgis.com/en/hub/team/how-discussions-work.htm",iconEnd:"launch",slot:"link"},e.t("empty.link")))}renderRecentChannelsError(){const{errorMessage:e,intl:t}=this;return s("calcite-notice",{class:"hub-discussions-post-editor__load-error",kind:"danger",open:!0},s("div",{slot:"title"},t.t("error.load.title")),s("div",{slot:"message"},e&&t.t(e)))}renderRecentChannels(){const{intl:e,errorMessage:t,recentChannelsResults:i=Array.from({length:4}).map((()=>null))}=this;let o;return o=t?this.renderRecentChannelsError():i.length?s("ul",{class:"hub-discussions-post-editor-recent__list"},i.map(((e,t)=>e?this.renderRecentChannelDetails(e,t):this.renderRecentChannelSkeleton(t)))):this.renderRecentChannelsEmpty(),s(a,null,s("header",{class:"hub-discussions-post-editor-recent__header"},e.t("recentChannels")),o)}renderCreate(){return s(a,null,this.renderHeader(),this.step===Te.AUDIENCE?this.renderGroupSelectionStep():this.renderContentStep())}renderPostEditor(){return this.postId?this.renderContentStep():this.renderCreate()}render(){const{isReply:e,context:t,loading:o,isRtl:a}=this;return s(i,{class:{rtl:a},"data-element":"discussions-post-editor"},Boolean(t)&&!o&&(e?this.renderReplyEditor():this.renderPostEditor()))}get isCollapsed(){return this.collapsible&&this.collapsed}get inputMessage(){const{bodyValue:e,isBodyValid:t,intl:s}=this;if(e.trim().length>=I)return t?{status:"idle",text:s.t("reply.body.validation.warning")}:{icon:"exclamation-mark-circle",status:"invalid",text:s.t("reply.body.validation.error")}}handleTitleElementRef(e){this.titleElement=e}handleBodyElementRef(e){this.bodyElement=e}focusInput(){setTimeout((()=>{const{titleElement:e,bodyElement:t,isReply:s}=this;s?t&&t.setFocus():e&&e.focus()}),500)}handleReplySubmit(e){return e.preventDefault(),this.pending=!0,(this.postId?this.handleEditReply():this.handleCreateReply()).catch((e=>(console.error("Could not create reply:",e.message),null))).finally((async()=>{this.pending=!1,this.arcgisHubDiscussionsGeometryClearAll.emit(),this.addLocationsActiveGeometryType=null,this.focusInput()}))}handleCreateReply(){const{context:e,_unsavedFeatures:t,_unsavedRelatedFeatures:s,bodyValue:i,parent:o,channel:a,discussion:n,entity:{url:r},arcgisHubDiscussionsPostCreate:l}=this;let d=n;if(s.length){const e=r.split("/").pop(),t=new Set(s.map((e=>e.objectId)));d=x(d,e,Array.from(t))}let h=null;return t.length&&(h=t.length>1?w(t):t[0].geometry),this.errorMessage=null,ee(Object.assign({postId:o.id,data:{discussion:d,body:i.trim(),geometry:h},mentionUrl:window.location.href},e.hubRequestOptions)).then((t=>(this.bodyValue="",this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.content.action.create.label.reply),{response:c.constants.response.SUCCESS,postId:t.id,parentId:o.id,channelId:a.id,channelAccess:a.access})),X(Object.assign({postId:t.id,data:{relations:[G.REACTIONS]}},e.hubRequestOptions))))).then((e=>(e.replyCount=0,l.emit(e),e))).catch((e=>(this.errorMessage="createFailure",this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.content.action.create.label.reply),{response:c.constants.response.FAILURE,parentId:o.id,channelId:a.id,channelAccess:a.access})),console.error("Failed to create reply:",e.message),null)))}handleEditReply(){const{context:e,bodyValue:t,post:s,parentId:i,channel:o,arcgisHubDiscussionsPostEdit:a,_unsavedFeatures:n,_unsavedRelatedFeatures:r,_unsavedExistingFeatures:l,entity:{url:d}}=this;this.errorMessage=null;let h=this.discussionValue;if(r.length){const e=d.split("/").pop(),t=r.map((e=>e.objectId));h=x(h,e,t)}const u=this.geometryValue&&Object.keys(this.geometryValue).length?_(Object.assign(Object.assign({},s),{geometry:this.geometryValue})):[];l.forEach((e=>{const{properties:{index:t},geometry:s}=e;s&&(u[+t].geometry=s)}));let p=null;const g=[...u,...n];return g.length&&(p=g.length>1?w(g):g[0].geometry.coordinates.length?g[0].geometry:null),Z(Object.assign({postId:s.id,data:{body:t.trim(),discussion:h,geometry:p},mentionUrl:window.location.href},e.hubRequestOptions)).then((t=>X(Object.assign({postId:t.id,data:{relations:[G.REACTIONS]}},e.hubRequestOptions)))).then((e=>(e.replyCount=0,this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.content.action.update.label.reply),{response:c.constants.response.SUCCESS,postId:s.id,parentId:i,channelId:o.id,channelAccess:o.access})),a.emit(e),e))).catch((e=>(this.errorMessage="editFailure",this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.content.action.update.label.reply),{response:c.constants.response.FAILURE,postId:s.id,parentId:i,channelId:o.id,channelAccess:o.access})),console.error("Failed to edit reply:",e.message),null)))}renderInput(){const{bodyValue:e,inputMessage:t,pending:i,intl:o,parentCreator:n,getMentionQuery:r,blockedNotice:c}=this,l=(null==n?void 0:n.firstName)?o.t("replyToUserPost",{firstName:n.firstName}):o.t("replyToPost");return s(a,null,s("arcgis-hub-rich-text",{class:"hub-discussions-reply-editor__body",disabled:Boolean(c)||i,getMentionQuery:r,label:o.t("inputLabel"),mention:!0,mentionCount:100,placeholder:l,ref:this.handleBodyElementRef,"text-transform":!0,toolbar:"",value:e}),t&&s("calcite-input-message",{class:"hub-discussions-reply-editor__message",icon:t.icon,scale:"l",status:t.status},t.text))}renderGeographies(){const{channelId:e,channel:t,context:i,hasMap:o,postWithLocationEdits:a,_unsavedFeatures:n,_unsavedRelatedFeatures:r,_unsavedExistingFeatures:c,displayFieldValid:l,displayFieldKey:d,blockedNotice:h,isMobile:u,parentId:p,entity:g,showLocations:m}=this;if(m)return s("arcgis-hub-discussions-post-geography",{channel:t,channelId:e,context:i,disabled:!o,disabledActions:Boolean(h),displayFieldKey:d,displayFieldValid:l,hasMap:o,isMobile:u,parentId:p,post:a,postId:null==a?void 0:a.id,renderedInEditor:!0,showLocationDescriptionText:!u,unsavedExistingFeatures:c,unsavedFeatures:n,unsavedRelatedFeatures:r,url:null==g?void 0:g.url})}renderEditor(){const{intl:e,errorMessage:t,blockedNotice:i}=this;return s(a,null,this.renderInput(),this.renderGeographies(),s("div",{class:"hub-discussions-post-editor-post-actions"},this.renderAddLocationsButton(),this.renderSecondaryActionButton(),this.renderPrimaryActionButton()),i&&s("arcgis-hub-discussions-blocked-notice",{class:"hub-discussions-reply-editor__not-discussable-notice",scale:"s",variant:i}),t&&s("calcite-notice",{class:"hub-discussions-reply-editor__notice",kind:"danger",open:!0,scale:"s"},s("div",{slot:"title"},e.t("error")),s("div",{slot:"message"},e.t(t))))}renderReplyEditor(){const{confirmCancel:e}=this;return s("form",{class:"hub-discussions-reply-editor__form",onSubmit:this.handleReplySubmit},this.renderPostHeader("m",!0),e?this.renderConfirmCancel():this.renderEditor())}static get assetsDirs(){return["locales"]}get element(){return o(this)}static get watchers(){return{context:["initialize"],geometryValue:["handleGeometryValueUpdated"],unsavedFeatures:["mapFeaturePropToState"],unsavedExistingFeatures:["mapExistingFeaturePropToState"],unsavedRelatedFeatures:["mapRelatedFeaturePropToState"],addLocationsActiveGeometryType:["handleAddLocationsActiveGeometryTypeChanged"],step:["handleStepChanged"]}}};Ge([W({delay:300})],ze.prototype,"_fetchRecentChannelDetails",null),Ge([ne({when(){return!this.isMobile}})],ze.prototype,"renderAddLocationsButton",null),ze.style="arcgis-hub-discussions-post-editor:not([parent-id]){display:block;border-radius:0.25rem;background-color:var(--calcite-ui-foreground-1);padding:0.75rem;--tw-shadow:0 2px 8px 0 rgba(0, 0, 0, 0.12);--tw-shadow-colored:0 2px 8px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.hub-discussions-post-editor-header{margin-bottom:1.5rem;display:grid;grid-template-rows:repeat(1, minmax(0, 1fr));align-items:center;column-gap:0.75rem;grid-template-columns:44px auto 44px}.hub-discussions-post-editor-header__title{margin:0px;text-align:center;font-size:var(--calcite-font-size-1);line-height:1.5rem;font-weight:var(--calcite-font-weight-bold);color:var(--calcite-ui-text-1)}.hub-discussions-post-editor-header__popover{padding:1rem;margin-top:revert;margin-bottom:revert}.hub-discussions-post-editor-recent__header{margin-top:1.5rem;margin-bottom:0.75rem;font-size:var(--calcite-font-size--1);line-height:1rem;font-weight:var(--calcite-font-weight-bold);color:var(--calcite-ui-text-1)}.hub-discussions-post-editor-groups__action{margin-top:0.75rem}.hub-discussions-post-editor-recent__list{margin-top:0px;margin-bottom:0px;list-style-type:none;padding:0px}.hub-discussions-post-editor-recent__item{margin-bottom:0.75rem;margin-top:0px;display:grid;grid-auto-flow:column;grid-template-rows:repeat(2, minmax(0, 1fr));column-gap:0.75rem;grid-template-columns:44px auto 44px}.hub-discussions-post-editor-recent__item:last-child{margin-bottom:0px}.hub-discussions-post-editor-recent__avatar{grid-row:span 2 / span 2}.hub-discussions-post-editor-recent__title{font-weight:var(--calcite-font-weight-bold);overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1}.hub-discussions-post-editor-recent__last-activity{font-size:var(--calcite-font-size--1);line-height:1rem;font-style:normal;color:var(--calcite-ui-text-2)}.hub-discussions-post-editor-recent__action{grid-row:span 2 / span 2}.hub-discussions-post-editor-post-actions,.hub-discussions-post-editor-geometry-actions{margin-top:1rem;display:flex;justify-content:flex-end}.hub-discussions-post-editor-post-actions>calcite-action{margin-right:auto}.hub-discussions-post-editor-geometry-actions__feature,.hub-discussions-post-editor-geometry-actions__related,.hub-discussions-post-editor-post-actions__primary,.hub-discussions-post-editor-post-actions__secondary{margin-left:0.75rem}arcgis-hub-discussions-post-editor.rtl .hub-discussions-post-editor-geometry-actions__feature,arcgis-hub-discussions-post-editor.rtl .hub-discussions-post-editor-geometry-actions__related,arcgis-hub-discussions-post-editor.rtl .hub-discussions-post-editor-post-actions__primary,arcgis-hub-discussions-post-editor.rtl .hub-discussions-post-editor-post-actions__secondary{margin-left:0px;margin-right:0.75rem}.hub-discussions-post-editor__title{margin:0px;margin-top:1rem;height:auto;width:100%;resize:none;border-style:none;background-color:var(--calcite-ui-foreground-1);padding:0px;font-size:var(--calcite-font-size-1);line-height:1.5rem;font-weight:var(--calcite-font-weight-bold);color:var(--calcite-ui-text-1);--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.hub-discussions-post-editor__title:focus{--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);outline:2px solid transparent;outline-offset:2px}.hub-discussions-post-editor .hub-discussions-post-editor__title::placeholder{color:var(--calcite-ui-text-3);opacity:1}.hub-discussions-post-editor__body{margin-top:0.5rem}.hub-discussions-post-editor__body[scale=m] .ck.ck-editor__editable{border-style:none;background-color:var(--calcite-ui-foreground-1);padding:0px;font-size:var(--calcite-font-size-0);line-height:1.25rem;color:var(--calcite-ui-text-1);outline:2px solid transparent;outline-offset:2px;min-height:6rem}.hub-discussions-post-editor__body .ck.ck-editor__editable.ck-focused:not(.ck-editor__nested-editable){border-style:none;outline:2px solid transparent;outline-offset:2px}.hub-discussions-post-editor__body[scale=m] .ck.ck-editor__editable .ck-placeholder:before{color:var(--calcite-ui-text-3)}.hub-discussions-post-editor__body .ck.ck-editor__editable_inline>:first-child{margin-top:0px}.hub-discussions-post-editor__body .ck.ck-editor__editable_inline>:last-child{margin-bottom:0px}.hub-discussions-post-editor__message{margin-top:0.5rem}.hub-discussions-post-editor__empty,.hub-discussions-post-editor__load-error{margin-top:1rem}.hub-discussions-post-editor__crud-error,.hub-discussions-post-editor__not-discussable-notice{margin-top:1rem}.hub-discussions-post-editor-cancel-confirm__header{margin-left:0px;margin-right:0px;margin-top:0.5rem;margin-bottom:0px;display:block;font-size:var(--calcite-font-size-1);line-height:1.5rem;font-weight:var(--calcite-font-weight-bold)}.hub-discussions-post-editor-cancel-confirm__message{margin-top:0.5rem;margin-bottom:0px}.hub-discussions-post-editor-cancel-confirm__footer{margin-top:1.5rem;display:flex;justify-content:flex-end;column-gap:0.75rem}.hub-discussions-post-editor-recent__skeleton{margin-bottom:0.75rem;margin-top:0px}.hub-discussions-post-editor-recent__skeleton arcgis-skeleton-loader{display:flex}@keyframes shimmer{0%{background-size:200% 100%;background-position:100% 0}100%{background-size:200% 100%;background-position:-100% 0}}.hub-discussions-post-editor-recent__skeleton arcgis-skeleton-loader>div:nth-of-type(1),.hub-discussions-post-editor-recent__skeleton arcgis-skeleton-loader>div:nth-of-type(2) div{animation:shimmer 2s cubic-bezier(0.4, 0, 0.2, 0.8) infinite;background-image:linear-gradient(90deg, rgba(255, 255, 255, 0) 0, rgba(255, 255, 255, 0) 40%, rgba(255, 255, 255, 0.6) 50%, rgba(255, 255, 255, 0) 60%, rgba(255, 255, 255, 0) 100%);background-color:var(--calcite-ui-foreground-3)}.hub-discussions-post-editor-recent__skeleton arcgis-skeleton-loader>div:nth-of-type(1){height:2.75rem;width:2.75rem;border-radius:50%}.hub-discussions-post-editor-recent__skeleton arcgis-skeleton-loader>div:nth-of-type(2){margin-left:1rem;display:flex;flex-grow:1;flex-direction:column;justify-content:center}.hub-discussions-post-editor-recent__skeleton arcgis-skeleton-loader>div:nth-of-type(2) div:nth-of-type(1){margin-bottom:0.5rem;height:0.75rem;border-radius:0.375rem}.hub-discussions-post-editor-recent__skeleton arcgis-skeleton-loader>div:nth-of-type(2) div:nth-of-type(2){height:0.5rem;border-radius:0.25rem}.location-popover>div.popover,.popover{max-width:20rem;padding-top:0.75rem;padding-bottom:0.75rem;padding-left:1.25rem;padding-right:1.25rem}.add-location-post:active .add-location-icon{--tw-text-opacity:1;color:rgb(21 21 21 / var(--tw-text-opacity))}.add-location-post[active] .add-location-icon{--tw-text-opacity:1;color:rgb(21 21 21 / var(--tw-text-opacity))}arcgis-hub-discussions-post-editor[parent-id]{display:block}.hub-discussions-reply-editor__form{border-radius:0.25rem;background-color:var(--calcite-ui-foreground-1);padding:0.75rem;--tw-shadow:0 2px 8px 0 rgba(0, 0, 0, 0.12);--tw-shadow-colored:0 2px 8px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.hub-discussions-reply-editor-user-details{margin:0px;display:grid;align-items:center;column-gap:0.75rem;grid-template-columns:32px auto}.hub-discussions-reply-editor-user-details__name{font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-bold);font-style:normal}.hub-discussions-reply-editor__notice,.hub-discussions-reply-editor__not-discussable-notice{margin-left:0px;margin-right:0px;margin-top:1rem}.hub-discussions-post-editor-cancel-confirm{display:block}.hub-discussions-post-editor-cancel-confirm__button{margin:0px}.hub-discussions-reply-editor__body{margin-top:0.75rem}.hub-discussions-reply-editor__body[scale=m] .ck.ck-editor__editable{border-style:none;background-color:var(--calcite-ui-foreground-1);padding:0px;font-size:var(--calcite-font-size-0);line-height:1.25rem;color:var(--calcite-ui-text-1);outline:2px solid transparent;outline-offset:2px;min-height:6rem}.hub-discussions-reply-editor__body .ck.ck-editor__editable.ck-focused:not(.ck-editor__nested-editable){border-style:none;outline:2px solid transparent;outline-offset:2px}.hub-discussions-reply-editor__body[scale=m] .ck.ck-editor__editable .ck-placeholder:before{color:var(--calcite-ui-text-3)}.hub-discussions-reply-editor__body .ck.ck-editor__editable_inline>:first-child{margin-top:0px}.hub-discussions-reply-editor__body .ck.ck-editor__editable_inline>:last-child{margin-bottom:0px}.hub-discussions-reply-editor__message{margin-top:0.5rem}.hub-discussions-reply-editor__location-popover>div.hub-discussions-reply-editor__location-popover__content,.hub-discussions-reply-editor__location-popover__content{max-width:20rem;padding-top:0.75rem;padding-bottom:0.75rem;padding-left:1.25rem;padding-right:1.25rem}.add-location-post:active .add-location-icon{--tw-text-opacity:1;color:rgb(21 21 21 / var(--tw-text-opacity))}.add-location-post[active] .add-location-icon{--tw-text-opacity:1;color:rgb(21 21 21 / var(--tw-text-opacity))}arcgis-hub-discussions-post-editor>form>header{padding-top:0.25rem;padding-bottom:1rem;text-align:center;font-size:var(--calcite-font-size-1);line-height:1.5rem;font-weight:var(--calcite-font-weight-bold);text-transform:capitalize;color:var(--calcite-ui-text-1)}";var Ee=function(e,t,s,i){var o,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(n=(a<3?o(n):a>3?o(t,s,n):o(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};const He=class{constructor(s){e(this,s),this.arcgisHubDiscussionsPostGeographySelect=t(this,"arcgisHubDiscussionsPostGeographySelect",7),this.arcgisHubDiscussionsPostGeographyHover=t(this,"arcgisHubDiscussionsPostGeographyHover",7),this.arcgisHubDiscussionsPostViewAllGeography=t(this,"arcgisHubDiscussionsPostViewAllGeography",7),this.arcgisHubDiscussionsPostEdit=t(this,"arcgisHubDiscussionsPostEdit",7),this.arcgisHubDiscussionsGeometryDrawEdit=t(this,"arcgisHubDiscussionsGeometryDrawEdit",7),this.arcgisHubDiscussionsGeometryDrawEditCancel=t(this,"arcgisHubDiscussionsGeometryDrawEditCancel",7),this.arcgisHubDiscussionsFeatureRemove=t(this,"arcgisHubDiscussionsFeatureRemove",7),this.hubTelemetry=t(this,"hubTelemetry",7),this.defaultMaxEntryCount=4,this.intl=void 0,this.maxEntryCount=this.defaultMaxEntryCount,this.relatedFeatures=void 0,this.relatedFeatureIds=[],this.activeEditIndex=-1,this.loading=!0,this.postId=void 0,this.post=void 0,this.parentId=void 0,this.channel=void 0,this.channelId=void 0,this.disabled=void 0,this.disabledActions=void 0,this.displayFieldValid=void 0,this.displayFieldKey=void 0,this.context=void 0,this.unsavedFeatures=void 0,this.unsavedRelatedFeatures=void 0,this.unsavedExistingFeatures=[],this.hasMap=void 0,this.expandable=void 0,this.toggleable=void 0,this.url=void 0,this.renderedInEditor=void 0,this.isMobile=void 0,this.showLocationDescriptionText=void 0,this.locationDescriptionText=void 0,r(this,"handleGeometrySelected","handleToggleAllGeography","handleViewAllGeography","handleGeometryHovered","renderButton","renderGeographyItem","renderGeographies","handleDelete","handleEdit")}get featuresLoaded(){var e;return!this.relatedFeatureIds.length||this.relatedFeatureIds.length===(null===(e=this.relatedFeatures)||void 0===e?void 0:e.length)}componentWillLoad(){this.initialize()}async initialize(){this.fetchRelatedFeatures(),this.updateFeatures(),this.intl=await n.loadIntlForComponent(this.element)}updateFeatures(){var e;const t=R(null===(e=null==this?void 0:this.post)||void 0===e?void 0:e.discussion);JSON.stringify(t)!==JSON.stringify(this.relatedFeatureIds)&&(this.relatedFeatureIds=t||[])}handleRelatedFeatureIdsChange(){this.relatedFeatures=[],this.fetchRelatedFeatures()}updateLoading(){const{intl:e,featuresLoaded:t}=this;this.loading=!Boolean(e&&t)}handleFeatureUpdated(){this.activeEditIndex=-1}async fetchRelatedFeatures(){const{url:e,relatedFeatureIds:t}=this;this.relatedFeatures=t.length?await P(e,t):[]}emitHubTelemetry(e){const{postId:t,parentId:s,channelId:i,channel:o}=this;this.hubTelemetry.emit(Object.assign(Object.assign({},e),{postId:t,parentId:s,channelId:i,channelAccess:null==o?void 0:o.access}))}findGeometryFromClickEvent(e){var t;const{relatedFeatures:s,unsavedFeatures:i,unsavedRelatedFeatures:o,geometries:a,post:n}=this,{dataset:{index:r,related:c,unsaved:l}}=e.target,d=Number(r),h=void 0!==c,u=void 0!==l;let p,g,m;return u?(p=h?o[d-s.length-a.length].feature.geometry:i[d-s.length-a.length-o.length].geometry,g=h?o[d-s.length-a.length].objectId:null,m=h?null:d-o.length-a.length-s.length):(p=h?s[d].geometry:null==n?void 0:n.geometry,g=h?s[d].id:null,m=h||"GeometryCollection"!==(null===(t=null==n?void 0:n.geometry)||void 0===t?void 0:t.type)?null:d-s.length),{featureGeometry:p,relatedFeatureId:g,featureIndex:m,isStaged:u,originalIndex:d,isRelatedFeature:h}}handleGeometrySelected(e){const{post:t}=this,{featureGeometry:s,relatedFeatureId:i,featureIndex:o,isStaged:a}=this.findGeometryFromClickEvent(e);this.emitHubTelemetry(c.dictionary.category.interaction.action.zoom.label.in),this.arcgisHubDiscussionsPostGeographySelect.emit({type:"Feature",geometry:s,properties:{id:null==t?void 0:t.id,relatedFeatureId:i,index:o,unsaved:a}})}handleGeometryHovered(e){const{post:t}=this,{featureGeometry:s,relatedFeatureId:i,featureIndex:o,isStaged:a}=this.findGeometryFromClickEvent(e);this.arcgisHubDiscussionsPostGeographyHover.emit({type:"Feature",geometry:s,properties:{id:null==t?void 0:t.id,relatedFeatureId:i,index:o,unsaved:a}})}handleDelete(e){e.stopPropagation();const{post:t}=this,{featureGeometry:s,relatedFeatureId:i,featureIndex:o,isStaged:a}=this.findGeometryFromClickEvent(e);if(this.arcgisHubDiscussionsFeatureRemove.emit({type:"Feature",geometry:s,properties:{id:null==t?void 0:t.id,relatedFeatureId:i,index:o,unsaved:a}}),i)this.emitHubTelemetry(c.dictionary.category.interaction.action.deselect.label.content);else{const e=F(s);this.emitHubTelemetry(c.dictionary.category.content.action.delete.label.location.details[e])}}handleEdit(e){e.stopPropagation();const{post:t}=this,{featureGeometry:s,relatedFeatureId:i,featureIndex:o,isStaged:a,originalIndex:n}=this.findGeometryFromClickEvent(e);this.activeEditIndex=e.target.active?-1:n,this.activeEditIndex>-1?this.arcgisHubDiscussionsGeometryDrawEdit.emit({type:"Feature",geometry:s,properties:{id:null==t?void 0:t.id,relatedFeatureId:i,index:o,unsaved:a}}):this.arcgisHubDiscussionsGeometryDrawEditCancel.emit()}handleViewAllGeography(){this.emitHubTelemetry(c.dictionary.category.interaction.action.open.label.thread),this.arcgisHubDiscussionsPostViewAllGeography.emit()}handleToggleAllGeography(){const{relatedFeatures:e,maxEntryCount:t,defaultMaxEntryCount:s,geometries:i}=this;t===s?(this.emitHubTelemetry(c.dictionary.category.interaction.action.open.label.locations),this.maxEntryCount=e.length+i.length):(this.emitHubTelemetry(c.dictionary.category.interaction.action.close.label.locations),this.maxEntryCount=s)}get geometries(){const{post:e}=this,t=[];return(null==e?void 0:e.geometry)&&("GeometryCollection"===e.geometry.type?t.push(...e.geometry.geometries):t.push(e.geometry)),t}renderActions(e,t,i){const{intl:o,activeEditIndex:a,hasMap:n,isMobile:r,disabledActions:c}=this,l=[s("calcite-action",{active:e===a,class:"discussions-post-geography-edit","data-index":e,"data-related":t,"data-unsaved":i,disabled:c,key:"pencil",onClick:this.handleEdit,scale:"m",slot:"actions-end",text:o.t("action.update")},s("calcite-icon",{class:"discussions-post-geography-edit-icon",icon:"pencil",scale:"s"})),s("calcite-action",{class:"discussions-post-geography-delete","data-index":e,"data-related":t,"data-unsaved":i,disabled:c,key:"trash",onClick:this.handleDelete,scale:"m",slot:"actions-end",text:o.t("action.remove")},s("calcite-icon",{class:"discussions-post-geography-delete-icon",icon:"trash",scale:"s"}))];return(t||!n||r)&&l.shift(),l}renderGeographyItem(e,t,i=!1,o=!1){const{intl:a,displayFieldValid:n,displayFieldKey:r,locationDescriptionText:c,showLocationDescriptionText:l}=this,{geometry:d,properties:h}=e;let u,p,g,m;return l&&(u=c||a.t("description")),"Point"===d.type||"MultiPoint"===d.type?(p=a.t(i?"displayField.existing":"displayField.added"),g="pin",m=a.t("point")):"LineString"===d.type||"MultiLineString"===d.type?(p=a.t(i?"displayField.existing":"displayField.added"),g="freehand",m=a.t("line")):"Polygon"!==d.type&&"MultiPolygon"!==d.type||(p=a.t(i?"displayField.existing.area":"displayField.added.area"),g="freehand-area",m=a.t("area")),i&&n&&(p=h[r]),s("calcite-list-item",{"data-index":t,"data-related":i,"data-unsaved":o,description:u,label:p,onClick:this.handleGeometrySelected,onMouseOver:this.handleGeometryHovered},s("calcite-icon",{icon:g,scale:"s",slot:"content-start",textLabel:m}),this.renderActions(t,i,o))}renderButton(e){const{intl:t,maxEntryCount:i,defaultMaxEntryCount:o,expandable:a,toggleable:n}=this;return a&&e>i?s("calcite-action",{class:"overflow",onClick:this.handleViewAllGeography,scale:"s",text:t.t("viewAll"),"text-enabled":!0}):n&&e>o?s("calcite-action",{class:"overflow",onClick:this.handleToggleAllGeography,scale:"s",text:t.t(e>i?"viewAll":"viewLess"),"text-enabled":!0}):void 0}get listItems(){const{geometries:e,relatedFeatures:t,maxEntryCount:s,expandable:i,toggleable:o,unsavedFeatures:a,unsavedRelatedFeatures:n,renderedInEditor:r}=this,c=(e,t,a=!1,n=!1)=>e.length<s||!i&&!o?[...e,this.renderGeographyItem(t,e.length,a,n)]:e;let l=t.reduce(((e,t)=>c(e,t,!0)),[]);return l=e.reduce(((e,t)=>c(e,{geometry:t})),l),r&&(l=n.reduce(((e,{feature:t})=>c(e,t,!0,!0)),l),l=a.reduce(((e,t)=>c(e,t,!1,!0)),l)),l}renderGeographies(){const{geometries:e,relatedFeatures:t,listItems:i,disabled:o}=this;return s(a,null,s("calcite-list",{disabled:o},i),this.renderButton(t.length+e.length))}renderSkeleton(){const{relatedFeatureIds:e,geometries:t}=this;return Array.from({length:e.length+t.length>4?4:e.length+t.length},((e,t)=>s("arcgis-skeleton-loader",{active:!0,key:t,rows:0,showFooter:!1,showHeading:!1,showThumbnail:!1},s("div",null),s("div",null,s("div",null),s("div",null)))))}render(){return s(i,{"data-count":this.loading?0:this.listItems.length,"data-element":"discussions-post-geography"},this.loading?this.renderSkeleton():this.renderGeographies())}static get assetsDirs(){return["locales"]}get element(){return o(this)}static get watchers(){return{post:["updateFeatures"],relatedFeatureIds:["handleRelatedFeatureIdsChange"],intl:["updateLoading"],relatedFeatures:["updateLoading"],unsavedFeatures:["handleFeatureUpdated"],unsavedExistingFeatures:["handleFeatureUpdated"]}}};Ee([ne({when(){return this.activeEditIndex>-1}})],He.prototype,"handleFeatureUpdated",null),Ee([W({delay:300})],He.prototype,"fetchRelatedFeatures",null),Ee([ne({when(){return!this.disabled}})],He.prototype,"handleGeometrySelected",null),Ee([ne({when(){return!this.disabled}})],He.prototype,"handleGeometryHovered",null),Ee([ne({when(){const{context:{currentUser:e},channel:t,renderedInEditor:s}=this,{post:i}=this;return s&&(!i||ve(i,e,t))}})],He.prototype,"renderActions",null),Ee([ne({when:function({geometry:e}){return Boolean(e)}})],He.prototype,"renderGeographyItem",null),He.style=':host{display:block}:host([data-count="0"]){display:none}.overflow{padding-left:1rem}calcite-icon{padding:1rem}arcgis-skeleton-loader:first-of-type{margin-top:0px}arcgis-skeleton-loader{margin-top:1rem;margin-bottom:1rem;display:grid;column-gap:1rem;grid-template-columns:1.75rem auto}arcgis-skeleton-loader:last-of-type{margin-bottom:0px}@keyframes shimmer{0%{background-size:200% 100%;background-position:100% 0}100%{background-size:200% 100%;background-position:-100% 0}}arcgis-skeleton-loader>div:nth-of-type(1),arcgis-skeleton-loader>div:nth-of-type(2)>div{animation:shimmer 2s cubic-bezier(0.4, 0, 0.2, 0.8) infinite;background-image:linear-gradient(90deg, rgba(255, 255, 255, 0) 0, rgba(255, 255, 255, 0) 40%, rgba(255, 255, 255, 0.6) 50%, rgba(255, 255, 255, 0) 60%, rgba(255, 255, 255, 0) 100%);background-color:var(--calcite-ui-foreground-3)}arcgis-skeleton-loader>div:nth-of-type(1){height:1.75rem;width:1.75rem;border-radius:9999px}arcgis-skeleton-loader>div:nth-of-type(2){display:grid;align-items:center;row-gap:0.5rem}arcgis-skeleton-loader>div:nth-of-type(2)>div:nth-of-type(1){height:0.75rem;border-radius:0.375rem}arcgis-skeleton-loader>div:nth-of-type(2)>div:nth-of-type(2){height:0.5rem;border-radius:0.25rem}.discussions-post-geography-edit-icon,.discussions-post-geography-delete-icon{padding:0px}.discussions-post-geography-edit:active .discussions-post-geography-edit-icon{--tw-text-opacity:1;color:rgb(21 21 21 / var(--tw-text-opacity))}.discussions-post-geography-edit[active] .discussions-post-geography-edit-icon{--tw-text-opacity:1;color:rgb(21 21 21 / var(--tw-text-opacity))}.discussions-post-geography-delete:active .discussions-post-geography-delete-icon{--tw-text-opacity:1;color:rgb(21 21 21 / var(--tw-text-opacity))}calcite-list[disabled]{opacity:100%}calcite-list-item{--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}';const Le=class{constructor(s){e(this,s),this.arcgisHubDiscussionsPostSelect=t(this,"arcgisHubDiscussionsPostSelect",7),this.postId=void 0,this.post=void 0,this.parent=void 0,this.postCreator=void 0,this.parentCreator=void 0,this.postCreatorOrg=void 0,this.channel=void 0,this.channelGroups=void 0,this.index=void 0,this.context=void 0,this.isHub=void 0,this.showCreatorAvatar=void 0,this.showCreatorUsername=void 0,this.showChannelAvatar=void 0,this.showPopover=void 0,this.showChannelName=void 0,this.showTimestamp=void 0,this.showChannelAccessIcon=void 0,this.showReplyingTo=void 0,this.showViewPostAction=void 0,this.iconScale="m",this.metadataOrientation="block",r(this,"handleViewPostClicked")}async componentWillLoad(){this.intl=await n.loadIntlForComponent(this.element)}get creator(){const{context:e,post:t,postCreator:s}=this;return t?s:e.currentUser}get creatorFullName(){const{intl:e,post:t,creator:s}=this;let i=e.t("anonymous");return(s||(null==t?void 0:t.creator))&&(i=(null==s?void 0:s.fullName)||e.t("privateUser")),i}get accessIcon(){const{intl:e,channel:t}=this;let s,i;return t.access===A.PRIVATE?(s="lock",i=e.t("visiblePrivate")):t.access===A.ORG?(s="organization",i=e.t("visibleOrg")):(s="globe",i=e.t("visibleAll")),{icon:s,label:i}}handleViewPostClicked(){this.arcgisHubDiscussionsPostSelect.emit()}renderAccessIcon(){const{accessIcon:e,showChannelAccessIcon:t}=this;if(t)return s("calcite-icon",{class:"access-icon",icon:e.icon,scale:"s","text-label":e.label})}renderPopover(e){const{post:t,creator:i,showPopover:o,postCreator:a,postCreatorOrg:n,channel:r,index:c,context:l,isHub:d,parent:h,parentCreator:u}=this;return t&&o&&i?s("arcgis-hub-discussions-popover",{channel:r,channelGroups:this.channelGroups,context:l,index:c,isHub:d,parent:h,parentCreator:u,post:t,postCreator:a,postCreatorOrg:n},e):e}renderAvatars(){const e=[this.renderCreatorAvatar(),this.renderChannelAvatar()].filter(Boolean);if(e.length){const t=s("div",{class:"avatars"},e);return this.renderPopover(t)}}renderCreatorAvatar(){const{post:e,creator:t,context:i,showCreatorAvatar:o,iconScale:a}=this;if(o){const o=!t&&e?{username:null==e?void 0:e.creator}:t;return s("calcite-avatar",{"full-name":null==o?void 0:o.fullName,scale:a,thumbnail:(null==o?void 0:o.thumbnail)&&D(i.session.portal,o,i.session.token),"user-id":null==o?void 0:o.id,username:null==o?void 0:o.username})}}renderChannelAvatar(){const{channel:e,channelGroups:t,showChannelAvatar:i,iconScale:o,showCreatorAvatar:a,intl:n}=this;if(i){let i;if(a?"l"===o?i="m":"m"===o&&(i="s"):i=o,i)return s("calcite-avatar",{"full-name":f(e,t,n.t("unnamedChannel")),scale:i})}}renderPostTimestamp(){const{showTimestamp:e,post:t}=this;if(e&&t)return s("arcgis-relative-date",{dateTime:t.createdAt,formatStyle:"short"})}renderHeader(){return s("header",null,this.creatorFullName)}renderChannelName(){const{showChannelName:e,channel:t,channelGroups:i,intl:o}=this;if(e)return s("span",{class:"channel-name"},f(t,i,o.t("unnamedChannel")))}renderCreatorUsername(){const{post:e,showCreatorUsername:t}=this;if(t&&e)return s("span",{class:"post-creator-username"},e.creator)}renderReplyingTo(){const{showReplyingTo:e,parentCreator:t,intl:i}=this;if(e&&t)return s("span",{class:"replying-to"},s("calcite-icon",{icon:"right",scale:"s"}),i.t("replyingTo",{fullName:t.fullName}))}renderViewPostAction(){const{showViewPostAction:e,intl:t}=this;if(e)return s("calcite-link",{onClick:this.handleViewPostClicked},t.t("viewPost"))}get isMetadataInline(){return"inline"===this.metadataOrientation}renderMetadata(){const e=[this.renderCreatorUsername(),this.renderChannelName(),this.renderReplyingTo(),this.renderViewPostAction(),this.renderPostTimestamp(),this.renderAccessIcon()].filter(Boolean).reduce(((e,t,i)=>this.isMetadataInline||i>0?[...e,s("span",{class:"metadata-separator",key:`separator:${i}`},"·"),t]:[...e,t]),[]);if(e.length)return s("div",{class:{metadata:!0,inline:this.isMetadataInline}},e)}render(){return s(i,null,s("address",null,this.renderAvatars(),this.renderHeader(),this.renderMetadata()))}static get assetsDirs(){return["locales"]}get element(){return o(this)}};Le.style=':host{display:block}address{display:grid;align-items:center;row-gap:0.25rem;font-style:normal}address:has(.metadata){grid-template-rows:repeat(2, minmax(0, 1fr));align-items:flex-start}address:has(.metadata.inline){grid-template-rows:repeat(1, minmax(0, 1fr));align-items:center;grid-template-columns:repeat(2, max-content)}address:has(calcite-avatar[scale="s"]){grid-template-columns:32px auto}address:has(.metadata.inline):has(calcite-avatar[scale="s"]){grid-template-columns:32px max-content max-content}address:has(calcite-avatar[scale="m"]){grid-template-columns:40px auto}address:has(.metadata.inline):has(calcite-avatar[scale="m"]){grid-template-columns:40px max-content max-content}address:has(calcite-avatar[scale="m"]):has(calcite-avatar+calcite-avatar){grid-template-columns:50px auto}address:has(.metadata.inline):has(calcite-avatar[scale="m"]):has(calcite-avatar+calcite-avatar){grid-template-columns:50px max-content max-content}address:has(calcite-avatar[scale="l"]){grid-template-columns:52px auto}address:has(.metadata.inline):has(calcite-avatar[scale="l"]){grid-template-columns:52px max-content max-content}address:has(calcite-avatar[scale="l"]):has(calcite-avatar+calcite-avatar){grid-template-columns:62px auto}address:has(.metadata.inline):has(calcite-avatar[scale="l"]):has(calcite-avatar+calcite-avatar){grid-template-columns:62px max-content max-content}arcgis-hub-discussions-popover{display:flex}address:has(.metadata) arcgis-hub-discussions-popover{grid-row:span 2 / span 2}address:has(.metadata.inline) arcgis-hub-discussions-popover{grid-row:span 1 / span 1}button{cursor:pointer;border-style:none;background-color:transparent;padding:0px}header{display:flex;align-items:flex-end;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-bold);text-transform:capitalize;color:var(--calcite-ui-text-1)}address:has(.metadata):not(:has(.inline)) header{align-self:flex-end}.avatars{position:relative;display:flex}address:has(.metadata) .avatars{grid-row:span 2 / span 2}address:has(.metadata.inline) .avatars{grid-row:span 1 / span 1}.avatars:has(calcite-avatar[scale="s"]){height:24px}.avatars:has(calcite-avatar[scale="s"]):has(calcite-avatar+calcite-avatar){height:30px}.avatars:has(calcite-avatar[scale="m"]){height:32px}.avatars:has(calcite-avatar[scale="m"]):has(calcite-avatar+calcite-avatar){height:42px}.avatars:has(calcite-avatar[scale="l"]){height:44px}.avatars:has(calcite-avatar[scale="l"]):has(calcite-avatar+calcite-avatar){height:54px}.avatars calcite-avatar+calcite-avatar{position:absolute;z-index:10;border-radius:9999px;border:3px solid var(--calcite-ui-foreground-1)}.avatars calcite-avatar+calcite-avatar[scale="s"]{top:0.75rem;left:0.75rem}.avatars calcite-avatar+calcite-avatar[scale="m"]{top:1rem;left:1rem}.metadata{display:flex;flex-wrap:nowrap;align-items:center;font-size:var(--calcite-font-size--1);line-height:1rem}.post-creator-username{font-style:normal;color:var(--calcite-ui-text-2)}.post-creator-username::before{font-style:normal;color:var(--calcite-ui-text-2);content:\'@\'}.channel-name{max-height:1rem;word-break:break-all;font-weight:var(--calcite-font-weight-medium);font-style:normal;color:var(--calcite-ui-text-2);overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1}.metadata-separator{display:flex;width:1rem;justify-content:center;font-size:var(--calcite-font-size--1);line-height:1rem;color:var(--calcite-ui-text-2)}.metadata arcgis-relative-date{white-space:nowrap}.access-icon{margin-top:-0.125rem}.replying-to calcite-icon{position:relative;top:3px;margin-right:0.25rem;transform:scaleY(-1)}';const Me=[S.THUMBS_UP,S.THINKING,S.GRINNING,S.PARTY_POPPER],Se=[...Me,S.SLIGHTLY_SMILING,S.CONFUSED,S.LAUGH,S.FACE_WITH_TEARS_OF_JOY,S.WINKING,S.PARTYING,S.SAD,S.SURPRISED,S.THUMBS_DOWN,S.CLAPPING_HANDS,S.RAISING_HANDS,S.WAVING_HAND,S.HEART,S.ONE_HUNDRED,S.FIRE,S.ROCKET,S.UP_ARROW,S.DOWN_ARROW,S.EYES,S.TROPHY,S.WORLD_MAP],Ve={[S.SLIGHTLY_SMILING]:{emoji:"🙂",telemetryKey:"smilingFace"},[S.CONFUSED]:{emoji:"😕",telemetryKey:"confusedFace"},[S.LAUGH]:{emoji:"😀",telemetryKey:"laughingFace"},[S.GRINNING]:{emoji:"😆",telemetryKey:"grinningFace"},[S.FACE_WITH_TEARS_OF_JOY]:{emoji:"😂",telemetryKey:"faceWithTearsOfJoy"},[S.THINKING]:{emoji:"🤔",telemetryKey:"thinkingFace"},[S.WINKING]:{emoji:"😉",telemetryKey:"winkingFace"},[S.PARTYING]:{emoji:"🥳",telemetryKey:"partyingFace"},[S.SAD]:{emoji:"😥",telemetryKey:"sadFace"},[S.SURPRISED]:{emoji:"😲",telemetryKey:"shockedFace"},[S.THUMBS_UP]:{emoji:"👍",telemetryKey:"thumbsUp"},[S.THUMBS_DOWN]:{emoji:"👎",telemetryKey:"thumbsDown"},[S.CLAPPING_HANDS]:{emoji:"👏",telemetryKey:"clappingHands"},[S.RAISING_HANDS]:{emoji:"🙌",telemetryKey:"raisingHands"},[S.WAVING_HAND]:{emoji:"👋",telemetryKey:"wavingHand"},[S.HEART]:{emoji:"❤️",telemetryKey:"redHeart"},[S.ONE_HUNDRED]:{emoji:"💯",telemetryKey:"hundredPoints"},[S.FIRE]:{emoji:"🔥",telemetryKey:"fire"},[S.PARTY_POPPER]:{emoji:"🎉",telemetryKey:"partyPopper"},[S.ROCKET]:{emoji:"🚀",telemetryKey:"rocket"},[S.UP_ARROW]:{emoji:"⬆",telemetryKey:"upArrow"},[S.DOWN_ARROW]:{emoji:"⬇",telemetryKey:"downArrow"},[S.EYES]:{emoji:"👀",telemetryKey:"eyes"},[S.TROPHY]:{emoji:"🏆",telemetryKey:"trophy"},[S.WORLD_MAP]:{emoji:"🗺",telemetryKey:"worldMap"}};const Be=(e,t)=>{const s=new Date(e.createdAt),i=new Date(t.createdAt);return s>i?-1:s<i?1:0},Ue=e=>(t,s)=>e[t.value].length>e[s.value].length?1:e[t.value].length<e[s.value].length?-1:0,Ke=class{constructor(s){e(this,s),this.hubTelemetry=t(this,"hubTelemetry",7),this.arcgisHubDiscussionsPostReactionChange=t(this,"arcgisHubDiscussionsPostReactionChange",7),this.reactionListButtons={},this.context=void 0,this.postId=void 0,this.post=void 0,this.channel=void 0,this.showAllReactions=!1,this.activePopover=null,this.pending=!1,this.users={},r(this,"handleAddReactionClick","handleViewAllReactionsClick","handleAddReactionPopoverClose","handleReactionFocus","handleReactionMouseEnter","handleReactionPopoverClose","handleReactionClicked","handleReactionPopoverOpen","handleReactionRef","deleteUserReaction","handleReactionPopoverBeforeOpen")}handleContextChanged(e,t){var s,i;(null===(s=e.currentUser)||void 0===s?void 0:s.username)!==(null===(i=t.currentUser)||void 0===i?void 0:i.username)&&(this.users={})}async handlePostIdChanged(e,t){await this.fetchPostDetails(e,t)}handlePopoverOpen(e){e.target!==this.element&&(this.activePopover=null)}async componentWillLoad(){const[e]=await Promise.all([n.loadIntlForComponent(this.element),this.handlePostIdChanged(this.postId)]);this.intl=e}get isDisabled(){const{context:e,channel:t,pending:s}=this;return[!e.currentUser,!t.allowReaction,s].some((e=>Boolean(e)))}get overflowReactionRecords(){const{listReactions:e,reactionRecordGroups:t}=this;return Object.entries(t).reduce(((t,[s,i])=>e.find((e=>e.value===s))?t:[...t,...i]),[]).sort(Be)}get currentUserReactions(){const{context:e,reactionRecordGroups:t}=this;return Object.values(t).reduce(((t,s)=>[...t,...s.filter((t=>{var s;return t.creator===(null===(s=e.currentUser)||void 0===s?void 0:s.username)}))]),[]).sort(Ue(t))}get otherUserReactions(){const{reactionRecordGroups:e,currentUserReactions:t}=this;return Object.values(e).reduce(((e,t)=>[...e,...t]),[]).reduce(((e,s)=>t.find((e=>e.value===s.value))||e.find((e=>e.value===s.value))?e:[...e,s]),[]).sort(Ue(e))}get listReactions(){const{currentUserReactions:e,otherUserReactions:t,reactionRecordGroups:s}=this,i=[...t,...e],o=Object.keys(s).length>4?3:4;let a,n;return i.length>o?(a=i.length-o,n=i.length):(a=0,n=i.length),i.slice(a,n)}get reactionRecordGroups(){const{post:{reactions:e}}=this;return[...e].sort(Be).reduce(((e,t)=>Se.includes(t.value)?Object.assign(Object.assign({},e),{[t.value]:[...e[t.value]||[],t]}):e),{})}async fetchPostDetails(e,t){const{context:s}=this;if(e&&e!==t){const t=await X(Object.assign({postId:e,data:{relations:[G.CHANNEL,G.REACTIONS,G.REPLIES]}},s.hubRequestOptions)),{channel:i}=t,o=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(s[i[o]]=e[i[o]])}return s}(t,["channel"]);o.channelId=i.id,o.replyCount=o.replies.total,delete o.replies,this.channel=i,this.post=o}}handleAddReactionClick(e){const{dataset:{reaction:t}}=e.target,{post:s,channel:i}=this;this.activePopover=t,this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.interaction.action.open.label.popover.details.addReaction),{postId:s.id,parentId:s.parentId,channelId:i.id,channelAccess:i.access}))}handleViewAllReactionsClick(){this.showAllReactions=!0}handleAddReactionPopoverClose(){this.showAllReactions=!1,this.activePopover=null}handleReactionFocus(e){const{dataset:{reaction:t}}=e.target;this.activePopover=t}handleReactionMouseEnter(e){const t=e.target,{nodeName:s,dataset:{reaction:i}}=t;"CALCITE-BUTTON"===s&&"add"!==this.activePopover&&(this.activePopover=i)}handleReactionPopoverClose(e){const{dataset:{reaction:t}}=e.target;this.activePopover===t&&(this.activePopover=null)}async handleReactionPopoverBeforeOpen(e){const{reaction:t}=e.target.dataset,s=await this.fetchUserRecords(t);this.users=Object.assign(Object.assign({},this.users),s)}async handleReactionClicked(e){const{currentUserReactions:t,arcgisHubDiscussionsPostReactionChange:s,activePopover:i}=this,{dataset:{reaction:o}}=e.currentTarget,a=t.find((({value:e})=>e===o));this.pending=!0;try{if(await Promise.all(t.map(this.deleteUserReaction)),a||await this.createReaction(o),"add"===i&&(this.activePopover=null),this.activePopover){const e=await this.fetchUserRecords(o);this.users=Object.assign(Object.assign({},this.users),e)}}catch(e){}finally{s.emit(),this.pending=!1}}handleReactionPopoverOpen(e){const{channel:t,post:s}=this,{dataset:{reaction:i}}=e.target;this.hubTelemetry.emit(Object.assign(Object.assign({},"overflow"===i?c.dictionary.category.interaction.action.open.label.popover.details.reactionOverflow:c.dictionary.category.interaction.action.open.label.popover.details[Ve[i].telemetryKey]),{postId:s.id,parentId:s.parentId,channelId:t.id,channelAccess:t.access}))}async handleReactionRef(e){var t;0==+(null===(t=null==e?void 0:e.dataset)||void 0===t?void 0:t.index)&&await e.setFocus()}async fetchUserRecords(e){const{reactionRecordGroups:t,overflowReactionRecords:s,users:i}=this,o=("overflow"===e?s:t[e]).reduce(((e,t)=>i[t.creator]?e:[...e,t.creator]),[]);if(o.length){const e=o.reduce(((e,t)=>[...e,this.fetchUserRecord(t)]),[]);return(await Promise.all(e)).reduce(((e,t,s)=>Object.assign(Object.assign({},e),{[o[s]]:t})),{})}}async fetchUserRecord(e){return d(e,this.context.hubRequestOptions).catch((()=>null))}async createReaction(e){const{context:t,post:s,channel:i}=this;try{const o=await function(e){return e.httpMethod="POST",pe("/reactions",e)}(Object.assign({data:{postId:s.id,value:e}},t.hubRequestOptions));this.post=Object.assign(Object.assign({},this.post),{reactions:[...this.post.reactions,o]}),this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.content.action.create.label.reaction.details[Ve[e].telemetryKey]),{postId:s.id,parentId:s.id,channelId:i.id,channelAccess:i.access,response:c.constants.response.SUCCESS}))}catch(t){throw this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.content.action.create.label.reaction.details[Ve[e].telemetryKey]),{postId:s.id,parentId:s.id,channelId:i.id,channelAccess:i.access,response:c.constants.response.FAILURE})),console.error("Failed to create reaction:",e,t.message),t}}async deleteUserReaction(e){const{context:t,post:s,channel:i,currentUserReactions:o}=this;try{await function(e){const{reactionId:t}=e;return e.httpMethod="DELETE",pe(`/reactions/${t}`,e)}(Object.assign({reactionId:e.id},t.hubRequestOptions)),this.post=Object.assign(Object.assign({},s),{reactions:s.reactions.filter((({id:e})=>!o.find((t=>t.id===e))))}),this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.content.action.delete.label.reaction.details[Ve[e.value].telemetryKey]),{postId:s.id,parentId:s.id,channelId:i.id,channelAccess:i.access,response:c.constants.response.SUCCESS}))}catch(t){throw console.error("Failed to delete reaction:",e.value,e.id,t.message),this.hubTelemetry.emit(Object.assign(Object.assign({},c.dictionary.category.content.action.delete.label.reaction.details[Ve[e.value].telemetryKey]),{postId:s.id,parentId:s.id,channelId:i.id,channelAccess:i.access,response:c.constants.response.FAILURE})),t}}renderList(){const{listReactions:e,reactionRecordGroups:t,intl:i,context:o,activePopover:a,isDisabled:n,handleReactionPopoverClose:r,handleReactionPopoverOpen:c}=this;return s("ul",{class:"submitted_reactions_list"},e.reduce(((e,l)=>{var d;const h=l.creator===(null===(d=o.currentUser)||void 0===d?void 0:d.username),u=t[l.value].length>99?i.t("reaction_count_99_plus"):t[l.value].length;return[...e,s("li",{key:l.value},s("calcite-button",{appearance:"outline","aria-checked":h?"true":"false","data-reaction":l.value,disabled:n,kind:h?"brand":"neutral",label:i.t(h?"reaction_list_label_remove":"reaction_list_label_add",{reaction:i.t(l.value),count:u}),onClick:this.handleReactionClicked,onFocus:this.handleReactionFocus,onMouseEnter:this.handleReactionMouseEnter,ref:e=>{this.reactionListButtons=Object.assign(Object.assign({},this.reactionListButtons),{[l.value]:e})},role:"radio",round:!0,scale:"m"},Ve[l.value].emoji,s("span",null,u)),s("calcite-popover",{"auto-close":!0,class:"user_reactions_popover","data-reaction":l.value,"focus-trap-disabled":!0,heading:i.t(l.value),label:i.t(l.value),onCalcitePopoverBeforeOpen:this.handleReactionPopoverBeforeOpen,onCalcitePopoverClose:r,onCalcitePopoverOpen:c,open:a===l.value,overlayPositioning:"fixed",placement:"bottom",referenceElement:this.reactionListButtons[l.value],"trigger-disabled":!0},this.renderUserReactions(t[l.value],!1)))]}),[]))}renderUserSkeleton(e){return s("arcgis-skeleton-loader",{active:!0,role:"listitem",rows:0,showFooter:!1,showHeading:!1,showThumbnail:!1},s("div",null),s("div",null,s("div",null," ")),e&&s("div",null,s("div",null," ")),s("div",null,s("div",null," ")))}renderUserReaction(e,t){const{users:i,context:o,intl:a}=this,n=i[e.creator],r=(null==n?void 0:n.fullName)||a.t("privateUser");return s("li",{"aria-label":a.t("reaction_user_label",{userFullName:r,reaction:a.t(e.value)}),class:"user_reaction_item"},s("calcite-avatar",{"full-name":null==n?void 0:n.fullName,scale:"l",thumbnail:(null==n?void 0:n.thumbnail)&&D(o.session.portal,{username:n.username,access:n.access,thumbnail:n.thumbnail},o.session.token),"user-id":null==n?void 0:n.id,username:null==n?void 0:n.username}),s("div",null,r),t&&s("div",null,Ve[e.value].emoji),s("div",null,(null==n?void 0:n.username)||a.t("noUser")))}renderUserReactions(e,t){const{users:i}=this;return s("ul",{class:"user_reactions_list"},e.map((e=>void 0===i[e.creator]?this.renderUserSkeleton(t):this.renderUserReaction(e,t))))}renderOverflow(){const{intl:e,overflowReactionRecords:t,handleReactionPopoverClose:i,handleReactionPopoverOpen:o,activePopover:n,isDisabled:r,overflowButton:c}=this,l=t.length>99?e.t("reaction_count_99_plus"):e.formatNumber(t.length,{signDisplay:"always"});return Boolean(t.length)&&s(a,null,s("calcite-button",{appearance:"outline","data-reaction":"overflow",disabled:r,kind:"neutral",label:e.t(t.length>1?"n_more_reactions":"one_more_reaction",{count:l}),onFocus:this.handleReactionFocus,onMouseOver:this.handleReactionMouseEnter,ref:e=>{this.overflowButton=e},round:!0,scale:"m"},l),s("calcite-popover",{"auto-close":!0,class:"user_reactions_popover","data-reaction":"overflow","focus-trap-disabled":!0,heading:e.t("moreReactions"),label:e.t("moreReactions"),onCalcitePopoverBeforeOpen:this.handleReactionPopoverBeforeOpen,onCalcitePopoverClose:i,onCalcitePopoverOpen:o,open:"overflow"===n,overlayPositioning:"fixed",placement:"bottom",referenceElement:c,"trigger-disabled":!0},this.renderUserReactions(t,!0)))}renderDefaultReactions(){const{currentUserReactions:e,intl:t,isDisabled:i}=this;return s("div",{class:"default_reactions"},s("ul",null,Me.map((o=>{const a=e.find((e=>e.value===o));return s("li",{key:o},s("calcite-button",{appearance:a?"outline":"transparent","aria-checked":a?"true":"false","data-reaction":o,disabled:i,kind:a?"brand":"neutral",label:t.t(a?"reaction_picker_label_remove":"reaction_picker_label_add",{reaction:t.t(o)}),onClick:this.handleReactionClicked,role:"radio",round:!0,scale:"m"},Ve[o].emoji))}))),s("calcite-button",{appearance:"transparent",disabled:i,"icon-start":"plus",kind:"neutral",label:t.t("viewAllReactions"),onClick:this.handleViewAllReactionsClick,round:!0,scale:"m"}))}renderAllReactions(){const{intl:e,currentUserReactions:t,isDisabled:i,handleReactionClicked:o,handleReactionRef:a}=this;return s("ul",{class:"all_reactions_list"},Se.map(((n,r)=>{const c=t.find((e=>e.value===n));return s("li",{key:n},s("calcite-button",{appearance:c?"outline":"transparent","aria-checked":c?"true":"false","data-index":r,"data-reaction":n,disabled:i,kind:c?"brand":"neutral",label:e.t(c?"reaction_picker_label_remove":"reaction_picker_label_add",{reaction:e.t(n)}),onClick:o,ref:a,round:!0,scale:"m"},Ve[n].emoji))})))}renderAddReaction(){const{intl:e,handleAddReactionClick:t,handleAddReactionPopoverClose:i,isDisabled:o,activePopover:n,showAllReactions:r,addReactionButton:c}=this;return s(a,null,s("calcite-button",{appearance:"outline","data-reaction":"add",disabled:o,"icon-start":"add-reaction",kind:"add"===n?"brand":"neutral",label:e.t("addReaction"),onClick:t,ref:e=>{this.addReactionButton=e},round:!0,scale:"m"}),s("calcite-popover",{"auto-close":!0,"data-reaction":"add",label:e.t("addReaction"),onCalcitePopoverClose:i,open:"add"===n,overlayPositioning:"fixed",placement:"bottom",referenceElement:c,scale:"m"},r?this.renderAllReactions():this.renderDefaultReactions()))}render(){return s(i,{class:{rtl:"rtl"===this.intl.direction},"data-element":"arcgis-hub-discussions-post-reactions"},s("div",null,this.renderList(),this.renderOverflow(),this.renderAddReaction()))}static get assetsDirs(){return["locales"]}get element(){return o(this)}static get watchers(){return{context:["handleContextChanged"],postId:["handlePostIdChanged"]}}};(function(e,t,s,i){var o,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(n=(a<3?o(n):a>3?o(t,s,n):o(t,s))||n);a>3&&n&&Object.defineProperty(t,s,n)})([W({delay:300})],Ke.prototype,"fetchUserRecord",null),Ke.style=':host{display:inline-block}:host>div>calcite-button{margin-right:0.125rem;border-width:2px;border-style:solid;border-color:transparent;padding:0.125rem}:host>div>calcite-button:last-of-type{margin-right:0px}.submitted_reactions_list calcite-button{border-width:2px;border-style:solid;border-color:transparent;padding:0.125rem}.submitted_reactions_list calcite-button span{margin-left:0.25rem}calcite-button[aria-checked="true"],calcite-button[data-reaction="add"][aria-expanded="true"]{border-color:var(--calcite-ui-brand)}:host(.rtl) calcite-button[data-reaction="add"]{transform:scaleX(-1)}calcite-button[aria-checked="true"] span{font-weight:var(--calcite-font-weight-bold)}:host>div{display:flex}.submitted_reactions_list{margin:0px;display:inline-flex;list-style-type:none;padding:0px}.submitted_reactions_list li{margin-right:0.125rem}.user_reactions_popover{width:20rem}.user_reactions_list{margin:0px;display:grid;max-height:407px;list-style-type:none;grid-auto-flow:row;row-gap:0.75rem;overflow:auto;padding:0.75rem}.user_reaction_item{display:grid;grid-template-rows:repeat(2, minmax(0, 1fr));column-gap:0.75rem;row-gap:0.125rem;background-color:var(--calcite-ui-foreground-1);grid-template-columns:2.75rem auto}.user_reaction_item:has(div:nth-of-type(3)){grid-template-columns:2.75rem auto minmax(0, 16px)}.user_reaction_item calcite-avatar{grid-row:span 2 / span 2;height:2.75rem;width:2.75rem}.user_reaction_item div:nth-of-type(1){display:flex;flex-grow:1;align-items:center;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-bold);text-transform:capitalize;color:var(--calcite-ui-text-1)}.user_reaction_item div:nth-of-type(2){display:flex;align-items:center;font-size:var(--calcite-font-size--1);line-height:1rem;color:var(--calcite-ui-text-2)}.user_reaction_item:has(div:nth-of-type(3)) div:nth-of-type(2){grid-row:span 2 / span 2;justify-content:flex-end}.user_reaction_item div:nth-of-type(2):before{content:\'@\'}.user_reaction_item:has(div:nth-of-type(3)) div:nth-of-type(2):before{content:\'\'}.user_reaction_item div:nth-of-type(3){display:flex;align-items:center;font-size:var(--calcite-font-size--1);line-height:1rem;color:var(--calcite-ui-text-2)}.user_reaction_item div:nth-of-type(3):before{content:\'@\'}arcgis-skeleton-loader{display:grid;grid-template-rows:repeat(2, minmax(0, 1fr));column-gap:0.75rem;row-gap:0.125rem;grid-template-columns:2.75rem auto}arcgis-skeleton-loader:has(div:nth-of-type(4)){grid-template-columns:2.75rem auto minmax(0, 16px)}@keyframes shimmer{0%{background-size:200% 100%;background-position:100% 0}100%{background-size:200% 100%;background-position:-100% 0}}arcgis-skeleton-loader>div:nth-of-type(1){animation:shimmer 2s cubic-bezier(0.4, 0, 0.2, 0.8) infinite;background-image:linear-gradient(90deg, rgba(255, 255, 255, 0) 0, rgba(255, 255, 255, 0) 40%, rgba(255, 255, 255, 0.6) 50%, rgba(255, 255, 255, 0) 60%, rgba(255, 255, 255, 0) 100%);background-color:var(--calcite-ui-foreground-3);grid-row:span 2 / span 2;height:2.75rem;width:2.75rem;border-radius:50%}arcgis-skeleton-loader>div:nth-of-type(2){display:flex;align-items:center}@keyframes shimmer{0%{background-size:200% 100%;background-position:100% 0}100%{background-size:200% 100%;background-position:-100% 0}}arcgis-skeleton-loader>div:nth-of-type(2) div{animation:shimmer 2s cubic-bezier(0.4, 0, 0.2, 0.8) infinite;background-image:linear-gradient(90deg, rgba(255, 255, 255, 0) 0, rgba(255, 255, 255, 0) 40%, rgba(255, 255, 255, 0.6) 50%, rgba(255, 255, 255, 0) 60%, rgba(255, 255, 255, 0) 100%);background-color:var(--calcite-ui-foreground-3);display:flex;flex-grow:1;border-radius:0.375rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}arcgis-skeleton-loader>div:nth-of-type(3){display:flex;align-items:center}@keyframes shimmer{0%{background-size:200% 100%;background-position:100% 0}100%{background-size:200% 100%;background-position:-100% 0}}arcgis-skeleton-loader>div:nth-of-type(3) div{animation:shimmer 2s cubic-bezier(0.4, 0, 0.2, 0.8) infinite;background-image:linear-gradient(90deg, rgba(255, 255, 255, 0) 0, rgba(255, 255, 255, 0) 40%, rgba(255, 255, 255, 0.6) 50%, rgba(255, 255, 255, 0) 60%, rgba(255, 255, 255, 0) 100%);background-color:var(--calcite-ui-foreground-3);display:flex;flex-grow:1;border-radius:0.375rem;font-size:var(--calcite-font-size--1);line-height:1rem}arcgis-skeleton-loader:has(div:nth-of-type(4))>div:nth-of-type(3){grid-row:span 2 / span 2;display:flex;align-items:center}@keyframes shimmer{0%{background-size:200% 100%;background-position:100% 0}100%{background-size:200% 100%;background-position:-100% 0}}arcgis-skeleton-loader::has(div:nth-of-type(4))>div:nth-of-type(3) div{animation:shimmer 2s cubic-bezier(0.4, 0, 0.2, 0.8) infinite;background-image:linear-gradient(90deg, rgba(255, 255, 255, 0) 0, rgba(255, 255, 255, 0) 40%, rgba(255, 255, 255, 0.6) 50%, rgba(255, 255, 255, 0) 60%, rgba(255, 255, 255, 0) 100%);background-color:var(--calcite-ui-foreground-3);display:flex;height:1rem;flex-grow:1;border-radius:0.5rem;font-size:var(--calcite-font-size--1);line-height:1rem}@keyframes shimmer{0%{background-size:200% 100%;background-position:100% 0}100%{background-size:200% 100%;background-position:-100% 0}}arcgis-skeleton-loader>div:nth-of-type(4) div{animation:shimmer 2s cubic-bezier(0.4, 0, 0.2, 0.8) infinite;background-image:linear-gradient(90deg, rgba(255, 255, 255, 0) 0, rgba(255, 255, 255, 0) 40%, rgba(255, 255, 255, 0.6) 50%, rgba(255, 255, 255, 0) 60%, rgba(255, 255, 255, 0) 100%);background-color:var(--calcite-ui-foreground-3);display:flex;flex-grow:1;border-radius:0.375rem;font-size:var(--calcite-font-size--1);line-height:1rem}.default_reactions{display:flex;flex-direction:row;padding:0.75rem}.default_reactions ul{margin-top:0px;margin-bottom:0px;margin-left:0px;margin-right:0.5rem;display:inline-flex;list-style-type:none;padding:0px}.default_reactions li{margin-right:0.5rem}.default_reactions li:last-of-type{margin-right:0px}.all_reactions_list{margin:0px;display:grid;list-style-type:none;grid-template-columns:repeat(5, minmax(0, 1fr));gap:0.5rem;padding:0.75rem}';const Ne=class{constructor(t){e(this,t)}render(){return s(i,null,s("arcgis-skeleton-loader",{active:!0,rows:0,showFooter:!1,showHeading:!1,showThumbnail:!1},s("div",null),s("div",null,s("div",null)),s("div",null,s("div",null),s("div",null)),s("div",null)))}};Ne.style=":host{display:block}arcgis-skeleton-loader{display:grid;column-gap:1rem;row-gap:0.5rem;padding:0.25rem;grid-template-rows:repeat(3, minmax(0, auto));grid-template-columns:2.75rem auto}@keyframes shimmer{0%{background-size:200% 100%;background-position:100% 0}100%{background-size:200% 100%;background-position:-100% 0}}arcgis-skeleton-loader>div:nth-of-type(1),arcgis-skeleton-loader>div:nth-of-type(2)>div,arcgis-skeleton-loader>div:nth-of-type(3)>div,arcgis-skeleton-loader>div:nth-of-type(4){animation:shimmer 2s cubic-bezier(0.4, 0, 0.2, 0.8) infinite;background-image:linear-gradient(90deg, rgba(255, 255, 255, 0) 0, rgba(255, 255, 255, 0) 40%, rgba(255, 255, 255, 0.6) 50%, rgba(255, 255, 255, 0) 60%, rgba(255, 255, 255, 0) 100%);background-color:var(--calcite-ui-foreground-3);height:0.75rem;border-radius:0.375rem}arcgis-skeleton-loader>div:nth-of-type(1){grid-row:span 3 / span 3;height:2.75rem;width:2.75rem;border-radius:50%}arcgis-skeleton-loader>div:nth-of-type(3){display:grid;grid-template-rows:repeat(1, minmax(0, 1fr));column-gap:0.75rem;grid-template-columns:calc((100% - .75rem) * .6) calc((100% - .75rem) * .4)}arcgis-skeleton-loader>div:nth-of-type(2)>div{margin-bottom:0.5rem}";const $e=class{constructor(s){e(this,s),this.arcgisLayoutListLayoutSelected=t(this,"arcgisLayoutListLayoutSelected",7),this.layout="list",this.disabled=!1,this.showMapControl=void 0,this.scale="s",this.listStyleDeclaration=void 0,this.hasSlottedActions=!1,r(this,"handleResized","handleLayoutSelected","handleSlotChanged")}connectedCallback(){ge.addHandler(this.element,this.handleResized)}async componentWillLoad(){await this.loadTranslations()}disconnectedCallback(){ge.unobserve(this.element)}async loadTranslations(){this.intl=await n.loadIntlForComponent(this.element)}handleResized(){this.listRef&&(this.listStyleDeclaration=globalThis.getComputedStyle(this.listRef))}get showActions(){return this.hasLayoutActions||this.hasSlottedActions}handleSlotChanged(){this.hasSlottedActions=Boolean(this.element.querySelector('[slot="actions"]'))}get hasLayoutActions(){const{listStyleDeclaration:e,layout:t,showMapControl:s}=this;let i=!1;if(e){const o=parseInt(e.getPropertyValue("gap"),10),a=e.getPropertyValue("grid-template-columns").split(" "),n=parseFloat(a[0]),r=e.getPropertyValue("--arcgis-hub-layout-list-min-column-width"),c=parseFloat(r)*(r.endsWith("rem")?16:1);i=a.length>1||2*c+o<n||s&&"map"===t}return Boolean(i)}handleLayoutSelected(e){this.layout=e.target.icon,this.arcgisLayoutListLayoutSelected.emit(this.layout)}renderList(){return s("ol",{class:{[this.layout]:!0},ref:e=>{this.listRef=e}},s("slot",null))}renderLayoutActions(){if(this.hasLayoutActions){const{layout:e,intl:t,disabled:i,handleLayoutSelected:o,scale:a,showMapControl:n}=this,r=[...n?["map"]:[],"grid","list"];return s("div",{class:"layout-actions"},s("calcite-action-bar",{"expand-disabled":!0,layout:"horizontal"},r.map((n=>s("calcite-action",{active:e===n,disabled:i,icon:n,key:n,label:t.t(`${n}.label`),onClick:o,scale:a,text:t.t(`${n}.text`)})))))}}renderActions(){return s("div",{class:{actions:!0,hasActions:this.showActions}},s("div",null,s("slot",{name:"actions",onSlotchange:this.handleSlotChanged})),this.renderLayoutActions())}render(){return s(i,{class:{rtl:"rtl"===this.intl.direction}},this.renderActions(),this.renderList())}static get assetsDirs(){return["locales"]}get element(){return o(this)}};(function(e,t,s,i){var o,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(n=(a<3?o(n):a>3?o(t,s,n):o(t,s))||n);a>3&&n&&Object.defineProperty(t,s,n)})([me({timeout:250})],$e.prototype,"handleResized",null),$e.style=":host{display:block}ol{margin:0px;display:grid;padding:0px;gap:var(--arcgis-hub-layout-list-gap, 1rem)}.map{grid-template-columns:1fr}.list{grid-template-columns:1fr}.grid{grid-template-columns:repeat(auto-fill, minmax(var(--arcgis-hub-layout-list-min-column-width, 20rem), 1fr))}.actions{display:grid;align-items:center;gap:var(--arcgis-hub-layout-list-actions-gap, 0.25rem);grid-template-columns:1fr;grid-template-rows:1fr;margin-bottom:var(--arcgis-hub-layout-list-actions-margin, 1rem)}.actions:has(.layout-actions){grid-template-columns:auto max-content}.actions:not(.hasActions){display:none}:host(.rtl) .layout-actions calcite-action{transform:scaleX(-1)}";const We=class{constructor(s){e(this,s),this.arcgisLoadMoreChange=t(this,"arcgisLoadMoreChange",7),this.nextStart=void 0,this.color="neutral",this.appearance="transparent",this.scale="l",this.width="full",this.round=!0,this.loading=!1,r(this,"handleLoadMore")}get hasMoreResults(){const{nextStart:e}=this;return-1!==e}get disabled(){const{loading:e,hasMoreResults:t}=this;return e||!t}async componentWillLoad(){this.intl=await n.loadIntlForComponent(this.el)}handleLoadMore(){const{nextStart:e}=this;this.arcgisLoadMoreChange.emit(e)}render(){const{loading:e,handleLoadMore:t,round:o,scale:a,width:n,intl:r,hasMoreResults:c,disabled:l,color:d,appearance:h}=this,u=r.t("loadMore");return s(i,null,c&&s("calcite-button",{appearance:h,disabled:l,kind:be(d),label:u,loading:e,onClick:t,round:o,scale:a,width:n},u))}static get assetsDirs(){return["locales"]}get el(){return o(this)}};We.style=":host{display:block}";export{_e as arcgis_hub_discussions_blocked_notice,ke as arcgis_hub_discussions_popover,Fe as arcgis_hub_discussions_post,Ae as arcgis_hub_discussions_post_chips,ze as arcgis_hub_discussions_post_editor,He as arcgis_hub_discussions_post_geography,Le as arcgis_hub_discussions_post_header,Ke as arcgis_hub_discussions_post_reactions,Ne as arcgis_hub_discussions_post_skeleton,$e as arcgis_layout_list,We as arcgis_load_more_button}