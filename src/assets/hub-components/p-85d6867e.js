import{g as e}from"./p-a0deb8c6.js";import{g as t,a as n}from"./p-dd26efbb.js";import{g as o,P as a,f as i,i as s,s as r}from"./p-6f931af6.js";import{c,u,e as l,b as d}from"./p-b728aff4.js";import{f as m,m as p,g as f,h as y,i as g}from"./p-8dbea197.js";import{g as h}from"./p-7202c430.js";import{g as b,i as w}from"./p-90dc0f6f.js";import{i as v}from"./p-59fd2498.js";import{g as j,a as K}from"./p-cea8413b.js";import{r as $}from"./p-16a95e5b.js";import{g as E}from"./p-796574a4.js";import{a as O}from"./p-d1b12a9c.js";import{u as I}from"./p-e43616ff.js";import{c as D}from"./p-ca048216.js";import{s as S}from"./p-52612356.js";import{_ as k,a as T,d as V,s as H}from"./p-4a14259a.js";import{s as A}from"./p-235bb6ee.js";import{g as N}from"./p-3904125b.js";import{g as P}from"./p-783242bc.js";import{d as x}from"./p-c836a9b6.js";function _(e){return Object.keys(e).forEach((t=>{e[t]&&"object"==typeof e[t]?_(e[t]):null==e[t]&&delete e[t]})),e}function R(e){return"string"==typeof e?e.trim().toLowerCase().replace(/ +/g,"-").replace(/[^\w-]/g,"").replace(/-+/g,"-"):e}function U(e,t){return`${t.toLowerCase()}|${R(e)}`}function L(e,t){const n=e.filter((e=>!e.startsWith("slug|")));return n.push(`slug|${t}`),n}function C(e,t){return M({slug:function(e){return e.indexOf("::")>-1&&(e=e.replace("::","|")),e}(e)},t).then((e=>e.length?j(e[0].id,t):null))}function M(e,t){const n={filter:`typekeywords:"slug|${e.slug}"`};return t.authentication?n.authentication=t.authentication:t.portal&&(n.portal=t.portal),e.exclude&&(n.q=`NOT id:${e.exclude}`),A(n).then((e=>e.results)).catch((e=>{throw e}))}function G(e,t,n=0){let o=e.slug;return n&&(o=`${e.slug}-${n}`),M({slug:o,exclude:e.existingId},t).then((a=>a.length?(n++,G(e,t,n)):o)).catch((e=>{throw Error(`Error in getUniqueSlug ${e}`)}))}function q(e){var t;const n=null===(t=e.properties)||void 0===t?void 0:t.slug;return n?function(e){return e.indexOf("|")>-1&&(e=e.replace("|","::")),e}(n):e.id}function B(e,t){return Promise.all([j(e,t),K(e,t)]).then((e=>({item:e[0],data:e[1]})))}function J(e,t){const n=c(e.item);n.data=c(e.data),n.extent&&"string"!=typeof n.extent&&(n.extent=O(n.extent));const o=Object.assign({item:n},t);return D(o).then((e=>B(e.id,t)))}function F(e,t){const n=c(e.item);n.data=c(e.data),n.extent&&"string"!=typeof n.extent&&(n.extent=O(n.extent)),function(e){return["description","snippet","tags","categories","licenseInfo"].some((t=>{var n;return""===e[t]||0===(null===(n=e[t])||void 0===n?void 0:n.length)}))}(n)&&(t.params=Object.assign(Object.assign({},t.params),{clearEmptyFields:!0}));const o=Object.assign({item:n},t);return I(o).then((()=>n.data?B(n.id,t):j(n.id,t).then((e=>({item:e})))))}async function z(e,t){return{item:e,data:await K(e.id,t)}}function W(e){const t=e.split(" AS "),n=t[0],o=t[1]||n.split(".").reverse()[0];return{enrichment:n.split(".")[0],path:n,prop:o}}function Q(e,t){const n=Object.assign(Object.assign({},t),e),o=Object.keys(t);return Object.keys(n).reduce(((e,t)=>(o.includes(t)||e.push(t),e)),[]).forEach((e=>{delete n[e]})),n}function X(){const e=o();return["headContent","layout"].forEach((t=>{e.push({entityKey:t,storeKey:`data.values.${t}`})})),e}function Y(e,n,o){var a;let i;o.authentication&&(i=o.authentication.token);const s=b(e.item,o,i);return n.thumbnailUrl=s,n.links={self:t(n.id,o),siteRelative:`/pages/${n.id}`,workspaceRelative:h("page",n.id),layoutRelative:`/pages/${n.id}/edit`,thumbnail:s},n.createdDate=new Date(e.item.created),n.createdDateSource="item.created",n.updatedDate=new Date(e.item.modified),n.updatedDateSource="item.modified",n.features=Q((null===(a=e.data.settings)||void 0===a?void 0:a.features)||{},m),n}const Z="Hub Page",ee="Site Page",te={name:"No title provided",permissions:[],schemaVersion:1,tags:[],typeKeywords:["hubPage"],view:{contacts:[],featuredContentIds:[],showMap:!0}},ne={item:{type:"Hub Page",title:"No Title Provided",description:"",snippet:"",tags:[],typeKeywords:["hubPage"],properties:{slug:"",schemaVersion:1}},data:{values:{layout:{}}}};async function oe(e,t){const n=Object.assign(Object.assign({},te),e);n.slug||(n.slug=U(n.name,n.orgUrlKey)),n.slug=await G({slug:n.slug},t),n.typeKeywords=L(n.typeKeywords,n.slug);const o=new a(X());let i=o.entityToStore(n,c(ne));i=await J(i,t);let s=o.storeToEntity(i,{});return s=Y(i,s,t),s}async function ae(e,t){e.slug=await G({slug:e.slug,existingId:e.id},t);const n=await B(e.id,t),o=new a(X()),i=o.entityToStore(e,n),s=await F(i,t);let r=o.storeToEntity(s,e);return r=Y(n,r,t),r}async function ie(e,t){let n;return n=v(e)?j(e,t):C(e,t),n.then((e=>e?async function(e,t){return function(e,t){return Y(e,new a(X()).storeToEntity(e,{}),t)}(await z(e,t),t)}(e,t):null))}async function se(e,t){const n=Object.assign(Object.assign({},t),{id:e});await $(n)}async function re(o,a,s){const r={access:o.access,id:o.id,type:o.type,name:o.title,owner:o.owner,typeKeywords:o.typeKeywords,tags:o.tags,categories:o.categories,summary:o.snippet||o.description,createdDate:new Date(o.created),createdDateSource:"item.created",updatedDate:new Date(o.modified),updatedDateSource:"item.modified",family:e(o.type),links:{self:"not-implemented",siteRelative:"not-implemented",thumbnail:"not-implemented"}},c=(a=[...a].filter(u)).map(W),l=p("enrichment",c).filter(u);let d={};return l.length&&(d=await i(o,l,s)),c.forEach((e=>{r[e.prop]=E(d,e.path)})),r.links.thumbnail=b(o,s),r.links.self=t(r.id,s),r.links.siteRelative=n(r.type,r.id,o.typeKeywords),r}function ce(e,t){let n=e;e.indexOf("#/")>-1&&(n=e.split("#/")[1]);const o=`hubsubdomain|${n}`,a=Object.assign({q:`typekeywords: ${o}`},t);return A(a).then((e=>e.results.filter((e=>w(e.typeKeywords,o)))[0])).then((e=>{if(!e)throw new Error("site not found");return{hostname:e.url,siteId:e.id}}))}async function ue(e){return e.status>=200&&e.status<300?e.json():e.json().then((t=>{if(t.error)throw new Error(`${t.error.title} :: ${t.error.detail} :: ${e.status}`);throw new Error(`Got ${e.status} ${e.statusText}`)}))}function le(e,t){if(t.isPortal)return ce(e,t);{const n=`${T(t.hubApiUrl)}/${e}`,o=k(t);return fetch(n,{method:"GET",headers:o,mode:"cors"}).then(ue)}}function de(e){let t=c(e);return 1===E(t,"schemaVersion")||(t=function(e){if(E(e,"schemaVersion")>1)return e;{const t={schemaVersion:1,title:"Default Catalog",scopes:{item:{targetEntity:"item",filters:[]}},collections:[]},n=E(e,"groups");let o=[];Array.isArray(n)&&n.length?o=n:"string"==typeof n&&(o=[n]),o.length&&t.scopes.item.filters.push({predicates:[{group:o}]});const a=E(e,"orgId");return a&&t.scopes.item.filters.push({predicates:[{orgid:[a]},{type:{not:["Code Attachment"]}}]}),t}}(t)),t}function me(e,o){let a;return o.authentication&&(a=o.authentication.token),{self:t(e.id,o),siteRelative:n(e.type,q(e)),workspaceRelative:h(e.type,q(e)),thumbnail:b(e,o,a)}}function pe(e,t,n){var o;let a;return n.authentication&&(a=n.authentication.token),t.thumbnailUrl=b(e.item,n,a),t.createdDate=new Date(e.item.created),t.createdDateSource="item.created",t.updatedDate=new Date(e.item.modified),t.updatedDateSource="item.modified",t.isDiscussable=s(t),t.features=Q((null===(o=e.data.settings)||void 0===o?void 0:o.features)||{},f),t.links=me(e.item,n),t}function fe(){const e=o();return e.push({entityKey:"status",storeKey:"data.status"}),e.push({entityKey:"catalog",storeKey:"data.catalog"}),e.push({entityKey:"permissions",storeKey:"data.permissions"}),e.push({entityKey:"features",storeKey:"data.settings.features"}),e.push({entityKey:"location",storeKey:"item.properties.location"}),e.push({entityKey:"metrics",storeKey:"item.properties.metrics"}),e}const ye={"{{default.name}}":"{{name}}","{{default.description}}":"{{description}}","{{item.tags}}":"{{tags}}","{{item.created:toISO}}":"{{created:toISO}}","{{item.modified:toISO}}":"{{modified:toISO}}","{{default.source.source}}":"{{source}}","{{item.owner}}":"{{owner}}","{{org.portalProperties.links.contactUs.url}}":"{{orgContactEmail}}","{{org.name}}":"{{orgName}}","{{item.categories}}":"{{categories}}","{{item.licenseInfo}}":"{{licenseInfo}}","{{item.modified}}":"{{modified}}","{{enrichments.categories}}":"{{categories}}","{{default.id}}":"{{id}}","{{item.licenseInfo || No License}}":"{{licenseInfo || No License}}","{{org.portalProperties.links.contactUs.url || mailto:data@tempe.gov}}":"{{orgContactEmail || mailto:data@tempe.gov}}","{{default.description || No Description}}":"{{description || No Description}}","{{item.id}}":"{{id}}"};function ge(e,t){if(t.isPortal)throw new Error("addDomain is not available in ArcGIS Enterprise. Instead, edit the hubdomain typekeyword on the item");const n=k(t);n["Content-Type"]="application/json";const o=`${T(t.hubApiUrl)}`,a=e.siteTitle;return"number"==typeof a&&(e.siteTitle=a.toString()),e.clientKey&&(e.clientKey=""),fetch(o,{method:"POST",headers:n,mode:"cors",body:JSON.stringify(e)}).then(ue)}function he(e,t,n,o=0){let a=e;return o&&(a=e+"-"+o),V(`${a}-${t}`,n).then((i=>i?he(e,t,n,o+1):a))}function be(e,t,n=0){let o=e;return n&&(o=e+"-"+n),function(e,t){return ce(e,t).then((()=>!0)).catch((()=>!1))}(o,t).then((a=>a?be(e,t,n+1):o))}function we(e,t){let n;return n=t.isPortal?be(e,t):he(e,`${t.portalSelf.urlKey}.${H(N(t))}`,t),n.then((e=>function(e,t){let n=c(e),o=63;return t&&(o-=t.length+1),n.length>o&&(n=`${n.slice(0,o-6)}-${function(){let e=(new Date).getTime();return Array(5).fill(0).reduce((function(t){const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),`${t}${n.toString(16)}`}),"")}()}`),n}(e,t.portalSelf.urlKey)))}const ve=[{capability:"hideFollow",feature:"hub:site:feature:follow",negate:!0},{capability:"disableDiscussions",feature:"hub:site:feature:discussions",negate:!0}];function je(e){return 1.7===E(e,"item.properties.schemaVersion")?e:e=function(e){if(E(e,"item.properties.schemaVersion")>=1.7)return e;const t=c(e);t.data.telemetry={};const n=(E(e,"data.values.capabilities")||[]).includes("consentNotice");t.data.telemetry.consentNotice={allowPrivacyConfig:n,disclaimer:[{text:E(e,"data.values.telemetry.consentNotice.consentText")||"",default:!0}],policyURL:E(e,"data.values.telemetry.consentNotice.policyURL")||""};const o=E(e,"item.properties.telemetry.plugins");return o&&(t.data.telemetry.plugins=o),S("item.properties.schemaVersion",1.7,t),t}(e=(e=>{const t={};let n={};(E(e,"data.values.capabilities")||[]).forEach((e=>{t[e]=!0}));const o=E(e,"data.settings.features")||{};return n=ve.reduce(((e,n)=>{const o=n.negate?!t[n.capability]:t[n.capability];return Object.assign(Object.assign({},e),{[n.feature]:o})}),o),S("data.settings.features",n,e),e})(e=function(e){var t;if((null===(t=e.item.properties)||void 0===t?void 0:t.schemaVersion)>=1.6)return e;const n=c(e);return n.data.values.layout.sections.map((e=>Object.assign(Object.assign({},e),{rows:(e.rows||[]).map((e=>Object.assign(Object.assign({},e),{cards:(e.cards||[]).map((e=>("event-list-card"===e.component.name&&(e.component.settings.displayMode=e.component.settings.calendarEnabled?"calendar":"list",delete e.component.settings.calendarEnabled),e)))})))}))),S("item.properties.schemaVersion",1.6,n),n}(e=function(e){if(E(e,"item.properties.schemaVersion")>=1.5)return e;const t=c(e),n=t.data.values.dcatConfig;return t.data.feeds={},n&&(t.data.feeds.dcatUS11=function(e){let t=JSON.stringify(e);return Object.keys(ye).forEach((e=>{const n=ye[e];t=t.split(e).join(n)})),JSON.parse(t)}(n)),t.item.properties.schemaVersion=1.5,t}(e=function(e){if(E(e,"item.properties.schemaVersion")>=1.4)return e;const t=c(e),n=E(t,"data.values.gacode");return t.data.values.telemetry={consentNotice:{isTheme:!0,consentText:"",policyURL:""},customAnalytics:{ga:{customerTracker:{enabled:Boolean(n),id:n}}}},function(e,t){if("object"!=typeof e||null===e)return;const n=t.split(".");for(let t=0;t<n.length-1;t++){if(!e.hasOwnProperty(n[t]))return;e=e[n[t]]}delete e[n[n.length-1]]}(t,"data.values.gacode"),S("item.properties.schemaVersion",1.4,t),t}(e=function(e){if(E(e,"item.properties.schemaVersion")>=1.3)return e;const t=c(e),n=E(t,"data.catalog.groups")||[];return t.data.catalog.groups=n.filter(v),t.item.properties.schemaVersion=1.3,t}(e=function(e){if(E(e,"item.properties.schemaVersion")>=1.2)return e;const t=c(e),n=E(t,"data.catalog")||{};return E(t,"data.values.groups")&&(n.groups=c(t.data.values.groups),delete t.data.values.groups),t.data.catalog=n,t.item.properties.schemaVersion=1.2,t}(e=function(e){if(E(e,"item.properties.schemaVersion")>=1.1)return e;const t=c(e);return["subdomain","defaultHostname","internalUrl","customHostname","externalUrl"].forEach((e=>{t.data.values[e]&&"string"==typeof t.data.values[e]&&(t.data.values[e]=t.data.values[e].toLowerCase())})),t.item.properties.schemaVersion=1.1,t}(e=function(e){if(E(e,"item.properties.schemaVersion")>=1)return e;const t=c(e);if(["groupId","title"].forEach((e=>{delete t.data.values[e]})),t.item.properties||(t.item.properties={}),t.item.properties.schemaVersion=1,t.data.values.groups&&Array.isArray(t.data.values.groups)){const e=t.data.values.groups.map((e=>"object"==typeof e?e.id:e)).filter((e=>!!e));t.data.values.groups=e}return t}(e)))))))))}function Ke(e,t){return B(e,t).then(je)}function $e(){const e=o();return e.push({entityKey:"feeds",storeKey:"data.feeds"}),e.push({entityKey:"permissions",storeKey:"data.permissions"}),["pages","theme","subdomain","defaultHostname","customHostname","clientId","defaultExtent","map","headerSass","headContent","layout"].forEach((t=>{e.push({entityKey:t,storeKey:`data.values.${t}`})})),e.push({entityKey:"slug",storeKey:"item.properties.slug"}),e.push({entityKey:"followersGroupId",storeKey:"item.properties.followersGroupId"}),e.push({entityKey:"legacyCapabilities",storeKey:"data.values.capabilities"}),e.push({entityKey:"orgUrlKey",storeKey:"item.properties.orgUrlKey"}),e.push({entityKey:"name",storeKey:"item.title"}),e.push({entityKey:"location",storeKey:"item.properties.location"}),e.push({entityKey:"legacyTeams",storeKey:"item.properties.teams"}),e.push({entityKey:"catalog",storeKey:"data.catalog"}),e.push({entityKey:"features",storeKey:"data.settings.features"}),e.push({entityKey:"telemetry",storeKey:"data.telemetry"}),e}const Ee={header:{background:"#fff",text:"#4c4c4c"},body:{background:"#fff",text:"#4c4c4c",link:"#0079c1"},button:{background:"#0079c1",text:"#fff"},logo:{small:""},fonts:{base:{url:"",family:"Avenir Next"},heading:{url:"",family:"Avenir Next"}}};var Oe;!function(e){e.DATA="components.search.category_tabs.data",e.SITES="components.search.category_tabs.sites",e.DOCUMENTS="components.search.category_tabs.documents",e.APPS_AND_MAPS="components.search.category_tabs.apps_and_maps",e.EVENTS="components.search.category_tabs.events",e.INITIATIVES="components.search.category_tabs.initiatives"}(Oe||(Oe={}));const Ie="Hub Site Application",De="Site Application",Se={name:"No title provided",tags:[],typeKeywords:["Hub Site","hubSite","DELETEMESITE"],legacyCapabilities:["api_explorer","pages","my_data","social_logins","json_chart_card","document_iframes","items_view","app_page","underlinedLinks","globalNav","socialSharing"],catalog:{schemaVersion:1},subdomain:"",defaultHostname:"",customHostname:"",clientId:"",map:null,feeds:{},pages:[],theme:null,contentViews:{sidePanelOpen:{app:!0,map:!0,dataset:!0,document:!0,feedback:!0}}},ke={item:{title:"No Title Provided",description:"No Description Provided",snippet:"",tags:[],typeKeywords:["Hub Site","hubSite","DELETEMESITE"],properties:{slug:"",orgUrlKey:"",defaultHostname:"",customHostname:"",clientId:"",subdomain:"",schemaVersion:1.5},url:""},data:{catalog:{groups:[]},feeds:{},values:{title:"",defaultHostname:"",customHostname:"",subdomain:"",faviconUrl:"",uiVersion:"2.4",clientId:"",map:{basemaps:{}},defaultExtent:{},pages:[],theme:{},layout:{sections:[],header:{component:{name:"site-header",settings:{fullWidth:!1,iframeHeight:"150px",iframeUrl:"",links:[],logoUrl:"",title:"default site",markdown:"",headerType:"default",schemaVersion:3,showLogo:!0,showTitle:!0,logo:{display:{},state:"valid"},shortTitle:"",menuLinks:[],socialLinks:{facebook:{},twitter:{},instagram:{},youtube:{}}}},showEditor:!1},footer:{component:{name:"site-footer",settings:{footerType:"none",markdown:"",schemaVersion:2.1}},showEditor:!1}},contentViews:{sidePanelOpen:{app:!0,map:!0,dataset:!0,document:!0,feedback:!0}}}}};async function Te(e,t){const n=Object.assign(Object.assign({},Se),e),o=t.portalSelf;n.type=t.isPortal?"Site Application":"Hub Site Application",n.slug||(n.slug=U(n.name,n.orgUrlKey)),n.typeKeywords=L(n.typeKeywords,n.slug),n.subdomain||(n.subdomain=R(n.name)),n.subdomain=await we(n.subdomain,t),t.isPortal?(n.typeKeywords.push(`hubsubdomain|${n.subdomain}`.toLowerCase()),n.url=`${t.authentication.portal.replace("/sharing/rest","/apps/sites")}/#/${n.subdomain}`):(n.defaultHostname=`${n.subdomain}-${o.urlKey}.${H(N(t))}`,n.url=`https://${n.customHostname?n.customHostname:n.defaultHostname}`),n.orgUrlKey=o.urlKey,n.theme||(n.theme=function(e){let t=c(Ee),n=E(e,"portalProperties.sharedTheme");return n&&(n=_(n),t=l(t,n)),t}(o)),n.defaultExtent||(n.defaultExtent=o.defaultExtent),n.culture||(n.culture=o.culture),E(n,"map.basemaps.primary")||S("map.basemaps.primary",o.defaultBasemap,n),E(n,"layout.header.component.settings.title")||S("layout.header.component.settings.title",n.name,n),n.typeKeywords=r(n.typeKeywords,n.isDiscussable);const i=new a($e());let s=i.entityToStore(n,c(ke));s=await J(s,t);const u=await function(e,t){return t.isPortal?Promise.resolve([{clientKey:"arcgisonline"}]):Promise.all(["defaultHostname","customHostname"].reduce(((n,o)=>{const a=E(e,`data.values.${o}`);return a&&n.push(ge({hostname:a,clientKey:e.data.values.clientId,orgId:t.portalSelf.id,orgTitle:t.portalSelf.name,orgKey:t.portalSelf.urlKey,siteId:e.item.id,siteTitle:e.item.title,sslOnly:!0},t)),n}),[]))}(s,t);s.data.values.clientId=u[0].clientKey;const d=await F(s,t);return i.storeToEntity(d,{})}async function Ve(e,t){e.slug=await G({slug:e.slug,existingId:e.id},t),e.typeKeywords=r(e.typeKeywords,e.isDiscussable);const n=await B(e.id,t);let o=new a($e()).entityToStore(e,n);return await async function(e,t,n){const o={clientKey:e.data.values.clientId,orgId:n.portalSelf.id,orgTitle:n.portalSelf.name,orgKey:n.portalSelf.urlKey,siteId:e.item.id,siteTitle:e.item.title,sslOnly:!0},a={remove:[],add:[]};["customHostname","defaultHostname"].forEach((n=>{const o=E(t,`data.values.${n}`)||"",i=E(e,`data.values.${n}`)||"";i!==o&&(a.remove.push(o),a.add.push(i))}));const i=[];return a.add.map((e=>{const t=Object.assign({hostname:e},o);i.push(ge(t,n))})),a.remove.map((e=>{i.push(async function(e,t){if(t.isPortal)throw new Error("removeDomainByHostname is not available in ArcGIS Enterprise. Instead, edit the hubdomain typekeyword on the item");try{const n=await le(e,t),o=E(n,"id");o&&await function(e,t){if(t.isPortal)throw new Error("removeDomain is not available in ArcGIS Enterprise. Instead, edit the hubdomain typekeyword on the item");const n=k(t);n["Content-Type"]="application/json";const o=`${T(t.hubApiUrl)}/${e}`;return fetch(o,{method:"DELETE",headers:n,mode:"cors"}).then(ue)}(o,t)}catch(t){throw new Error(`Error removing domain entry for ${e}: ${t}`)}}(e,n))})),Promise.all(i)}(o,n,t),o=function(e){const t=c(e),n={dataset:Oe.DATA,site:Oe.SITES,appAndMap:Oe.APPS_AND_MAPS,document:Oe.DOCUMENTS},o={[Oe.DATA]:"Dataset",[Oe.SITES]:"Site",[Oe.APPS_AND_MAPS]:"App,Map",[Oe.DOCUMENTS]:"Document"},a=t.data.catalog.collections.filter((e=>!!n[e.key])).map((e=>{const t=n[e.key],a={hidden:e.hidden,key:t,queryParams:{collection:o[t]}};return e.label&&(a.overrideText=e.label),a}));return t.data.values.searchCategories=a,t}(o),o=function(e,t){const n=c(e),o=E(e,"data.catalog.scopes.item"),a=P(o);if(a){const e=c(t.data.catalog),o=Array.isArray(a.group)?a.group:[a.group];e.groups=o,n.data.catalog=e}else n.data.catalog=c(t.data.catalog);return n}(o,n),o=((e,t)=>{let n={};(E(t,"data.values.capabilities")||[]).forEach((e=>{n[e]=!0}));const o=E(e,"data.settings.features")||{};n=ve.reduce(((e,t)=>{const n=t.negate?!o[t.feature]:o[t.feature];return Object.assign(Object.assign({},e),{[t.capability]:n})}),n);const a=Object.entries(n).reduce(((e,[t,n])=>(n&&e.push(t),e)),[]);return S("data.values.capabilities",a,e),e})(o,n),Ne(await F(o,t),t)}async function He(e,t){t.isPortal||await function(e,t){if(t.isPortal)throw new Error("removeDomainsBySiteId is not available in ArcGIS Enterprise. Instead, edit the hubdomain typekeyword on the item");const n=k(t);n["Content-Type"]="application/json";const o=`${T(t.hubApiUrl)}/?siteId=${e}`;return fetch(o,{method:"DELETE",headers:n,mode:"cors"}).then(ue)}(e,t);const n=Object.assign(Object.assign({},t),{id:e});await $(n)}async function Ae(e,t){return Ne(await function(e,t){let n;if(v(e))n=Ke(e,t);else{let o=e;o=H(o),o=o.split("/")[0],n=le(o,t).then((({siteId:e})=>Ke(e,t)))}return n}(e,t),t)}function Ne(e,n){let o=function(e){const t=c(e);return t.data.permissions=t.data.permissions||[],[{prop:"item.properties.contentGroupId",type:"group",permissions:["hub:project:create"]},{prop:"item.owner",type:"user",permissions:["hub:site:delete"]}].forEach((e=>{const n=E(t,e.prop);n&&e.permissions.forEach((o=>{t.data.permissions.find((e=>e.permission===o&&e.collaborationId===n))||t.data.permissions.push({permission:o,collaborationType:e.type,collaborationId:n})}))})),t}(e);return o=function(e){let t=e.data.catalog||{};if(!t.schemaVersion){const n=t.groups||[];t={schemaVersion:1,title:"Default Site Catalog",scopes:{item:{targetEntity:"item",filters:[]}},collections:[]},t.scopes.item.filters.push({predicates:[{group:[...n]}]}),e.data.catalog=t}return e}(o),o=function(e){const t=["all","dataset","document","site","appAndMap"].reduce(((e,t)=>(e[t]={label:null,key:t,include:[],targetEntity:"item",scope:{targetEntity:"item",collection:t,filters:[]}},e)),{}),n={[Oe.DATA]:"dataset",[Oe.INITIATIVES]:"site",[Oe.SITES]:"site",[Oe.DOCUMENTS]:"document",[Oe.APPS_AND_MAPS]:"appAndMap"},o=(e.data.values.searchCategories||[{key:Oe.SITES,hidden:!0},{key:Oe.DATA},{key:Oe.DOCUMENTS},{key:Oe.APPS_AND_MAPS}]).filter((e=>e.key!==Oe.EVENTS)).filter((e=>!!n[e.key])).map((e=>{const o=t[n[e.key]];return o.label=e.overrideText||null,o.hidden=e.hidden,o}));return o.unshift(t.all),e.data.catalog.collections=o,e}(o),function(e,n,o){var a;let i;o.authentication&&(i=o.authentication.token);const r=b(e.item,o,i);return n.thumbnailUrl=r,n.links={self:t(n.id,o),siteRelative:"/",workspaceRelative:h("site",n.id),layoutRelative:"/edit",thumbnail:r},n.createdDate=new Date(e.item.created),n.createdDateSource="item.created",n.updatedDate=new Date(e.item.modified),n.updatedDateSource="item.modified",n.isDiscussable=s(n),n.features=Q((null===(a=e.data.settings)||void 0===a?void 0:a.features)||{},y),n.catalog=de(n.catalog),n}(e,new a($e()).storeToEntity(o,{}),n)}async function Pe(t,o,a){const s={access:t.access,id:t.id,type:t.type,name:t.title,owner:t.owner,typeKeywords:t.typeKeywords,tags:t.tags,categories:t.categories,summary:t.snippet||t.description,createdDate:new Date(t.created),createdDateSource:"item.created",updatedDate:new Date(t.modified),updatedDateSource:"item.modified",family:e(t.type),links:{self:"not-implemented",siteRelative:"not-implemented",thumbnail:"not-implemented"}},r=(o=[...o].filter(u)).map(W),c=p("enrichment",r).filter(u);let l={};return c.length&&(l=await i(t,c,a)),r.forEach((e=>{s[e.prop]=E(l,e.path)})),s.links.thumbnail=b(t,a),s.links.self=t.url,s.links.siteRelative=n(s.type,s.id,t.typeKeywords),s}function xe(){const e=o();return e.push({entityKey:"previewUrl",storeKey:"item.properties.previewUrl"}),e}function _e(e,o){var a;let i;o.authentication&&(i=o.authentication.token);const s=null===(a=e.typeKeywords)||void 0===a?void 0:a.includes("Deployed"),r=t(e.id,o),c=n(e.type,q(e),e.typeKeywords);return{self:r,siteRelative:c,workspaceRelative:s?r:h(e.type,q(e)),advancedEditRelative:`${c.split("/").slice(0,-1).join("/")}/edit/advanced`,thumbnail:b(e,o,i)}}const Re=e=>{let t="Solution";const n=e.typeKeywords.find((e=>e.startsWith("hubSolutionType|")));if(n){const e=n.split("|")[1];t=x(e).split("-").map((e=>d(e))).join(" ");const o={storyMap:"StoryMap"};o[e]&&(t=o[e])}return t};function Ue(e,t,n){return t.links=_e(e.item,n),t.thumbnailUrl=t.links.thumbnail,t.createdDate=new Date(e.item.created),t.createdDateSource="item.created",t.updatedDate=new Date(e.item.modified),t.updatedDateSource="item.modified",t.isDiscussable=s(t),t.features=Q(E(e,"data.settings.features")||{},g),t.isDeployed=(E(e,"item.typeKeywords")||[]).includes("Deployed"),t.deployedType=Re(e.item),t}export{ae as A,Te as B,$e as C,te as D,De as E,ee as F,Z as G,Ie as H,oe as I,de as J,_ as K,Ae as a,z as b,q as c,G as d,B as e,ie as f,C as g,U as h,J as i,W as j,pe as k,le as l,fe as m,me as n,Ue as o,Q as p,xe as q,_e as r,L as s,Re as t,F as u,Ve as v,Pe as w,re as x,se as y,He as z}