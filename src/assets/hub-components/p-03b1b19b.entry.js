import{r as t,c as e,h as i,F as s,H as a,a as o}from"./p-d4ba4c14.js";import{b as l}from"./p-fd260f2d.js";import{i as n}from"./p-be5c5009.js";import{g as c}from"./p-861893ad.js";import{g as r,c as h}from"./p-81a9bee2.js";import{C as d,D as p}from"./p-c29c8d33.js";import{c as u}from"./p-b728aff4.js";import{d as g}from"./p-8cf4bd83.js";import{g as m}from"./p-75d6da59.js";import{g as b}from"./p-796574a4.js";import{s as f}from"./p-52612356.js";import{g as y}from"./p-783242bc.js";import{u as v,f as C,g as j,h as k}from"./p-066a64ad.js";import{updateDiscussion as w}from"./p-db05bb7b.js";import{u as O}from"./p-58cf73b6.js";import{A as R,v as x}from"./p-85d6867e.js";import"./p-859c5360.js";import"./p-dfe5a97d.js";import"./p-a0deb8c6.js";import"./p-af59e67b.js";import"./p-dd26efbb.js";import"./p-d1b12a9c.js";import"./p-dcdf7b57.js";import"./p-6dcae6cd.js";import"./p-637ea136.js";import"./p-3f64a9d9.js";import"./p-377e1b5e.js";import"./p-2acb70a6.js";import"./p-903ef8af.js";import"./p-6f931af6.js";import"./p-56b73d71.js";import"./p-3904125b.js";import"./p-b295a5ae.js";import"./p-cea8413b.js";import"./p-d763eacf.js";import"./p-ad325ed1.js";import"./p-8e7f4c22.js";import"./p-69555c48.js";import"./p-7b082f5d.js";import"./p-5955d0c4.js";import"./p-16a95e5b.js";import"./p-8ccaf06d.js";import"./p-9b205605.js";import"./p-c8e0e01f.js";import"./p-59fd2498.js";import"./p-97274a47.js";import"./p-30a7cbb2.js";import"./p-90dc0f6f.js";import"./p-7202c430.js";import"./p-10274eb9.js";import"./p-bded806b.js";import"./p-87582fe0.js";import"./p-9646abb2.js";import"./p-8dbea197.js";import"./p-e43616ff.js";import"./p-ca048216.js";import"./p-4a14259a.js";import"./p-235bb6ee.js";import"./p-c836a9b6.js";const A=async(t,e,i)=>{let s;switch(t){case"project":s=await k(e,i.userRequestOptions);break;case"site":s=await x(e,i.hubRequestOptions);break;case"initiative":s=await O(e,i.userRequestOptions);break;case"discussion":s=await w(e,i.hubRequestOptions);break;case"content":s=await j(e,i.userRequestOptions);break;case"page":s=await R(e,i.userRequestOptions);break;case"template":s=await C(e,i.userRequestOptions);break;case"initiativeTemplate":s=await v(e,i.userRequestOptions)}return s},M=class{constructor(i){t(this,i),this.arcgisHubEntityContentCatalogConfigureButtonClicked=e(this,"arcgisHubEntityContentCatalogConfigureButtonClicked",7),this.entity=void 0,this.facets=void 0,this._context=r(),this.selectedCollectionKey=void 0,this.showThumbnail=!1,l(this,"handleCollectionSelect","openCatalogConfigTab")}async componentWillLoad(){this.intl=await n.loadIntlForComponent(this.element),this.setFacets()}connectedCallback(){h(this)}disconnectedCallback(){this.disconnectContext()}setFacets(){this.facets=[{label:this.intl.t("facets.map.label"),tooltip:this.intl.t("facets.map.tooltip"),key:"bbox",display:"map",field:"bbox",value:null},{label:this.intl.t("facets.type"),key:"type",display:"multi-select",field:"type",options:[],operation:"OR",aggLimit:100},{label:this.intl.t("facets.tags"),key:"tags",display:"multi-select",field:"tags",options:[],operation:"OR"},{label:this.intl.t("facets.categories"),key:"categories",display:"tree",field:"categories",options:[],operation:"OR"},{label:this.intl.t("facets.dateUpdated"),key:"modified",display:"date-range",field:"modified",state:"open"},{label:this.intl.t("facets.sharing"),key:"access",display:"multi-select",field:"access",options:[],operation:"OR"}]}openCatalogConfigTab(){this.arcgisHubEntityContentCatalogConfigureButtonClicked.emit()}get query(){const t=this.entity.catalog.scopes.item,e=u(this.selectedCollection.scope);return e.filters=[...e.filters,...t.filters],e}get selectedCollection(){return this.collections.find((t=>t.key===this._selectedCollectionKey))}get _selectedCollectionKey(){return this.selectedCollectionKey||this.collections[0].key}get collections(){return this.entity.catalog.collections.filter((t=>!t.hidden))}handleCollectionSelect(t){this.selectedCollectionKey=t.target.tab}renderNoCollectionsView(){return i(s,null,i("h4",null,this.intl.t("noCollections.title")),i("p",null,this.intl.t("noCollections.message")),i("calcite-button",{appearance:"outline-fill","icon-end":"launch",onClick:this.openCatalogConfigTab,round:!0},this.intl.t("noCollections.button")))}updateShowThumbnail(t){this.showThumbnail="grid"===t.detail.layout}render(){return i(a,{"data-element":"entity-content-catalog"},i("h3",null,this.intl.t("title")),c(this.entity).length?i("arcgis-hub-gallery",{context:this._context,corners:d.round,facets:this.facets,"link-target":"siteRelative",query:this.query,shadow:p.low,"show-back-to-top-btn":!0,"show-chips":!0,"show-facets":!0,"show-layout-switcher":!0,"show-more-results-btn":!0,"show-results-count":!0,"show-search":!0,"show-sort":!0,showThumbnail:this.showThumbnail},i("div",{slot:"collection-select"},i("calcite-tabs",{layout:"center",scale:"l"},i("calcite-tab-nav",{onCalciteTabsActivate:this.handleCollectionSelect,slot:"title-group"},this.collections.map((t=>i("calcite-tab-title",{key:t.key,selected:t.key===this._selectedCollectionKey,tab:t.key},t.label||this.intl.t(`collections.${t.key}`)))))))):this.renderNoCollectionsView())}static get assetsDirs(){return["locales"]}get element(){return o(this)}};M.style=".sc-arcgis-hub-entity-content-catalog-h{display:block}h3.sc-arcgis-hub-entity-content-catalog{margin:30px 0;font-size:var(--calcite-font-size-2);line-height:1.5rem;font-weight:var(--calcite-font-weight-bold);color:var(--calcite-ui-text-1)}";const F=class{constructor(i){t(this,i),this.arcgisHubWorkspaceEntitySaved=e(this,"arcgisHubWorkspaceEntitySaved",7),this.hubTelemetry=e(this,"hubTelemetry",7),this.entity=void 0,this.operationAlert=null,this._context=r(),this.showReharvestWarningModal=!1,this.isReharvestRequestLoading=!1,l(this,"handleCatalogGroupsChanged","openReharvestWarningModal","closeReharvestWarningModal","handleReharvestCatalogConfirmed","clearOperationAlert")}async componentWillLoad(){this.intl=await n.loadIntlForComponent(this.element)}connectedCallback(){h(this)}disconnectedCallback(){this.disconnectContext()}get pickerFacets(){var t,e,i,s,a,o,l,n;const c=this._context.currentUser.groups.reduce(((t,e)=>("admin"===e.userMembership.memberType&&t.push(e.id),t)),[]),r={label:this.intl.t("groupPickerFacet.label"),key:"from",display:"single-select",operation:"OR",options:[{label:this.intl.t("groupPickerFacet.myGroup"),key:this.intl.t("groupPickerFacet.myGroup"),selected:!0,predicates:[{owner:null===(t=this._context)||void 0===t?void 0:t.currentUser.username}]},{label:this.intl.t("groupPickerFacet.myOrganization"),key:this.intl.t("groupPickerFacet.myOrganization"),selected:!1,predicates:[{orgid:null===(i=null===(e=this._context)||void 0===e?void 0:e.currentUser)||void 0===i?void 0:i.orgId,searchUserAccess:"groupMember",searchUserName:this.entity.owner,isviewonly:!1},{orgid:null===(a=null===(s=this._context)||void 0===s?void 0:s.currentUser)||void 0===a?void 0:a.orgId,id:c}]}]};return(null===(o=this._context)||void 0===o?void 0:o.communityOrgId)&&r.options.push({label:this.intl.t("groupPickerFacet.myCommunity"),key:this.intl.t("groupPickerFacet.myCommunity"),selected:!1,predicates:[{orgid:null===(l=this._context)||void 0===l?void 0:l.communityOrgId,searchUserAccess:"groupMember",searchUserName:this.entity.owner,isviewonly:!1},{orgid:null===(n=this._context)||void 0===n?void 0:n.communityOrgId,id:c}]}),[r]}get isCatalogConfigured(){return!!c(this.entity).length}get showReharvestUi(){return"site"===m(this.entity)&&this.isCatalogConfigured}async handleCatalogGroupsChanged(t){const{added:e,removed:i,updatedList:s}=t.detail,a=u(this.entity),o=[];e&&o.push(Object.assign(Object.assign({},g.dictionary.category.content.action.update.label.groups.details.addCatalogGroups),{count:s.length})),i&&o.push(Object.assign(Object.assign({},g.dictionary.category.content.action.update.label.groups.details.removeCatalogGroups),{count:s.length}));try{b(this.entity,"catalog.scopes.item")||f("catalog.scopes.item",{targetEntity:"item",filters:[]},a);const t=y(a.catalog.scopes.item);t?t.group=s:a.catalog.scopes.item.filters.push({operation:"OR",predicates:[{group:s}]}),this.entity=a;const e=m(a),i=await A(e,a,this._context);o.forEach((t=>{this.hubTelemetry.emit(Object.assign(Object.assign({},t),{response:g.constants.response.SUCCESS}))})),this.arcgisHubWorkspaceEntitySaved.emit({entity:i,isSuccess:!0})}catch(t){this.triggerOperationAlert({kind:"danger",title:this.intl.t("configSaveAlert.failure")}),o.forEach((t=>{this.hubTelemetry.emit(Object.assign(Object.assign({},t),{response:g.constants.response.FAILURE}))})),this.arcgisHubWorkspaceEntitySaved.emit({entity:a,isSuccess:!1,error:t.message})}}async handleFeedsEnabledToggle(){const t=m(this.entity),e=u(this.entity),i=!b(e,"feeds.disabled");f("feeds.disabled",i,e);try{this.entity=e;const i=await A(t,e,this._context);this.arcgisHubWorkspaceEntitySaved.emit({entity:i,isSuccess:!0})}catch(t){this.triggerOperationAlert({kind:"danger",title:this.intl.t("configSaveAlert.failure")}),this.arcgisHubWorkspaceEntitySaved.emit({entity:e,isSuccess:!1,error:t.message})}this.hubTelemetry.emit(i?g.dictionary.category.interaction.action.disable.label.content.details.hubFeeds:g.dictionary.category.interaction.action.enable.label.content.details.hubFeeds)}handleEditFeedsClicked(){this.hubTelemetry.emit(g.dictionary.category.navigation.action.edit.label.content.details.hubFeeds)}openReharvestWarningModal(){this.hubTelemetry.emit(Object.assign({},g.dictionary.category.catalog.action.update.label.checkForErrors.details.openModal)),this.showReharvestWarningModal=!0}closeReharvestWarningModal(){this.showReharvestWarningModal=!1}async handleReharvestCatalogConfirmed(){this.closeReharvestWarningModal(),this.isReharvestRequestLoading=!0;try{await async function(t,e){return fetch(`${e.hubUrl}/api/v3/jobs/site/${t}/harvest`,{method:"POST",headers:{"content-type":"application/json",authorization:e.hubRequestOptions.authentication.token}}).then((t=>t.json()))}(this.entity.id,this._context),this.triggerOperationAlert({title:this.intl.t("reharvestCatalogAlert.success"),kind:"brand"}),this.hubTelemetry.emit(Object.assign(Object.assign({},g.dictionary.category.catalog.action.update.label.checkForErrors.details.reharvest),{response:g.constants.response.SUCCESS}))}catch(t){this.triggerOperationAlert({title:this.intl.t("reharvestCatalogAlert.failure"),kind:"danger"}),this.hubTelemetry.emit(Object.assign(Object.assign({},g.dictionary.category.catalog.action.update.label.checkForErrors.details.reharvest),{response:g.constants.response.FAILURE}))}this.isReharvestRequestLoading=!1}async triggerOperationAlert({kind:t,title:e}){this.operationAlert=i("calcite-alert",{autoClose:"danger"!==t,autoCloseDuration:"fast",icon:!0,kind:t,label:this.intl.t("formAlert"),onCalciteAlertClose:this.clearOperationAlert,open:!0,placement:"top-end"},i("div",{slot:"title"},e))}clearOperationAlert(){this.operationAlert=null}renderHeaderRow(){return i(s,null,i("div",{class:"title-container"},i("h3",null,this.intl.t("title")),this.showReharvestUi&&i("calcite-button",{appearance:"outline",class:"reharvest-catalog-button",iconStart:"debug-script",loading:this.isReharvestRequestLoading,onClick:this.openReharvestWarningModal,round:!0},this.intl.t("reharvestCatalogButton"))),this.showReharvestUi&&this.renderReharvestWarningModal())}renderReharvestWarningModal(){return this.showReharvestUi&&i("calcite-modal",{onCalciteModalClose:this.closeReharvestWarningModal,open:this.showReharvestWarningModal,width:"s"},i("div",{slot:"header"},this.intl.t("reharvestWarningModal.title")),i("div",{class:"reharvest-modal-body",slot:"content"},i("div",null,this.intl.t("reharvestWarningModal.body1")),i("div",null,this.intl.t("reharvestWarningModal.body2"))),i("calcite-button",{appearance:"outline",onClick:this.closeReharvestWarningModal,slot:"secondary"},this.intl.t("reharvestWarningModal.secondaryButton")),i("calcite-button",{onClick:this.handleReharvestCatalogConfirmed,slot:"primary"},this.intl.t("reharvestWarningModal.primaryButton")))}renderGroupsSection(){return i(s,null,i("h4",null," ",this.intl.t("sections.groups.title")," "),i("p",null," ",this.intl.t("sections.groups.helperText")," "),i("arcgis-hub-group-list-manager",{allowAdd:!0,allowRemove:!0,groupIds:c(this.entity),pickerFacets:this.pickerFacets,wellKnownPickerCatalog:"allGroups"},i("calcite-button",{appearance:"outline-fill",href:`${this._context.portalUrl}/home/groups.html`,"icon-end":"launch",round:!0,slot:"secondary-picker-button",target:"_blank"},this.intl.t("sections.groups.createGroup"))))}renderFeedsSection(){if("site"===m(this.entity)){const t=this.entity,e="public"===t.access,a=!b(t,"feeds.disabled");return i(s,null,i("h4",null,this.intl.t("sections.feeds.title")),i("p",null,this.intl.t("sections.feeds.helperText")),i("p",null,i("calcite-link",{href:"https://doc.arcgis.com/en/hub/content/federate-data-with-external-catalogs.htm","icon-end":"launch",target:"_blank"},this.intl.t("sections.feeds.learn"))),e&&i("p",null,i("label",null,this.intl.t("sections.feeds.toggle"),i("calcite-switch",{checked:a}))),e&&a&&i("calcite-button",{appearance:"outline-fill",href:"/content/edit/feed","icon-end":"launch",onClick:this.handleEditFeedsClicked,round:!0,target:"_blank"},this.intl.t("sections.feeds.configure")),!e&&i("div",{class:"private-site-notice-container"},i("calcite-notice",{icon:"lightbulb",open:!0},i("div",{slot:"message"},this.intl.t("sections.feeds.notice")))))}}render(){return i(a,{"data-element":"entity-content-catalog-config"},this.operationAlert,this.renderHeaderRow(),i("div",null,this.intl.t("helperText")),this.renderGroupsSection(),this.renderFeedsSection())}static get assetsDirs(){return["locales"]}get element(){return o(this)}};F.style=":host{display:block}h3{margin:30px 0;font-size:var(--calcite-font-size-2);line-height:1.5rem;font-weight:var(--calcite-font-weight-bold);color:var(--calcite-ui-text-1)}arcgis-hub-group-list-manager{padding-bottom:0.75rem}.private-site-notice-container{max-width:20rem}.title-container{display:flex;flex-direction:row;justify-content:space-between}.reharvest-catalog-button{align-self:center;margin-inline-end:0.25rem}.reharvest-modal-body{display:flex;flex-direction:column;gap:0.5rem}";const S=class{constructor(i){t(this,i),this.arcgisHubWorkspaceEntitySaved=e(this,"arcgisHubWorkspaceEntitySaved",7),this.entity=void 0,this.footerSlotRef=void 0,this.configurableCollections=void 0,this.showRenameModal=!1,this.renamingCollectionKey=null,this.isSaving=!1,this.saveOperationAlert=null,l(this,"handleCollectionOrderChange","handleVisibilityToggle","handleRenameActionClicked","handleRenameApplied","handleRenamedCancelled","translationFunction","saveCollectionConfiguration")}get renameValues(){const t={},e=this.configurableCollections.find((t=>t.key===this.renamingCollectionKey));return e&&(t.label=this.getCollectionEditLabel(e)),t}async componentWillLoad(){this.intl=await n.loadIntlForComponent(this.element),this.setRenameModalSchemas(),this.setConfigurableCollections()}setRenameModalSchemas(){this.renameSchema={type:"object",required:["label"],properties:{label:{type:"string"}}},this.renameUiSchema={type:"Layout",elements:[{label:"Collection Label",labelKey:"collectionRenameModal.fieldLabel",scope:"/properties/label",type:"Control",options:{messages:[{type:"ERROR",keyword:"required",icon:!0,label:this.intl.t("collectionRenameModal.requiredMessage")}]}}]}}setConfigurableCollections(){const t=this.entity.catalog.collections.filter((t=>"all"!==t.key));this.configurableCollections=u(t)}handleCollectionOrderChange(t){t.stopPropagation();const e=Array.from(t.target.children).map((t=>t.getAttribute("data-key")));this.configurableCollections.sort(((t,i)=>e.indexOf(t.key)-e.indexOf(i.key)))}handleVisibilityToggle(t){const e=t.target.dataset.key;this.configurableCollections=this.configurableCollections.map((t=>{const i=t.hidden;return t.key===e?Object.assign(Object.assign({},t),{hidden:!i}):t}))}handleRenameActionClicked(t){this.renamingCollectionKey=t.target.dataset.key,this.showRenameModal=!0}handleRenameApplied(t){t.preventDefault(),this.showRenameModal=!1,this.configurableCollections.find((t=>t.key===this.renamingCollectionKey)).label=t.detail.label,this.renamingCollectionKey=null}handleRenamedCancelled(){this.showRenameModal=!1,this.renamingCollectionKey=null}translationFunction(t){return this.intl.t(t)}getCollectionDisplayLabel(t){const e=t.hidden;return t.label?e?this.intl.t("collections.custom.hidden",{userTitleInput:t.label}):t.label:this.intl.t(e?`collections.${t.key}.hidden`:`collections.${t.key}.visible`)}getCollectionEditLabel(t){return t.label||this.intl.t(`collections.${t.key}.visible`)}getActionsMenuKey(t){return[t.key,this.getCollectionEditLabel(t),t.hidden?"hidden":"visible",t.key===this.renamingCollectionKey?"editing":"not-editing"].join("-")}async saveCollectionConfiguration(){const t=u(this.entity),e=u(this.configurableCollections),i=t.catalog.collections.find((t=>"all"===t.key));t.catalog.collections=i?[i,...e]:e;try{this.isSaving=!0;const e=m(t),i=await A(e,t,r());this.triggerSaveOperationAlert("success"),this.arcgisHubWorkspaceEntitySaved.emit({entity:i,isSuccess:!0})}catch(e){this.triggerSaveOperationAlert("failure"),this.arcgisHubWorkspaceEntitySaved.emit({entity:t,isSuccess:!1,error:e.message})}finally{this.isSaving=!1}}renderCollectionRenameModal(){return i("arcgis-configuration-form",{isOpen:this.showRenameModal,layout:"modal",messageOverrides:{save:this.intl.t("collectionRenameModal.apply")},onArcgisConfigurationFormModalClosed:this.handleRenamedCancelled,onArcgisConfigurationFormSaved:this.handleRenameApplied,schema:this.renameSchema,t:this.translationFunction,uiSchema:this.renameUiSchema,values:this.renameValues},this.showRenameModal&&i("div",{slot:"header"},this.intl.t("collectionRenameModal.title")))}async triggerSaveOperationAlert(t){const e=this.intl.t("success"===t?"alertMessages.success":"alertMessages.error");this.saveOperationAlert=i("calcite-alert",{autoClose:!0,autoCloseDuration:"fast",icon:!0,kind:"success"===t?"success":"danger",label:this.intl.t("formAlert"),open:!0,placement:"top-end"},i("div",{slot:"title"},e)),setTimeout((()=>{this.saveOperationAlert=null}),6e3)}render(){return i(a,{"data-element":"entity-content-collections"},this.saveOperationAlert,this.renderCollectionRenameModal(),i("h3",null,this.intl.t("title")),i("calcite-sortable-list",{onCalciteListOrderChange:this.handleCollectionOrderChange},this.configurableCollections.map((t=>{const e=this.getCollectionDisplayLabel(t),s=this.getActionsMenuKey(t);return i("calcite-block",{"data-key":t.key,"drag-handle":!0,heading:e,"is-hidden":t.hidden,key:t.key},i("calcite-action-menu",{key:s,slot:"control"},i("calcite-action",{"data-key":t.key,icon:"pencil",onClick:this.handleRenameActionClicked,text:this.intl.t("actions.rename"),"text-enabled":!0}),i("calcite-action",{"data-key":t.key,icon:t.hidden?"view-visible":"view-hide",onClick:this.handleVisibilityToggle,text:this.intl.t("actions."+(t.hidden?"show":"hide")),"text-enabled":!0})))}))),this.footerSlotRef&&i("arcgis-wormhole",{styles:{position:"relative"},target:this.footerSlotRef},i("div",{class:"collections-footer"},i("calcite-button",{disabled:this.isSaving,loading:this.isSaving,onClick:this.saveCollectionConfiguration,round:!0},this.intl.t("saveButton")))))}static get assetsDirs(){return["locales"]}get element(){return o(this)}static get watchers(){return{entity:["setConfigurableCollections"]}}};S.style=".sc-arcgis-hub-entity-content-collections-h{display:block}h3.sc-arcgis-hub-entity-content-collections{margin:30px 0;font-size:var(--calcite-font-size-2);line-height:1.5rem;font-weight:var(--calcite-font-weight-bold);color:var(--calcite-ui-text-1)}calcite-block[is-hidden].sc-arcgis-hub-entity-content-collections{--calcite-ui-text-2:#9F9F9F}.collections-footer.sc-arcgis-hub-entity-content-collections{display:flex;justify-content:flex-end}";export{M as arcgis_hub_entity_content_catalog,F as arcgis_hub_entity_content_catalog_config,S as arcgis_hub_entity_content_collections}