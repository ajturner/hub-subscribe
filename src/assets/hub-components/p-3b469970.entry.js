import{r as t,h as e,F as s,H as i,a as r}from"./p-d4ba4c14.js";import{i as o}from"./p-be5c5009.js";import{b as a}from"./p-fd260f2d.js";import{p as n,g as p,a as c}from"./p-79bb36a5.js";import{c as l}from"./p-f845584b.js";import{c as h}from"./p-b728aff4.js";import{h as d}from"./p-b1a98ae3.js";import{r as m}from"./p-7853d817.js";import"./p-d763eacf.js";import"./p-377e1b5e.js";import"./p-637ea136.js";import"./p-dcdf7b57.js";import"./p-24ecdf64.js";import"./p-7b082f5d.js";import"./p-8dbea197.js";import"./p-b295a5ae.js";import"./p-796574a4.js";import"./p-9b205605.js";import"./p-1458dcfd.js";import"./p-783242bc.js";import"./p-dd26efbb.js";import"./p-d1b12a9c.js";import"./p-a0deb8c6.js";import"./p-6dcae6cd.js";import"./p-3f64a9d9.js";import"./p-2acb70a6.js";import"./p-903ef8af.js";import"./p-52612356.js";import"./p-af59e67b.js";import"./p-85d6867e.js";import"./p-6f931af6.js";import"./p-56b73d71.js";import"./p-3904125b.js";import"./p-cea8413b.js";import"./p-ad325ed1.js";import"./p-8e7f4c22.js";import"./p-69555c48.js";import"./p-7202c430.js";import"./p-75d6da59.js";import"./p-90dc0f6f.js";import"./p-59fd2498.js";import"./p-16a95e5b.js";import"./p-e43616ff.js";import"./p-ca048216.js";import"./p-4a14259a.js";import"./p-235bb6ee.js";import"./p-c836a9b6.js";import"./p-dafb2329.js";import"./p-992b9d10.js";import"./p-895b662f.js";import"./p-31aebb8c.js";import"./p-aa262d60.js";import"./p-ea6de7f6.js";import"./p-3363f483.js";import"./p-87582fe0.js";const b=class{constructor(e){t(this,e),this.entity=void 0,this.context=void 0,this.collection=void 0,this.membersCount=void 0,this.newMembersCount=void 0,this.isUserPickerOpen=!1,a(this,"handlePickerOpen","handlePickerClose","handlePickerSelectionUpdate","handleGalleryBulkAction")}async componentWillLoad(){this.intl=await o.loadIntlForComponent(this.element),this.fetchStats()}handlePickerOpen(){this.isUserPickerOpen=!0}handlePickerClose(){this.isUserPickerOpen=!1}get canEdit(){return l("hub:group:edit",this.context,this.entity).access}get query(){return{targetEntity:"groupMember",filters:[{predicates:[{group:this.entity.id}]}]}}get facets(){return[{label:this.intl.t("facets.role.label"),key:"access",display:"single-select",field:"access",options:[{label:this.intl.t("facets.role.all"),key:"all",selected:!0,predicates:[]},{label:this.intl.t("facets.role.manager"),key:"admin",selected:!1,predicates:[{memberType:"admin"}]},{label:this.intl.t("facets.role.member"),key:"member",selected:!1,predicates:[{memberType:"member"}]}],operation:"OR"},{label:this.intl.t("facets.dateJoined.label"),key:"joined",display:"date-range",state:"open",field:"joined"}]}get pickerCatalogDefinition(){return n}get pickerFacets(){return p(this.entity,this.context,this.intl)}get bulkActions(){const t={actions:[]};return this.canEdit&&t.actions.push({name:"removeUsers",icon:"user-minus",text:this.intl.t("removeUsers.button")}),t}async fetchStats(){const t=h(this.query),e=(new Date).getDate();t.filters[0].predicates[0].joined={type:"date-range",from:new Date((new Date).setDate(e-30)).valueOf(),to:(new Date).valueOf()};const[s,i]=await Promise.all([d(this.query,{requestOptions:this.context.hubRequestOptions}),d(t,{requestOptions:this.context.hubRequestOptions})]);this.membersCount=s.total,this.newMembersCount=i.total}async handlePickerSelectionUpdate(t){var e,s;const{communityUser:i}=t.detail;try{const t=await c(this.entity.id,i,this.context.userRequestOptions,l("platform:portal:admin:assignToGroups",this.context).access);let s=this.intl.t("addMembers.notifications.invited");t.added.length&&(s=this.intl.t("addMembers.notifications.added")),t.notInvited.length&&(s=this.intl.t("addMembers.notifications.notInvited")),null===(e=this.workspacePane)||void 0===e||e.triggerAlert({kind:t.notAdded.length&&t.notInvited.length?"danger":"success",title:s}),this.fetchStats()}catch(t){console.error("Something went wrong adding users to the group",t),null===(s=this.workspacePane)||void 0===s||s.triggerAlert({kind:"danger",title:this.intl.t("addMembers.notifications.notInvited")})}}async handleGalleryBulkAction(t){const{action:e,selection:s}=t.detail;switch(e.name){case"removeUsers":this.removeUsersFromGroup(s)}}async removeUsersFromGroup(t){var e,s,i,r;try{const r=await m(Object.assign({id:this.entity.id,users:t},this.context.userRequestOptions));null===(e=this.memberGallery)||void 0===e||e.refresh(),null===(s=this.memberGallery)||void 0===s||s.clearSelection(),this.fetchStats(),null===(i=this.workspacePane)||void 0===i||i.triggerAlert({kind:r.notRemoved.length?"danger":"success",title:r.notRemoved.length?this.intl.t("removeUsers.error"):this.intl.t("removeUsers.success",{groupName:this.entity.name})})}catch(t){console.error("Something went wrong removing users from the group",t),null===(r=this.workspacePane)||void 0===r||r.triggerAlert({kind:"danger",title:this.intl.t("removeUsers.error")})}}renderStats(){return e("div",{class:"entity-group-members__stats"},e("arcgis-stat-card",{cardTitle:this.intl.t("stats.total.title"),key:"total",trailingText:this.intl.t("stats.total.trailingText"),value:this.membersCount&&this.intl.formatNumber(this.membersCount)}),e("arcgis-stat-card",{cardTitle:this.intl.t("stats.new.title"),key:"new",trailingText:this.intl.t("stats.new.trailingText"),value:this.newMembersCount&&this.intl.formatNumber(this.newMembersCount)}))}renderMembersGallery(){return e("arcgis-hub-gallery",{bulkActions:this.bulkActions,context:this.context,facets:this.facets,onArcgisHubGalleryBulkAction:this.handleGalleryBulkAction,query:this.query,ref:t=>{this.memberGallery=t},selectionMode:this.canEdit?"multiple":"none","show-back-to-top-btn":!0,"show-chips":!0,"show-facets":!0,"show-layout-switcher":!0,"show-more-results-btn":!0,"show-results-count":!0,"show-search":!0,"show-sort":!0,sortField:"username",sortOptions:["username","joined","memberType"]})}renderUserPicker(){if(this.canEdit)return e(s,null,e("div",{class:"picker-button-container"},e("calcite-button",{appearance:"outline-fill",onClick:this.handlePickerOpen,round:!0},this.intl.t("addMembers.button"))),this.isUserPickerOpen&&e("arcgis-wormhole",{elAttributes:{unthemed:""}},e("arcgis-hub-gallery-picker",{catalogs:[this.pickerCatalogDefinition],context:this.context,facets:this.pickerFacets,modalTitle:this.intl.t("addMembers.modal.title"),onArcgisHubGalleryPickerClose:this.handlePickerClose,onArcgisHubGalleryPickerSelectionUpdate:this.handlePickerSelectionUpdate,open:this.isUserPickerOpen,showBadges:!1,showSearch:!0,showThumbnail:!0,sortField:"username",sortOptions:["username","joined"]})))}render(){return e(i,{"data-element":"group-entity-members"},e("arcgis-hub-workspace-pane",{ref:t=>{this.workspacePane=t}},e("h2",{slot:"title"},this.intl.t("title")),e("div",null,this.renderUserPicker(),this.renderStats(),this.renderMembersGallery())))}static get assetsDirs(){return["locales"]}get element(){return r(this)}};b.style=":host{display:block;height:100%}.entity-group-members__stats{display:flex;width:100%;gap:1rem}.entity-group-members__stats arcgis-stat-card{width:50%}.picker-button-container{display:flex;gap:0.75rem}";export{b as arcgis_hub_entity_group_members}