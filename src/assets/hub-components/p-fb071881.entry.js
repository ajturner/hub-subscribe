import{r as e,c as t,h as i,H as s,a}from"./p-d4ba4c14.js";import{d as o}from"./p-8cf4bd83.js";import{b as c}from"./p-fd260f2d.js";import{i as n}from"./p-be5c5009.js";import{f as r}from"./p-4db6fd24.js";import{g as l}from"./p-fbd5dcee.js";import{a as d,r as p,c as h,b as m}from"./p-9e418183.js";import{s as u}from"./p-57f04fe1.js";import"./p-dfe5a97d.js";import"./p-adee2925.js";import"./p-c94c130f.js";import"./p-992b9d10.js";import"./p-d763eacf.js";import"./p-377e1b5e.js";import"./p-637ea136.js";import"./p-dcdf7b57.js";import"./p-ad325ed1.js";import"./p-3363f483.js";import"./p-87582fe0.js";import"./p-56b73d71.js";import"./p-3904125b.js";import"./p-3f64a9d9.js";import"./p-8ccaf06d.js";import"./p-9b205605.js";import"./p-6f931af6.js";import"./p-b728aff4.js";import"./p-796574a4.js";import"./p-52612356.js";import"./p-af59e67b.js";import"./p-b295a5ae.js";import"./p-dd26efbb.js";import"./p-d1b12a9c.js";import"./p-a0deb8c6.js";import"./p-6dcae6cd.js";import"./p-2acb70a6.js";import"./p-cea8413b.js";import"./p-8e7f4c22.js";import"./p-69555c48.js";import"./p-c8e0e01f.js";import"./p-59fd2498.js";import"./p-97274a47.js";import"./p-30a7cbb2.js";import"./p-90dc0f6f.js";import"./p-7202c430.js";import"./p-75d6da59.js";import"./p-10274eb9.js";import"./p-e43616ff.js";import"./p-895b662f.js";import"./p-5b420841.js";const b=e=>{switch(e){case"blue":return"brand";case"green":return"success";case"red":return"danger";case"yellow":return"warning"}},j=class{constructor(i){e(this,i),this.hubTelemetry=t(this,"hubTelemetry",7),this.channelId=void 0,this.context=void 0,this.open=void 0,this.channel=void 0,this.channelGroups=void 0,this.saving=!1,this.postTotal=void 0,this.activeStepIndex=void 0,this.notifications=void 0,this.activity=!0,this.notices=[],c(this,"handleStepperItemSelected","handleCancelButtonClicked","handleSaveButtonClicked","handleModalClosed","handleTileSelect","handleNoticeClosed")}get isMember(){const{channel:e,context:t}=this;return Boolean(e)&&t.currentUser.groups.some((({id:t})=>e.groups.includes(t)))}async componentWillLoad(){const[e,t,i]=await Promise.all([n.loadIntlForComponent(this.element),d(Object.assign({channelId:this.channelId},this.context.hubRequestOptions)).catch((()=>null)),r({channelId:this.channelId},this.context.hubRequestOptions)]);this.intl=e,this.notifications=!t,this.channel=i.channel,this.channelGroups=i.channelGroups,this.postTotal=await this.fetchTotalPosts(),this.activeStepIndex=this.isMember?0:1}get stepItems(){const{isMember:e,intl:t,notifications:i,activity:s}=this;return[{name:"notifications",description:e?"":t.t("notifications-disabled"),disabled:!e,heading:t.t("notifications"),options:[{checked:i,description:t.t("receiveDesc"),heading:t.t("receive"),icon:"email-address",value:!0},{checked:!i,description:t.t("stopDesc"),heading:t.t("stop"),icon:"circle-disallowed",value:!1}],notice:{title:t.t("stopNotice"),message:t.t("stopNoticeMessage"),link:t.t("noticeLink"),url:"https://doc.arcgis.com/en/hub/team/how-discussions-work.htm"}},{name:"activity",disabled:!1,heading:t.t("activity"),options:[{checked:s,description:t.t("keepDesc"),heading:t.t("keep"),icon:"speech-bubble-check",value:!0},{checked:!s,description:t.t("deleteDesc"),heading:t.t("delete"),icon:"trash",value:!1}],notice:{color:"red",title:t.t("deleteNotice"),message:t.t("deleteNoticeMessage"),link:t.t("noticeLink"),url:"https://doc.arcgis.com/en/hub/team/how-discussions-work.htm"}}]}async fetchTotalPosts(){const{channelId:e,context:{hubRequestOptions:t,currentUser:i}}=this,{total:s}=await u(Object.assign({data:{start:1,num:1,channels:[e],creator:i.username}},t));return s}handleStepperItemSelected(e){const t=e.currentTarget,{activeStepIndex:i,stepItems:s}=this;t.disabled||t.dataset.name===s[i].name||(this.hubTelemetry.emit(o.dictionary.category.interaction.action.open.label.stepper.details["notifications"===t.dataset.name?"emailNotifications":"postActivity"]),this.activeStepIndex=s.findIndex((({name:e})=>e===t.dataset.name)))}handleCancelButtonClicked(){this.open=!1}async removeChannelActivity(){const{channelId:e,intl:t,context:i}=this;try{await p(Object.assign({channelId:e},i.hubRequestOptions)),this.hubTelemetry.emit(Object.assign(Object.assign({},o.dictionary.category.content.action.delete.details.allPosts),{response:o.constants.response.SUCCESS})),this.postTotal=await this.fetchTotalPosts()}catch(e){this.hubTelemetry.emit(Object.assign(Object.assign({},o.dictionary.category.content.action.delete.details.allPosts),{response:o.constants.response.FAILURE})),this.notices=[...this.notices,{color:"red",title:t.t("deleteError"),message:t.t("deleteErrorMessage")}]}}async createChannelNotificationOptOut(){const{channelId:e,intl:t,context:i}=this;try{await h(Object.assign({channelId:e},i.hubRequestOptions)),this.hubTelemetry.emit(Object.assign(Object.assign({},o.dictionary.category.users.action.update.label.notifications.details.disabled),{response:o.constants.response.SUCCESS}))}catch(e){this.hubTelemetry.emit(Object.assign(Object.assign({},o.dictionary.category.users.action.update.label.notifications.details.disabled),{response:o.constants.response.FAILURE})),this.notices=[...this.notices,{color:"red",title:t.t("stopError"),message:t.t("stopErrorMessage")}]}}async removeChannelNotificationOptOut(){const{channelId:e,intl:t,context:i}=this;try{await m(Object.assign({channelId:e},i.hubRequestOptions)),this.hubTelemetry.emit(Object.assign(Object.assign({},o.dictionary.category.users.action.update.label.notifications.details.enabled),{response:o.constants.response.SUCCESS}))}catch(e){this.hubTelemetry.emit(Object.assign(Object.assign({},o.dictionary.category.users.action.update.label.notifications.details.enabled),{response:o.constants.response.FAILURE})),this.notices=[...this.notices,{color:"red",title:t.t("receiveError"),message:t.t("receiveErrorMessage")}]}}handleSaveButtonClicked(){this.saving=!0,this.notices=[];const e=[];this.activity||e.push(this.removeChannelActivity()),e.push(this.notifications?this.removeChannelNotificationOptOut():this.createChannelNotificationOptOut()),Promise.all(e).then((()=>{this.saving=!1,this.notices.length||(this.notices=[{title:this.intl.t("updated"),message:this.intl.t("updatedMessage")}])}))}handleModalClosed(){this.hubTelemetry.emit(o.dictionary.category.interaction.action.close.label.modal.details.managePreferences)}handleTileSelect(e){const t=e.target;this[t.name]=t.value}handleNoticeClosed(){this.notices=[]}renderMetadata(){const{channel:e,channelGroups:t,postTotal:s,intl:a}=this;return i("address",null,i("calcite-avatar",{fullName:l(e,t,a.t("unnamedChannel")),scale:"l"}),i("div",null,i("b",null,l(e,t,a.t("unnamedChannel"))),i("span",null,a.t("totalPosts",{count:s}))))}renderChannelDetails(){return i("calcite-card",null,i("div",null,this.renderMetadata()))}renderContent(){const{activeStepIndex:e,isMember:t}=this;return i("section",{slot:"content"},t&&this.renderChannelDetails(),i("calcite-stepper",{layout:"vertical"},this.stepItems.map(((t,s)=>i("calcite-stepper-item",{"data-name":t.name,description:t.description,disabled:t.disabled,heading:t.heading,key:t.heading,onClick:this.handleStepperItemSelected,selected:s===e},i("calcite-tile-select-group",null,t.options.map((e=>i("calcite-tile-select",{checked:e.checked,description:e.description,heading:e.heading,icon:e.icon,inputEnabled:!0,key:e.icon,name:t.name,onCalciteTileSelectChange:this.handleTileSelect,type:"radio",value:e.value})))),t.options[1].checked&&i("calcite-notice",{kind:b(t.notice.color),open:!0,width:"full"},i("p",{slot:"title"},t.notice.title),i("p",{slot:"message"},t.notice.message),i("calcite-link",{href:t.notice.url,slot:"link"},t.notice.link)))))),this.renderNotice())}renderNotice(){const{notices:e,intl:t}=this,s=e.length>1?{color:"red",title:t.t("multipleError"),message:t.t("multipleErrorMessage")}:e[0];if(s)return i("calcite-notice",{closable:!0,kind:b(s.color),onCalciteNoticeClose:this.handleNoticeClosed,open:!0,width:"full"},i("p",{slot:"title"},s.title),i("p",{slot:"message"},s.message))}renderModal(){const{intl:e,saving:t,open:s}=this;return i("calcite-modal",{closeButtonDisabled:t,escapeDisabled:t,open:s,outsideCloseDisabled:!0},i("p",{slot:"header"},e.t("header")),i("calcite-button",{disabled:t,loading:t,onClick:this.handleSaveButtonClicked,round:!0,scale:"l",slot:"primary"},e.t("save")),i("calcite-button",{appearance:"outline",disabled:t,onClick:this.handleCancelButtonClicked,round:!0,scale:"l",slot:"secondary"},e.t("cancel")),this.renderContent())}render(){return i(s,{"data-element":"discussions-channel-settings-editor"},this.renderModal())}static get assetsDirs(){return["locales"]}get element(){return a(this)}};j.style=":host{display:block}calcite-modal{z-index:1030}section{display:grid;gap:1rem}calcite-notice{display:none}calcite-notice[active]{display:block}calcite-stepper-item calcite-notice{margin-top:1rem}address{display:flex;gap:1rem}address div{display:flex;flex-direction:column;align-items:flex-start;justify-content:center;gap:0.125rem}address b{font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-bold);font-style:normal;color:var(--calcite-ui-text-1)}address span{font-size:var(--calcite-font-size--1);line-height:1rem;font-style:normal;color:var(--calcite-ui-text-2)}div{display:flex;align-items:center;justify-content:space-between}";export{j as arcgis_hub_discussions_channel_settings_editor}