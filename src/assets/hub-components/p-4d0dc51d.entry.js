import{r as t,h as e,a as i,H as s,c as a}from"./p-d4ba4c14.js";import{intersects as n}from"@arcgis/core/geometry/geometryEngine.js";import{C as r}from"./p-1fde1b24.js";import o from"@arcgis/core/geometry/Polygon.js";import{b as l}from"./p-fd260f2d.js";import{i as c}from"./p-be5c5009.js";const d=(t,e)=>{const{height:i,width:s}=e;return`${t.y<i/2?"top":"bottom"}-${t.x<s/2?"left":"right"}`};const h=class{constructor(e){t(this,e),this.target=void 0,this.unthemed=!1,this.x=void 0,this.y=void 0,this.quadrant=void 0,this.content=void 0}handlePopoverOpen(t){t.stopPropagation();const{detail:e}=t,i=e.view,s=e.geometry,{left:a,top:r,height:l,width:c}=i.container.getBoundingClientRect();if("polygon"===s.type||"polyline"===s.type||"extent"===s.type){const t=s.extent,e=i.toScreen(t.center);this.quadrant=d(e,i);const h=((t,e)=>{const{spatialReference:i}=e;let s=1/0,a=0;const n=("polygon"===e.type?e.rings.flat(1/0):e.paths.flat(1/0)).reduce(((t,e,i)=>{const s=Math.floor(i/2);return t[s]||(t[s]=[]),t[s].push(e),t}),[]);n.forEach(((e,n)=>{const[r,o]=e,l=((t,e)=>{const{x:i,y:s}=t,{x:a,y:n}=e;return Math.sqrt((a-i)**2+(n-s)**2)})({x:r,y:o,spatialReference:i},t);l<s&&(s=l,a=n)}));const[r,o]=n[a];return{x:r,y:o,spatialReference:i}})(((t,e)=>{const{xmin:i,ymin:s,xmax:a,ymax:n,spatialReference:r}=t,o=e.includes("top")?s:n;return{x:e.includes("left")?a:i,y:o,spatialReference:r}})(t,this.quadrant),"extent"===s.type?o.fromExtent(s):s),p=i.toScreen(h);if(p.x<0||p.y<0||p.x>c||p.y>l){if(!n(i.extent,s))return void(this.content=null);{const t=i.toScreen(i.center);this.quadrant=d(t,i),this.x=t.x+a,this.y=t.y+r}}else this.x=p.x+a,this.y=p.y+r}else if("point"===s.type){const t=i.toScreen(s);this.quadrant=d(t,i),this.x=t.x+a,this.y=t.y+r}this.content=this.x<a||this.x>a+c||this.y<r||this.y>r+l?null:e.render(s.type)}handlePopoverClear(t){t.stopPropagation(),this.content=null}get styles(){const{quadrant:t,x:e,y:i}=this,s=(null==t?void 0:t.includes("right"))?"translateX(-110%)":"translateX(10%)",a=(null==t?void 0:t.includes("top"))?"translateY(-25%)":"translateY(-75%)";return{"--top-offset":`${i+window.scrollY}px`,"--left-offset":`${e}px`,transform:`${s} ${a}`}}render(){const{styles:t,content:i,unthemed:a}=this;return e(s,{style:t,unthemed:a},i)}get el(){return i(this)}};(function(t,e,i,s){var a,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);n>3&&r&&Object.defineProperty(e,i,r)})([r({when(t){const{target:e}=this,{detail:{source:i}}=t;return!e&&!i||(null==e?void 0:e.toLowerCase())===(null==i?void 0:i.toLowerCase())}})],h.prototype,"handlePopoverOpen",null),h.style=":host{position:absolute;z-index:1;width:max-content;--tw-shadow:0 6px 20px -4px rgba(0, 0, 0, 0.1), 0 4px 12px -2px rgba(0, 0, 0, 0.08);--tw-shadow-colored:0 6px 20px -4px var(--tw-shadow-color), 0 4px 12px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);top:var(--top-offset);left:var(--left-offset);transform:var(--transform)}calcite-action{border-width:0px;border-top-width:1px;border-style:solid;border-color:var(--calcite-ui-border-1)}calcite-action:first-of-type{border-width:0px}calcite-action-pad>calcite-action{border-width:0px}calcite-action-group{border-width:0px;border-bottom-width:1px;border-style:solid;border-color:var(--calcite-ui-border-1)}calcite-action-group>calcite-action{border-style:none}";const p=class{constructor(e){t(this,e),this.text=void 0}render(){const{text:t}=this;return e(s,null,e("span",null,t))}};var u,f,g;p.style=":host{display:block}span{margin:0px;width:auto;border-radius:0.5rem;--tw-bg-opacity:1;background-color:rgb(151 71 255 / var(--tw-bg-opacity));padding:0.5rem;font-size:var(--calcite-font-size--1);line-height:1rem;font-weight:var(--calcite-font-weight-medium);--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity));--tw-drop-shadow:drop-shadow(0 4px 3px rgb(0 0 0 / 0.07)) drop-shadow(0 2px 2px rgb(0 0 0 / 0.06));filter:var(--tw-filter)}",function(t){t.Imperial="imperial",t.Metric="metric"}(u||(u={})),function(t){t.Feet="feet",t.Miles="miles",t.NauticalMiles="nautical miles"}(f||(f={})),function(t){t.Meters="meters",t.Kilometers="kilometers"}(g||(g={}));const b=class{constructor(e){t(this,e),this.arcgisHubMapWidgetDrawBufferChanged=a(this,"arcgisHubMapWidgetDrawBufferChanged",7),this.arcgisHubMapWigetDrawBufferReset=a(this,"arcgisHubMapWigetDrawBufferReset",7),this.arcgisHubMapWidgetDrawBufferPanelClosed=a(this,"arcgisHubMapWidgetDrawBufferPanelClosed",7),this.arcgisHubWidgetPanelToggled=a(this,"arcgisHubWidgetPanelToggled",7),this.visible=void 0,this.unit=this.defaultUnitOfMeasurement,this.distance=0,this.status="idle",l(this,"handleInputKeyUp","handleSetPanelRef","handleSetSelectRef","handleSetInputRef","reset")}async componentWillLoad(){const{el:t}=this;this.intl=await c.loadIntlForComponent(t),this.handleVisibleChange()}handleUnitDistanceChanged(){const{arcgisHubMapWidgetDrawBufferChanged:t,unit:e,distance:i}=this;t.emit({distance:i,unit:e})}handleCalciteSelectChange(){const{selectEl:{selectedOption:{value:t}}}=this;this.unit=t.toLowerCase()}handleCalciteInputInput(){const{inputEl:{value:t}}=this;this.distance=+t,this.validateDistance()}handleCalcitePanelDismissedChange(){const{panelEl:{closed:t},arcgisHubMapWidgetDrawBufferPanelClosed:e}=this;t&&e.emit()}handleVisibleChange(){const{visible:t,panelEl:e,arcgisHubWidgetPanelToggled:i}=this;e&&i.emit(!t)}async forceReset(){this.reset()}reset(){const{arcgisHubMapWigetDrawBufferReset:t}=this;this.distance=0,this.unit=this.defaultUnitOfMeasurement,t.emit()}validateDistance(){const{inputEl:{value:t}}=this;this.status=t?"idle":"invalid"}handleInputKeyUp(){this.validateDistance()}handleSetSelectRef(t){t&&(this.selectEl=t)}handleSetInputRef(t){t&&(this.inputEl=t)}handleSetPanelRef(t){t&&(this.panelEl=t)}get defaultSystemOfMesasurement(){const[,t]=window.navigator.language.toLowerCase().split("-");return["us","lr","mm"].includes(t)?u.Imperial:u.Metric}get defaultUnitOfMeasurement(){const{defaultSystemOfMesasurement:t}=this;return t===u.Imperial?f.Feet:g.Meters}get canReset(){const{distance:t,unit:e,defaultUnitOfMeasurement:i}=this;return Boolean(t)||e!==i}get distanceIsInvalid(){const{status:t}=this;return"invalid"===t}renderOptionsGroup(t,i){const{unit:s,intl:a}=this;return e("calcite-option-group",{label:a.t(`system.${t}`)},i.map((t=>e("calcite-option",{key:t,selected:s===t},a.t(`units.${t.replace(" ","")}`)))))}render(){const{distance:t,distanceIsInvalid:i,intl:a,canReset:n,status:r,visible:o,handleInputKeyUp:l,handleSetSelectRef:c,handleSetInputRef:d,handleSetPanelRef:h,reset:p}=this,b=a.t("panel.heading"),m=a.t("panel.reset"),w=a.t("distance.title"),v=a.t("distance.placeholder"),x=a.t("distance.message"),y=a.t("units.title");return e(s,{"data-element":"widget-draw-buffer"},e("calcite-panel",{closable:!0,closed:!o,heading:b,ref:h},e("calcite-action",{disabled:!n,icon:"reset",onClick:p,slot:"header-actions-end",text:m}),e("div",{class:"location-filter"},e("calcite-label",{scale:"l"},w,e("calcite-input",{onKeyUp:l,placeholder:v,ref:d,scale:"l",status:r,type:"number",value:t.toString()}),e("calcite-input-message",{hidden:!i},x)),e("calcite-label",{scale:"l"},y,e("calcite-select",{label:y,ref:c,scale:"l"},this.renderOptionsGroup(u.Metric,Object.values(g)),this.renderOptionsGroup(u.Imperial,Object.values(f)))))))}static get assetsDirs(){return["locales"]}get el(){return i(this)}static get watchers(){return{unit:["handleUnitDistanceChanged"],distance:["handleUnitDistanceChanged"],visible:["handleVisibleChange"]}}};b.style="calcite-panel div{display:grid;gap:0.25rem;padding:1rem;background-color:var(--calcite-ui-foreground-1)}";export{h as arcgis_hub_map_popover,p as arcgis_hub_map_tip,b as arcgis_hub_map_widget_draw_buffer}