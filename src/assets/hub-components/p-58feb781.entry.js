import{r as t,c as s,h as i,H as e}from"./p-d4ba4c14.js";import{i as r,g as a,f as o,c as h,d as l,C as n}from"./p-e4c1ab9e.js";import{b as c}from"./p-fd260f2d.js";import{d}from"./p-8cf4bd83.js";import{p}from"./p-6dcae6cd.js";import"./p-dcdf7b57.js";import"./p-b728aff4.js";import"./p-796574a4.js";import"./p-dfe5a97d.js";import"./p-637ea136.js";const m=class{constructor(i){t(this,i),this.hubTelemetry=s(this,"hubTelemetry",7),this.arcgisDownloadSuccess=s(this,"arcgisDownloadSuccess",7),this.arcgisDownloadError=s(this,"arcgisDownloadError",7),this.item=void 0,this.server=void 0,this.layers=void 0,this.fileFormat=void 0,this.filterGeometry=void 0,this.appearance="solid",this.width="auto",this.authentication=void 0,this.loading=!1,this.hasError=!1,c(this,"onHandleClick")}get serviceUrl(){let t;return r(this.server)?t=this.server:this.server?t=this.server.url:this.item&&(t=p(this.item.url)),t}async onHandleClick(){this.hasError=!1,this.loading=!0;const{serviceUrl:t,fileFormat:s}=this,i=(new Date).valueOf();try{const e=this.getCreateReplicaOptions(),r=await a(t,this.authentication,e);this.hubTelemetry.emit(Object.assign(Object.assign({},d.dictionary.category.interaction.action.download),{label:o(s),details:t,response:d.constants.response.SUCCESS,duration:(new Date).valueOf()-i})),this.arcgisDownloadSuccess.emit({serviceUrl:t,fileFormat:s,downloadUrl:r})}catch(e){this.hasError=!0,this.hubTelemetry.emit(Object.assign(Object.assign({},d.dictionary.category.interaction.action.download),{label:o(s),details:t,response:d.constants.response.FAILURE,duration:(new Date).valueOf()-i})),this.arcgisDownloadError.emit({serviceUrl:t,fileFormat:s,error:e})}this.loading=!1}getCreateReplicaOptions(){let t,s;r(this.layers)?(t=this.layers,s=this.layers.split(",").reduce(((t,s)=>(t[+s]={queryOption:"all"},t)),{})):h(this.layers)?(t=this.layers.join(","),s=this.layers.reduce(((t,s)=>(t[s]={queryOption:"all"},t)),{})):l(this.layers)&&(t=this.layers.map((t=>t.id)).join(","),s=this.layers.reduce(((t,{id:s,where:i})=>(t[s]={queryOption:"all"},i&&(t[s]={where:i,queryOption:"useFilter"}),t)),{}));let i=new n;return t&&(i=i.layers(t)),s&&(i=i.layerQueries(s)),this.fileFormat&&(i=i.dataFormat(this.fileFormat)),this.filterGeometry&&(i=i.geometry(this.filterGeometry)),i.build()}render(){let t,s;return this.hasError&&(t="red",s="exclamationMarkTriangle"),i(e,{"data-element":"download-features-button"},i("calcite-button",{appearance:this.appearance,color:t,"icon-start":s,loading:this.loading,onClick:this.onHandleClick,width:this.width},i("slot",null)))}};m.style=":host{display:block}";export{m as arcgis_download_features_button}