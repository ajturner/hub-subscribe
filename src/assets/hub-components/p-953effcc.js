import{d as i}from"./p-4a14259a.js";import{f as t}from"./p-adee2925.js";import{f as e,p as s,h as l,a}from"./p-fbd5dcee.js";import{D as o}from"./p-56b73d71.js";async function n(t,e){let{isHub:s}=t;if(void 0===s)try{s=await i(globalThis.location.hostname,e)}catch(i){s=!1}return{isHub:s}}async function d(i,n){var d;const{post:p,parent:u,bust:r,locationId:y,discussionType:c}=i;let{discussion:f,entityId:v,entityType:w,entity:b,displayFieldValue:h,displayFieldKey:m,displayFieldValid:F}=i;const T=(i,s,l)=>s===o.GROUP?t(i,n,{bust:l}):e(i,n,{bust:l});if(b)v=b.id,w=b.type===o.GROUP?o.GROUP:"content";else if(v&&w)b=await T(v,w,r);else if(u||p)({type:w,id:v}=s((null==u?void 0:u.discussion)||(null==p?void 0:p.discussion))),b=await T(v,w,r);else if(f)if(({type:w,id:v}=s(f)),[o.GROUP,o.CONTENT].includes(w))b=await T(v,w,r);else{if(!w)throw new Error("must provide an `entityType` when only providing `discussion` with scope that is not `content` or `group`");b=await T(v,w,r)}if(b)if(m=(null===(d=b.layer)||void 0===d?void 0:d.displayField)||null,F=l(b),y&&F&&void 0===h)try{({properties:{[b.layer.displayField]:h}}=await a(b.url,y))}catch(i){console.error("Failed to load location:",i.message)}else h=h||null;else m=null,F=null,h=null;return f=f||(null==p?void 0:p.discussion)||(null==u?void 0:u.discussion)||`hub://${w}/${v}${c?`/${c}`:""}`,{discussion:f,entityId:v,entityType:w,entity:b,displayFieldKey:m,displayFieldValid:F,displayFieldValue:h}}export{d as a,n as f}