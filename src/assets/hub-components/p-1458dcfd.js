import{c as e,u as t}from"./p-b728aff4.js";import{v as r,r as i,c as a}from"./p-783242bc.js";import{s as n}from"./p-52612356.js";import{g as o}from"./p-796574a4.js";import{j as s,w as c,x as p}from"./p-85d6867e.js";import{c as l,d as u}from"./p-dafb2329.js";import{g as m}from"./p-b295a5ae.js";import{d,f}from"./p-6f931af6.js";import{g as y}from"./p-a0deb8c6.js";import{g as b,a as g}from"./p-dd26efbb.js";import{m as w}from"./p-8dbea197.js";import{g as $}from"./p-90dc0f6f.js";import{g as S}from"./p-31aebb8c.js";import{s as h}from"./p-235bb6ee.js";class v extends d{constructor(e,t,r){super(e,t=t||"UNKNOWN_ERROR",r=m(r,"rootCause",r)),this.name="HubError",this.stack=m(r,"stack",(new Error).stack)}}function A(e){return null==e||""===e}function j(e,t){let r=null;const i=t.filter((t=>t.predicates.find((t=>!A(t[e])))));if(i.length>1)throw new Error(`Only 1 IFilter can have a '${e}' predicate but ${i.length} were detected`);if(i.length){const t=i[0],a=t.predicates.filter((t=>!A(t[e])));if(a.length>1)throw new Error(`Only 1 '${e}' predicate is allowed but ${a.length} were detected`);if("AND"!==t.operation&&t.predicates.length>1)throw new Error(`'${e}' predicates cannot be OR'd to other predicates`);const n=a[0],o=n[e];if("string"!=typeof o&&"boolean"!=typeof o)throw new Error(`'${e}' predicate must be a string or boolean primitive. string[] and IMatchOptions are not allowed.`);r=n}return r}const k=["created","modified","lastlogin"],D=["bbox","categoriesAsParam","categoryFilter","filterType","isopendata","isviewonly","memberType","name","searchUserAccess","searchUserName","term"],M=[...k,...D];function O(t){const a={};return Object.entries(t).forEach((([s,c])=>{if(M.includes(s)||n(s,r(c),a),k.includes(s)){const r=e(o(t,s));"relative-date"===o(t,`${s}.type`)?n(s,i(r),a):n(s,r,a)}D.includes(s)&&t.hasOwnProperty(s)&&n(s,c,a)})),a}function x(e){const t=E(e.filters.map(N).filter(W),"AND"),r=j("bbox",e.filters);return r&&(t.params={bbox:r.bbox}),t}function W(e){return!(null==e||""===e)}function E(e,t){return e.reduce(((e,r)=>(Object.entries(r).forEach((([r,i])=>{e[r]&&""!==i?e[r]=`${e[r]} ${t} ${i}`:""!==i&&(e[r]=i)})),e)),{q:""})}function N(e){const t=e.operation||"AND",r=e.predicates.map(O),i=E(r.map(P).filter((e=>null!=e)),t);return r.length>1&&(i.q=`(${i.q})`),i}function P(e){const t=["created","modified"],r=["isopendata","isviewonly"],i=["searchUserAccess","searchUserName","memberType","name","categoriesAsParam","categoryFilter","bbox","joined"],a=["filterType","term",...t,...r,...i],n=["access","capabilities","created","categories","categoriesAsParam","categoryFilter","description","disabled","email","emailstatus","firstname","fullname","group","id","isInvitationOnly","isopendata","joined","lastlogin","lastname","memberType","modified","name","orgid","orgIds","owner","provider","role","searchUserAccess","searchUserName","snippet","tags","term","title","type","typekeywords","userlicensetype","username","isviewonly"],o=Object.entries(e).map((([e,o])=>{if(n.includes(e)){const n={q:""};return a.includes(e)||"term"===e||(n.q=function(e,t){let r="";return t.any&&(r=`${T("OR",e,t.any)}`),t.all&&(r=(r?r+" AND ":"")+`${T("AND",e,t.all)}`),t.not&&(r=(r?r+" AND ":"")+`${T("OR",`-${e}`,t.not)}`),r}(e,o)),(t.includes(e)||function(e){return"object"==typeof e&&null!==e&&["from","to"].every((t=>void 0!==e[t]))}(o))&&(n.q=function(e,t){return`${e}:[${t.from} TO ${t.to}]`}(e,o)),r.includes(e)&&(n.q=`${e}:${o}`),i.includes(e)&&(n[e]="joined"===e?`${o.from},${o.to}`:o),"term"===e&&(n.q=o),n}})).filter(W);if(o.length){const e=E(o,"AND");return e.q&&(e.q=`(${e.q})`),e}return null}function T(e,t,r){let i="";return Array.isArray(r)?(i=`${t}:"${r.join(`" ${e} ${t}:"`)}"`,r.length>1&&(i=`(${i})`)):i=`${t}:"${r}"`,i}function I(e){var t;return(null===(t=e.aggregations)||void 0===t?void 0:t.counts)?e.aggregations.counts.map((e=>({mode:"terms",field:e.fieldName,values:e.fieldValues}))):[]}async function F(e,r,i){const a={access:e.access,id:e.id,type:e.type,name:e.title,owner:e.owner,tags:e.tags,typeKeywords:e.typeKeywords,categories:e.categories,summary:e.snippet||e.description,createdDate:new Date(e.created),createdDateSource:"item.created",updatedDate:new Date(e.modified),updatedDateSource:"item.modified",family:y(e.type),links:{self:"not-implemented",siteRelative:"not-implemented",thumbnail:"not-implemented"}},n=(r=[...r].filter(t)).map(s),c=w("enrichment",n).filter(t);let p={};return c.length&&(p=await f(e,c,i)),n.forEach((e=>{a[e.prop]=o(p,e.path)})),a.links.thumbnail=$(e,i),a.links.self=b(a.id,i),a.links.siteRelative=g(a.type,a.id,e.typeKeywords),a}async function R(e,t){return L(C(t,e))}function H(e,t){return G(C(t,e))}function C(t,r){var i;if(!t.requestOptions)throw new v("portalSearchItems","options.requestOptions is required.");const a=x(function(t){let r=function(t){const r=e(t);if(r.collection){const{collection:e,targetEntity:i,filters:a}=t,n=S("",i,e),s=o(n,"scope.filters")||[];r.filters=[...a,...s]}return r}(t);return r=function(t){const r=e(t);return r.filters=r.filters.map((e=>{let t=!1;return e.predicates=e.predicates.reduce(((e,r)=>{if(function(e){let t=!1;return"string"==typeof e&&(t=e in V),t}(r.type)){const i=V[r.type];e=[...e,...i],t=!0}else e.push(r);return e}),[]),t&&(e.operation="OR"),e})),r}(r),r.filters=r.filters.map((e=>(e.predicates=e.predicates.map(O),e))),r}(r));return["num","sortField","sortOrder","include","start","requestOptions"].forEach((e=>{t.hasOwnProperty(e)&&(a[e]=t[e])})),t.requestOptions.authentication?a.authentication=t.requestOptions.authentication:a.portal=t.requestOptions.portal,(null===(i=t.aggFields)||void 0===i?void 0:i.length)&&(a.countFields=t.aggFields.join(","),a.countSize=t.aggLimit||10),a}async function G(e){const t=await h(e),r=I(t);return{total:t.total,results:t.results,aggregations:r,hasNext:t.nextStart>-1,next:a(e,t.nextStart,t.total,G)}}async function L(e){const t=await h(e),r=await Promise.all(t.results.map((t=>U(t,e.includes,e.requestOptions)))),i=I(t);return{total:t.total,results:r,aggregations:i,hasNext:t.nextStart>-1,next:a(e,t.nextStart,t.total,L)}}async function U(e,t=[],r){let i=F;switch(e.type){case"Hub Site Application":case"Site Application":i=c;break;case"Hub Page":case"Site Page":i=p;break;case"Hub Project":i=u;break;case"Solution":i=l;break;case"Web Mapping Application":e.typeKeywords.includes("hubSite")&&(i=c)}return i(e,t,r)}const V={$application:[{type:{any:["Web Mapping Application","Application","Insights","Web Experience"],not:["Insights Theme","Insights Model"]},typekeywords:{not:["hubSite","Story Map"]}},{type:"Web Mapping Experience",typekeywords:"EXB Experience"}],$dashboard:[{type:{any:["Dashboard"],not:["Operation View"]},typekeywords:{not:["Extension","ArcGIS Operation View"]}}],$dataset:[{type:{any:["Scene Service","Feature Collection","Route Layer","Layer","Explorer Layer","Tile Package","Vector Tile Package","Scene Package","Layer Package","Feature Service","Stream Service","Map Service","Vector Tile Service","Image Service","WMS","WFS","WMTS","KML","KML Collection","Globe Service","CSV","Shapefile","GeoJson","Service Definition","File Geodatabase","CAD Drawing","Relational Database Connection"],not:["Web Mapping Application","Geodata Service"]}},{typekeywords:["OGC","Geodata Service"]}],$document:[{type:["PDF","Microsoft Excel","Microsoft Word","Microsoft Powerpoint","iWork Keynote","iWork Pages","iWork Numbers","Visio Document","Document Link"]}],$initiative:[{type:"Hub Initiative"}],$experience:[{type:"Web Experience"}],$feedback:[{type:"Form"}],$page:[{typekeywords:"hubPage"}],$site:[{type:["Hub Site Application","Site Application"]}],$storymap:[{type:"Storymap"},{type:"Web Mapping Application",typekeywords:"Story Map"}],$template:[{type:["Web Mapping Application","Hub Initiative","Hub Initiative Template","Solution"],typekeywords:{any:["hubInitiativeTemplate","hubSolutionTemplate","Template"],not:"Deployed"}}],$webmap:[{type:{any:["Web Map","Web Scene"],not:"Web Mapping Application"}}]};export{v as H,U as a,H as b,O as e,j as g,A as i,R as p,x as s}