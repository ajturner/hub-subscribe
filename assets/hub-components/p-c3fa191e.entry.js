import{r as i,c as t,h as e,H as s,a}from"./p-d4ba4c14.js";import{d as r}from"./p-8cf4bd83.js";import{D as c}from"./p-3bf8d293.js";import{b as o}from"./p-fd260f2d.js";import{i as n}from"./p-be5c5009.js";import{g as h}from"./p-e07eb8b2.js";import{webMercatorToGeographic as l}from"@arcgis/core/geometry/support/webMercatorUtils.js";import"./p-dfe5a97d.js";var d;!function(i){i.circle="circle",i.square="square",i.grip="grip"}(d||(d={}));const u="none",p=(i,t)=>i.action===t.action&&i.category===t.category&&i.label===t.label,g=class{constructor(e){i(this,e),this.arcgisBoundaryPickerUpdate=t(this,"arcgisBoundaryPickerUpdate",7),this.arcgisBoundaryPickerCancel=t(this,"arcgisBoundaryPickerCancel",7),this.arcgisBoundaryPickerSave=t(this,"arcgisBoundaryPickerSave",7),this.state=void 0,this.authenticated=!1,this.sources=void 0,this.extent=void 0,this.resetDrawingToolsOnDisconnect=!0,this._selected=void 0,this._savedEditState=void 0,this._view=void 0,this._editGeometry=void 0,this._updatedGeometry=void 0,o(this,"handleSave","handleCancel","handleEditClick","handleCancelEditClick","handleSaveEditClick","_setMapDrawElement")}get _editing(){return!!this._editGeometry}get _selectedGraphic(){var i;return null===(i=this._selected)||void 0===i?void 0:i.graphic}get _selectedGraphics(){const i=this._selectedGraphic;return i&&!i.symbol&&i.geometry&&i.geometry.type&&(i.symbol=h()),this._editing?[]:[i]}get _selectedValue(){var i;return null===(i=this._selected)||void 0===i?void 0:i.value}get _isNone(){return this._selectedValue===u}get _initialSelection(){var i;return null===(i=this.sources)||void 0===i?void 0:i.find((i=>i.selected))}get _isGeometryDirty(){return!!this._updatedGeometry}get _isDirty(){var i;return this._selectedValue!==(null===(i=this._initialSelection)||void 0===i?void 0:i.value)||this._isGeometryDirty}get _isLoadingOrSaving(){return"loading"===this.state||"saving"===this.state}get _canSave(){return this.authenticated&&this._isDirty&&!this._isLoadingOrSaving}get _noneOption(){var i;return null===(i=this.sources)||void 0===i?void 0:i.find((i=>i.value===u))}get _otherOptions(){var i;return null===(i=this.sources)||void 0===i?void 0:i.filter((i=>i.value!==u))}get _saveGeometry(){return this._isGeometryDirty?"item"===this._selectedValue?l(this._updatedGeometry.extent):this._updatedGeometry:this._selectedGraphic.geometry}get _saveSource(){const i=this._saveGeometry,t=Object.assign(Object.assign({},this._selectedGraphic),{geometry:i});return Object.assign(Object.assign({},this._selected),{graphic:t})}get _overlayMessage(){var i;if(!this._editing)return this._isNone?this.intl.t("noLocationSet"):"item"!==this._selectedValue||(null===(i=this._selectedGraphic)||void 0===i?void 0:i.geometry)?void 0:this.intl.t("clickEditAndDraw")}_getDefaultLabel(i){return[u,"item"].includes(i)?this.intl.t("item"===i?"itemsCurrentExtent":i):void 0}_cancelEditGeometry(){this._editGeometry=null,this._updatedGeometry=null,this._mapDrawElement.forceReset()}_setMapDrawElement(i){this._mapDrawElement=i}_emitGeometryUpdate(){this.arcgisBoundaryPickerUpdate.emit(this._saveSource)}async componentWillLoad(){this.intl=await n.loadIntlForComponent(this.element),this.onSourcesUpdate()}onSourcesUpdate(){this._selected=this._initialSelection}async handleMapViewReady(i){i.stopPropagation();const{detail:{view:t}}=i;await t.when(),t.ui.components=[],this._view=t}handleListChange(i){var t;i.stopPropagation(),this._cancelEditGeometry();const e=i.detail.keys().next().value;let s=null===(t=this.sources)||void 0===t?void 0:t.find((i=>i.value===e));this._savedEditState&&s.value===this._savedEditState.value&&(s=this._savedEditState),this._selected=Object.assign(Object.assign({},s),{selected:!0}),this.arcgisBoundaryPickerUpdate.emit(this._selected)}handleGraphicsChange(i){var t;const{graphics:e}=i.detail;this._updatedGeometry=null===(t=e.getItemAt(0))||void 0===t?void 0:t.geometry,this._emitGeometryUpdate()}handleTelemetry(i){const t=i.detail,e=r.dictionary.category.interaction.action;(p(t,e.search.label.filter)||p(t,e.enable.label.draw.details.update)||p(t,e.disable.label.draw.details.update))&&i.stopPropagation()}async cancelEditGeometry(){this._cancelEditGeometry()}handleSave(i){i.preventDefault(),this.arcgisBoundaryPickerSave.emit(this._saveSource)}handleCancel(i){i.preventDefault(),this.arcgisBoundaryPickerCancel.emit(),this._cancelEditGeometry()}handleEditClick(i){var t;i.preventDefault();const e=null===(t=this._selectedGraphic)||void 0===t?void 0:t.geometry;e?this._editGeometry=e:(this._editGeometry=this._view.extent.expand(1/1.5),this._updatedGeometry=this._editGeometry,this.arcgisBoundaryPickerUpdate.emit(this._saveSource))}handleCancelEditClick(i){i.preventDefault(),this._cancelEditGeometry(),this.arcgisBoundaryPickerUpdate.emit(this._selected)}handleSaveEditClick(i){i.preventDefault(),this._savedEditState=this._saveSource,this._selected=this._saveSource,this._cancelEditGeometry(),this._emitGeometryUpdate()}renderEditConfirmButton(){if(this._editing)return e("calcite-action",{icon:"check",onClick:this.handleSaveEditClick,slot:"actions-end",text:""})}render(){var i;return e(s,null,e("div",{class:"row"},e("arcgis-hub-map",{basemap:"gray-vector",expand:1.5,extent:this.extent,graphics:this._selectedGraphics},e("arcgis-hub-map-widget-container",{"expand-disabled":!0,scale:"s",view:this._view,"view-position":"top-right"},e("arcgis-hub-map-widget-zoom",{scale:"s",view:this._view})),e("arcgis-hub-map-widget-container",{scale:"s","view-position":"top-right"},e("arcgis-hub-map-widget-draw",{disableEditOptions:!0,disablePrimaryOptions:!0,geometry:this._editGeometry,ref:this._setMapDrawElement,resetOnDisconnect:this.resetDrawingToolsOnDisconnect,tools:[],view:this._view})),this._overlayMessage?e("div",{class:"arcgis-boundary-map-overlay"},e("div",{class:"arcgis-boundary-none-message"},this._overlayMessage)):null),e("calcite-pick-list",{"aria-busy":"false","aria-disabled":this._isLoadingOrSaving,disabled:this._isLoadingOrSaving,role:"menu"},this._noneOption?e("calcite-pick-list-item",{icon:d.circle,label:this._noneOption.label||this._getDefaultLabel(this._noneOption.value),selected:this._noneOption.selected,tabindex:"-1",value:this._noneOption.value}):null,e("calcite-pick-list-group",{"group-title":this.intl.t("startFrom")},null===(i=this._otherOptions)||void 0===i?void 0:i.map((i=>e("calcite-pick-list-item",{icon:d.circle,key:i.value,label:i.label||this._getDefaultLabel(i.value),selected:i.selected,value:i.value},this.renderEditConfirmButton(),e("calcite-action",{disabled:this._selectedValue!==i.value,icon:this._editing?"x":"pencil",onClick:this._editing?this.handleCancelEditClick:this.handleEditClick,slot:"actions-end",text:""}))))))),this.authenticated&&e("div",{class:"buttons"},e("calcite-button",{appearance:"solid",color:"blue",disabled:!this._canSave,loading:"saving"===this.state,onClick:this.handleSave,scale:"m",type:"button",width:"auto"},this.intl.t("save")),e("calcite-button",{appearance:"outline",color:"blue",disabled:this._isLoadingOrSaving,onClick:this.handleCancel,scale:"m",type:"button",width:"auto"},this.intl.t("cancel"))))}static get assetsDirs(){return["locales"]}get element(){return a(this)}static get watchers(){return{sources:["onSourcesUpdate"]}}};(function(i,t,e,s){var a,r=arguments.length,c=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,e):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(i,t,e,s);else for(var o=i.length-1;o>=0;o--)(a=i[o])&&(c=(r<3?a(c):r>3?a(t,e,c):a(t,e))||c);r>3&&c&&Object.defineProperty(t,e,c)})([c({timeout:300})],g.prototype,"_emitGeometryUpdate",null),g.style=".sc-arcgis-boundary-picker-ui-h{display:block}@media (min-width: 640px){.row.sc-arcgis-boundary-picker-ui{display:flex}.row.sc-arcgis-boundary-picker-ui{flex-direction:row-reverse}}arcgis-hub-map.sc-arcgis-boundary-picker-ui{height:300px;position:relative;margin-bottom:1rem;width:100%}@media (min-width: 640px){arcgis-hub-map.sc-arcgis-boundary-picker-ui{margin-bottom:0px}}arcgis-hub-map.sc-arcgis-boundary-picker-ui .arcgis-boundary-map-overlay.sc-arcgis-boundary-picker-ui{position:absolute;top:0px;left:0px;z-index:10;display:flex;height:100%;width:100%;flex-direction:column;justify-content:center;background-color:#0000004d;color:var(--calcite-ui-text-inverse)}.arcgis-boundary-none-message.sc-arcgis-boundary-picker-ui{text-align:center}calcite-pick-list.sc-arcgis-boundary-picker-ui{width:100%;background-color:var(--calcite-ui-foreground-3);padding:1rem;color:var(--calcite-ui-text-3)}@media (min-width: 640px){calcite-pick-list.sc-arcgis-boundary-picker-ui{max-width:20rem}}.buttons.sc-arcgis-boundary-picker-ui{display:flex;justify-content:flex-end;padding:1rem}.buttons.sc-arcgis-boundary-picker-ui calcite-button.sc-arcgis-boundary-picker-ui{margin-left:0.5rem}";export{g as arcgis_boundary_picker_ui}