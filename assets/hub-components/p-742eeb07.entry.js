import{r as t,c as e,h as i,F as s,H as o,a}from"./p-d4ba4c14.js";import{i as r}from"./p-be5c5009.js";import{b as l}from"./p-fd260f2d.js";import{c as n}from"./p-0373fd99.js";import{g as h}from"./p-cea8413b.js";import{s as c,u as d,d as u}from"./p-c0aa9a66.js";import{c as p}from"./p-b728aff4.js";import"./p-d763eacf.js";import"./p-377e1b5e.js";import"./p-637ea136.js";import"./p-dcdf7b57.js";import"./p-ad325ed1.js";import"./p-16a95e5b.js";import"./p-aa262d60.js";import"./p-796574a4.js";import"./p-af59e67b.js";import"./p-e43616ff.js";const m={month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"},v=class{constructor(i){t(this,i),this.arcgisHubVersionsVersionSelected=e(this,"arcgisHubVersionsVersionSelected",7),this.activeVersionId=void 0,this.context=void 0,this.itemId=void 0,this.publishedVersionId=void 0,this.versions=[],this.loading=!0,this.error=!1,this.versionToOperateOn=void 0,this.shouldShowDetailsModal=!1,this.shouldShowDeleteModal=!1,this.updateDetailsError=!1,this.deleteError=!1,this.shouldShowAlert=!1,this.hasClipboardError=!1,this.item=void 0,l(this,"onAlertClose","onDelete","onHideDeleteModal","onHideDetailsModal","onSaveDetails","onSelectVersion","onShare","onShowDeleteModal","onShowDetailsModal","onShowPopover","renderListItem","setPopoverEl")}async componentWillLoad(){this.intl=await r.loadIntlForComponent(this.element),this.fetchVersions()}async fetchVersions(){var t,e;this.loading=!0,this.error=!1;try{if(this.context&&this.itemId){this.item=await h(this.itemId,null===(t=this.context)||void 0===t?void 0:t.requestOptions);const i=await c(this.itemId,null===(e=this.context)||void 0===e?void 0:e.requestOptions);this.versions=i}}catch(t){console.error(t.message),this.error=!0}finally{this.loading=!1}}onTitleLinkClick(t){t.preventDefault()}onSelectVersion(t){t.stopPropagation(),t.target.value.id!==this.activeVersionId&&this.arcgisHubVersionsVersionSelected.emit(t.target.value)}setPopoverEl(t){this.popover=t}onShowPopover(t){t.stopPropagation();const e=this.versions.find((e=>e.id===t.target.dataset.id));e&&(this.versionToOperateOn=p(e),this.popover.referenceElement=t.target,setTimeout((()=>{this.popover.open=!0}),100))}onShowDetailsModal(t){t.stopPropagation(),this.popover.open=!1,this.shouldShowDetailsModal=!0}onHideDetailsModal(t){t.stopPropagation(),this.updateDetailsError=!1,this.versionToOperateOn=null,this.shouldShowDetailsModal=!1}async onSaveDetails(t){var e;t.stopPropagation();try{const i=t.detail;await d(this.itemId,i,this.item.owner,null===(e=this.context)||void 0===e?void 0:e.requestOptions),this.versions=this.versions.map((t=>t.id===i.id?i:t)),this.shouldShowDetailsModal=!1,this.versionToOperateOn=null}catch(t){console.error(t),this.updateDetailsError=!0}}onShowDeleteModal(t){t.stopPropagation(),this.showDeleteModal(this.versionToOperateOn.id)}async showDeleteModal(t){const e=this.versions.find((e=>e.id===t));e&&(this.popover.open=!1,this.versionToOperateOn=p(e),this.shouldShowDeleteModal=!0)}onHideDeleteModal(t){t.stopPropagation(),this.deleteError=null,this.versionToOperateOn=null,this.shouldShowDeleteModal=!1}async onDelete(t){var e;t.stopPropagation();try{const i=t.detail;await u(this.itemId,i.id,this.item.owner,null===(e=this.context)||void 0===e?void 0:e.requestOptions),this.versions=this.versions.filter((t=>t.id!==i.id)),this.shouldShowDeleteModal=!1,this.versionToOperateOn=null,i.id===this.activeVersionId&&(this.activeVersionId=null,this.arcgisHubVersionsVersionSelected.emit(null))}catch(t){this.deleteError=!0}}async onShare(){try{this.hasClipboardError=!1,await n(this.getShareUrl(this.versionToOperateOn.id))}catch(t){console.log("Error copying to clipboard",t),this.hasClipboardError=!0}finally{this.popover.open=!1,this.shouldShowAlert=!0}}onAlertClose(){this.shouldShowAlert=!1}getItemUrl(t){const e=new URLSearchParams(window.location.search);return e.set("version",t),`?${e.toString()}`}getShareUrl(t){const e=new URL(window.location.origin);return e.searchParams.set("layoutVersion",t),e.searchParams.set("previewing","true"),e.toString()}get shouldShowDeleteButton(){var t;return this.publishedVersionId!==(null===(t=this.versionToOperateOn)||void 0===t?void 0:t.id)}getVersionMetadata(t){return{name:this.getVersionName(t),createdBy:t.creator}}getVersionName(t){return(null==t?void 0:t.name)||this.intl.formatDate(null==t?void 0:t.created,m)}getCreatedDate(t){const{name:e,created:i}=t;let s="";return e&&(s=this.intl.formatDate(i,m)),s}renderAlert(){const t=this.hasClipboardError?"shareErrorMessage":"shareSuccessMessage";return i("calcite-alert",{"auto-close":!0,autoCloseDuration:"fast",kind:this.hasClipboardError?"danger":"success",label:this.intl.t(t),onCalciteAlertClose:this.onAlertClose,open:this.shouldShowAlert,placement:"top",scale:"s"},i("div",{slot:"title"},this.intl.t(t)))}renderLoading(){const{loading:t}=this;if(t)return i(s,null,i("arcgis-skeleton-loader",{active:!0,rows:1,"show-heading":!0}),i("arcgis-skeleton-loader",{active:!0,rows:1,"show-heading":!0}),i("arcgis-skeleton-loader",{active:!0,rows:1,"show-heading":!0}))}renderEmptyState(){const{loading:t,error:e,versions:o}=this;if(!t&&!e&&!o.length)return i(s,null,i("h2",null,this.intl.t("emptyMessage")))}renderError(){const{loading:t,error:e}=this;if(!t&&e)return i(s,null,i("h2",null,this.intl.t("errorMessage")))}renderPopover(){if(this.versions.length)return i("calcite-popover",{"auto-close":!0,"focus-trap-disabled":!0,label:this.intl.t("popover.label"),overlayPositioning:"fixed",placement:"leading",ref:this.setPopoverEl,referenceElement:""},i("calcite-action-pad",{"expand-disabled":!0,expanded:!0},i("calcite-action",{icon:"share",onClick:this.onShare,scale:"m",text:this.intl.t("popover.actions.share")}),i("calcite-action",{icon:"pencil",onClick:this.onShowDetailsModal,scale:"m",text:this.intl.t("popover.actions.edit")}),this.shouldShowDeleteButton&&i("calcite-action",{icon:"trash",onClick:this.onShowDeleteModal,scale:"m",text:this.intl.t("popover.actions.delete"),"text-enabled":!0})))}renderDetailsModal(){return i("arcgis-hub-versions-details-modal",{error:this.updateDetailsError,onArcgisHubVersionsDetailsModalClose:this.onHideDetailsModal,onArcgisHubVersionsDetailsModalSave:this.onSaveDetails,shouldShow:this.shouldShowDetailsModal,version:this.versionToOperateOn})}renderDeleteModal(){return i("arcgis-hub-versions-delete-modal",{displayName:this.getVersionName(this.versionToOperateOn),error:this.deleteError,onArcgisHubVersionsDeleteModalClose:this.onHideDeleteModal,onArcgisHubVersionsDeleteModalDelete:this.onDelete,shouldShow:this.shouldShowDeleteModal,version:this.versionToOperateOn})}renderListItem(t){return i("calcite-list-item",{key:t.id,metadata:this.getVersionMetadata(t),onCalciteListItemSelect:this.onSelectVersion,selected:this.activeVersionId===t.id,value:t},i("div",{slot:"content"},i("div",{class:"badges-container"},this.publishedVersionId===t.id&&i("calcite-chip",{kind:"brand",scale:"s",value:""},this.intl.t("publishedBadge")),this.activeVersionId===t.id&&i("calcite-chip",{class:"viewing-badge",scale:"s",value:""},this.intl.t("viewingBadge"))),i("h2",{class:"version-title"},i("calcite-link",{href:this.getItemUrl(t.id),onClick:this.onTitleLinkClick},this.getVersionName(t))),i("div",null,this.getCreatedDate(t)),i("div",null,this.intl.t("createdBy",t)),i("div",null,t.description)),i("calcite-action",{"data-id":t.id,icon:"ellipsis",onClick:this.onShowPopover,slot:"actions-end",text:this.intl.t("menuLabel")}))}render(){return i(o,{"data-element":"versions"},i("calcite-list",{"selection-appearance":"border","selection-mode":"none"},this.renderLoading(),this.renderEmptyState(),this.renderError(),this.versions.map(this.renderListItem)),this.renderPopover(),i("arcgis-wormhole",null,this.renderAlert(),this.renderDetailsModal(),this.renderDeleteModal()))}static get assetsDirs(){return["locales"]}get element(){return a(this)}static get watchers(){return{context:["fetchVersions"],itemId:["fetchVersions"]}}};v.style=':host{display:block}arcgis-skeleton-loader{margin:1.25rem;margin-bottom:0}.version-title{margin-block:0.25rem;font-size:1rem;color:var(--calcite-ui-brand)}calcite-list-item{border-inline-start:4px solid transparent}calcite-list-item[selected]{border-inline-start-color:var(--calcite-ui-brand)}calcite-list-item[selected] .version-title:before{content:"â‰« ";color:black}calcite-list-item[selected] .version-title calcite-link{color:transparent;--calcite-ui-text-link:black;--calcite-link-blue-underline:transparent;text-decoration:none}.badges-container{min-height:1.5rem;display:flex;gap:0.25rem}.viewing-badge{--calcite-ui-foreground-2:var(--calcite-ui-foreground-current)}';export{v as arcgis_hub_versions}