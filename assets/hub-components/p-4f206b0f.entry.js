import{r as t,c as i,h as e,H as s,a as o}from"./p-d4ba4c14.js";import{b as h}from"./p-fd260f2d.js";import{i as a}from"./p-be5c5009.js";const r=class{constructor(e){t(this,e),this.arcgisImageUploadEditStepImageChanged=i(this,"arcgisImageUploadEditStepImageChanged",7),this.handleWheel=t=>{t.preventDefault();const i=t.deltaY>0?1*this.imageProperties.scale/1.1:1.1*this.imageProperties.scale;this.zoomValue=""+(50+Math.log(i)/Math.log(1.1)),this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{scale:i})},this.handleDragStart=()=>{this.dragging=!0},this.handleDrag=t=>{if(!this.dragging)return;const{touches:i}=t;let{clientX:e,clientY:s}=t;if(void 0===e||void 0===s){if(!i.length)return;e=i[0].clientX,s=i[0].clientY}if(!this.previousPosition)return void(this.previousPosition={top:s,left:e});const{top:o,left:h}=this.previousPosition,a=s-o,r=e-h;this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{top:this.imageProperties.top+a,left:this.imageProperties.left+r}),this.previousPosition={top:o+a,left:h+r}},this.handleDragEnd=()=>{this.dragging=!1,this.previousPosition=void 0},this.handleImageLoaded=()=>{if(this.editingExisting)return this.loadingImage=!1,this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{scale:this.height/this.imageEl.width,top:0,left:0,origin:{x:"0%",y:"0%"}}),void(this.isLoading=!1);const t=this.aspectRatio>1?this.height*this.aspectRatio:this.height,{clientWidth:i,clientHeight:e}=this.imageEl,s=t/(i>e?i:e);let o=Object.assign({},this.imageProperties);o=Object.assign(Object.assign({},o),{top:this.height/2-e/2,left:this.height*this.aspectRatio/2-i/2,origin:{x:"50%",y:"50%"}}),this.zoomToFit&&(o=Object.assign(Object.assign({},o),{scale:s}),this.initiallySettingZoom=!0,this.zoomValue=""+(50+Math.log(s)/Math.log(1.1))),this.imageProperties=Object.assign({},o),this.isLoading=!1},this.handleZoomInput=t=>{this.initiallySettingZoom?this.initiallySettingZoom=!1:(this.zoomValue=t.target.value,this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{scale:Math.pow(1.1,t.target.value-50)}))},this.handleImageKeydown=t=>{let i=!1;switch(t.key){case"ArrowUp":this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{top:this.imageProperties.top-1}),i=!0;break;case"ArrowDown":this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{top:this.imageProperties.top+1}),i=!0;break;case"ArrowLeft":this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{left:this.imageProperties.left-1}),i=!0;break;case"ArrowRight":this.imageProperties=Object.assign(Object.assign({},this.imageProperties),{left:this.imageProperties.left+1}),i=!0}i&&t.preventDefault()},this.aspectRatio=void 0,this.previewSrc=void 0,this.loadingImage=!1,this.editingExisting=!1,this.zoomToFit=!1,this.height=void 0,this.imageProperties={scale:1,top:0,left:0,origin:{x:"50%",y:"50%"}},this.dragging=!1,this.previousPosition=void 0,this.previewStyle=void 0,this.zoomValue="50",this.initiallySettingZoom=!1,this.firstImagePropertiesChange=!0,this.isLoading=!0,h(this,"handleWheel","handleDragStart","handleDrag","handleDragEnd","handleImageLoaded","handleZoomInput","handleZoomInput","getImageEl","getImageContainerEl")}async componentWillLoad(){this.intl=await a.loadIntlForComponent(this.el);const t=this.height*this.aspectRatio,i=`${this.height+60}px`;this.thumbContainerStyle={height:i},this.translucentContainerStyle={width:`${t+60}px`,height:i},this.transparentContainerStyle={width:`${t}px`,height:`${this.height}px`},this.previewStyle={transform:`scale(${this.imageProperties.scale})`,top:`${this.imageProperties.top}px`,left:`${this.imageProperties.left}px`,transformOrigin:`${this.imageProperties.origin.x} ${this.imageProperties.origin.y}`}}componentDidLoad(){this.imageContainerEl.focus()}getImageExtent(){const t=this.imageEl.getBoundingClientRect(),i=this.imageContainerEl.getBoundingClientRect();return{left:(i.left-t.left)/t.width,right:(i.right-t.left)/t.width,top:(i.top-t.top)/t.height,bottom:(i.bottom-t.top)/t.height}}getDrawDimensions(){const t=this.imageEl.getBoundingClientRect(),i=this.imageContainerEl.getBoundingClientRect();return{left:(t.left-i.left>0?t.left-i.left:0)/i.width,top:(t.top-i.top>0?t.top-i.top:0)/i.height,width:((t.right>i.right?i.right:t.right)-(t.left<i.left?i.left:t.left))/i.width,height:((t.bottom>i.bottom?i.bottom:t.bottom)-(t.top<i.top?i.top:t.top))/i.height}}async getDrawParameters(){const t=this.height*this.aspectRatio,i=this.height,{left:e,right:s,top:o,bottom:h}=this.getImageExtent(),a=e<0?0:e,r=o<0?0:o,n=s>1?1:s,l=h>1?1:h,c=this.getDrawDimensions(),p=this.imageEl.clientWidth,d=this.imageEl.clientHeight;return{selectionX:a*p,selectionY:r*d,selectionWidth:n*p-a*p,selectionHeight:l*d-r*d,canvasWidth:s*p-e*p,canvasHeight:h*d-o*d,minWidth:t,minHeight:i,drawDimensions:c}}handleImagePropertiesChange(){this.previewStyle={transform:`scale(${this.imageProperties.scale})`,top:`${this.imageProperties.top}px`,left:`${this.imageProperties.left}px`,transformOrigin:`${this.imageProperties.origin.x} ${this.imageProperties.origin.y}`},this.firstImagePropertiesChange?(this.firstImagePropertiesChange=!1,this.zoomToFit&&this.arcgisImageUploadEditStepImageChanged.emit()):this.arcgisImageUploadEditStepImageChanged.emit()}getImageContainerEl(t){this.imageContainerEl=t}getImageEl(t){this.imageEl=t}render(){return e(s,{onWheel:this.handleWheel},e("calcite-loader",{class:"edit-step__loader",hidden:!this.isLoading,label:""}),e("div",{class:"edit-step__crop-thumb-container "+(this.isLoading?"edit-step__crop-thumb-container--hidden":""),style:this.thumbContainerStyle},e("div",{class:"edit-step__translucent-container",onMouseDown:this.handleDragStart,onMouseMove:this.handleDrag,onMouseOut:this.handleDragEnd,onMouseUp:this.handleDragEnd,onTouchEnd:this.handleDragEnd,onTouchMove:this.handleDrag,onTouchStart:this.handleDragStart,style:this.translucentContainerStyle},e("div",{class:"edit-step__transparent-container",onKeyDown:this.handleImageKeydown,ref:this.getImageContainerEl,style:this.transparentContainerStyle,tabIndex:0},e("img",{alt:"",class:"edit-step__preview-image "+(this.loadingImage?"edit-step__preview-image--loading":""),onLoad:this.handleImageLoaded,ref:this.getImageEl,src:this.previewSrc,style:this.previewStyle})))),e("calcite-label",{class:"edit-step__zoom-control "+(this.isLoading?"edit-step__zoom-control--hidden":""),"disable-spacing":!0},this.intl.t("zoom"),e("calcite-slider",{"aria-label":this.intl.t("zoom"),max:100,min:0,onCalciteSliderInput:this.handleZoomInput,scale:"l",value:+this.zoomValue}),e("div",{class:"edit-step__zoom-control-label"},e("div",{class:"edit-step__zoom-control-icon-s"},e("calcite-icon",{icon:"image",scale:"s"})),e("div",{class:"edit-step__zoom-control-label-spacer"}),e("div",{class:"edit-step__zoom-control-icon-l"},e("calcite-icon",{icon:"image",scale:"l"})))))}static get assetsDirs(){return["locales"]}get el(){return o(this)}static get watchers(){return{imageProperties:["handleImagePropertiesChange"]}}};r.style=':host{position:relative;display:block;overflow:hidden;min-height:20.625rem}.edit-step__loader{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%)}.edit-step__crop-thumb-container{position:relative;width:100%;overflow:hidden}.edit-step__crop-thumb-container--hidden{visibility:hidden}.edit-step__translucent-container{position:absolute;top:0px;overflow:hidden;left:50%;cursor:all-scroll;transform:translate(-50%)}.edit-step__translucent-container:after{position:absolute;top:0px;right:0px;bottom:0px;left:0px;box-sizing:border-box;height:100%;width:100%;content:"";opacity:0.9;border:1.875rem solid white}.edit-step__transparent-container{position:absolute;box-sizing:border-box;overflow-x:visible;outline:2px solid transparent;outline-offset:2px;background-color:var(--calcite-ui-foreground-3);border:1px solid var(--calcite-ui-border-1);margin-right:-50%;top:50%;left:50%;transform:translate(-50%, -50%)}.edit-step__preview-image{position:absolute;left:0px;top:0px;margin:0px;transform-origin:50% 50%}.edit-step__preview-image--loading{visibility:hidden}.edit-step__transparent-container:focus .edit-step__preview-image{box-shadow:0px 0px 6px 4px var(--calcite-ui-brand)}.edit-step__zoom-control--hidden{visibility:hidden}.edit-step__zoom-control-label{display:flex;height:2rem}.edit-step__zoom-control-label-spacer{flex:1 1 0%}';const n=class{constructor(e){t(this,e),this.arcgisImageUploadFileStepFileChange=i(this,"arcgisImageUploadFileStepFileChange",7),this.arcgisImageUploadFileStepInvalidFile=i(this,"arcgisImageUploadFileStepInvalidFile",7),this.handleDragOver=t=>{t.preventDefault()},this.handleDrop=t=>{t.preventDefault(),this.processFile(t.dataTransfer.files[0])},this.handleFileInputChange=t=>{this.processFile(t.target.files[0])},this.triggerErrorState=t=>{this.errorMessage=this.intl.t(t),setTimeout((()=>{this.resetErrorState()}),3e3)},this.resetErrorState=()=>{this.errorMessage=void 0},this.sizeDescription=void 0,this.errorMessage=void 0,h(this,"handleButtonClick","setFileInputEl","handleDragOver","handleDrop","handleFileInputChange")}async componentWillLoad(){this.intl=await a.loadIntlForComponent(this.el)}get headingIntl(){const{errorMessage:t}=this;let i="dragDrop";return t&&(i="errorHeading"),i}get description(){const{errorMessage:t}=this;let i=this.sizeDescription;return t&&(i=this.errorMessage),i}processFile(t){if(t&&t){if(!this.isValidFile(t))return this.arcgisImageUploadFileStepInvalidFile.emit(),void this.triggerErrorState("unsupportedFileTypeError");const i=new FileReader;i.onload=async i=>{this.arcgisImageUploadFileStepFileChange.emit({dataURL:i.target.result,fileName:t.name||""})},i.readAsDataURL(t)}}isValidFile(t){return(null==t?void 0:t.name)&&/\.(gif|jpg|jpeg|png)$/i.test(t.name)}handleButtonClick(){this.fileInput.click()}setFileInputEl(t){this.fileInput=t}render(){return e("div",{"aria-label":this.intl.t(this.headingIntl),class:"file-step",onDragEnter:this.handleDragOver,onDragOver:this.handleDragOver,onDrop:this.handleDrop},e("div",{class:"file-step__upload-icon"},e("calcite-icon",{icon:"upload"})),e("div",null,e("div",{"aria-label":this.intl.t(this.headingIntl),class:{"file-step__drag-text":!0,error:!!this.errorMessage}},this.intl.t(this.headingIntl)),this.description&&e("div",{"aria-label":this.description},this.description),e("calcite-button",{appearance:"transparent",class:"file-step__browse-button",iconStart:"image",onClick:this.handleButtonClick,scale:"l"},this.intl.t("browse")),e("input",{accept:".jpg,.gif,.png,image/jpg,image/gif,image/png",class:"file-step__file-input",onChange:this.handleFileInputChange,ref:this.setFileInputEl,type:"file"})))}static get assetsDirs(){return["locales"]}get el(){return o(this)}};n.style=".file-step{text-align:center}.file-step__upload-icon{margin-bottom:0.5rem;margin-top:0.25rem;color:var(--calcite-ui-text-3)}.file-step__upload-icon calcite-icon{width:4rem;height:4rem}.file-step__drag-text{margin-bottom:0.25rem;font-size:var(--calcite-font-size-2);line-height:1.5rem;font-weight:var(--calcite-font-weight-medium)}.file-step__browse-button{margin-top:1rem}.file-step__file-input{display:none}";export{r as arcgis_hub_image_upload_edit_step,n as arcgis_hub_image_upload_file_step}