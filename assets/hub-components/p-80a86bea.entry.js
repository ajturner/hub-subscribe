import{r as t,c as e,h as s,H as i,a as o}from"./p-d4ba4c14.js";import{i as a}from"./p-be5c5009.js";import{b as r}from"./p-fd260f2d.js";import{i as n}from"./p-547e8db0.js";import{g as l}from"./p-81a9bee2.js";import{d as p}from"./p-8cf4bd83.js";import{c as h}from"./p-f845584b.js";import{a as c}from"./p-31aebb8c.js";import{h as d}from"./p-b1a98ae3.js";import{s as m}from"./p-78bc8064.js";import"./p-859c5360.js";import"./p-dfe5a97d.js";import"./p-7b082f5d.js";import"./p-8dbea197.js";import"./p-b295a5ae.js";import"./p-796574a4.js";import"./p-a0deb8c6.js";import"./p-9b205605.js";import"./p-1458dcfd.js";import"./p-b728aff4.js";import"./p-783242bc.js";import"./p-dd26efbb.js";import"./p-d1b12a9c.js";import"./p-dcdf7b57.js";import"./p-6dcae6cd.js";import"./p-637ea136.js";import"./p-3f64a9d9.js";import"./p-377e1b5e.js";import"./p-2acb70a6.js";import"./p-903ef8af.js";import"./p-52612356.js";import"./p-af59e67b.js";import"./p-85d6867e.js";import"./p-6f931af6.js";import"./p-56b73d71.js";import"./p-3904125b.js";import"./p-cea8413b.js";import"./p-d763eacf.js";import"./p-ad325ed1.js";import"./p-8e7f4c22.js";import"./p-69555c48.js";import"./p-7202c430.js";import"./p-75d6da59.js";import"./p-90dc0f6f.js";import"./p-59fd2498.js";import"./p-16a95e5b.js";import"./p-e43616ff.js";import"./p-ca048216.js";import"./p-4a14259a.js";import"./p-235bb6ee.js";import"./p-c836a9b6.js";import"./p-dafb2329.js";import"./p-992b9d10.js";import"./p-895b662f.js";import"./p-aa262d60.js";import"./p-ea6de7f6.js";import"./p-24ecdf64.js";import"./p-3363f483.js";import"./p-87582fe0.js";import"./p-00849f08.js";import"./p-7853d817.js";const b=class{constructor(s){t(this,s),this.hubTelemetry=e(this,"hubTelemetry",7),this.unsharedItemIds=[],this.handleHubTelemetry=t=>{t.stopPropagation(),this.hubTelemetry.emit(Object.assign({},t.detail))},this.entity=void 0,this.isAddContentModalOpen=!1,this.isUnsharedContentModalOpen=!1,this._context=l(),this._catalogs=void 0,this.workspacePane=void 0,r(this,"handleAddContentModalOpen","handleAddContentModalClose","handleGalleryPickerSelectionUpdate","handleUnsharedContentModalClose")}async componentWillLoad(){this.intl=await a.loadIntlForComponent(this.element),this.setCatalogs()}get contentFacets(){return[{label:this.intl.t("facets.map.label"),tooltip:this.intl.t("facets.map.tooltip"),key:"bbox",display:"map",field:"bbox",value:null},{label:this.intl.t("facets.type"),key:"type",display:"multi-select",field:"type",options:[],operation:"OR",aggLimit:100},{label:this.intl.t("facets.tags"),key:"tags",display:"multi-select",field:"tags",options:[],operation:"OR"},{label:this.intl.t("facets.categories"),key:"categories",display:"tree",field:"categories",options:[],operation:"OR"},{label:this.intl.t("facets.dateUpdated"),key:"modified",display:"date-range",field:"modified",state:"open"},{label:this.intl.t("facets.sharing"),key:"access",display:"multi-select",field:"access",options:[],operation:"OR"}]}get contentPickerFacets(){return[{label:this.intl.t("shareContent.facets.type"),key:"type",display:"multi-select",field:"type",options:[],operation:"OR",aggLimit:100},{label:this.intl.t("shareContent.facets.sharing"),key:"access",display:"multi-select",field:"access",options:[],operation:"OR"}]}get canShareContentWithGroup(){const{access:t}=h("hub:group:shareContent",this._context,this.entity);return t&&(!!this.entity.canEdit||!this.entity.isReadOnly)}setCatalogs(){this._catalogs=(this.entity.isSharedUpdate?["myContent"]:["myContent","favorites","organization","world"]).map((t=>{var e;const s={user:null===(e=this._context)||void 0===e?void 0:e.currentUser,filter:{group:{not:this.entity.id}}},i=c("shareContent",t,"item",s);return i.scopes.item.filters[0].predicates.push({group:{not:this.entity.id}}),n(this.intl,i)}))}handleAddContentModalOpen(){this.isAddContentModalOpen=!0}handleAddContentModalClose(){this.isAddContentModalOpen=!1}handleUnsharedContentModalClose(){this.unsharedItemIds=[],this.isUnsharedContentModalOpen=!1}async delay(t){return new Promise((e=>setTimeout(e,t)))}async handleContentShare(t){await Promise.all(t.map((async t=>{var e,s;try{const i={targetEntity:"item",filters:[{predicates:[{id:t}]}]},o={requestOptions:null===(e=this._context)||void 0===e?void 0:e.hubRequestOptions},{results:a}=await d(i,o);await m({id:t,groupId:this.entity.id,confirmItemControl:this.entity.isSharedUpdate,owner:a[0].owner,authentication:null===(s=this._context)||void 0===s?void 0:s.session})}catch(e){this.unsharedItemIds=[...this.unsharedItemIds,t]}}))),await this.delay(2e3),this.setCatalogs()}async handleGalleryPickerSelectionUpdate(t){var e;const s=t.detail.item||[];await this.handleContentShare(s),this.unsharedItemIds.length?(this.isUnsharedContentModalOpen=!0,this.hubTelemetry.emit(Object.assign(Object.assign({},p.dictionary.category.content.action.update.label.groups.details.add),{response:"Failed"}))):(null===(e=this.workspacePane)||void 0===e||e.triggerAlert({kind:"success",title:this.intl.t("shareContent.itemSharedSuccessAlert")}),this.hubTelemetry.emit(Object.assign(Object.assign({},p.dictionary.category.content.action.update.label.groups.details.add),{response:"Success"}))),this.isAddContentModalOpen=!1}renderUnsharedContentNotice(){const t="shareContent.unsharedModal.notice";return s("calcite-notice",{icon:this.intl.t(`${t}.icon`),kind:"danger",open:!0,scale:"m"},s("div",{slot:"title"},this.intl.t(`${t}.title`)),s("div",{slot:"message"},this.intl.t(`${t}.message`)),s("calcite-link",{"aria-label":this.intl.t("newTab"),href:"https://doc.arcgis.com/en/arcgis-online/share-maps/share-items.htm",iconEnd:"launch",slot:"link",target:"_blank"},this.intl.t(`${t}.linkText`)))}renderUnsharedContentModal(t){const e={targetEntity:"item",filters:[{predicates:[{id:{any:t}}]}]};return s("arcgis-wormhole",{elAttributes:{unthemed:""}},s("calcite-modal",{"data-element":"modal",onCalciteModalClose:this.handleUnsharedContentModalClose,open:this.isUnsharedContentModalOpen},s("div",{slot:"header"},this.intl.t("shareContent.unsharedModal.title")),s("div",{slot:"content"},this.renderUnsharedContentNotice(),s("arcgis-hub-gallery",{context:l(),newTab:!0,query:e,showAdditionalInfo:!1,showBackToTopBtn:!0,showMoreResultsBtn:!0,showResultsCount:!0,showThumbnail:!1})),s("calcite-button",{onClick:this.handleUnsharedContentModalClose,slot:"primary",width:"full"},this.intl.t("close"))))}renderContentGallery(){return s("arcgis-hub-gallery",{context:this._context,facets:this.contentFacets,query:{targetEntity:"item",filters:[{predicates:[{group:this.entity.id}]}]},"show-back-to-top-btn":!0,"show-chips":!0,"show-facets":!0,"show-layout-switcher":!0,"show-more-results-btn":!0,"show-results-count":!0,"show-search":!0,"show-sort":!0,sortField:"modified"})}renderGalleryPicker(){return s("arcgis-wormhole",{elAttributes:{unthemed:""}},s("arcgis-hub-gallery-picker",{catalogs:this._catalogs,context:this._context,facets:this.contentPickerFacets,modalTitle:this.intl.t("shareContent.modal.title"),onArcgisHubGalleryPickerClose:this.handleAddContentModalClose,onArcgisHubGalleryPickerSelectionUpdate:this.handleGalleryPickerSelectionUpdate,onHubTelemetry:this.handleHubTelemetry,open:this.isAddContentModalOpen,showFacetForSingleCatalog:!0,showSearch:!0,showSelection:!0}))}render(){return s(i,{"data-element":"entity-group-content"},s("arcgis-hub-workspace-pane",{ref:t=>{this.workspacePane=t}},s("h2",{slot:"title"},this.intl.t("title")),this.canShareContentWithGroup&&s("calcite-button",{appearance:"outline-fill",onClick:this.handleAddContentModalOpen,round:!0,slot:"primary-actions"},this.intl.t("shareContent.buttonText")),s("div",null,this.renderContentGallery())),this.isAddContentModalOpen&&this.renderGalleryPicker(),this.isUnsharedContentModalOpen&&this.renderUnsharedContentModal(this.unsharedItemIds))}static get assetsDirs(){return["locales"]}get element(){return o(this)}};b.style=":host{display:block;height:100%}calcite-button{width:-moz-fit-content;width:fit-content}calcite-modal{--calcite-modal-height:80vh}";export{b as arcgis_hub_entity_group_content}