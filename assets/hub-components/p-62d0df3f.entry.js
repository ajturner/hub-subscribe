import{r as t,c as e,h as r,H as i,a as o}from"./p-d4ba4c14.js";import{c as a}from"./p-dfe5a97d.js";import{i as n}from"./p-be5c5009.js";import{d as s}from"./p-8cf4bd83.js";import{b as d}from"./p-fd260f2d.js";import{U as c}from"./p-903ef8af.js";import{g as l}from"./p-796574a4.js";import{d as h,f as u,g as p}from"./p-cea8413b.js";import{S as f,s as m}from"./p-235bb6ee.js";import{a as w}from"./p-6d4e51c6.js";import{g as y}from"./p-b728aff4.js";import{p as I,g}from"./p-c8e0e01f.js";import{g as b}from"./p-69555c48.js";import{g as v}from"./p-377e1b5e.js";import{r as x}from"./p-dcdf7b57.js";import{a as j}from"./p-ca048216.js";import{u as D,m as E}from"./p-e43616ff.js";import{s as C}from"./p-c6da5747.js";import{r as k}from"./p-16a95e5b.js";import"./p-637ea136.js";import"./p-d763eacf.js";import"./p-ad325ed1.js";import"./p-59fd2498.js";import"./p-00849f08.js";import"./p-992b9d10.js";const $={csv:{name:"CSV",itemTypes:["CSV","CSV Collection"],supportsProjection:!0},kml:{name:"KML",itemTypes:["KML","KML Collection"],supportsProjection:!1},shapefile:{name:"Shapefile",itemTypes:["Shapefile"],supportsProjection:!0},fileGeodatabase:{name:"File Geodatabase",itemTypes:["File Geodatabase"],supportsProjection:!0},geojson:{name:"GeoJson",itemTypes:["GeoJson"],supportsProjection:!1},excel:{name:"Excel",itemTypes:["Microsoft Excel"],supportsProjection:!0},featureCollection:{name:"Feature Collection",itemTypes:["Feature Collection"],supportsProjection:!0}};function P(t,e){const{onlyTypes:r,layerId:i,spatialRefId:o}=function(t){return t?{onlyTypes:t.onlyTypes,layerId:t.layerId,spatialRefId:t.spatialRefId}:{}}(e),a=Object.keys($).map((t=>$[t])),n=new Set(y(a.filter((t=>!t.supportsProjection)).map((t=>t.itemTypes))));let s;s=r||y(a.map((t=>t.itemTypes)));const d=(new f).startGroup().match(S(t)).in("typekeywords").and().match(T(i)).in("typekeywords").endGroup().and().startGroup();return function(t,e){const{types:r,noProjectionItemTypes:i,spatialRefId:o}=e,a=(t,e)=>{e.startGroup().match(/\s/g.test(t)?t:`"${t}"`).in("type").and().match(R(((t,e)=>{let r="4326";return t&&!i.has(e)&&(r=t),r})(o,t))).in("typekeywords").endGroup()};r.forEach(((e,i)=>{a(e,t),i<r.length-1&&t.or()}))}(d,{types:s,spatialRefId:o,noProjectionItemTypes:n}),d.endGroup(),d.toParam()}function R(t){return`spatialRefId:${function(t){if("object"==typeof t){const{wkid:e,wkt:r}=t;return e?e+"":w.btoa(r)}return t}(function(t){let e;try{e=JSON.parse(t)}catch(r){e=t}return e}(t))}`}function S(t){return`exportItem:${t}`}function T(t){return t?`exportLayer:0${t}`:"exportLayer:null"}var O=a((function(t){var e=Object.prototype.hasOwnProperty,r="~";function i(){}function o(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function a(t,e,i,a,n){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new o(i,a||t,n),d=r?r+e:e;return t._events[d]?t._events[d].fn?t._events[d]=[t._events[d],s]:t._events[d].push(s):(t._events[d]=s,t._eventsCount++),t}function n(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),s.prototype.eventNames=function(){var t,i,o=[];if(0===this._eventsCount)return o;for(i in t=this._events)e.call(t,i)&&o.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},s.prototype.listeners=function(t){var e=this._events[r?r+t:t];if(!e)return[];if(e.fn)return[e.fn];for(var i=0,o=e.length,a=new Array(o);i<o;i++)a[i]=e[i].fn;return a},s.prototype.listenerCount=function(t){var e=this._events[r?r+t:t];return e?e.fn?1:e.length:0},s.prototype.emit=function(t,e,i,o,a,n){var s=r?r+t:t;if(!this._events[s])return!1;var d,c,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,i),!0;case 4:return l.fn.call(l.context,e,i,o),!0;case 5:return l.fn.call(l.context,e,i,o,a),!0;case 6:return l.fn.call(l.context,e,i,o,a,n),!0}for(c=1,d=new Array(h-1);c<h;c++)d[c-1]=arguments[c];l.fn.apply(l.context,d)}else{var u,p=l.length;for(c=0;c<p;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,e);break;case 3:l[c].fn.call(l[c].context,e,i);break;case 4:l[c].fn.call(l[c].context,e,i,o);break;default:if(!d)for(u=1,d=new Array(h-1);u<h;u++)d[u-1]=arguments[u];l[c].fn.apply(l[c].context,d)}}return!0},s.prototype.on=function(t,e,r){return a(this,t,e,r,!1)},s.prototype.once=function(t,e,r){return a(this,t,e,r,!0)},s.prototype.removeListener=function(t,e,i,o){var a=r?r+t:t;if(!this._events[a])return this;if(!e)return n(this,a),this;var s=this._events[a];if(s.fn)s.fn!==e||o&&!s.once||i&&s.context!==i||n(this,a);else{for(var d=0,c=[],l=s.length;d<l;d++)(s[d].fn!==e||o&&!s[d].once||i&&s[d].context!==i)&&c.push(s[d]);c.length?this._events[a]=1===c.length?c[0]:c:n(this,a)}return this},s.prototype.removeAllListeners=function(t){var e;return t?this._events[e=r?r+t:t]&&n(this,e):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,t.exports=s}));class M extends Error{constructor(t,e,r){super(t),this.status=r,this.url=e}}function L(t){const{host:e,route:r,query:i}=t,o=e.endsWith("/")?e:`${e}/`,a=new URL(r,o);return a.search=function(t={}){const e=Object.keys(t).filter((e=>void 0!==t[e])).reduce(((e,r)=>(e[r]=t[r],e)),{});return new URLSearchParams(e).toString()}(i),a.toString()}function F(t){const{datasetId:e,format:r,spatialRefId:i,geometry:o,where:a}=t;return`${e}:${r}:${i}:${o}:${a}`}const _={Shapefile:"shp",CSV:"csv","File Geodatabase":"fgdb",GeoJson:"geojson",KML:"kml"};function U(t){if(!_[t])throw new Error(`Unsupported Hub download format: ${t}`);return _[t]}function H(t){const{host:e,datasetId:r,spatialRefId:i,geometry:o,where:a}=t,n=L({host:e,route:`/api/v3/datasets/${r}/downloads`,query:{spatialRefId:i,formats:U(t.format),geometry:o?JSON.stringify(o):void 0,where:a}});return fetch(n).then((t=>{const{ok:e,status:r,statusText:i}=t;if(!e)throw new M(i,n,r);return t.json()})).then((e=>(function({data:t}){if(!t)throw new Error('Unexpected API response; no "data" property.');if(!Array.isArray(t))throw new Error('Unexpected API response; "data" is not an array.');if(t.length>1)throw new Error('Unexpected API response; "data" contains more than one download.')}(e),function(t,e){const{data:[r]}=t;if(!r)return{downloadId:e,status:"not_ready"};const{attributes:{contentLastModified:i,lastModified:o,status:a,errors:n,contentLength:s,cacheTime:d,source:{lastEditDate:c}},links:{content:l}}=r;return{downloadId:e,contentLastModified:i,lastEditDate:c,lastModified:o,status:a,errors:n||[],downloadUrl:l,contentLength:s,cacheTime:d}}(e,F(t)))))}class G{disablePoll(){clearInterval(this.pollTimer),this.pollTimer=null}activatePoll(t){const{downloadId:e,eventEmitter:r,pollingInterval:i,existingFileDate:o=new Date(0).toISOString()}=t,a=new Date(o).getTime();this.pollTimer=setInterval((()=>{H(t).then((t=>{if(function(t,e){const{status:r,lastModified:i}=t,o=new Date(i).getTime();return"ready"===r||"ready_unknown"===r&&o>e}(t,a))return r.emit(`${e}ExportComplete`,{detail:{metadata:t}}),this.disablePoll();if(function(t){return t&&("error_updating"===t.status||"error_creating"===t.status)}(t)){const{errors:[i]}=t;return r.emit(`${e}ExportError`,{detail:{error:i,metadata:t}}),this.disablePoll()}})).catch((t=>(r.emit(`${e}PollingError`,{detail:{error:t,metadata:{status:"error"}}}),this.disablePoll())))}),i)}}var K,A,z;!function(t){t.READY="ready",t.READY_UNKNOWN="ready_unknown",t.STALE="stale",t.NOT_READY="not_ready",t.LOCKED="locked",t.STALE_LOCKED="stale_locked",t.DISABLED="disabled",t.CREATING="creating",t.UPDATING="updating",t.ERROR_CREATING="error_creating",t.ERROR_UPDATING="error_updating",t.ERROR="error"}(K||(K={}));class q extends Error{constructor(t){super(t),Object.setPrototypeOf(this,q.prototype)}}class N{disablePoll(){clearInterval(this.pollTimer),this.pollTimer=null}activatePoll(t){const{downloadId:e,datasetId:r,format:i,spatialRefId:o,jobId:a,authentication:n,exportCreated:s,eventEmitter:d,pollingInterval:c}=t;this.pollTimer=setInterval((()=>{u({id:e,jobId:a,jobType:"export",authentication:n}).then((t=>"completed"===t.status?function(t){const{downloadId:e,datasetId:r,exportCreated:i,spatialRefId:o,eventEmitter:a,authentication:n}=t,{itemId:s,layerId:d}=I(r),c=[S(s),T(d),`modified:${i}`,R(o)];return D({item:{id:e,typekeywords:c.join(",")},authentication:n}).then((()=>C({id:e,authentication:n,access:"private"}))).then((()=>function(t){return function(t){var e=t.folderId,r=t.start,i=void 0===r?1:r,o=t.num,a=void 0===o?10:o,n=t.authentication,s=e?"/"+e:"";return h(t).then((function(e){return v(t)+"/content/users/"+e+s})).then((function(t){return x(t,{httpMethod:"GET",authentication:n,params:{start:i,num:a}})}))}({authentication:t}).then((e=>{const r=e.folders.find((t=>"item-exports"===t.title));return r?{folder:r}:j({authentication:t,title:"item-exports"})})).then((t=>{const{folder:e}=t;return e.id}))}(n))).then((t=>E({itemId:e,folderId:t,authentication:n}))).catch((t=>{if(!t||"CONT_0011"!==t.code)throw k({id:e,authentication:n}),new q(t.message)})).then((()=>a.emit(`${e}ExportComplete`,{detail:{metadata:{downloadId:e,status:K.READY,lastModified:(new Date).toISOString(),downloadUrl:L({host:n.portal,route:`content/items/${e}/data`,query:{token:n.token}})}}})))}({datasetId:r,format:i,authentication:n,downloadId:e,spatialRefId:o,exportCreated:s,eventEmitter:d}).then((()=>{this.disablePoll()})):"failed"===t.status?(d.emit(`${e}ExportError`,{detail:{error:new Error(t.statusMessage),metadata:{status:K.ERROR,errors:[new Error(t.statusMessage)]}}}),this.disablePoll()):void 0)).catch((t=>(d.emit(t instanceof q?`${e}ExportError`:`${e}PollingError`,{detail:{error:t,metadata:{status:K.ERROR,errors:[t]}}}),this.disablePoll())))}),c)}}function J(t){const{datasetId:e,spatialRefId:r,where:i}=t,o=e.split("_")[1];if(!o)return r?{targetSR:{wkid:Number(r)}}:{};const a=[{id:Number(o),where:i}];return r?{layers:a,targetSR:{wkid:Number(r)}}:{layers:a}}function B(t){const{host:e,datasetId:r,format:i,spatialRefId:o,geometry:a,where:n,title:s,target:d,authentication:c}=t;return d&&"hub"!==d?function(t){const{datasetId:e,title:r,format:i,authentication:o}=t,[a]=e.split("_");return function(t){var e=t.authentication,r=t.id,i=t.title,o=t.exportFormat,a=t.exportParameters;return h(t).then((function(e){return v(t)+"/content/users/"+e+"/export"})).then((function(t){return x(t,{httpMethod:"POST",authentication:e,params:{itemId:r,title:i,exportFormat:o,exportParameters:a}})}))}({id:a,exportFormat:i,exportParameters:J(t),title:r,authentication:o}).then((t=>{const{size:e,jobId:r,exportItemId:i}=t;return{downloadId:i,jobId:r,size:e,exportCreated:Date.now()}}))}({datasetId:r,format:i,title:s,authentication:c,spatialRefId:o,where:n}):function(t){const{host:e,datasetId:r,spatialRefId:i,geometry:o,where:a}=t,n={spatialRefId:i,format:U(t.format),geometry:o,where:a},s=L({host:e,route:`/api/v3/datasets/${r}/downloads`});return fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((t=>{const{ok:e,status:r,statusText:i}=t;if(!e)throw new M(i,s,r)})).then((()=>({downloadId:F(t)})))}({host:e,datasetId:r,format:i,spatialRefId:o,geometry:a,where:n})}function V(t){const{format:e,layerId:r,layers:i}=t;return function(t,e){return void 0===t&&e.length>1}(r,i)&&(t=>t===A.CSV||t===A.KML)(e)?`${e} Collection`:e}function W(t){return t.map((t=>{const{editingInfo:{lastEditDate:e}={}}=t;return e})).filter((t=>void 0!==t)).sort(((t,e)=>e-t))[0]}function Q(t){return t.catch((t=>{if("ArcGISAuthError"===t.name)return t.retry((()=>Promise.resolve(null)),1);throw t}))}!function(t){t.Shapefile="Shapefile",t.CSV="CSV",t.KML="KML",t.GeoJson="GeoJson",t.Excel="Excel",t["File Geodatabase"]="File Geodatabase",t["Feature Collection"]="Feature Collection",t["Scene Package"]="Scene Package"}(A||(A={})),function(t){t.FeatureService="Feature Service",t.MapService="Map Service"}(z||(z={}));const X={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!1};function Y(t,e){return"hub"===t||!!e}const Z=class{constructor(r){t(this,r),this.hubTelemetry=e(this,"hubTelemetry",7),this.hubDownloadCardSuccess=e(this,"hubDownloadCardSuccess",7),this.contentLengthString=null,this.poller=null,this.loading=void 0,this.metadata=void 0,this.exportRequested=!1,this.apiError=void 0,this.host=void 0,this.datasetId=void 0,this.format=void 0,this.name=void 0,this.target="hub",this.spatialRefId="4326",this.where=void 0,this.geometry=void 0,this.filename=void 0,this.username=void 0,this.token=void 0,d(this,"exportDatasetComplete","exportDatasetError","exportPollingError","download","downloadKeyDown","exportDataset","exportDatasetKeyDown")}async componentWillLoad(){this.resetUndefinedProps(),await this.setLocalization(),this.setAuthentication(),await this.fetchMetadataAndSetState(),this.setTranslations()}buildDownloadTelemetry({isSuccess:t=!0,isCached:e=!0}={}){return Object.assign(Object.assign({},e?s.dictionary.category.interaction.action.download.details.cache:s.dictionary.category.interaction.action.download.details.export),{label:this.format,response:t?s.constants.response.SUCCESS:s.constants.response.FAILURE})}resetUndefinedProps(){["spatialRefId","where","geometry","filename","target"].forEach((t=>{this[t]="undefined"===this[t]?void 0:this[t]})),this.spatialRefId||(this.spatialRefId="4326")}async setLocalization(){this.intl=await n.loadIntlForComponent(this.element),this.dateTimeFormatter=new Intl.DateTimeFormat(this.intl.locale,X),this.setLabels()}setLabels(){this.labels=["buttonDownload","fileCreated","fileSize","buttonOptions","menuRequest"].reduce(((t,e)=>(t[e]=this.intl.t(e),t)),{})}setAuthentication(){this.username&&this.token&&(this.authentication=new c({username:this.username,portal:`${this.host}/sharing/rest`,token:this.token}),this.authentication.getToken=()=>new Promise((t=>{t(this.token)})))}setTranslations(){this.setContentLengthString()}setContentLengthString(){const{metadata:{contentLength:t}={}}=this;if(t){const e=function(t){const e=["Bytes","KB","MB","GB","TB"],r=t;if(0===r)return"n/a";const i=Math.floor(Math.log(r)/Math.log(1024));return 0===i?[r,e[i]]:[(r/1024**i).toFixed(1),e[i]]}(t);this.contentLengthString="string"==typeof e?this.intl.t(e.toLowerCase()):`${e[0]} ${this.intl.t(e[1].toLowerCase())}`}}async watchHandler(){this.resetUndefinedProps(),await this.fetchMetadataAndSetState()}async disconnectedCallback(){this.resetUndefinedProps(),this.poller&&this.poller.disablePoll()}async fetchMetadataAndSetState(){this.poller&&this.poller.disablePoll();const t=this.getServiceParams();try{this.metadata=await function(t){const{host:e,datasetId:r,spatialRefId:i,format:o,geometry:a,where:n,target:s,authentication:d}=t;return s&&"hub"!==s?function(t){const{datasetId:e,authentication:r,format:i,spatialRefId:o,target:a,portal:n}=t,{itemId:s,layerId:d}=I(e);let c,h,u,f;return p(s,{authentication:r,portal:n}).then((t=>{const{type:e,modified:o,url:a}=t;return f=t,h=o,u=e,function(t){const{format:e,layerId:r,url:i,type:o,modified:a,authentication:n,portal:s}=t;return o!==z.FeatureService&&o!==z.MapService?Promise.resolve({modified:a,format:e}):Q(b({url:i,authentication:n,portal:s})).then((t=>{const e=(t.layers||[]).map((t=>Q(g({url:`${i}/${t.id}`,authentication:n,portal:s}))));return Promise.all(e)})).then((t=>({format:V({format:e,layerId:r,layers:t}),modified:W(t)})))}({url:a,authentication:r,type:e,modified:o,format:i,layerId:d,portal:n})})).then((t=>{const{modified:e,format:i}=t;return c=e,m({q:P(s,{layerId:d,onlyTypes:[i],spatialRefId:o}),num:1,sortField:"modified",sortOrder:"DESC",authentication:r,portal:n})})).then((t=>function(t){const{cachedDownload:e,serviceLastEditDate:r,authentication:i,target:o,item:a,format:n,portal:s}=t,d=void 0===r?void 0:new Date(r).toISOString(),{created:c,id:h}=e||{},u=function(t,e){return"portal"===t&&e&&(new Date).getTime()-e<=6e5}(o,r),p=function(t,e){const r=e?e.toLowerCase():"",i=!1!==l(t,"properties.downloadsConfig.enabled"),o=l(t,"properties.downloadsConfig.formats")||{};return!(!i||o[r]&&!1===o[r].enabled)}(a,n)?function(t,e,r){return e?t?t>e?r?K.STALE_LOCKED:K.STALE:K.READY:K.READY_UNKNOWN:r?K.LOCKED:K.NOT_READY}(r,c,u):K.DISABLED;return e?{downloadId:h,status:p,lastEditDate:d,contentLastModified:new Date(c).toISOString(),lastModified:new Date(c).toISOString(),downloadUrl:L({host:s||i.portal,route:`content/items/${h}/data`,query:{token:null==i?void 0:i.token}})}:{downloadId:F(t),status:p,lastEditDate:d}}({cachedDownload:t.results[0],datasetId:e,format:i,spatialRefId:o,serviceLastEditDate:c,itemModifiedDate:h,itemType:u,authentication:r,target:a,item:f,portal:n}))).catch((t=>{throw t}))}({portal:`${e}/sharing/rest`,datasetId:r,format:o,authentication:d,spatialRefId:i,target:s}):H({host:e,datasetId:r,format:o,spatialRefId:i,geometry:a,where:n})}(t),this.pollingEvent=new O,this.exportInProgress()&&this.poll()}catch(t){this.apiError=t}}getServiceParams(){const t={host:this.host,datasetId:this.datasetId,format:this.format,target:this.target,authentication:this.authentication,spatialRefId:this.spatialRefId};return this.where&&(t.where=this.where),this.geometry&&(t.geometry=this.geometry),t}poll(){const t=this.getServiceParams();this.pollingEvent.on(`${this.metadata.downloadId}ExportComplete`,this.exportDatasetComplete),this.pollingEvent.on(`${this.metadata.downloadId}ExportError`,this.exportDatasetError),this.pollingEvent.on(`${this.metadata.downloadId}PollingError`,this.exportPollingError),this.poller=function(t){const{target:e,downloadId:r,datasetId:i,jobId:o,format:a,authentication:n,exportCreated:s,eventEmitter:d,pollingInterval:c,spatialRefId:l,geometry:h,where:u,host:p,existingFileDate:f}=t;return e&&"hub"!==e?function(t){const e=new N;return e.activatePoll(t),e}({downloadId:r,datasetId:i,jobId:o,authentication:n,exportCreated:s,format:a,spatialRefId:l,eventEmitter:d,pollingInterval:c,geometry:h,where:u}):function(t){const e=new G;return e.activatePoll(t),e}({host:p,downloadId:r,datasetId:i,format:a,eventEmitter:d,pollingInterval:c,spatialRefId:l,geometry:h,where:u,existingFileDate:f})}(Object.assign(Object.assign({},t),{downloadId:this.metadata.downloadId,jobId:this.metadata.jobId,exportCreated:this.metadata.exportCreated,eventEmitter:this.pollingEvent,pollingInterval:5e3,existingFileDate:new Date(this.metadata.lastModified||0).toISOString()}))}async download(){if(this.metadata&&this.metadata.downloadUrl)try{const t=this.transferFile(this.metadata.downloadUrl);return this.hubTelemetry.emit(this.buildDownloadTelemetry()),this.hubDownloadCardSuccess.emit(),t}catch(t){throw this.hubTelemetry.emit(this.buildDownloadTelemetry({isSuccess:!1})),t}return await this.exportDataset()}transferFile(t){return"Feature Collection"===this.format?window.open(t):window.location.href=t}async exportDataset(){this.exportRequested=!0,this.metadata.status=this.downloadCached()?"updating":"creating";const t=Object.assign({title:this.filename},this.getServiceParams());try{const e=await B(t);this.metadata=Object.assign(Object.assign({},this.metadata),e),this.poll()}catch(t){this.apiError=t,this.metadata.status="error",this.metadata.errors=[t]}}exportDatasetComplete(t){if(this.exportDatasetHandler(t),this.hubTelemetry.emit(this.buildDownloadTelemetry({isCached:!1})),this.hubDownloadCardSuccess.emit(),this.exportRequested){const{downloadUrl:t}=this.metadata;if(t)return this.transferFile(t)}}exportDatasetError(t){this.exportDatasetHandler(t),this.hubTelemetry.emit(this.buildDownloadTelemetry({isSuccess:!1,isCached:!1}))}exportPollingError(t){this.apiError=t.detail.error,this.exportDatasetHandler(t),this.hubTelemetry.emit(this.buildDownloadTelemetry({isSuccess:!1,isCached:!1}))}exportDatasetHandler(t){this.metadata=Object.assign(Object.assign({},this.metadata),t.detail.metadata),this.pollingEvent.off(`${this.metadata.downloadId}ExportComplete`,this.exportDatasetComplete),this.pollingEvent.off(`${this.metadata.downloadId}ExportError`,this.exportDatasetError),this.pollingEvent.off(`${this.metadata.downloadId}PollingError`,this.exportDatasetError)}renderNotice(){const{metadata:t,apiError:e,exportRequested:i}=this,{status:o}=t||{};let a=o;return"locked"===o?a="not_ready":"stale_locked"===o&&(a="stale"),r("hub-download-notice",{"api-error":e?e.status||e.message:void 0,"cannot-export":!Y(this.target,this.username),"export-requested":i,"file-status":a})}exportInProgress(){const{metadata:{status:t}={}}=this;return"creating"===t||"updating"===t}downloadCached(){const{metadata:{status:t}={}}=this;return["ready","ready_unknown","stale","stale_locked","updating","error_updating"].includes(t)}downloadUpToDate(){return this.metadata&&"ready"===this.metadata.status}isFormatDownloadDisabled(){return this.metadata&&"disabled"===this.metadata.status}renderFileDescription(){const t=[],{metadata:{lastModified:e}={}}=this;return this.downloadCached()?(e&&("rtl"===this.intl.direction?t.push(r("dt",null,this.dateTimeFormatter.format(new Date(e))),r("dd",{class:"rtl"},this.labels.fileCreated)):t.push(r("dt",{class:"ltr"},this.labels.fileCreated),r("dd",null,this.dateTimeFormatter.format(new Date(e))))),this.contentLengthString&&("rtl"===this.intl.direction?t.push(r("dt",null,this.contentLengthString),r("dd",{class:"rtl"},this.labels.fileSize)):t.push(r("dt",{class:"ltr"},this.labels.fileSize),r("dd",null,this.contentLengthString))),t):null}exportDatasetKeyDown(t){["Enter"," "].includes(t.key)&&this.exportDataset()}downloadKeyDown(t){["Enter"," "].includes(t.key)&&this.download()}renderDownloadControl(){return this.shouldUseDownloadButton()?r("calcite-button",{appearance:"solid",color:"blue",disabled:this.shouldDisableDownload(),"icon-position":"start",onClick:this.download,scale:"m",width:"full"},this.labels.buttonDownload):r("calcite-dropdown",{open:!1,placement:"top",scale:"m",type:"click"},r("calcite-button",{appearance:"solid",color:"blue","icon-end":"caretUp",scale:"m",slot:"trigger"},this.labels.buttonOptions),r("calcite-dropdown-group",{"selection-mode":"none"},r("calcite-dropdown-item",{hidden:this.exportInProgress(),onClick:this.exportDataset,onKeyDown:this.exportDatasetKeyDown,role:"menuitem","selection-mode":"none",tabindex:"0"},r("span",null,this.labels.menuRequest)),r("calcite-dropdown-item",{onClick:this.download,onKeyDown:this.downloadKeyDown,role:"menuitem","selection-mode":"none",tabindex:"0"},r("span",null,this.intl.t("menuDownload",{createdDate:this.dateTimeFormatter.format(new Date(this.metadata.lastModified))})))))}shouldUseDownloadButton(){return this.downloadUpToDate()||!this.downloadCached()||this.isFormatDownloadDisabled()||!Y(this.target,this.username)}shouldDisableDownload(){return this.isFormatDownloadDisabled()||this.exportInProgress()&&!this.downloadCached()}render(){return r(i,{"data-element":"download-card"},r("calcite-card",{dir:this.intl.direction},r("h3",{slot:"title"},this.name),r("dl",{slot:"subtitle"},this.renderFileDescription()),r("div",{slot:"footer-start"},this.renderNotice(),this.renderDownloadControl())))}static get assetsDirs(){return["locales"]}get element(){return o(this)}static get watchers(){return{host:["watchHandler"],datasetId:["watchHandler"],format:["watchHandler"],spatialRefId:["watchHandler"],where:["watchHandler"],geometry:["watchHandler"],target:["watchHandler"],username:["watchHandler"],token:["watchHandler"]}}};Z.style=":host{font-size:1em}calcite-card div{font-size:1em}h3{font-size:1.25em}dl{font-size:inherit}dt,dd,calcite-dropdown-item{font-size:0.875em}dt{float:left;clear:left;margin-right:0.25rem}dt.ltr::after{content:':'}dd.rtl::after{content:':'}dd{margin:0px;padding:0px;margin-left:110px;margin-inline-start:0}a{vertical-align:middle}calcite-icon{margin-left:0.25rem}a:visited{color:inherit}calcite-dropdown{width:100%;--calcite-dropdown-width:100%;position:relative}calcite-dropdown-item span{color:#323232}calcite-button{width:100%}calcite-card div{width:100%}div[slot=\"footer-start\"]{display:block}";export{Z as hub_download_card}