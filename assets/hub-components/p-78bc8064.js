import{g as r}from"./p-377e1b5e.js";import{g as t}from"./p-00849f08.js";import{b as e}from"./p-8e7f4c22.js";import{a as n,r as o}from"./p-7853d817.js";import{r as i}from"./p-dcdf7b57.js";import{s as u}from"./p-235bb6ee.js";function a(t){var e=r(t)+"/community/groups/"+t.id+"/updateUsers",n={authentication:t.authentication,params:{}};return"admin"===t.newMemberType?n.params.admins=t.users:n.params.users=t.users,i(e,n)}function s(r){return u({q:"id: "+r.id+" AND group: "+r.groupId,start:1,num:10,sortField:"title",authentication:r.authentication,httpMethod:"POST"}).then((function(t){if(t.total>0)return t.results.some((function(t){return t.id===r.id}))}))}function d(r){return s(r).then((function(n){if(n)return{itemId:r.id,shortcut:!0,notSharedWith:[]};var o=r.authentication.username,i=r.confirmItemControl,u=r.owner||o;if(u!==o){var a=!1,s=!1;return Promise.all([e({username:o,authentication:r.authentication}),e({username:u,authentication:r.authentication}),t(r)]).then((function(t){var e=t[0],n=t[1];return s=e.orgId!==n.orgId,function(r,t,e,n,o,i){var u=[];if(i.groupId!==r.favGroupId)if(t){if(!n)throw Error("This item can not be shared to shared editing group "+i.groupId+" by "+r.username+" as they not the item owner or org admin.");u.push(f(r,r,!1,"Error adding "+r.username+" as member to edit group "+i.groupId+". Consequently item "+i.id+" was not shared to the group.",i),f(r,o,!0,"none"===e?"Error adding user "+o.username+" to edit group "+i.groupId+". Consequently item "+i.id+" was not shared to the group.":"Error promoting user "+o.username+" to admin in edit group "+i.groupId+". Consequently item "+i.id+" was not shared to the group.",i))}else if(n)u.push(f(r,r,!1,"Error adding "+r.username+" as member to view group "+i.groupId+". Consequently item "+i.id+" was not shared to the group.",i));else if("none"===e)throw new Error("This item can not be shared by "+r.username+" as they are not a member of the specified group "+i.groupId+".");return u}(e,!!i,t[2],a="org_admin"===e.role&&!e.roleId,n,r)})).then((function(t){var e=t[0],n=(void 0===e?{promise:Promise.resolve({notAdded:[]}),revert:function(r){return Promise.resolve(r)}}:e).revert;return Promise.all(t.map((function(r){return r.promise}))).then((function(){return m(r,a,s)})).then((function(r){return n(r)}))}))}return m(r)})).then((function(t){if(t.notSharedWith.length)throw Error("Item "+r.id+" could not be shared to group "+r.groupId+".");return t}))}function m(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!1);var o=t.authentication.username,u=t.owner||o,a=r(t)+"/content/items/"+t.id+"/share";return(u===o||e&&!n)&&(a=r(t)+"/content/users/"+u+"/items/"+t.id+"/share"),t.params={groups:t.groupId,confirmItemControl:t.confirmItemControl},i(a,t)}function f(r,t,e,i,u){var s,d,m,f=t.groups||[],c=f.find((function(r){return r.id===u.groupId}));if(r.orgId!==t.orgId)throw Error("User "+t.username+" is not a member of the same org as "+r.username+". Consequently they can not be added added to group "+u.groupId+" nor can item "+u.id+" be shared to the group.");if(!c&&f.length>511)throw Error("User "+t.username+" already has 512 groups, and can not be added to group "+u.groupId+". Consequently item "+u.id+" can not be shared to the group.");return c?e&&"member"===c.userMembership.memberType?(d=a({id:u.groupId,users:[t.username],newMemberType:"admin",authentication:u.authentication}).then((function(r){var t=r.results.reduce((function(r,t){return t.success||r.push(t.username),r}),[]);return Promise.resolve({notAdded:t})})).catch((function(){return{notAdded:[t.username]}})),m=function(r){return a({id:u.groupId,users:[t.username],newMemberType:"member",authentication:u.authentication}).then((function(){return r})).catch((function(){return r}))}):(d=Promise.resolve({notAdded:[]}),m=function(r){return Promise.resolve(r)}):(d=n((s={id:u.groupId},s[e?"admins":"users"]=[t.username],s.authentication=u.authentication,s)).then((function(r){if(r.errors&&r.errors.length)throw r.errors[0];return r})).catch((function(){return{notAdded:[t.username]}})),m=function(r){return o({id:u.groupId,users:[t.username],authentication:u.authentication}).then((function(){return r}))}),{promise:d.then((function(r){if(r.notAdded.length)throw new Error(i);return r})),revert:m}}export{s as i,d as s}