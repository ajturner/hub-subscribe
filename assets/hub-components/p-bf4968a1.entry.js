import{r as e,c as t,h as i,F as s,H as r,a as o}from"./p-d4ba4c14.js";import{b as a}from"./p-fd260f2d.js";import{i as n}from"./p-be5c5009.js";import{d as h}from"./p-8cf4bd83.js";import{c}from"./p-4ac31396.js";import{C as l}from"./p-1fde1b24.js";import{watch as d}from"@arcgis/core/core/watchUtils.js";import p from"@arcgis/core/layers/GraphicsLayer.js";import g from"@arcgis/core/widgets/Sketch/SketchViewModel.js";import u from"@arcgis/core/Graphic.js";import{project as w}from"@arcgis/core/geometry/support/webMercatorUtils.js";import f from"@arcgis/core/geometry/Geometry.js";import b from"@arcgis/core/geometry/Extent.js";import{buffer as m}from"@arcgis/core/geometry/geometryEngine.js";import{l as v,g as y}from"./p-e16232c9.js";import{b as C}from"./p-e07eb8b2.js";import{D as x}from"./p-3bf8d293.js";import{watch as E}from"@arcgis/core/core/reactiveUtils.js";import M from"@arcgis/core/widgets/Search/SearchViewModel.js";import"./p-dfe5a97d.js";import"./p-4c02fe5e.js";import"@arcgis/core/kernel.js";var T,O;!function(e){e.START="start",e.ACTIVE="active",e.COMPLETE="complete",e.CANCEL="cancel"}(T||(T={})),function(e){e.START="start",e.ACTIVE="active",e.INACTIVE="inactive"}(O||(O={}));var S=function(e,t,i,s){var r,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(a=(o<3?r(a):o>3?r(t,i,a):r(t,i))||a);return o>3&&a&&Object.defineProperty(t,i,a),a};const D=["select","point","polyline","polygon","rectangle"],P={select:{icon:"select"},point:{icon:"pin"},polyline:{icon:"freehand"},polygon:{icon:"freehand-area"},rectangle:{icon:"rectangle-area"},circle:{icon:"circle"}},j=class{constructor(i){e(this,i),this.arcgisHubMapDrawGraphicsChange=t(this,"arcgisHubMapDrawGraphicsChange",7),this.arcgisHubMapDrawGraphicsClear=t(this,"arcgisHubMapDrawGraphicsClear",7),this.arcgisHubMapDrawSelect=t(this,"arcgisHubMapDrawSelect",7),this.arcgisHubDrawCancel=t(this,"arcgisHubDrawCancel",7),this.arcgisHubDrawActiveToolChange=t(this,"arcgisHubDrawActiveToolChange",7),this.arcgisHubMapPopoverOpen=t(this,"arcgisHubMapPopoverOpen",7),this.arcgisHubMapPopoverClear=t(this,"arcgisHubMapPopoverClear",7),this.hubTelemetry=t(this,"hubTelemetry",7),this.handles=[],this.geometry=void 0,this.mode="hybrid",this.scale="m",this.tools=D,this.view=void 0,this.disablePrimaryOptions=void 0,this.disableEditOptions=void 0,this.color=[0,0,0],this.buffer=void 0,this.condensed=void 0,this.resetOnDisconnect=!0,this.enableMapTips=void 0,this.drawTip=void 0,this.unthemed=!1,this.disabled=!1,this.activeTool=void 0,this.isEditing=void 0,this.isFiltered=void 0,this.bufferDetails=void 0,this.bufferPanelVisible=void 0,this.bottomOffset=0,this.topOffset=0,this.viewWidth=void 0,this.open=void 0,this.optionsEl=void 0,this.mapTipState=O.INACTIVE,a(this,"applyFilter","cancelEdits","clearFilter","deleteDrawing","handleSetBufferWidgetRef","handleSketchOnCreate","handleSketchOnUpdate","handleViewClick","handleViewEscape","handleViewExtentChange","handleViewPointerMove","handleViewPointerMoveOrDown","renderPrimaryOptions","renderEditOptions","renderEditingOptions","renderMapTip","setPanelHeight","startEditing","saveEdits","setOptionsEl")}async componentWillLoad(){const{el:e}=this;this.intl=await n.loadIntlForComponent(e),this.createGraphicsLayers(),await this.connectViewModel(),this.addWatchHandles(),this.setViewPosition(),v()}connectedCallback(){this.addWatchHandles()}disconnectedCallback(){this.resetOnDisconnect&&this.reset(),this.removeWatchHandles()}handleMapDrawFilter(e){const{hubTelemetry:t,isFiltered:i}=this,{detail:{graphics:[s],save:r}}=e;if(s&&r&&i){const{geometry:{type:e}}=s;t.emit(Object.assign(Object.assign({},h.dictionary.category.interaction.action.search.label.filter),{details:c(e)}))}}handleWidgetSelected(e){const{activeTool:t,isEditing:i}=this,{target:s}=e,{icon:r}=s,o="minus-circle"===r?t:Object.entries(P).find((([,e])=>e.icon===r))[0];"select"!==o?this.reset():i&&this.cancelEdits(),this.activeTool=t===o?void 0:o,this.open=!1}handleWidgetDrawBufferChanged(e){const{detail:t}=e;this.bufferDetails=t}handleWidgetDrawBufferReset(){const{bufferGraphicsLayer:e}=this;e&&(this.bufferDetails=void 0,e.removeAll())}handleWidgetDrawBufferClosed(){this.bufferPanelVisible=!1}handleWidgetPanelToggled(e){const{target:t,detail:i}=e,{bufferWidgetEl:s}=this;t===s||i?t!==s||i||setTimeout((()=>{this.setPanelHeight()}),0):this.bufferPanelVisible=!1}focusView(){const{view:e}=this;setTimeout((()=>{null==e||e.focus()}),250)}handleActiveToolChange(e,t){const{hubTelemetry:i,sketchViewModel:s,isEditing:r}=this;s&&(s.cancel(),e&&"select"!==e&&!r?(s.create(e),this.arcgisHubDrawActiveToolChange.emit(e)):e||(this.isEditing=!1));const o="select"===e?"select":"draw";this.mapTipState=this.activeTool?O.ACTIVE:O.INACTIVE,e&&this.focusView(),this.arcgisHubMapPopoverClear.emit(),i.emit(Object.assign(Object.assign({},h.dictionary.category.interaction.action[e?"enable":"disable"].label[o]),{details:c(e||t)}))}handleGraphicsChange(){const{geometry:e,bufferWidgetEl:t}=this;e?(this.addGeometryToGraphicsLayer(),this.startEditing()):(this.reset(),null==t||t.forceReset(),this.activeTool=void 0)}handleIsEditingChange(){const{isEditing:e}=this;e||(this.activeTool=void 0),this.setBufferPanelVisible()}handleIsFilteredChange(){const{isFiltered:e,graphicsLayer:{graphics:t}}=this,i=t.getItemAt(0);if(e&&i){const{geometry:{type:e}}=i,t=C(e);i.symbol=this[`${t}Symbol`]}this.setBufferPanelVisible()}handleViewChange(e,t){e&&e!==t&&(this.removeWatchHandles(),this.connectViewModel().then((()=>{this.addWatchHandles()})))}handleBufferDetailsChanged(){const{arcgisHubMapDrawGraphicsChange:e,bufferPolygonSymbol:t,graphicsLayer:i,bufferGraphicsLayer:s,bufferDetails:r,isEditing:o}=this,{graphics:a}=i,[n]=a,{graphics:h}=s;if(!r||!n)return;const{distance:c,unit:l}=r,d=m(null==n?void 0:n.geometry,c,l.split(" ").join("-"),!0),p=new u({geometry:d,symbol:t});s.removeAll(),s.add(p),e.emit({graphics:a.clone(),bufferGraphics:h.clone(),save:!o})}async forceReset(){this.reset()}async setActiveTool(e){this.activeTool=e}handleSetBufferWidgetRef(e){e&&(this.bufferWidgetEl=e)}createGraphicsLayers(){const{graphicsLayer:e,bufferGraphicsLayer:t}=this;p&&(e||(this.graphicsLayer=new p({elevationInfo:{mode:"on-the-ground"}}),this.reset(),this.addGeometryToGraphicsLayer()),t||(this.bufferGraphicsLayer=new p({elevationInfo:{mode:"on-the-ground"}})))}handleSketchOnCreate(e){const{state:t,graphic:i,tool:s}=e,{activeTool:r,arcgisHubMapPopoverOpen:o,bufferGraphicsLayer:a,graphicsLayer:n,hubTelemetry:c,view:l}=this;t===T.START&&(c.emit(h.dictionary.category.interaction.action.draw.label.start.details[r]),this.mapTipState=O.ACTIVE),t===T.COMPLETE&&("rectangle"===this.activeTool&&(i.geometry=i.geometry.extent),l.map.reorder(n,99),l.map.reorder(a,100),this.isEditing=!1,this.activeTool=void 0,setTimeout((()=>{o.emit({source:"options",geometry:null==i?void 0:i.geometry,view:l,render:this.renderPrimaryOptions})}),150),c.emit(h.dictionary.category.interaction.action.draw.label.complete.details[r]),this.disableEditOptions&&this.disablePrimaryOptions&&this.arcgisHubMapDrawGraphicsChange.emit({graphics:n.graphics.clone(),unsaved:!0}),this.mapTipState=O.INACTIVE),t===T.CANCEL&&s===r&&(this.isEditing=!1,this.activeTool=void 0,this.arcgisHubDrawCancel.emit())}handleSketchOnUpdate(e){const{state:t}=e,{arcgisHubMapPopoverClear:i,arcgisHubMapDrawGraphicsChange:s,graphicsLayer:{graphics:r},bufferGraphicsLayer:{graphics:o}}=this;t===T.ACTIVE&&(i.emit(),s.emit({graphics:r.clone(),bufferGraphics:o.clone()}),this.handleBufferDetailsChanged())}handleViewClick(e){const{activeTool:t,arcgisHubMapPopoverClear:i,hubTelemetry:s}=this;i.emit(),"select"===t?(s.emit(h.dictionary.category.interaction.action.select.label.content.details.selectTool),this.arcgisHubMapDrawSelect.emit(e)):s.emit(h.dictionary.category.interaction.action.select.label.content)}handleViewPointerMove(e){const{view:t,arcgisHubMapPopoverOpen:i}=this,s=t.toMap(e);i.emit({source:"tips",geometry:s,view:t,render:this.renderMapTip})}handleViewPointerMoveOrDown(e){const{view:t,graphicsLayer:i}=this;t.hitTest(e,{include:i}).then((e=>{var i;const{isFiltered:s,isEditing:r,arcgisHubMapPopoverOpen:o}=this,a=y(e.results);if(e.results.length){let e=this.renderPrimaryOptions;s&&!r?e=this.renderEditOptions:r&&(e=this.renderEditingOptions),o.emit({source:"options",geometry:null===(i=a.graphic)||void 0===i?void 0:i.geometry,view:t,render:e})}}))}handleViewExtentChange(){const{arcgisHubMapPopoverClear:e}=this;e.emit()}handleToolsOpened(){this.open=!0,this.hubTelemetry.emit(h.dictionary.category.interaction.action.open.label.popover.details.options)}handleToolsClosed(){this.open=!1,this.hubTelemetry.emit(h.dictionary.category.interaction.action.close.label.popover.details.options)}async connectViewModel(){const{bufferGraphicsLayer:e,graphicsLayer:t,mode:i,sketchViewModel:s,view:r,pointSymbol:o,polygonSymbol:a,polylineSymbol:n}=this;r&&!s&&g&&(await r.when(),r.map.addMany([t,e]),this.sketchViewModel=new g({view:r,layer:t,defaultCreateOptions:{mode:i},updateOnGraphicClick:!1,polygonSymbol:a,polylineSymbol:n,pointSymbol:o}),d(r,"size",this.setPanelHeight))}handleViewEscape(e){this.activeTool=void 0}addWatchHandles(){const{handles:e,sketchViewModel:t,view:i}=this;i&&d&&t&&e.push(i.on("key-down",["Escape"],this.handleViewEscape),i.on("pointer-down",this.handleViewClick),i.on(["pointer-move","pointer-down"],this.handleViewPointerMoveOrDown),i.on("pointer-move",this.handleViewPointerMove),d(i,"extent",this.handleViewExtentChange),t.on("create",this.handleSketchOnCreate),t.on("update",this.handleSketchOnUpdate))}removeWatchHandles(){const{handles:e}=this;e.forEach((e=>{e.remove()})),this.handles=[]}addGeometryToGraphicsLayer(){const{geometry:e,graphicsLayer:t,sketchViewModel:i}=this;if(!e||!t||!this.sketchViewModel)return;this.isFiltered=!0;const s=this.processGeometry(e),r=new u({geometry:s,symbol:i[`${"extent"===s.type?"polygon":s.type}Symbol`]});t.add(r)}applyFilter(){const{arcgisHubMapDrawGraphicsChange:e,arcgisHubMapPopoverClear:t,graphicsLayer:{graphics:i},bufferGraphicsLayer:{graphics:s}}=this;this.isFiltered=!0,e.emit({graphics:i.clone(),bufferGraphics:s.clone(),save:!0}),t.emit()}deleteDrawing(){const{graphicsLayer:{graphics:[e]},hubTelemetry:t,bufferWidgetEl:i}=this;if(!e)return;const{geometry:{type:s}}=e;t.emit(Object.assign(Object.assign({},h.dictionary.category.interaction.action.draw.label.delete.details[s]),{response:"Success"})),this.reset(),this.activeTool=void 0,null==i||i.forceReset()}clearFilter(){const{arcgisHubMapDrawGraphicsClear:e,hubTelemetry:t}=this;this.deleteDrawing(),e.emit(),t.emit(h.dictionary.category.interaction.action.search.label.filter.details.clear)}startEditing(){const{arcgisHubMapPopoverClear:e,graphicsLayer:{graphics:t},bufferGraphicsLayer:{graphics:i},hubTelemetry:s,sketchViewModel:r,geometryIsExtent:o}=this;e.emit(),this.isEditing=!0,this.cachedGraphics=t.clone(),this.cachedBufferGraphics=i.clone();const a=t.getItemAt(0).geometry.type;this.activeTool=C(a);let n="extent"===a?"transform":"reshape",c=!0,l=!0;o&&(n="transform",c=!1,l=!1),r.update(t.getItemAt(0),{tool:n,enableRotation:c,toggleToolOnClick:l}),s.emit(h.dictionary.category.interaction.action.enable.label.draw.details.update)}cancelEdits(){const{arcgisHubMapPopoverClear:e,arcgisHubMapDrawGraphicsChange:t,cachedGraphics:i,cachedBufferGraphics:s,graphicsLayer:{graphics:r},bufferGraphicsLayer:{graphics:o},hubTelemetry:a}=this;i&&s&&(this.graphicsLayer.graphics=i.clone(),this.cachedGraphics=null,this.bufferGraphicsLayer.graphics=s.clone(),this.cachedBufferGraphics=null),this.isEditing=!1,e.emit(),t.emit({graphics:r.clone(),bufferGraphics:o.clone(),canceled:!0}),a.emit(h.dictionary.category.interaction.action.disable.label.draw.details.update)}saveEdits(){const{activeTool:e,arcgisHubMapDrawGraphicsChange:t,arcgisHubMapPopoverClear:i,graphicsLayer:{graphics:s},bufferGraphicsLayer:{graphics:r},hubTelemetry:o,sketchViewModel:a}=this;a.complete(),t.emit({graphics:s.clone(),bufferGraphics:r.clone(),save:!0}),i.emit(),this.isEditing=!1,o.emit(h.dictionary.category.interaction.action.draw.label.update.details[e]),this.open=!1}reset(){const{bufferGraphicsLayer:e,graphicsLayer:t,arcgisHubMapPopoverClear:i,bufferWidgetEl:s}=this;t&&e&&(this.isEditing=!1,this.isFiltered=!1,this.cachedGraphics=null,this.cachedBufferGraphics=null,this.geometry=null,t.removeAll(),e.removeAll(),i.emit(),null==s||s.forceReset())}processGeometry(e){const{view:t}=this;let i=e;return e.clone||(i="extent"===e.type?b.fromJSON(i):f.fromJSON(i)),i.spatialReference!==t.spatialReference&&(i=w(i,t.spatialReference)),i}setBufferPanelVisible(){const{isEditing:e,isFiltered:t}=this;this.bufferPanelVisible=e||t}setPanelHeight(){const{bufferWidgetEl:e,view:{size:t,container:i}}=this;if(!e)return;const[s]=t;this.viewWidth=s;const{top:r,bottom:o}=i.getBoundingClientRect(),{top:a,bottom:n}=e.getBoundingClientRect();this.topOffset=a-r,this.bottomOffset=o-n}setViewPosition(){const{el:e}=this,t=e&&e.closest("arcgis-hub-map-widget-container");this.viewPosition=null==t?void 0:t.viewPosition}setOptionsEl(e){this.optionsEl=e}get geometryIsExtent(){var e;return"extent"===(null===(e=this.geometry)||void 0===e?void 0:e.type)}get pointSymbol(){const{color:e}=this;return{type:"text",color:[...e,.9],text:"î˜",font:{size:24,family:"CalciteWebCoreIcons"}}}get polylineSymbol(){const{lineStyle:e,color:t}=this;return{style:e,color:[...t,1],width:2,type:"simple-line"}}get polygonSymbol(){const{color:e,lineStyle:t}=this;return{type:"simple-fill",style:"solid",color:[0,0,0,0],outline:{style:t,color:[...e,1],width:2}}}get rectangleSymbol(){return this.polygonSymbol}get lineStyle(){const{isFiltered:e}=this;return e?"solid":"short-dash"}get bufferPolygonSymbol(){const{color:e}=this;return{type:"simple-fill",style:"cross",color:[...e,.25],outline:{style:"short-dash",color:[...e,1],width:2}}}get positionClass(){const{viewPosition:e}=this;if(e)return`hub-widget-draw ${e.split("-").join(" ")}`}get styles(){const{viewWidth:e,bottomOffset:t,topOffset:i,bufferPanelVisible:s}=this;return{"--view-width":`${e}px`,"--bottom-offset":`${t}px`,"--top-offset":`${i}px`,"--mobile-display":s?"flex":"none"}}get helperText(){const{activeTool:e,mapTipState:t,sketchViewModel:{createGraphic:i},intl:s,isEditing:r}=this;if(!r&&!i&&"select"!==e)return;let o=s.t("select"===e?"tip.select":"tip.edit");if(i&&!r){const{geometry:r}=i;let a="start";const n=["polygon","polyline"].includes(e);if(t===O.ACTIVE&&n){const t="polygon"===e?r.rings[0].length-2:r.paths[0].length-1;1===t?a="point":t>1&&(a="end")}o=s.t(`tip.${e}.${a}`)}return o}renderPrimaryOptions(e="polygon"){const{disablePrimaryOptions:t}=this,r=C(e),o=this.intl.t(`filter.${r}`),a=this.intl.t("delete");return t?this.renderEditOptions():i(s,null,i("calcite-action",{icon:"selection-filter",onClick:this.applyFilter,text:o,"text-enabled":!0}),i("calcite-action",{icon:"trash",onClick:this.deleteDrawing,text:a,"text-enabled":!0}))}renderEditOptions(){const e=this.intl.t("update"),t=this.intl.t("delete");return i("calcite-action-pad",{"expand-disabled":!0,layout:"horizontal"},i("calcite-action",{icon:"pencil",onClick:this.startEditing,text:e}),i("calcite-action",{icon:"trash",onClick:this.clearFilter,text:t}))}renderEditingOptions(){const e=this.intl.t("cancel"),t=this.intl.t("save");return i(s,null,i("calcite-action",{icon:"undo",onClick:this.cancelEdits,text:e,"text-enabled":!0}),i("calcite-action",{icon:"check",onClick:this.saveEdits,text:t,"text-enabled":!0}))}renderMapTip(){const{helperText:e}=this;return e?i("arcgis-hub-map-tip",{text:e}):null}renderDrawBuffer(){const{buffer:e,positionClass:t,handleSetBufferWidgetRef:s,bufferPanelVisible:r}=this;if(e)return i("arcgis-hub-map-widget-draw-buffer",{class:t,ref:s,visible:r})}renderDrawToolWidgets(e=!1){const{tools:t,activeTool:s,scale:r}=this;return D.reduce(((o,a)=>t.includes(a)?[...o,i("arcgis-hub-map-widget-generic",{active:s===a,disabled:this.disabled,icon:P[a].icon,key:a,scale:r,text:this.intl.t(a),textEnabled:e})]:o),[])}renderDrawingOptionsAction(){const{open:e,isEditing:t,activeTool:s,intl:r}=this,o=e||t;let a,n;return a=t?"pencil":s?P[s].icon:"pencil-mark-plus",n=r.t(t?"updating":e?"close":"open"),i("calcite-action",{active:o,icon:a,ref:this.setOptionsEl,text:n})}renderDrawingOptionsPopoverContent(){const{isEditing:e,open:t,activeTool:r,intl:o}=this;return e?i("calcite-action",{onClick:this.saveEdits,text:o.t("finish"),"text-enabled":!0}):i(s,null,this.renderDrawToolWidgets(!0),r&&t&&i("arcgis-hub-map-widget-generic",{icon:"minus-circle",text:o.t("stop"),"text-enabled":!0}))}renderCondensedDrawTools(){const{open:e,intl:t,optionsEl:r}=this;return i(s,null,this.renderDrawingOptionsAction(),this.renderDrawBuffer(),i("calcite-popover",{"auto-close":!0,"disable-pointer":!0,label:t.t("options"),offsetDistance:15,open:e,placement:"left-start",referenceElement:r},this.renderDrawingOptionsPopoverContent()))}renderDrawTools(){return i(s,null,this.renderDrawBuffer(),this.renderDrawToolWidgets())}renderPopovers(){const{unthemed:e}=this;return i("arcgis-wormhole",{styles:{position:"absolute",top:0,left:0}},i("arcgis-hub-map-popover",{style:{pointerEvents:"none"},target:"tips",unthemed:e}),i("arcgis-hub-map-popover",{target:"options",unthemed:e}),i("arcgis-hub-map-popover",{target:"action",unthemed:e}))}renderDrawPopover(){const{el:e,drawTip:t}=this;return i("calcite-popover",{autoClose:!0,class:"draw-popover",label:t,open:!0,placement:"left",referenceElement:e,triggerDisabled:!0},i("p",null,t))}render(){return i(r,{"data-element":"map-widget-draw",style:this.styles},this.renderDrawPopover(),this.condensed?this.renderCondensedDrawTools():this.renderDrawTools(),this.renderPopovers())}static get assetsDirs(){return["locales"]}get el(){return o(this)}static get watchers(){return{activeTool:["handleActiveToolChange"],geometry:["handleGraphicsChange"],isEditing:["handleIsEditingChange"],isFiltered:["handleIsFilteredChange"],view:["handleViewChange"],bufferDetails:["handleBufferDetailsChanged"]}}};S([l({when(){return this.enableMapTips&&(this.mapTipState!==O.INACTIVE||this.isEditing&&"point"!==this.activeTool)}})],j.prototype,"handleViewPointerMove",null),S([l({when(){return"select"===this.activeTool}})],j.prototype,"handleViewEscape",null),S([l({when(){return!this.disableEditOptions}})],j.prototype,"renderEditOptions",null),S([l({when(){return!this.disableEditOptions}})],j.prototype,"renderEditingOptions",null),S([l({when(){return this.view}})],j.prototype,"renderPopovers",null),S([l({when(){return this.drawTip&&this.drawTip.length}})],j.prototype,"renderDrawPopover",null),j.style=":host{display:block}.hub-widget-draw{min-width:none !important;max-width:none !important;padding:0px}.draw-popover{width:max-content}.draw-popover>p{margin:0px;padding:0.75rem}arcgis-hub-map-widget-generic:nth-of-type(5){border-left-width:0px;border-right-width:0px;border-top-width:1px;border-bottom-width:0px;border-style:solid;border-color:var(--calcite-ui-border-1)}@media only screen and (min-width: 640px){.hub-widget-draw.top{position:absolute}.hub-widget-draw.top{width:25rem}.hub-widget-draw.top{padding:0px}.hub-widget-draw.right{right:100%}.hub-widget-draw.right{margin-right:1rem}.hub-widget-draw.left{left:100%}.hub-widget-draw.left{margin-left:1rem}.hub-widget-draw.bottom.left{margin-left:0.5rem}.hub-widget-draw.bottom.right{margin-right:0.5rem}}@media only screen and (max-width: 640px){.hub-widget-draw.top{position:absolute}.hub-widget-draw.top{z-index:50}.hub-widget-draw.top{padding:0px}.hub-widget-draw.top{top:calc(var(--top-offset) + var(--bottom-offset));width:calc(var(--view-width) + 1px);display:var(--mobile-display)}.hub-widget-draw.right{right:-1rem}.hub-widget-draw.left{left:-1rem}}";var k=function(e,t,i,s){var r,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(a=(o<3?r(a):o>3?r(t,i,a):r(t,i))||a);return o>3&&a&&Object.defineProperty(t,i,a),a};const V=class{constructor(i){e(this,i),this.arcgisHubWidgetPanelToggled=t(this,"arcgisHubWidgetPanelToggled",7),this.hubTelemetry=t(this,"hubTelemetry",7),this.scale="m",this.view=void 0,this.searchViewModelProperties={},this.active=void 0,this.inputScale=void 0,this.loading=void 0,this.searchComplete=void 0,this.suggestions=[],this.value=void 0,this.width="25rem",a(this,"handleSetInputRef","handleSetDropdownRef","searchIfEnter","toggleActive","setInputWidth")}async componentWillLoad(){const{el:e}=this,t=e&&e.closest("arcgis-hub-map-widget-container");this.viewPosition=null==t?void 0:t.viewPosition,this.intl=await n.loadIntlForComponent(e),await this.connectViewModel()}connectedCallback(){this.connectWatch()}disconnectedCallback(){this.removeWatch()}componentDidLoad(){this.setInputScale(),v()}componentDidRender(){const{active:e,inputEl:t}=this;e&&t&&(t.setFocus(),t.scale=this.inputScale)}handleViewChange(e,t){e&&e!==t&&(this.removeWatch(),this.connectViewModel().then((()=>{this.connectWatch()})))}handleSuggestionsChange(){const{dropdownEl:e,suggestions:t}=this;e.open=Boolean(t.length)}handleActiveChange(e){const{hubTelemetry:t}=this;t.emit(e?h.dictionary.category.interaction.action.open.label.search:h.dictionary.category.interaction.action.close.label.search),this.setInputWidth()}handleValueChange(){const{value:e,searchViewModel:t}=this;t&&""===e&&t.clear()}handlePanelToggled(e){const{target:t,detail:i}=e,{el:s}=this;t===s||i||(this.active=!1)}onCalciteDropdownSelect(){const{dropdownEl:e}=this;this.selectedKey=e.selectedItems[0].dataset.value,this.value=this.selected.text,this.search()}onCalciteInputChange(e){this.value=e.target.value}onCalciteInputInput(e){this.value=e.target.value,this.value&&this.getSuggestions()}handleSetDropdownRef(e){e&&(this.dropdownEl=e)}handleSetInputRef(e){e&&(this.inputEl=e)}async getSuggestions(){const{value:e,searchComplete:t,hubTelemetry:i,searchViewModel:s}=this;i.emit(Object.assign(Object.assign({},h.dictionary.category.interaction.action.search.label.query),{search:e}));const{results:[r]}=await s.suggest(e);t?this.searchComplete=!1:this.suggestions=(null==r?void 0:r.results)||[]}async search(){const{value:e,hubTelemetry:t,searchViewModel:i}=this;this.loading=!0;const s=this.selected||e,r=await i.search(s);t.emit(Object.assign(Object.assign({},h.dictionary.category.interaction.action.zoom.label.to),{details:null==r?void 0:r.searchTerm})),this.loading=!1,this.selectedKey=null,this.suggestions=[],this.searchComplete=!0}searchIfEnter(e){const{key:t}=e;"Enter"===t&&this.search()}toggleActive(){const{active:e,arcgisHubWidgetPanelToggled:t}=this;this.active=!e,t.emit(e)}connectWatch(){const{view:e}=this;e&&(this.handle=E((()=>e.size),this.setInputWidth))}removeWatch(){const{handle:e}=this;e&&e.remove(),this.handle=void 0}async connectViewModel(){const{view:e,searchViewModel:t}=this;e&&!t&&(await e.when(),this.searchViewModel=new M(Object.assign({autoSelect:!0,suggestionsEnabled:!0,maxResults:1,maxSuggestions:5,minSuggestCharacters:3,view:e},this.searchViewModelProperties)))}setInputScale(){const{scale:e}=this;this.inputScale="s"===e?"m":"l"}setInputWidth(){const{inputEl:e,view:{size:t}}=this;if(!e)return;const[i]=t;this.width=i<600?.65*i+"px":"25rem"}get positionClass(){const{viewPosition:e}=this;if(e)return`hub-widget-search ${e.split("-").join(" ")}`}get selected(){const{suggestions:e,selectedKey:t}=this;return e.filter((({key:e})=>e===t)).pop()}get styles(){const{width:e}=this;return{"--width":e}}render(){const{value:e,loading:t,scale:s,active:o,styles:a}=this,n=this.intl.t("textOpen"),h=this.intl.t("textClose"),c=this.intl.t("placeholder");return i(r,{"data-element":"map-widget-search",style:a},this.active&&i("section",{class:this.positionClass},i("calcite-dropdown",{ref:this.handleSetDropdownRef,scale:s},i("calcite-input",{clearable:!0,icon:"search",loading:t,onKeyPress:this.searchIfEnter,placeholder:c,ref:this.handleSetInputRef,scale:this.inputScale,slot:"trigger",value:e}),i("calcite-dropdown-group",{selectionMode:"single"},this.suggestions.map((e=>i("calcite-dropdown-item",{"data-value":e.key,key:e.key},e.text)))))),i("arcgis-hub-map-widget-generic",{active:o,icon:"search",onClick:this.toggleActive,scale:s,text:o?h:n}))}static get assetsDirs(){return["locales"]}get el(){return o(this)}static get watchers(){return{view:["handleViewChange"],suggestions:["handleSuggestionsChange"],active:["handleActiveChange"],value:["handleValueChange"]}}};k([x({timeout:300})],V.prototype,"getSuggestions",null),k([x({timeout:25})],V.prototype,"setInputWidth",null),V.style=":host{display:block}calcite-dropdown{position:absolute}calcite-input{width:var(--width)}calcite-dropdown-group{width:var(--width)}.hub-widget-search.top{position:absolute;width:var(--width)}.hub-widget-search.right{right:100%;margin-right:1rem}.hub-widget-search.left{left:100%;margin-left:1rem}";export{j as arcgis_hub_map_widget_draw,V as arcgis_hub_map_widget_search}