import{r as t,c as e,h as i,a as s,H as n}from"./p-d4ba4c14.js";import{i as r}from"./p-be5c5009.js";import{b as o}from"./p-fd260f2d.js";import{c as a}from"./p-b728aff4.js";import{I as c,a as l,F as h}from"./p-c3d545c0.js";import{c as p}from"./p-d1b12a9c.js";import{D as u}from"./p-3bf8d293.js";import{a as d}from"./p-008d72ef.js";import"./p-796574a4.js";import"./p-dcdf7b57.js";const g=/(feature)server(\/|\/(\d+))?$/i,f=/\/[a-zA-Z]+server(\/|\/(\d+))?$/i;function m(t){let e;try{const i=new URL(t);e="/"!==i.pathname?i.pathname.split("/").pop():i.hostname}catch(t){throw new Error("Error getting file name from data url")}return e}function v(t,e){return{title:e.name,description:e.description,extent:e.extent,url:t}}function y(t,e){const i=e.serviceDescription||e.description;return{title:function(t){return t.match(/\/services\/(.+)\/(feature|map|image)server/i)[1]}(t),description:i,extent:e.fullExtent||e.initialExtent,url:t}}async function b(t){if(!function(t){try{return!!new URL(t)}catch(t){return d.error("Error parsing URL"),!1}}(t))return{pass:!1,error:"invalidFormat"};const e=function(t){return g.test(t)}(t);if(function(t){return f.test(t)}(t)&&!e)return{pass:!1,error:"invalidFormat"};let i,s,n={};try{if(n=e?await async function(t){const e=new URL(t);e.searchParams.set("f","json");const i=await fetch(e.href);if(!i.ok)return{ok:!1};const s=await i.json();return s.error?{ok:!1}:{ok:!0,item:(function(t){const e=t.match(g);return e&&!!e[3]}(t)?v:y)(t,s)}}(t):await async function(t){const e=await fetch(t,{method:"HEAD"});return{ok:e.ok,headers:e.headers}}(t),!n.ok)return{pass:!1,error:"invalidUrl"}}catch(t){d.error("error requesting url")}return s=n.item?n.item:{title:m(t),url:t},n.headers&&(i=function(t){let e,i=t.get("Content-Type");if(i)return i=i.split(";").shift(),"text/csv"===i?e=c.CSV:"application/vnd.ms-excel"===i||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===i?e=c["Microsoft Excel"]:"application/pdf"===i?e=c.PDF:"image/jpeg"===i||"image/jpg"===i||"image/png"===i?e=c.Image:"application/geo+json"===i&&(e=c.GeoJson),e}(n.headers)),e?i=c["Feature Service"]:i||(i=function(t){const e=t.toLowerCase().split(".").pop();let i;return"csv"===e?i=c.CSV:"xls"===e||"xlsx"===e?i=c["Microsoft Excel"]:"pdf"===e?i=c.PDF:"jpeg"===e||"jpg"===e||"png"===e?i=c.Image:"geojson"===e&&(i=c.GeoJson),i}(t)),i&&(s.type=i),s.type&&!["Feature Service","Document Link"].includes(s.type)&&(s.dataUrl=s.url),{pass:!0,type:i,item:s}}const w={required:["title"],type:"object",properties:{title:{type:"string",minLength:1},snippet:{type:"string",maxLength:2048},tags:{type:"array",items:{type:"string"}}}},x={type:"Layout",elements:[{labelKey:"title",scope:"/properties/title",type:"Control"},{labelKey:"snippet",scope:"/properties/snippet",type:"Control",options:{control:"hub-field-input-input",type:"textarea"}},{labelKey:"tags",scope:"/properties/tags",type:"Control",options:{control:"hub-field-input-multiselect"}}]},D=class{constructor(i){t(this,i),this.arcgisHubFileMetadataEditorChange=e(this,"arcgisHubFileMetadataEditorChange",7),this._schema=a(w),this._uiSchema=a(x),this.values={},o(this,"translationFunc")}async componentWillLoad(){this.intl=await r.loadIntlForComponent(this.element)}handleValuesChanged(){this.internalValues=a(this.values)}handleEditorChangeEvent(t){t.stopPropagation(),this.arcgisHubFileMetadataEditorChange.emit(t.detail)}translationFunc(t,e,i){return this.intl.t(t,e,i)}render(){return i("div",null,i("arcgis-configuration-editor",{schema:this._schema,t:this.translationFunc,uiSchema:this._uiSchema,values:this.internalValues}))}static get assetsDirs(){return["locales"]}get element(){return s(this)}static get watchers(){return{values:["handleValuesChanged"]}}};const j={"image/png":c.Image,"image/jpeg":c.Image,"image/tiff":c.Image,"image/tif":c.Image,"text/csv":c.CSV,"application/pdf":c.PDF,"application/geo+json":c.GeoJson,"application/vnd.ms-excel":c["Microsoft Excel"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":c["Microsoft Excel"],"application/msword":c["Microsoft Word"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":c["Microsoft Word"],"application/vnd.ms-powerpoint":c["Microsoft Powerpoint"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":c["Microsoft Powerpoint"]},F={month:"short",day:"numeric",year:"numeric"},k=class{constructor(i){t(this,i),this.arcgisHubFileSelected=e(this,"arcgisHubFileSelected",7),this.arcgisHubDragOver=e(this,"arcgisHubDragOver",7),this.componentType="content",this.maxSize=200,this.owner=void 0,this.defaultExtent=void 0,this.allowedFileTypes=void 0,this.portalName=void 0,this.errorMessage=void 0,this.files=void 0,this.isDragging=void 0,o(this,"handleDragOver","handleDragLeave","handleDrop","setInputEl","onInputChange","buttonRef","onButtonClick")}async componentWillLoad(){this.intl=await r.loadIntlForComponent(this.el)}validateFiles(){const{files:t,allowedFileTypes:e}=this,i=1e3*this.maxSize*1e3;if(t){const{success:s,errorMessage:n}=function(t,e,i){let s,n=!1;return t.length>1?s="multipleFilesError":t[0].size>e?s="fileTooLargeError":function(t,e){const i=Object.keys(l),s=[];return i.forEach((i=>{var n,r,o;(null===(n=l[i].fileExt)||void 0===n?void 0:n.indexOf(t))>=0&&(e?((null===(r=e.extensions)||void 0===r?void 0:r.indexOf(t))>=0||(null===(o=e.types)||void 0===o?void 0:o.indexOf(l[i].type))>=0)&&s.push(l[i]):s.push(l[i]))})),s}(function(t){const e=/(?:\.([^.]+))?$/,i=t.replace(/^.*(\\|\/|:)/,"");let s=i&&e.exec(i)[1]?e.exec(i)[1].toLowerCase():"",n="";if(i.indexOf(".rft.")>-1){const[t,e]=i.split(".rft.");s=`rft.${e}`,n=t}return i&&!n&&(n=-1===i.lastIndexOf(".")?i:i.substring(0,i.lastIndexOf("."))),n=n.replace(/\.|-/g,"_"),{title:n,fileName:i,extension:s}}(t[0].name).extension,i).length>0?n=!0:s="unsupportedFileTypeError",{success:n,errorMessage:s}}(t,i,e);if(s){this.errorMessage=void 0;const e=t[0],i={owner:this.owner,extent:p(this.defaultExtent),spatialReference:this.defaultExtent.spatialReference,source:this.portalName,publishedDate:this.intl.formatDate(new Date,F),access:"private",title:this.trimExtension(e.name),type:j[e.type],modified:e.lastModified,file:e};this.arcgisHubFileSelected.emit(i)}else this.errorMessage=n}}trimExtension(t){const e=t.split(".");return e.splice(0,e.length-1).join(".")}async focusMainInput(){this.mainInputRef.focus()}async clearSelectedFile(){this.files=void 0}get fileExtensionsFromAllowedFileTypes(){var t,e;const{allowedFileTypes:i}=this;let s=[];return(null===(t=null==i?void 0:i.extensions)||void 0===t?void 0:t.length)&&(s=[...s,...this.allowedFileTypes.extensions]),(null===(e=null==i?void 0:i.types)||void 0===e?void 0:e.length)&&(s=i.types.reduce(((t,e)=>l[e]&&l[e].fileExt?[...t,...l[e].fileExt]:t),s)),s=[...new Set(s)],s}get isFileSelected(){return this.files&&!this.errorMessage}handleDragOver(t){return t.dataTransfer.types.includes("Files")&&!this.isFileSelected&&(t.preventDefault(),this.isDragging=!0,this.arcgisHubDragOver.emit(this.isDragging)),!1}handleDragLeave(){this.isDragging=!1}handleDrop(t){t.preventDefault(),this.isDragging=!1,this.files=t.dataTransfer.files}onInputChange(t){this.files=Object.assign({},t.target.files)}setInputEl(t){this.inputElement=t}get inputAcceptList(){let t=this.fileExtensionsFromAllowedFileTypes;return t.length||(t=Object.keys(h)),`.${t.join(", .")}`}onButtonClick(){var t;this.isFileSelected?this.clearSelectedFile():null===(t=this.inputElement)||void 0===t||t.click()}buttonRef(t){this.mainInputRef=t}get buttonIntl(){const{isFileSelected:t,componentType:e}=this;let i="contentButton";return t?i="clearButton":"image"===e&&(i="imageButton"),i}get headingIntl(){const{componentType:t,errorMessage:e,files:i}=this;let s="contentHeading";return e?s="errorHeading":i&&!e?s="selectedHeading":"image"===t&&(s="imageHeading"),s}renderDetails(){const{errorMessage:t,files:e,isFileSelected:s,maxSize:n,fileExtensionsFromAllowedFileTypes:r,intl:o}=this;let a;const c=!r.length||r.length>15;let l="maxSizeAndSupportedTypes";t?l=t:c&&(l="maxSize"),c&&!t||(a=r.join(", "));let h=o.t(l,{maxSize:n,fileTypes:a});t?h=o.t(l):s?h=e[0].name:c&&(h=o.t(l,{maxSize:n}));let p=i("p",null,h);return c&&!t&&(p=i("p",null,h,i("a",{href:""},o.t("linkText")))),p}render(){return i(n,{class:{"file-select-zone":!0,dragging:this.isDragging,error:!!this.errorMessage,success:this.isFileSelected},onDragLeave:this.handleDragLeave,onDragOver:this.handleDragOver,onDrop:this.handleDrop},i("calcite-icon",{"aria-hidden":"true",icon:this.isFileSelected?"check-circle":"upload",scale:"l"}),i("header",null,this.intl.t(this.headingIntl)),this.renderDetails(),i("input",{accept:this.inputAcceptList,onChange:this.onInputChange,ref:this.setInputEl,tabIndex:-1,type:"file"}),i("calcite-button",{appearance:"outline",onClick:this.onButtonClick,ref:this.buttonRef},this.intl.t(this.buttonIntl)),i("slot",null))}static get assetsDirs(){return["locales"]}get el(){return s(this)}static get watchers(){return{files:["validateFiles"]}}};k.style=":host{box-sizing:border-box;display:block;width:100%;border-width:1px;border-style:dashed;padding-top:2rem;padding-bottom:2rem;text-align:center;transition:all 200ms ease-in-out;border-color:#828282;background-color:var(--calcite-ui-foreground-1)}:host(.dragging){border-color:var(--calcite-ui-brand);background-color:rgba(0, 121, 193, 0.05)}:host(.error){background-color:#FFF1EF;border-color:var(--calcite-ui-danger)}:host(.success){border-color:var(--calcite-ui-success);color:var(--calcite-ui-success)}header{margin-bottom:5px;font-size:var(--calcite-font-size-2);line-height:1.5rem;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-2)}p{margin-top:5px;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-normal);color:var(--calcite-ui-text-2)}a{display:block}input{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}";const S=class{constructor(i){t(this,i),this.arcgisHubSelectedGroupsChange=e(this,"arcgisHubSelectedGroupsChange",7),this.internalSelectedGroups=[],this.internalDeselectedGroups=[],this.groups=[],this.selectedGroups=[],o(this,"updateSelectedGroups","_shouldGroupBeSelected")}updateSelectedGroups(t){t.target.checked?(this.internalSelectedGroups.push(t.target.value),this.internalDeselectedGroups=this.internalDeselectedGroups.filter((e=>e!==t.target.value))):(this.internalDeselectedGroups.push(t.target.value),this.internalSelectedGroups=this.internalSelectedGroups.filter((e=>e!==t.target.value))),this.arcgisHubSelectedGroupsChange.emit({share:this.internalSelectedGroups,unshare:this.internalDeselectedGroups})}async componentWillLoad(){this.intl=await r.loadIntlForComponent(this.element),this.selectedGroups.length&&(this.internalSelectedGroups=this.internalSelectedGroups.concat(this.selectedGroups))}_shouldGroupBeSelected(t){return!!this.internalSelectedGroups.find((e=>e.id===t))}render(){if(this.groups.length)return i("div",null,i("header",null,this.intl.t("heading")),this.groups.map((t=>i("calcite-label",{key:t.id,layout:"inline"},i("calcite-checkbox",{checked:this._shouldGroupBeSelected(t.id),name:t.title,onCalciteCheckboxChange:this.updateSelectedGroups,value:t}),t.title))))}static get assetsDirs(){return["locales"]}get element(){return s(this)}};S.style="header{font-size:var(--calcite-font-size-1);line-height:1.5rem;font-weight:var(--calcite-font-weight-medium);margin-bottom:0.375rem}calcite-label{--calcite-font-size--1:16px}";const E={month:"short",day:"numeric",year:"numeric"},z=class{constructor(i){t(this,i),this.arcgisHubUrlValidated=e(this,"arcgisHubUrlValidated",7),this.arcgisHubItemTypeSelected=e(this,"arcgisHubItemTypeSelected",7),this.types=[{intl:"doclink",type:"Document Link",active:!0},{intl:"csv",type:"CSV"},{intl:"shp",type:"Shapefile"},{intl:"geojson",type:"GeoJson"},{intl:"featureservice",type:"Feature Service"},{intl:"xls",type:"Microsoft Excel"},{intl:"pdf",type:"PDF"},{intl:"png",type:"Image"},{intl:"jpg",type:"Image"}],this.owner=void 0,this.defaultExtent=void 0,this.portalName=void 0,this.selectedTypeText=void 0,this.errorString=void 0,this.showTypePicker=!1,this.validatedUrlItem=void 0,this.mergedUrlItem=void 0,o(this,"setDropdownEl","setInputEl","handleOnInput","handleOnKeyDown")}async componentWillLoad(){this.intl=await r.loadIntlForComponent(this.el)}validateDebounced(){this.validateUrl()}handleItemTypeSelection(){const t=this.dropdownEl.selectedItems[0];if(t){const e=t.dataset.value;this.selectedTypeText=t.getAttribute("title"),this.validatedUrlItem&&(this.validatedUrlItem.type=e,this.mergedUrlItem.type=e,this.arcgisHubItemTypeSelected.emit(this.mergedUrlItem))}}async validateUrl(){const t=this.inputEl.value;if(t){const e=await b(t);this.validatedUrlItem=e;const i=e.item.extent||this.defaultExtent,s=Object.assign({owner:this.owner,extent:p(i),spatialReference:i.spatialReference,source:this.portalName,publishedDate:this.intl.formatDate(new Date,E),access:"private"},e.item);"object"==typeof s.extent&&(s.extent=p(s.extent)),this.mergedUrlItem=s,e.type||(this.showTypePicker=!0,this.validatedUrlItem.type="Document Link",this.mergedUrlItem.type="Document Link",this.selectedTypeText=this.intl.t("doclink")),this.arcgisHubUrlValidated.emit(this.mergedUrlItem)}else this.validatedUrlItem=void 0}handleOnInput(){this.validateDebounced()}handleOnKeyDown(t){"Enter"===t.key&&this.validateDebounced()}setDropdownEl(t){this.dropdownEl=t}setInputEl(t){this.inputEl=t}renderSubText(){const{intl:t,showTypePicker:e,validatedUrlItem:s}=this;let n=i("span",null,t.t("subText"));if(s&&s.error)n=i("span",null,i("calcite-icon",{class:"error",icon:"x-octagon",scale:"s"}),t.t(s.error));else if(s&&s.pass&&e)n=i("span",null,i("calcite-icon",{class:s.type?"success":"error",icon:s.type?"check-circle":"x-octagon",scale:"s"}),s.type&&this.intl.t("recognizedType"),i("calcite-dropdown",{placement:"top",ref:this.setDropdownEl},i("calcite-button",{appearance:"transparent","icon-end":"caret-down",slot:"trigger"},this.selectedTypeText||this.intl.t("fileTypeSelector")),i("calcite-dropdown-group",{"selection-mode":"single"},this.types.map((t=>i("calcite-dropdown-item",{"data-value":t.type,key:t.type,selected:t.active,title:this.intl.t(t.intl)},this.intl.t(t.intl)))))));else if(s&&s.pass){const t=s.type.toLowerCase().split(" ").join("");n=i("span",null,i("calcite-icon",{class:"success",icon:"check-circle",scale:"s"}),this.intl.t(t))}return n}render(){return i(n,null,i("header",null,this.intl.t("heading")),i("calcite-input",{onInput:this.handleOnInput,onKeyDown:this.handleOnKeyDown,ref:this.setInputEl}),this.renderSubText())}static get assetsDirs(){return["locales"]}get el(){return s(this)}};(function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);r>3&&o&&Object.defineProperty(e,i,o)})([u({timeout:300})],z.prototype,"validateDebounced",null),z.style=':host{display:flex;flex-direction:column;align-items:center}header{margin-bottom:5px;font-size:var(--calcite-font-size-2);line-height:1.5rem;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-2)}calcite-input{width:100%}span{margin-top:5px;display:flex;align-items:center;justify-content:center;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-normal);color:var(--calcite-ui-text-2)}calcite-icon[class="error"]{color:var(--calcite-ui-danger)}calcite-icon[class="success"]{color:var(--calcite-ui-success)}calcite-icon{margin-right:0.625rem}';export{D as arcgis_hub_file_metadata_editor,k as arcgis_hub_file_select,S as arcgis_hub_groups_sharing,z as arcgis_hub_url_content_form}