import{N as e}from"./p-81dd3f52.js";import{i}from"./p-6dac87c8.js";import{E as t}from"./p-2d862ad3.js";function l(i,t,l){t=function(e){return e.border=e.border||!1,e}(t);let n=Object.assign({value:"Statistic"},t);const{metricId:r}=t;if(null==i?void 0:i.features){let a;const o=function(e,i){return null==e?void 0:e.find((e=>{var t;return null===(t=null==e?void 0:e.attributes)||void 0===t?void 0:t.hasOwnProperty(i)}))}(i.features,r);o&&(a=null==o?void 0:o.attributes[r],"esriFieldTypeDate"===(null==t?void 0:t.fieldType)&&"count"!==t.statistic?a=l.formatDate(a):isNaN(parseFloat(a))&&!e.includes(null==t?void 0:t.fieldType)||"NaN"===l.formatNumber(a)||(a=l.formatNumber(a,{style:"decimal",maximumFractionDigits:2}))),a=a||"Statistic",n=Object.assign({value:a},t)}return n}function n(e=[]){return e.map((e=>{const{field:l,values:n,relationship:r}=e,a=e=>null==e?void 0:e.replace(/(['])/g,"$1$1");if(!(n&&n.length&&l&&(null==l?void 0:l.name)))return!1;let o;switch(l.type){case"esriFieldTypeString":o=r===t.LIKE?`${l.name} like '%${n[0]}%'`:`(${l.name} IN (${n.map((e=>`'${a(e)}'`)).join(", ")}))`;break;case"esriFieldTypeDate":i(n[0])?i(n[1])||(o=`${l.name} <= timestamp '${a(n[1])} 23:59:59'`):o=`${l.name} >= timestamp '${a(n[0])} 00:00:00'`,i(n[0])||i(n[1])||(o=`${l.name} >= timestamp '${a(n[0])} 00:00:00' AND ${l.name} <= timestamp '${a(n[1])} 23:59:59'`);break;default:i(n[0])?i(n[1])||(o=`(${l.name}) <= ${n[1]}`):o=`(${l.name}) >= ${n[0]}`,i(n[0])||i(n[1])||(o=`(${l.name}) >= ${n[0]} AND (${l.name}) <= ${n[1]}`)}return o})).filter(Boolean).join(" AND ")||"1=1"}function r(e,i,t){const{value:l,dynamicMetric:r}=e,a=function(e,i){var t={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&i.indexOf(l)<0&&(t[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(l=Object.getOwnPropertySymbols(e);n<l.length;n++)i.indexOf(l[n])<0&&Object.prototype.propertyIsEnumerable.call(e,l[n])&&(t[l[n]]=e[l[n]])}return t}(e,["value","dynamicMetric"]),{layerId:o,field:c,statistic:s,serviceUrl:d,fieldType:u,sourceLink:v,sourceTitle:m,allowExpressionSet:f,expressionSet:p,legacyWhere:y}=r||{},{entityInfo:$,metricName:j}=t,b={source:"dynamic"===(null==e?void 0:e.type)?{type:"service-query",serviceUrl:d,layerId:o,field:c,statistic:s,where:y||n(f?p:[])}:{type:"static-value",value:l},name:j||i,entityInfo:$||{id:void 0,name:void 0,type:void 0},id:i};return delete a.itemId,{metric:b,cardConfig:Object.assign(Object.assign({},a),{displayType:a.displayType||"stat-card",metricId:i,fieldType:u,statistic:s,sourceLink:"dynamic"===(null==e?void 0:e.type)&&v?v:null==a?void 0:a.sourceLink,sourceTitle:"dynamic"===(null==e?void 0:e.type)&&m?m:null==a?void 0:a.sourceTitle,allowLink:"dynamic"===(null==e?void 0:e.type)?a.allowDynamicLink:a.allowLink})}}export{l as m,r as t}