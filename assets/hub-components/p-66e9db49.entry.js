import{r as t,h as e,H as i,a as s,c as a,F as n}from"./p-d4ba4c14.js";import{i as o}from"./p-be5c5009.js";import{C as r,I as l,D as c}from"./p-c29c8d33.js";import{g as d}from"./p-fbd5dcee.js";import{S as h,C as p}from"./p-56b73d71.js";import{b as u}from"./p-fd260f2d.js";import{g as m}from"./p-81a9bee2.js";import{M as g}from"./p-3311a06c.js";import{D as b}from"./p-3bf8d293.js";import{d as f}from"./p-8cf4bd83.js";import{c as y,u as v}from"./p-b728aff4.js";import{a as j}from"./p-31aebb8c.js";import{f as C,u as k,d as w}from"./p-9e418183.js";import{c as x}from"./p-22777f47.js";import{s as O}from"./p-3363f483.js";import{j as A}from"./p-dafb2329.js";import{g as S}from"./p-ea6de7f6.js";import{h as P}from"./p-b1a98ae3.js";import"./p-c94c130f.js";import"./p-8ccaf06d.js";import"./p-9b205605.js";import"./p-6f931af6.js";import"./p-796574a4.js";import"./p-52612356.js";import"./p-af59e67b.js";import"./p-b295a5ae.js";import"./p-dd26efbb.js";import"./p-d1b12a9c.js";import"./p-dcdf7b57.js";import"./p-a0deb8c6.js";import"./p-6dcae6cd.js";import"./p-637ea136.js";import"./p-3f64a9d9.js";import"./p-377e1b5e.js";import"./p-2acb70a6.js";import"./p-cea8413b.js";import"./p-d763eacf.js";import"./p-ad325ed1.js";import"./p-8e7f4c22.js";import"./p-69555c48.js";import"./p-c8e0e01f.js";import"./p-59fd2498.js";import"./p-97274a47.js";import"./p-3904125b.js";import"./p-30a7cbb2.js";import"./p-90dc0f6f.js";import"./p-7202c430.js";import"./p-75d6da59.js";import"./p-10274eb9.js";import"./p-e43616ff.js";import"./p-992b9d10.js";import"./p-895b662f.js";import"./p-859c5360.js";import"./p-dfe5a97d.js";import"./p-5b420841.js";import"./p-f891d7bd.js";import"./p-87582fe0.js";import"./p-235bb6ee.js";import"./p-85d6867e.js";import"./p-8dbea197.js";import"./p-16a95e5b.js";import"./p-ca048216.js";import"./p-4a14259a.js";import"./p-783242bc.js";import"./p-903ef8af.js";import"./p-c836a9b6.js";import"./p-1458dcfd.js";import"./p-aa262d60.js";import"./p-24ecdf64.js";const I=class{constructor(e){t(this,e),this.actionLinks=void 0,this.baseUrl=void 0,this.clickable=void 0,this.corners=r.square,this.imageType=l.thumbnail,this.layout="row",this.lazy=!1,this.linkTarget=void 0,this.newTab=!1,this.selectable=!1,this.selected=!1,this.searchResult=void 0,this.shadow=c.none,this.showAdditionalInfo=!0,this.showAllAdditionalInfo=!0,this.showBadges=!0,this.showOwner=!0,this.showThumbnail=!0,this.showType=!0,this.titleTag=void 0,this.channelDetails=void 0,this.intl=void 0}get _showAllAdditionalInfo(){return this.showAllAdditionalInfo&&"row"===this.layout}formatAccess(t){const{intl:e}=this;let i;return t===h.ORG?i=e.t("org"):t===h.PRIVATE?i=e.t("private"):t===h.PUBLIC&&(i=e.t("public")),i}formatDate(t){const{intl:e}=this;return e.formatDate(t,{year:"numeric",month:"long",day:"numeric"})}async componentWillLoad(){this.intl=await o.loadIntlForComponent(this.element)}get _model(){return this.searchResult?this.convertChannelSearchResultToCardViewModel(this.searchResult):this.channelDetails?this.convertChannelDetailsToCardViewModel(this.channelDetails):void 0}convertChannelSearchResultToCardViewModel(t){var e;const i=[{i18nKey:"access",value:this.formatAccess(t.access)},{i18nKey:"dateCreated",value:this.formatDate(t.createdAt)}],s=null===(e=t.includes)||void 0===e?void 0:e.groups;return(null==s?void 0:s.length)&&i.push({i18nKey:"groups",value:s.map((t=>(null==t?void 0:t.title)||this.intl.t("groupNotFound"))).join(", ")}),Object.assign({access:t.access,actionLinks:this.actionLinks,badges:[],id:t.id,family:"channel",source:t.owner,title:d(t,[],this.intl.t("unnamed")),type:t.type,additionalInfo:i},!isNaN(t.index)&&{index:t.index})}convertChannelDetailsToCardViewModel(t){const{channel:e}=t,i=[{i18nKey:"access",value:this.formatAccess(e.access)},{i18nKey:"dateCreated",value:this.formatDate(e.createdAt)}];return{access:e.access,actionLinks:this.actionLinks,badges:[],id:e.id,family:"channel",source:e.creator,title:d(e,[],this.intl.t("unnamed")),type:"channel",additionalInfo:i}}render(){return e(i,{"data-element":"channel-card"},e("arcgis-hub-card",{clickable:this.clickable,corners:this.corners,imageType:this.imageType,layout:this.layout,lazy:this.lazy,model:this._model,newTab:this.newTab,selectable:this.selectable,selected:this.selected,shadow:this.shadow,showAdditionalInfo:this.showAdditionalInfo,showAllAdditionalInfo:this._showAllAdditionalInfo,showBadges:this.showBadges,showOwner:this.showOwner,showThumbnail:this.showThumbnail,showType:this.showType,titleTag:this.titleTag}))}static get assetsDirs(){return["locales"]}get element(){return s(this)}};I.style="";const G={type:"object",properties:{name:{type:"string"},blockWords:{type:"string"},access:{type:"string",enum:["public","org","private"]},groups:{type:"array"}},if:{properties:{groups:{const:[]}}},then:{properties:{access:{enum:["public","org"]}}}};var T=function(t,e,i,s){var a,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(a=t[r])&&(o=(n<3?a(o):n>3?a(e,i,o):a(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o};const M=class{constructor(e){t(this,e),this.arcgisHubChannelEditorSaved=a(this,"arcgisHubChannelEditorSaved",7),this.arcgisHubChannelEditorError=a(this,"arcgisHubChannelEditorError",7),this.arcgisHubChannelEditorSelected=a(this,"arcgisHubChannelEditorSelected",7),this.hubTelemetry=a(this,"hubTelemetry",7),this.schema=y(G),this.channelId=null,this.namePrefix=void 0,this.disabled=!1,this.footerSlotRef=void 0,this.channel=void 0,this.values=void 0,this.isLoading=!1,this.isSaving=!1,this.isValid=!1,this.alertConfig=null,this.channelAlreadyExists=!1,this.channelGroupsManagers=[],this.isGalleryPickerOpen=!1,this.inaccessibleGroups=[],this.showModifyConfirmationModal=!1,u(this,"handleSaveClicked","updateValues","handleAlertClosed","handleUseExistingChannel","searchAllGroupManagers","handleFormInitialized","handleAddParticipantGroupClicked","handleParticipantsPickerClosed","handleParticipantsPickerSelectionUpdated","handleGalleryAction","validate","renderNotice","handleFormChanged","handleModifyConfirmationModalClosed","handleConfirmUpdateClicked")}async componentWillLoad(){await this.loadTranslations(),this.initialize()}get _context(){return m()}get isOrgAdmin(){const{_context:{currentUser:{role:t,roleId:e,orgId:i}},channelOrgsIds:s}=this;return!e&&"org_admin"===t&&s.includes(i)}get participantCatalogs(){return[j("groupPicker.","allGroups","group",{user:this._context.currentUser})]}get particpantFacets(){var t,e,i,s,a,n,o;const r={label:this.intl.t("groupPicker.facet.label"),key:"groups",display:"single-select",operation:"OR",options:[{label:this.intl.t("groupPicker.facet.myGroup"),key:"my-group",selected:!0,predicates:[{owner:null===(t=this._context)||void 0===t?void 0:t.currentUser.username,typekeywords:{not:p}}]},{label:this.intl.t("groupPicker.facet.myOrganization"),key:"my-organization",selected:!1,predicates:[{orgid:null===(i=null===(e=this._context)||void 0===e?void 0:e.currentUser)||void 0===i?void 0:i.orgId,searchUserAccess:"groupMember",searchUserName:null===(s=this._context)||void 0===s?void 0:s.currentUser.username,typekeywords:{not:p}}]}]};return(null===(a=this._context)||void 0===a?void 0:a.communityOrgId)&&r.options.push({label:this.intl.t("groupPicker.facet.myCommunity"),key:"my-community",selected:!1,predicates:[{orgid:null===(n=this._context)||void 0===n?void 0:n.communityOrgId,searchUserAccess:"groupMember",searchUserName:null===(o=this._context)||void 0===o?void 0:o.currentUser.username,typekeywords:{not:p}}]}),[r]}get uiSchema(){const{intl:t,namePrefix:e,isOrgAdmin:i,_context:s,disabled:a}=this;return(t=>{const{intl:e,namePrefix:i,isOrgAdmin:s,context:a,disabled:n}=t;return{type:"Layout",elements:[{labelKey:"name.label",type:"Control",scope:"/properties/name",options:{control:"hub-field-input-input",placeholder:e.t("name.placeholder",{prefix:i})}},{type:"Section",labelKey:"participants.label",options:{headerTag:"h3",helperText:{labelKey:"participants.helperText"}},elements:[{type:"Control",scope:"/properties/access",options:{messages:[{type:"ERROR",keyword:"enum",icon:!0,label:e.t("validations.minChannelGroups"),allowShowBeforeInteract:!0}],control:"hub-field-input-radio",icons:["globe","organization","user"],disabled:[!s,!s],labels:[e.t("access.public.label"),e.t("access.organization.label"),e.t("access.private.label")],descriptions:[e.t("access.public.description"),e.t("access.organization.description",{orgName:a.portal.name}),e.t("access.private.description")],tooltips:[!n&&!s&&{text:e.t("access.public.disabledTooltip"),placement:"top"},!n&&!s&&{text:e.t("access.organization.disabledTooltip"),placement:"top"}]}}]},{type:"Section",elements:[{type:"Slot",options:{name:"participant-groups"}}]},{type:"Section",labelKey:"manage.label",options:{headerTag:"h3",helperText:{labelKey:"manage.helperText"}},elements:[{type:"Slot",options:{name:"moderators"}}]},{type:"Section",labelKey:"blockWords.label",options:{headerTag:"h3",helperText:{labelKey:"blockWords.helperText"}},elements:[{type:"Control",scope:"/properties/blockWords",options:{control:"hub-field-input-input",type:"textarea"}}]}]}})({intl:t,namePrefix:e,isOrgAdmin:i,context:s,disabled:a})}get channelOrgsIds(){var t;const{channel:e,_context:i}=this;return null!==(t=null==e?void 0:e.orgs)&&void 0!==t?t:[i.currentUser.orgId]}get noticeConfigs(){const{channelId:t,disabled:e,intl:i,channelAlreadyExists:s,handleUseExistingChannel:a}=this,n=[];if(t&&!e&&n.push({icon:"exclamation-mark-triangle",kind:"warning",message:i.t("notices.edit")}),s){const e=t?"update":"create";n.push({icon:"exclamation-mark-triangle",title:i.t(`notices.duplicate.${e}.error.title`),message:i.t(`notices.duplicate.${e}.error.message`),kind:"danger",link:{text:i.t("notices.duplicate.action"),action:a}})}return n}get channelModeratorsQuery(){const{channelGroupsManagers:t,channelOrgsIds:e,values:i,_context:s,channel:a}=this,n=[{username:a?a.creator:s.currentUser.username}];return[h.ORG,h.PUBLIC].includes(i.access)&&n.push({role:"org_admin",orgid:e}),t.length&&n.push({username:t}),{targetEntity:"communityUser",filters:[{operation:"OR",predicates:n}]}}get participantGroupsQuery(){if(this.values.groups.some((t=>!this.inaccessibleGroups.includes(t))))return{targetEntity:"group",filters:[{predicates:[{id:this.values.groups}]}]}}get moderatorsActionLinks(){return[{},{action:"viewUser",label:this.intl.t("viewProfile"),showLabel:!0,icon:"launch",buttonStyle:"transparent"}]}get participantActionLinks(){return[this.disabled?{}:{action:"removeGroup",i18nKey:"remove",showLabel:!0,buttonStyle:"solid"},{action:"viewGroup",label:this.intl.t("viewProfile"),showLabel:!0,icon:"launch",buttonStyle:"transparent"}]}async loadChannelGroupsManagers(){const t=await Promise.all(this.values.groups.map(this.searchAllGroupManagers));this.channelGroupsManagers=[].concat(...t).map((({id:t})=>t)).filter(v)}initialize(){return this.loadDependencies().then(this.updateValues)}loadDependencies(){return this.isLoading=!0,this.fetchDependencies().then((t=>{Object.assign(this,t,{isLoading:!1})}))}updateValues(){var t,e,i,s;const{channel:a,intl:n}=this;this.values=Object.assign(Object.assign({},this.values),{name:d(a,[],n.t("unnamedChannel")),access:null!==(t=null==a?void 0:a.access)&&void 0!==t?t:h.PRIVATE,blockWords:null!==(i=null===(e=null==a?void 0:a.blockWords)||void 0===e?void 0:e.join(", "))&&void 0!==i?i:"",groups:null!==(s=null==a?void 0:a.groups)&&void 0!==s?s:[]})}async fetchDependencies(){const{channelId:t,_context:e}=this;return{channel:t?await C(Object.assign({channelId:t},e.hubRequestOptions)):null}}searchAllGroupManagers(t){const e=async(i,s)=>{if(-1===i)return s;let a,n;try{const{results:e,hasNext:o}=await P({targetEntity:"groupMember",filters:[{predicates:[{group:t,memberType:"admin"}]}]},{num:100,start:i,requestOptions:this._context.hubRequestOptions});a=[...s,...e],n=o?a.length+1:-1}catch(e){n=-1,a=s,this.inaccessibleGroups=this.inaccessibleGroups.includes(t)?this.inaccessibleGroups:[...this.inaccessibleGroups,t]}return e(n,a)};return t?e(1,[]):[]}async handleValuesChanged(t,e){(t.groups.length!==(null==e?void 0:e.groups.length)||!(null==e?void 0:e.groups.every((e=>t.groups.includes(e)))))&&await this.loadChannelGroupsManagers()}handleChannelIdChanged(){this.initialize()}async loadTranslations(){this.intl=await o.loadIntlForComponent(this.element),u(this.intl,"t")}handleFormChanged(t){this.values=Object.assign(Object.assign({},this.values),t.detail.values),this.isValid=t.detail.valid}handleFormInitialized(t){this.isValid=t.detail.valid}handleSaveClicked(){const{channel:t,values:e,_context:i}=this;!t||x(Object.assign(Object.assign({},t),e),i.currentUser)?this.saveChannel(!1):this.showModifyConfirmationModal=!0}handleConfirmUpdateClicked(){this.showModifyConfirmationModal=!1,this.saveChannel(!0)}handleModifyConfirmationModalClosed(){this.showModifyConfirmationModal=!1}async saveChannel(t){var e;const{values:i,channelId:s,_context:a,intl:n,channel:o,inaccessibleGroups:r}=this;this.isSaving=!0,this.alertConfig=null;const l=Boolean(o),c={access:i.access,blockWords:i.blockWords.trim().split(",").filter(Boolean).map((t=>t.trim())),name:i.name};try{this.channelAlreadyExists=!1;const e=l?await k(Object.assign({channelId:s,data:Object.assign(Object.assign({},c),{groups:[...r,...i.groups].filter(v)})},a.hubRequestOptions)):await w(Object.assign({data:Object.assign(Object.assign({},c),{groups:i.groups})},a.hubRequestOptions));this.channel=e,this.channelId=e.id,this.disabled=t,this.updateValues(),this.arcgisHubChannelEditorSaved.emit({channel:e,action:l?"update":"create"}).defaultPrevented||(this.alertConfig={kind:"success",title:n.t("alerts.success")})}catch(t){this.alertConfig={kind:"danger",title:n.t("alerts.error")},this.channelAlreadyExists=400===t.status&&(null===(e=t.error)||void 0===e?void 0:e.includes("already exists")),this.arcgisHubChannelEditorError.emit()}finally{this.isSaving=!1}}handleAlertClosed(){this.alertConfig=null}async handleUseExistingChannel(){const{_context:t,values:e}=this,{items:[i]}=await O(Object.assign({data:{access:[e.access],groups:e.groups}},t.hubRequestOptions));this.arcgisHubChannelEditorSelected.emit(i)}handleAddParticipantGroupClicked(){this.isGalleryPickerOpen=!0}handleParticipantsPickerClosed(){this.isGalleryPickerOpen=!1}handleParticipantsPickerSelectionUpdated(t){const{group:e}=t.detail;this.values=Object.assign(Object.assign({},this.values),{groups:e}),this.validate()}removeParticipantGroup(t){const{values:e}=this;this.values=Object.assign(Object.assign({},e),{groups:e.groups.filter((e=>e!==t.id))}),this.validate(),this.hubTelemetry.emit(f.dictionary.category.content.action.update.label.groups.details.removeParticipantGroup)}goToGroupProfile(t){this.goToUrl(A(t.id,this._context.hubRequestOptions))}goToUserProfile(t){this.goToUrl(S(t.id,this._context.hubRequestOptions))}goToUrl(t){window.location.href=t}handleGalleryAction(t){const{action:e,model:i}=t.detail;"removeGroup"===e?this.removeParticipantGroup(i):"viewGroup"===e?this.goToGroupProfile(i):"viewUser"===e&&this.goToUserProfile(i)}validate(){this._validate()}async _validate(){const{valid:t}=await this.editorRef.validate();this.isValid=t}renderModerators(){return e("arcgis-hub-gallery",{cardActionLinks:this.moderatorsActionLinks,context:this._context,key:"moderators",layout:"list",limit:100,onArcgisHubGalleryAction:this.handleGalleryAction,query:this.channelModeratorsQuery,showEmptyState:!0,slot:"moderators",sortField:"username",sortOrder:"asc"})}renderAlert(){const{alertConfig:t,intl:i}=this;if(t)return e("calcite-alert",{autoClose:!0,autoCloseDuration:"fast",icon:!0,kind:t.kind,label:i.t("alerts.label"),onCalciteAlertClose:this.handleAlertClosed,open:!0,placement:"top-end"},e("div",{slot:"title"},t.title))}renderNotices(){return this.noticeConfigs.map(this.renderNotice)}renderNotice({title:t,message:i,link:s,kind:a,icon:n}){return e("calcite-notice",{icon:n,key:t||i,kind:a,open:!0,scale:"s",width:"full"},t&&e("div",{slot:"title"},t),i&&e("div",{slot:"message"},i),s&&e("calcite-link",{compact:!0,onClick:s.action,slot:"link"},s.text))}renderSaveButton(){const{footerSlotRef:t}=this,{disabled:i,isLoading:s,isValid:a,isSaving:n,handleSaveClicked:o}=this;if(!i){const i=e("div",null,e("calcite-button",{disabled:s||!a,loading:n,onClick:o,round:!0,type:"submit"},this.intl.t("save")));return t?e("arcgis-wormhole",{styles:{position:"relative"},target:this.footerSlotRef},i):i}}renderParticipants(){let t;return t=this.values.groups.length?this.participantGroupsQuery?e("arcgis-hub-gallery",{cardActionLinks:this.participantActionLinks,context:this._context,key:"participant-groups",layout:"list",limit:100,onArcgisHubGalleryAction:this.handleGalleryAction,query:this.participantGroupsQuery,showEmptyState:!1,sortField:"username",sortOrder:"asc"}):null:e("p",{class:"no-participants"},this.intl.t("participants.none")),e("div",{slot:"participant-groups"},Boolean(this.inaccessibleGroups.length)&&this.renderNotice({icon:"information",kind:"info",title:this.intl.t("notices.inaccessibleGroups.title",{count:this.inaccessibleGroups.length}),message:this.intl.t("notices.inaccessibleGroups.message")}),t,!this.disabled&&e(n,null,e("calcite-button",{appearance:"outline-fill",onClick:this.handleAddParticipantGroupClicked,round:!0,slot:"participant-groups"},this.intl.t("participants.add")),this.isGalleryPickerOpen&&e("arcgis-hub-gallery-picker",{catalogs:this.participantCatalogs,context:this._context,facets:this.particpantFacets,gallerySelection:{group:this.values.groups},key:"gallery-picker",modalTitle:this.intl.t("groupPicker.title"),onArcgisHubGalleryPickerClose:this.handleParticipantsPickerClosed,onArcgisHubGalleryPickerSelectionUpdate:this.handleParticipantsPickerSelectionUpdated,open:!0,showSearch:!0,showSelection:!1,showThumbnail:!0})))}renderConfigurationEditor(){const{_context:t,schema:i,uiSchema:s,intl:a,handleFormChanged:n,handleFormInitialized:o,values:r,disabled:l,isSaving:c}=this;return e("arcgis-configuration-editor",{context:t,disabled:l||c,key:"channel-editor-form",onArcgisConfigurationEditorChange:n,onArcgisConfigurationEditorInitialized:o,ref:t=>{this.editorRef=t},schema:i,t:a.t,uiSchema:s,values:r},this.renderModerators(),this.renderParticipants())}renderModifyConfirmationModal(){const{showModifyConfirmationModal:t,handleModifyConfirmationModalClosed:i,handleConfirmUpdateClicked:s,intl:a}=this;return e("calcite-modal",{onCalciteModalClose:i,open:t},e("h3",{slot:"header"},a.t("access.confirmation.header")),e("div",{slot:"content"},a.t("access.confirmation.message")),e("calcite-button",{appearance:"outline",onClick:i,slot:"secondary",width:"full"},a.t("access.confirmation.secondary")),e("calcite-button",{onClick:s,slot:"primary",width:"full"},a.t("access.confirmation.primary")))}renderForm(){return e(n,null,this.renderNotices(),this.renderConfigurationEditor(),this.renderSaveButton(),this.renderAlert(),this.renderModifyConfirmationModal())}renderSkeleton(){return null}render(){return e(i,{"data-element":"channel-editor"},this.isLoading?this.renderSkeleton():this.renderForm())}static get assetsDirs(){return["locales"]}get element(){return s(this)}static get watchers(){return{values:["handleValuesChanged"],channelId:["handleChannelIdChanged"]}}};T([g("currentUser","channelOrgsIds")],M.prototype,"isOrgAdmin",null),T([g("_context.currentUser")],M.prototype,"participantCatalogs",null),T([g("_context.currentUser")],M.prototype,"particpantFacets",null),T([g("namePrefix","isOrgAdmin","disabled")],M.prototype,"uiSchema",null),T([g("channel","_context.currentUser")],M.prototype,"channelOrgsIds",null),T([g("channelId","disabled","channelAlreadyExists")],M.prototype,"noticeConfigs",null),T([g("channelGroupsManagers","values.access","channel","channelOrgsIds","_context.currentUser")],M.prototype,"channelModeratorsQuery",null),T([g("values.groups")],M.prototype,"participantGroupsQuery",null),T([g()],M.prototype,"moderatorsActionLinks",null),T([g("disabled")],M.prototype,"participantActionLinks",null),T([b({timeout:250})],M.prototype,"validate",null),M.style=':host{display:block}p[slot="moderators"]{font-weight:var(--calcite-font-weight-bold)}ul[slot="moderators"]{margin:0px;padding:0px}arcgis-configuration-editor{margin-top:1rem}arcgis-configuration-editor arcgis-configuration-editor-field[property="access"]{--calcite-label-margin-bottom:0}div:has(calcite-button[type="submit"]){display:flex;justify-content:flex-end}calcite-notice[kind="danger"]{margin-top:1rem}calcite-button[slot="participant-groups"]{margin-top:1rem}calcite-notice[kind="info"]+arcgis-hub-gallery{margin-top:1rem}.no-participants{margin:0px}';export{I as arcgis_hub_channel_card,M as arcgis_hub_channel_editor}