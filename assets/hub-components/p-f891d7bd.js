import{C as t,A as r,a as n,c as s}from"./p-56b73d71.js";function e(t){return"org_admin"===t.role&&!t.roleId}var i;!function(t){t.READ_POSTS="readPosts",t.WRITE_POSTS="writePosts",t.MODERATE_CHANNEL="moderateChannel"}(i||(i={}));class o{constructor(t,r){this.ALLOWED_GROUP_MEMBER_TYPES=["owner","admin","member"],this.isChannelAclEmpty=0===t.length,this.permissionsByCategory={},this.channelCreator=r,t.forEach((t=>{var r;const{category:n}=t;(null===(r=this.permissionsByCategory[n])||void 0===r?void 0:r.push(t))||(this.permissionsByCategory[n]=[t])}))}canPostToChannel(t){return!!this.canAnyUser(i.WRITE_POSTS)||!this.isUserUnAuthenticated(t)&&(this.canAnyAuthenticatedUser(i.WRITE_POSTS)||this.canSomeUser(i.WRITE_POSTS,t)||this.canSomeUserGroup(i.WRITE_POSTS,t)||this.canSomeUserOrg(i.WRITE_POSTS,t))}canCreateChannel(t){return!this.isUserUnAuthenticated(t)&&!this.isChannelAclEmpty&&this.userCanAddAnonymousToAcl(t)&&this.userCanAddUnauthenticatedToAcl(t)&&this.userCanAddAllGroupsToAcl(t)&&this.userCanAddAllOrgsToAcl(t)&&this.userCanAddUsersToAcl(t)}canModerateChannel(t){return!this.isUserUnAuthenticated(t)&&(t.username===this.channelCreator||this.canSomeUser(i.MODERATE_CHANNEL,t)||this.canSomeUserGroup(i.MODERATE_CHANNEL,t)||this.canSomeUserOrg(i.MODERATE_CHANNEL,t))}canReadChannel(t){return!!this.canAnyUser(i.READ_POSTS)||!this.isUserUnAuthenticated(t)&&(this.canAnyAuthenticatedUser(i.READ_POSTS)||this.canSomeUser(i.READ_POSTS,t)||this.canSomeUserGroup(i.READ_POSTS,t)||this.canSomeUserOrg(i.READ_POSTS,t))}canAnyUser(t){var n;const s=null===(n=this.permissionsByCategory[r.ANONYMOUS_USER])||void 0===n?void 0:n[0].role;return h(t).includes(s)}canAnyAuthenticatedUser(t){var n;const s=null===(n=this.permissionsByCategory[r.AUTHENTICATED_USER])||void 0===n?void 0:n[0].role;return h(t).includes(s)}canSomeUser(t,n){var s;const e=null!==(s=this.permissionsByCategory[r.USER])&&void 0!==s?s:[],i=n.username;return e.some((r=>{const{role:n,key:s}=r;return s===i&&h(t).includes(n)}))}canSomeUserGroup(t,s){var e;const o=null!==(e=this.permissionsByCategory[r.GROUP])&&void 0!==e?e:[],a=this.mapUserGroupsById(s.groups);return o.some((s=>{const e=a[s.key];if(t===i.READ_POSTS){if(!e)return!1}else if(!e||!u(e))return!1;return function(t,s){return t.category===r.GROUP&&"none"!==s.userMembership.memberType&&("owner"===s.userMembership.memberType||"admin"===s.userMembership.memberType||t.subCategory===n.MEMBER)}(s,e)&&h(t).includes(s.role)}))}canSomeUserOrg(t,s){var e;return(null!==(e=this.permissionsByCategory[r.ORG])&&void 0!==e?e:[]).some((e=>e.key===s.orgId&&function(t,s){return t.category===r.ORG&&(t.subCategory===n.MEMBER||"admin"===t.subCategory&&"org_admin"===s)}(e,s.role)&&h(t).includes(e.role)))}userCanAddAnonymousToAcl(t){return!this.permissionsByCategory[r.ANONYMOUS_USER]||e(t)}userCanAddUnauthenticatedToAcl(t){return!this.permissionsByCategory[r.AUTHENTICATED_USER]||e(t)}userCanAddAllGroupsToAcl(t){const n=this.permissionsByCategory[r.GROUP],s=this.mapUserGroupsById(t.groups);return!n||n.every((t=>{const r=s[t.key];return r&&this.isMemberTypeAuthorized(r)&&u(r)}))}userCanAddAllOrgsToAcl(t){const n=this.permissionsByCategory[r.ORG];return!n||e(t)&&this.isEveryPermissionForUserOrg(t.orgId,n)}isEveryPermissionForUserOrg(t,r){return r.every((r=>{const{key:n}=r;return t===n}))}userCanAddUsersToAcl(t){return!this.permissionsByCategory[r.USER]}isUserUnAuthenticated(t){return null==t.username}mapUserGroupsById(t){return t.reduce(((t,r)=>(t[r.id]=r,t)),{})}isMemberTypeAuthorized(t){const{userMembership:{memberType:r}}=t;return this.ALLOWED_GROUP_MEMBER_TYPES.includes(r)}}function u(r){const{typeKeywords:n=[]}=r;return!n.includes(t)}function h(t){return t===i.WRITE_POSTS?[s.WRITE,s.READWRITE,s.MODERATE,s.MANAGE,s.OWNER]:t===i.MODERATE_CHANNEL?[s.MODERATE,s.MANAGE,s.OWNER]:[s.READ,s.READWRITE,s.MODERATE,s.MANAGE,s.OWNER]}export{o as C,e as i}