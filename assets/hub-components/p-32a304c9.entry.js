import{r as t,c as e,h as i,F as s,H as a,a as r}from"./p-d4ba4c14.js";import{b as n}from"./p-fd260f2d.js";import{b as o,c as h,d as c,p as l,e as d,i as u}from"./p-fbd5dcee.js";import{S as p,a as m,s as v,d as g}from"./p-a5a61c3e.js";import{D as y}from"./p-3bf8d293.js";import{C as w}from"./p-1fde1b24.js";import{i as f}from"./p-be5c5009.js";import{P as b,d as x,e as j}from"./p-56b73d71.js";import{s as _}from"./p-57f04fe1.js";import{d as G}from"./p-8cf4bd83.js";import O from"@arcgis/core/layers/GraphicsLayer.js";import{watch as D}from"@arcgis/core/core/watchUtils.js";import{webMercatorToGeographic as I}from"@arcgis/core/geometry/support/webMercatorUtils.js";import k from"@arcgis/core/geometry/Extent.js";import C from"@arcgis/core/Graphic.js";import{isAbortError as F}from"@arcgis/core/core/promiseUtils.js";import{l as R,g as P}from"./p-e16232c9.js";import{a as T,f as H}from"./p-953effcc.js";import{m as L}from"./p-1b73120f.js";import{C as M}from"./p-c29c8d33.js";import{f as z}from"./p-c7306802.js";import{f as E}from"./p-4db6fd24.js";import{i as S}from"./p-6f931af6.js";import{b as A}from"./p-783242bc.js";import"./p-c94c130f.js";import"./p-8ccaf06d.js";import"./p-9b205605.js";import"./p-b728aff4.js";import"./p-796574a4.js";import"./p-c8e0e01f.js";import"./p-dcdf7b57.js";import"./p-637ea136.js";import"./p-59fd2498.js";import"./p-97274a47.js";import"./p-3904125b.js";import"./p-3f64a9d9.js";import"./p-377e1b5e.js";import"./p-a0deb8c6.js";import"./p-30a7cbb2.js";import"./p-90dc0f6f.js";import"./p-dd26efbb.js";import"./p-d1b12a9c.js";import"./p-6dcae6cd.js";import"./p-2acb70a6.js";import"./p-7202c430.js";import"./p-75d6da59.js";import"./p-10274eb9.js";import"./p-ad325ed1.js";import"./p-69555c48.js";import"./p-cea8413b.js";import"./p-d763eacf.js";import"./p-e43616ff.js";import"./p-992b9d10.js";import"./p-895b662f.js";import"@arcgis/core/geometry/geometryEngine.js";import"./p-5b420841.js";import"./p-dfe5a97d.js";import"./p-4c02fe5e.js";import"@arcgis/core/kernel.js";import"./p-4a14259a.js";import"./p-adee2925.js";import"./p-bded806b.js";import"./p-87582fe0.js";import"./p-9e418183.js";import"./p-3363f483.js";import"./p-52612356.js";import"./p-af59e67b.js";import"./p-b295a5ae.js";import"./p-8e7f4c22.js";import"./p-903ef8af.js";const $={type:"Polygon",coordinates:[[[180,-90],[180,90],[-180,90],[-180,-90],[180,-90]]]},B=t=>new Promise((e=>setTimeout(e,t)));var V=function(t,e,i,s){var a,r=arguments.length,n=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(n=(r<3?a(n):r>3?a(e,i,n):a(e,i))||n);return r>3&&n&&Object.defineProperty(e,i,n),n};const U=class{constructor(i){t(this,i),this.arcgisHubMapPopoverOpen=e(this,"arcgisHubMapPopoverOpen",7),this.arcgisHubMapPopoverClear=e(this,"arcgisHubMapPopoverClear",7),this.hubTelemetry=e(this,"hubTelemetry",7),this.initialized=!1,this.cachedFeatures=[],this.unsavedExistingGeometry=[],this.cachedRelatedFeatureGeometry={},this.layerIds=[],this.persistAttribute="__persist__",this.view=void 0,this.discussionsRef=void 0,this.drawRef=void 0,this.theme={},this.context=void 0,this.discussion=void 0,this.entity=void 0,this.entityId=void 0,this.entityType=void 0,this.isHub=void 0,this.activeFeature=void 0,this.activeMapDiscussion=void 0,this.viewHeight=void 0,this.viewWidth=void 0,this.preview=!0,this.previewHeight=void 0,this.leftOffset=void 0,this.topOffset=void 0,this.mapActionNoticeActive=void 0,this.activePost=void 0,this.activeGraphicDetails=void 0,n(this,"makeGraphic","makeCalloutGraphic","setCalloutSymbolOnPointerMove","calculateOffsets","handlePointerMove","handleMapClickDiscussions","handleViewSizeChange","handleMapDrawSelect","handleEditActiveGraphic","handleDeleteActiveGraphic","handlePostPendingGraphic","addRelatedFeature","removeRelatedFeature","cancelAddRelatedFeature","getRelatedFeature","renderAddLocation","renderRemoveLocation","renderPostLocationEditOptions","renderPostLocationPrimaryOptions")}async componentWillLoad(){this.initialize(),this.intl=await f.loadIntlForComponent(this.element),R()}disconnectedCallback(){this.teardown()}eventTargetIsDiscussionsRef(t){return t.target===this.discussionsRef||t.target===this.onMapDiscussionsRef||t.target===this.onMapDiscussionsPreviewRef}emitHubTelemetry(t){this.hubTelemetry.emit(Object.assign(Object.assign({},t),{postId:this.sketchPostId,channelId:this.currentDiscussionsRef.channelId}))}async initialize(){const{view:t,context:e}=this;if(this.saveInitialDrawOptions(),t&&e){if(await t.when(),this.addGeometryGraphicsLayer(),this.addStagedGeometryGraphicsLayer(),this.addCalloutGraphicsLayer(),this.addHighlightGraphicsLayer(),await this.fetchSubject(),this.fetchPosts(),this.handleViewSizeChange(),this.cachedFeatures.length)try{await this.refreshFeatures(this.cachedFeatures)}catch(t){console.warn("Cannot add discussions features to the map",t.message)}this.setDiscussionsRefHasMap(!0),this.mapViewSizeChangeHandler=D(t,"size",this.handleViewSizeChange),this.mapViewCenterChangeHandler=D(t,"center",this.calculateOffsets),this.initialized=!0}}attachView(t,e){const{initialized:i}=this;t&&t!==e?(i&&this.teardown(),this.initialize()):!t&&i&&this.teardown()}attachdiscussionsRef(t){const{initialized:e}=this;t&&!e&&this.initialize()}handleDrawRefUpdate(){this.saveInitialDrawOptions()}calculateOffsets(){const{view:t,preview:e,graphicGeometry:i,isOffset:s,previewHeight:a,activeMapDiscussion:r}=this;if(t&&r&&i){const{container:r}=t,{top:n,left:o,right:h}=r.getBoundingClientRect(),c=t.toScreen(i),l=s?c.x+5:c.x,d=s?c.y-34:c.y;this.leftOffset=e?l+o:h,this.topOffset=e?d+n-a:n}}handlePreviewDidLoad(t){const{detail:e}=t;this.previewHeight=0,this.previewHeight=e}handlePreviewExpanded(){this.preview=!1}handleGeometryGoTo(t){const{detail:e}=t,i=[...this.geometryGraphicsLayer.graphics.toArray(),...this.calloutGraphicsLayer.graphics.toArray()];let s=[];if(e){const t=e.id,a=e.parentId?e.parentId:e.id;s=i.filter((({attributes:{id:e,parentId:i}})=>e===a||t&&i===t))}else{const{activeMapDiscussion:{locationId:t}}=this;s=i.filter((({attributes:{relatedFeatureId:e}})=>e===t))}s.length&&this.goTo(s)}handleGeometryFeature(t){const{detail:{post:e,create:i}}=t;this.unsavedExistingGeometry=[],this.cachedFeatures=this.cachedFeatures.filter((({properties:{id:t}})=>t!==e.id)),h(e)&&(this.cachedFeatures=[...this.cachedFeatures,...h(e)],i&&this.cachedFeatures.map((t=>{const{properties:{id:i}}=t,{parentId:s}=e;return i===s&&("replyCount"in t.properties||(t.properties.replyCount=0),t.properties.replyCount+=1),t})),this.refreshFeatures(this.cachedFeatures),this.clearHoverActiveGraphics(!0))}handleGeometryFeatureDeleted(t){const{detail:{id:e,parentId:i}}=t;this.cachedFeatures=this.cachedFeatures.filter((({properties:{id:t}})=>t!==e)).map((t=>{const{properties:{id:e}}=t;return e===i&&(t.properties.replyCount-=1),t})),this.refreshFeatures(this.cachedFeatures),this.clearHoverActiveGraphics(!0)}handleGeometryFeatureSelect(t){this.selectFeature(t.detail)}selectFeature(t){const{properties:{id:e,relatedFeatureId:i,index:s,unsaved:a}}=t;this.clearHoverActiveGraphics();const r=this.getMatchingGraphic(t);if(r&&this.addHighlightGraphic(!1,r,p.ACTIVE,!1),a){let e=this.unsavedGeometryGraphicsLayer.graphics.getItemAt(s);i&&(e=this.makeGraphic(t)),this.goTo(e)}else{const t=this.calloutGraphicsLayer.graphics.find((t=>{const{attributes:{relatedFeatureId:a,id:r,__index__:n}}=t;return i?i==a:r==e&&(null===n||s==n)}));if(t){this.addHighlightGraphic(!0,t,p.ACTIVE,!1);const a=i?this.cachedRelatedFeatureGeometry[i].arcgis:this.getGraphicById(e,s);this.goTo(a)}}}handleGeometryFeatureHighlight(t){const{detail:{properties:{id:e,relatedFeatureId:i,index:s,unsaved:a}}}=t;this.clearHoverActiveGraphics();const r=this.getMatchingGraphic(t.detail);if(r&&this.addHighlightGraphic(!1,r,p.HOVER,!1),!a){const t=this.calloutGraphicsLayer.graphics.find((t=>{const{attributes:{relatedFeatureId:a,id:r,__index__:n}}=t;return i?i==a:r==e&&(null===n||s==n)}));t&&this.addHighlightGraphic(!0,t,p.HOVER,!1)}}handleFeatureRemove(t){const{detail:{properties:{id:e,relatedFeatureId:i,index:s,unsaved:a}}}=t;this.removeGraphic(e,i,s,a)}removeGraphic(t,e,i,s){const{currentDiscussionsRef:{unsavedFeatures:a,unsavedRelatedFeatures:r,unsavedExistingFeatures:n}}=this;if(s)if(e)this.currentDiscussionsRef.unsavedRelatedFeatures=[...r.slice(0,i),...r.slice(i+1,r.length)];else{this.currentDiscussionsRef.unsavedFeatures=[...a.slice(0,i),...a.slice(i+1,a.length)];const t=this.unsavedGeometryGraphicsLayer.graphics.getItemAt(i);this.unsavedGeometryGraphicsLayer.graphics.remove(t)}else{const s=s=>{const{attributes:{relatedFeatureId:a,id:r,__index__:n}}=s;return e?e==a:r==t&&(null===n||+i==+n)},a=this.calloutGraphicsLayer.graphics.find(s);a&&(a.visible=!1);const r=this.geometryGraphicsLayer.graphics.find(s);r&&(r.visible=!1);const o=this.postToGeoJSON(null,{id:t,index:+i});this.currentDiscussionsRef.unsavedExistingFeatures=[...n.filter((({properties:{id:e,index:s}})=>!(t===e&&+i==+s))),o]}this.clearHoverActiveGraphics(!0)}handleGeometryDrawCreate(t){const{detail:{post:e,postType:i}}=t;this.sketchPostType=i,this.sketchPostId=null==e?void 0:e.id,this.drawRef.buffer=!1,this.drawRef.disablePrimaryOptions=!0,this.drawRef.disableEditOptions=!0,this.drawRef.drawTip=void 0,this.drawRef.enableMapTips=!0}handleGeometryDrawTypeSelect(t){this.mapActionNoticeActive=!0,this.drawRef.setActiveTool(t.detail)}handleGeometryDrawDone(){this.mapActionNoticeActive=!1,this.drawRef.setActiveTool(void 0),this.deletePendingGraphics()}handleGeometryDrawCancel(){this.drawRef.setActiveTool(void 0)}handleActiveToolChange(t){const{detail:e}=t;e&&(this.deletePendingGraphics(),this.arcgisHubMapPopoverClear.emit())}handleGeometryDrawEdit(t){const{detail:{properties:{id:e,index:i,unsaved:s}}}=t;this.preview=!1,this.editGraphic(e,i,s)}editGraphic(t,e,i){const{drawRef:s}=this,{geometry:a}=i?this.unsavedGeometryGraphicsLayer.graphics.getItemAt(e):this.getGraphicById(t,e);this.hideLayers(),this.goTo(a),this.sketchPostId=t,this.sketchIndex=e,this.sketchIsUnsaved=i,this.drawRef.geometry=void 0,setTimeout((()=>{s.geometry=a,s.disablePrimaryOptions=!0,s.disableEditOptions=!1,s.buffer=!1,s.enableMapTips=!0}),0)}handlePostEditorReady(t){this.activePost=t.detail}handleGeometryDrawEditCancel(){this.currentDiscussionsRef.unsavedFeatures=[...this.currentDiscussionsRef.unsavedFeatures],this.drawRef.forceReset(),this.showLayers()}handleDrawGraphicsChange(t){var e;const{detail:{graphics:i,save:s,canceled:a,unsaved:r}}=t,{sketchPostId:n,sketchIndex:o,sketchIsUnsaved:h}=this,l=i.getItemAt(0);if(l.geometry=m(l.geometry.clone(),this.view),s&&this.drawRef.disablePrimaryOptions){this.drawRef.disableEditOptions=!0;const t=I(l.geometry),i=c(t);if(h){const t=this.currentDiscussionsRef.unsavedFeatures.map(((t,e)=>(e===o&&(t.geometry=i),t)));this.currentDiscussionsRef.unsavedFeatures=t;const s=this.unsavedGeometryGraphicsLayer.graphics.getItemAt(o);s.geometry=l.geometry,(null===(e=s.attributes)||void 0===e?void 0:e.pending)&&setTimeout((()=>{this.activeGraphicDetails={id:n,index:o,unsaved:!0,geometry:l.geometry},this.arcgisHubMapPopoverOpen.emit({geometry:l.geometry,view:this.view,render:this.renderPostLocationPrimaryOptions,source:"action"})}),150)}else{const t=this.postToGeoJSON(i,{index:o,id:n});this.currentDiscussionsRef.unsavedExistingFeatures=[...this.currentDiscussionsRef.unsavedExistingFeatures.filter((({properties:{index:t}})=>t!==o)),t];const e=this.getGraphicById(n,o);this.unsavedExistingGeometry.filter((({id:t,index:e})=>t===n&&e===o)).length||this.unsavedExistingGeometry.push({id:n,index:o,geometry:e.geometry.clone()}),e.geometry=l.geometry}this.drawRef.forceReset(),this.showLayers();const s=u(i);this.emitHubTelemetry(G.dictionary.category.content.action.update.label.location.details[s])}else if(a)this.currentDiscussionsRef.unsavedFeatures=[...this.currentDiscussionsRef.unsavedFeatures],this.drawRef.forceReset(),this.showLayers();else if(r){this.drawRef.forceReset(),l.symbol=v[l.geometry.type](p.DEFAULT,this.themeWithDefaults[l.geometry.type]),l.attributes={pending:!0},this.addGraphicsToGraphicsLayer(this.unsavedGeometryGraphicsLayer,[l]);const t=[];i.forEach((e=>{const i=I(e.geometry),s=c(i);t.push({type:"Feature",geometry:s,properties:{id:this.sketchPostId,pending:!0}});const a=u(s);this.emitHubTelemetry(G.dictionary.category.content.action.create.label.location.details[a])})),this.currentDiscussionsRef.unsavedFeatures=[...this.currentDiscussionsRef.unsavedFeatures,...t],setTimeout((()=>{this.activeGraphicDetails={id:n,index:this.unsavedGeometryGraphicsLayer.graphics.length-1,unsaved:!0,geometry:l.geometry},this.arcgisHubMapPopoverOpen.emit({geometry:l.geometry,view:this.view,render:this.renderPostLocationPrimaryOptions,source:"action"})}),150)}}handleGeometryDrawReset(){this.currentDiscussionsRef.unsavedFeatures=[...this.currentDiscussionsRef.unsavedFeatures],this.restoreInitialDrawOptions(),this.showLayers()}handleGeometryClearAll(){this.resetStagedFeatures(),this.restoreInitialDrawOptions(),this.showLayers(),this.unsavedGeometryGraphicsLayer.graphics.removeAll();const t=t=>{t.visible=!0};this.geometryGraphicsLayer.graphics.forEach(t),this.calloutGraphicsLayer.graphics.forEach(t),this.mapActionNoticeActive=!1,this.activePost=void 0}async handleMapDrawSelect(t){const{detail:e}=t,{targetLayer:i}=this,{results:s}=await this.view.hitTest(e,{include:i}),a=P(s);if((null==a?void 0:a.graphic)&&this.drawRef.disableEditOptions){const{graphic:t}=a,e=t.attributes[t.layer.objectIdField];if(this.cacheRelatedFeatureGeometry([e]),!t.attributes.hasOwnProperty(i.displayField)){const{features:[s]}=await i.queryFeatures({objectIds:[e],outFields:["*"],returnGeometry:!1});s&&(t.attributes=s.attributes)}const s=this.currentDiscussionsRef.unsavedRelatedFeatures.map((t=>t.objectId));let r=this.renderAddLocation;s.includes(e)&&(r=this.renderRemoveLocation),this.selectedGraphic=t,this.drawRef.enableMapTips=!1,this.arcgisHubMapPopoverOpen.emit({geometry:t.geometry,view:this.view,render:r,source:"action"}),this.highlightGraphic(t)}else this.selectedGraphic=null,this.drawRef.enableMapTips=!0,this.highlightGraphic()}handleDiscussionsClose(t){t.target!==this.onMapDiscussionsRef&&t.target!==this.onMapDiscussionsPreviewRef||(this.activeMapDiscussion=void 0,this.preview=!1,this.clearHoverActiveGraphics(!0))}addRelatedFeature(){const t=this.selectedGraphic.attributes[this.selectedGraphic.layer.objectIdField];this.selectedGraphic.geometry=I(this.selectedGraphic.geometry);const e={postId:this.sketchPostId,objectId:t,feature:c(this.selectedGraphic.toJSON())};this.currentDiscussionsRef.unsavedRelatedFeatures=[...this.currentDiscussionsRef.unsavedRelatedFeatures,e],this.highlightGraphic(),this.arcgisHubMapPopoverClear.emit(),this.drawRef.enableMapTips=!0,this.emitHubTelemetry(G.dictionary.category.interaction.action.select.label.content)}removeRelatedFeature(){const{currentDiscussionsRef:{unsavedRelatedFeatures:t}}=this,e=this.selectedGraphic.attributes[this.selectedGraphic.layer.objectIdField],i=this.currentDiscussionsRef.unsavedRelatedFeatures.findIndex((t=>t.objectId==e));this.currentDiscussionsRef.unsavedRelatedFeatures=[...t.slice(0,i),...t.slice(i+1,t.length)],this.cancelAddRelatedFeature(),this.emitHubTelemetry(G.dictionary.category.interaction.action.deselect.label.content)}cancelAddRelatedFeature(){this.arcgisHubMapPopoverClear.emit(),this.selectedGraphic=null,this.drawRef.enableMapTips=!0,this.clearHighlights()}setDiscussionsRefHasMap(t){this.discussionsRef&&(this.discussionsRef.hasMap=t)}teardown(){this.clearHighlights(),this.removeViewHandlers(),this.removeLayers(),this.resetSelect(),this.setDiscussionsRefHasMap(!1)}async fetchSubject(){const{discussion:t,entity:e,entityId:i,entityType:s,context:a}=this,r=await T({discussion:t,entity:e,entityId:i,entityType:s},a.hubRequestOptions);Object.assign(this,r)}fetchPosts(){(async(t,e,i=10,s=!0)=>{const a=async({discussion:t=null,geometry:r=null,start:n=1})=>{const o=Object.assign({data:Object.assign(Object.assign({discussion:t},r&&{geometry:r}),{sortBy:b.UPDATED_AT,sortOrder:x.DESC,start:n,num:i,relations:[j.REPLIES]})},e),h=_(o);if(1===n){const{total:e}=await h;let o=n+i;const c=[h],l=s?((t,e)=>{const i=Math.ceil(t/e);return i>10?(console.warn("Discussions requests exceeds desired threshold, throttling to 250ms per batch."),250):2500/i})(e,i):0;for(;o<=e;)await B(l),c.push(...await a({discussion:t,geometry:r,start:o})),o+=i;return c}return[h]};try{const e=await Promise.all([...await a({discussion:`${t}%?id=%`}),...await a({discussion:`${t}%`,geometry:$})]),i=[],s=e.map((({items:t})=>t)).flat().filter((t=>!i.includes(t.id)&&(i.push(t.id),!0)));return o(s)}catch(t){const{message:e}=t;console.error("Could not fetch on-map discussions:",e)}})(this.discussion,this.context.hubRequestOptions).then((t=>{(null==t?void 0:t.features)&&(this.cachedFeatures=t.features,this.initialized&&this.refreshFeatures(t.features))}))}addGeometryGraphicsLayer(){this.geometryGraphicsLayer=new O({graphics:[],elevationInfo:{mode:"on-the-ground"}}),this.view.map.add(this.geometryGraphicsLayer),this.layerIds.push(this.geometryGraphicsLayer.id)}addStagedGeometryGraphicsLayer(){this.unsavedGeometryGraphicsLayer=new O({graphics:[],elevationInfo:{mode:"on-the-ground"}}),this.view.map.add(this.unsavedGeometryGraphicsLayer),this.layerIds.push(this.geometryGraphicsLayer.id)}addCalloutGraphicsLayer(){this.calloutGraphicsLayer=new O({graphics:[],effect:"drop-shadow(0px, 2px, 8px, rgba(0, 0, 0, .20))",elevationInfo:{mode:"relative-to-ground"}}),this.view.map.add(this.calloutGraphicsLayer),this.layerIds.push(this.calloutGraphicsLayer.id),this.mapPointerMoveHandler=this.view.on("pointer-move",this.handlePointerMove),this.mapClickDiscussionsHandler=this.view.on("click",this.handleMapClickDiscussions)}addHighlightGraphicsLayer(){this.highlightGraphicsLayer=new O({graphics:[],elevationInfo:{mode:"relative-to-ground"}}),this.view.map.add(this.highlightGraphicsLayer),this.layerIds.push(this.highlightGraphicsLayer.id)}addHighlightGraphic(t,e,i,s){var a,r,n;const{themeWithDefaults:o,highlightGraphicsLayer:h,persistAttribute:c,is3D:l}=this,d=e.clone();t?d.symbol=v.callout(i,Object.assign(Object.assign({},o.callout),{isOffset:null===(a=null==e?void 0:e.attributes)||void 0===a?void 0:a.isOffset,is3D:l}),null===(r=d.attributes)||void 0===r?void 0:r.totalCount):(null===(n=null==e?void 0:e.geometry)||void 0===n?void 0:n.type)&&(d.symbol=v[e.geometry.type](i,Object.assign({},o[e.geometry.type])),this.clearHoverActiveGraphics(s)),d.attributes=Object.assign(Object.assign({},d.attributes),{[c]:s}),h.add(d)}setCalloutSymbolOnPointerMove(t){this.view.hitTest(t,{include:this.calloutGraphicsLayer}).then((t=>{if(this.clearHoverActiveGraphics(!1),t.results.length){const e=P(t.results),{graphic:i}=e;this.addHighlightGraphic(!0,i,p.HOVER,!1)}}))}setLocationEditPopover(t){this.view.hitTest(t,{include:[this.geometryGraphicsLayer,this.unsavedGeometryGraphicsLayer]}).then((t=>{if(t.results.length){const{results:[e]}=t,i=e.layer===this.geometryGraphicsLayer;let s,a,r;if(e.layer===this.unsavedGeometryGraphicsLayer){const t=this.unsavedGeometryGraphicsLayer.graphics.findIndex((t=>t===e.graphic));s=void 0,a=t,r=!0}if(i&&this.activePost){const{id:t}=this.activePost,{graphic:{attributes:{id:i,__index__:n}}}=e,o=n||null;t===i&&(s=t,a=o,r=!1)}if(void 0!==a){const{geometry:t,attributes:i}=e.graphic;this.activeGraphicDetails={id:s,index:a,unsaved:r,geometry:t},this.arcgisHubMapPopoverOpen.emit({geometry:t,view:this.view,render:(null==i?void 0:i.pending)?this.renderPostLocationPrimaryOptions:this.renderPostLocationEditOptions,source:"action"})}}}))}publishPendingGraphics(){this.unsavedGeometryGraphicsLayer.graphics.forEach((t=>{t.attributes.pending&&delete t.attributes.pending})),this.currentDiscussionsRef.unsavedFeatures=this.currentDiscussionsRef.unsavedFeatures.map((t=>(t.properties.pending&&delete t.properties.pending,t)))}deletePendingGraphics(){const t=this.unsavedGeometryGraphicsLayer.graphics.find((t=>{var e;return null===(e=t.attributes)||void 0===e?void 0:e.pending}));this.unsavedGeometryGraphicsLayer.remove(t),this.currentDiscussionsRef&&(this.currentDiscussionsRef.unsavedFeatures=this.currentDiscussionsRef.unsavedFeatures.filter((t=>!t.properties.pending||!t.properties.pending)))}removeLayers(){[this.geometryGraphicsLayer,this.unsavedGeometryGraphicsLayer,this.calloutGraphicsLayer,this.highlightGraphicsLayer].forEach((t=>this.removeLayer(t)))}hideLayers(){[this.geometryGraphicsLayer,this.unsavedGeometryGraphicsLayer,this.calloutGraphicsLayer,this.highlightGraphicsLayer].forEach((t=>t.opacity=.1))}showLayers(){[this.geometryGraphicsLayer,this.unsavedGeometryGraphicsLayer,this.calloutGraphicsLayer,this.highlightGraphicsLayer].forEach((t=>t.opacity=1))}removeLayer(t){t&&t.destroy()}emptyFeatures(){[this.geometryGraphicsLayer,this.unsavedGeometryGraphicsLayer,this.calloutGraphicsLayer].forEach((t=>t.removeAll()))}addGraphicsToGraphicsLayer(t,e){t.addMany(e)}async refreshFeatures(t){this.emptyFeatures(),this.resetSelect(),t.forEach((t=>{var e;return t.properties.totalCount=null!==(e=t.properties.replyCount)&&void 0!==e?e:0}));const e=({geometry:t})=>Boolean(t),i=t.map(this.makeGraphic).filter(e),s=t.map(this.makeCalloutGraphic).filter(e),a=t.filter((({properties:t})=>Boolean(l(t.discussion).features))),r=Array.from(new Set(a.map((({properties:{discussion:t}})=>l(t).features.map((t=>t)))).flat()));await this.cacheRelatedFeatureGeometry(r);const n=[],o=[];for(const t of a){if(o.includes(t.properties.id))continue;o.push(t.properties.id);const{properties:e}=t,{features:i}=l(e.discussion);e.totalCount=0,i.forEach((i=>{var s;const a=n.find((({properties:{relatedFeatureId:t}})=>t==i));if(a){const{properties:t}=a,i=(null!==(s=e.totalCount)&&void 0!==s?s:0)+1;t.totalCount+=i}else try{const e=this.getRelatedFeature(i);e.properties=Object.assign(Object.assign({},t.properties),{relatedFeatureId:i}),n.push(e)}catch(t){console.warn("Failed to access post related feature:",t.message)}}))}const h=[...s,...n.map(this.makeCalloutGraphic)];this.addGraphicsToGraphicsLayer(this.geometryGraphicsLayer,i),this.addGraphicsToGraphicsLayer(this.calloutGraphicsLayer,h),this.activeFeature&&(this.selectFeature(this.activeFeature),this.activeFeature=void 0)}pointToExtent(t,e=.0025){const{x:i,y:s,spatialReference:a}=t;return new k({xmin:i-e,ymin:s-e,xmax:i+e,ymax:s+e,spatialReference:a})}goTo(t){if(!this.view)return;let e=t;e.geometry&&"point"===e.geometry.type&&(e=this.pointToExtent(e.geometry)),e.extent&&(e=e.extent.clone().expand(2)),this.view.goTo({target:e},{duration:1e3,easing:"ease"}).catch((t=>{F(t)||console.error("Failed to zoom map to target feature or extent:",t.message)}))}postToGeoJSON(t,e){return{type:"Feature",geometry:t,properties:e}}makeGraphic(t){var e;const i=d(t),s=C.fromJSON(i);return(null===(e=null==s?void 0:s.geometry)||void 0===e?void 0:e.type)&&(s.symbol=v[s.geometry.type](p.DEFAULT,this.themeWithDefaults[s.geometry.type])),s}makeCalloutGraphic(t){var e;const{is3D:i}=this,{callout:s}=v,{geometry:a,properties:r}=t,[n,o]=a.coordinates.flat(1/0),h=!r.relatedFeatureId&&"Point"===t.geometry.type,c=d({type:"Feature",geometry:{type:"Point",coordinates:[n,o]},properties:Object.assign(Object.assign({},r),{replyCount:r.replyCount||0,isOffset:h})}),l=C.fromJSON(c);return l.symbol=s(p.DEFAULT,Object.assign(Object.assign({},this.themeWithDefaults.callout),{isOffset:h,is3D:i}),null===(e=t.properties)||void 0===e?void 0:e.totalCount),l}getRelatedFeature(t){return{type:"Feature",geometry:this.cachedRelatedFeatureGeometry[t].geojson,properties:{}}}async cacheRelatedFeatureGeometry(t){const{cachedRelatedFeatureGeometry:e,targetLayer:i}=this;if(!i)return void console.warn("Discussions service layer not defined; ingnoring related features");const s=Object.keys(e),a=t.filter((t=>!s.includes(`${t}`)));if(a.length){const t={where:"1=1",objectIds:a.map((t=>+t)),returnGeometry:!0,outSpatialReference:{wkid:4326},outFields:[this.targetLayer.objectIdField,this.targetLayer.displayField]},{features:e}=await this.targetLayer.queryFeatures(t);e.forEach((({geometry:t,attributes:e})=>{const i=c(t);this.cachedRelatedFeatureGeometry[e[this.targetLayer.objectIdField]]={arcgis:t,geojson:i}}))}}getMatchingGraphic(t){const{properties:{id:e,relatedFeatureId:i,index:s,unsaved:a}}=t;let r;return r=i&&this.cachedRelatedFeatureGeometry[i]?new C({geometry:this.cachedRelatedFeatureGeometry[i].arcgis}):a?this.unsavedGeometryGraphicsLayer.graphics.getItemAt(s):this.getGraphicById(e,s),r}getGraphicById(t,e){return this.geometryGraphicsLayer.graphics.find((({attributes:{id:i,__index__:s}})=>i===t&&(null===e||e==s)))}highlightGraphic(t){this.clearHighlights(),t&&(this.clearHighlights(),this.view.whenLayerView(t.layer).then((e=>{this.highlightHandle=e.highlight(t)})))}clearHighlights(){this.highlightHandle&&(this.highlightHandle.remove(),this.highlightHandle=null)}clearHoverActiveGraphics(t){const{persistAttribute:e,highlightGraphicsLayer:i}=this;if(t)i.removeAll();else{const t=i.graphics.filter((({attributes:t})=>!t[e]));i.removeMany(t.toArray())}}removeViewHandlers(){[this.mapPointerMoveHandler,this.mapClickDiscussionsHandler,this.mapViewSizeChangeHandler,this.mapViewCenterChangeHandler].forEach((t=>{t&&(t.remove(),t=null)}))}resetSelect(){this.clearHighlights()}saveInitialDrawOptions(){const{drawRef:{buffer:t,disableEditOptions:e,disablePrimaryOptions:i,enableMapTips:s}}=this;this.initialDrawOptions={buffer:t,disableEditOptions:e,disablePrimaryOptions:i,enableMapTips:s}}restoreInitialDrawOptions(){const{initialDrawOptions:{buffer:t,disableEditOptions:e,disablePrimaryOptions:i,enableMapTips:s}}=this;this.drawRef.buffer=t,this.drawRef.disableEditOptions=e,this.drawRef.disablePrimaryOptions=i,this.drawRef.enableMapTips=s,this.drawRef.setActiveTool(void 0),this.drawRef.forceReset()}resetStagedFeatures(){this.currentDiscussionsRef.unsavedFeatures=[],this.currentDiscussionsRef.unsavedRelatedFeatures=[],this.currentDiscussionsRef.unsavedExistingFeatures=[],this.unsavedExistingGeometry.forEach((({id:t,index:e,geometry:i})=>{this.getGraphicById(t,e).geometry=i})),this.unsavedExistingGeometry=[]}handleMapClickDiscussions(t){this.view.hitTest(t,{include:[this.calloutGraphicsLayer]}).then((t=>{if(t.results.length){this.preview=!1,this.clearHoverActiveGraphics(!0);const e=P(t.results),{graphic:i}=e;this.graphicGeometry=i.geometry,this.isOffset=i.attributes.isOffset;const{attributes:{parentId:s,channelId:a,id:r,relatedFeatureId:n}}=i;this.activeMapDiscussion=n?{channelId:a,locationId:n}:{channelId:a,postId:s?r:void 0,parentId:s||r},this.addHighlightGraphic(!0,i,p.ACTIVE,!0),setTimeout((()=>{this.preview=!0}),0)}}))}handleViewSizeChange(){const{view:{height:t,width:e}}=this;this.viewHeight=t,this.viewWidth=e}handlePointerMove(t){this.setCalloutSymbolOnPointerMove(t),this.setLocationEditPopover(t)}handleEditActiveGraphic(){const{id:t,index:e,unsaved:i}=this.activeGraphicDetails;this.editGraphic(t,e,i)}handleDeleteActiveGraphic(){const{id:t,index:e,unsaved:i}=this.activeGraphicDetails;this.removeGraphic(t,null,e,i),this.arcgisHubMapPopoverClear.emit()}handlePostPendingGraphic(){this.publishPendingGraphics(),this.arcgisHubMapPopoverClear.emit(),1===this.currentDiscussionsRef.unsavedFeatures.length&&(this.drawRef.drawTip=this.intl.t("draw.tip"))}get currentDiscussionsRef(){return this.activeMapDiscussion?this.onMapDiscussionsRef:this.discussionsRef}get themeWithDefaults(){const{theme:t}=this,e={};return["point","polyline","polygon","callout"].forEach((i=>{e[i]=Object.assign(Object.assign({},g[i]),t[i])})),e}get is3D(){const{view:t}=this;return t.hasOwnProperty("camera")}get targetLayer(){return this.view.map.allLayers.filter((t=>"feature"===t.type&&!this.layerIds.includes(t.id))).getItemAt(0)}get styles(){const{view:t,viewWidth:e,viewHeight:i,leftOffset:s,topOffset:a,previewHeight:r,preview:n}=this;let o={};if(t){const{container:h}=t;if(!h)return;const{top:c,left:l,right:d,bottom:u}=h.getBoundingClientRect();o={"--left-offset":`${s}px`,"--top-offset":`${a}px`,"--panel-left":`${l}px`,"--panel-height":(n?i-r:u-c)+"px","--panel-width":d-l+"px","--view-width":`${e}px`,"--view-height":`${i}px`}}return o}renderAddLocation(){const{intl:t,sketchPostType:e}=this;return i(s,null,i("calcite-action-group",null,i("calcite-action",{icon:"check",onClick:this.addRelatedFeature,text:t.t(`prompt.add.${e}`),textEnabled:!0})),i("calcite-action-group",null,i("calcite-action",{icon:"undo",onClick:this.cancelAddRelatedFeature,text:t.t("prompt.remove.existing"),textEnabled:!0})))}renderRemoveLocation(){return i("calcite-action-pad",{"expand-disabled":!0,expanded:!0,layout:"horizontal"},i("calcite-action",{icon:"trash",onClick:this.removeRelatedFeature,text:this.intl.t("location.remove"),textEnabled:!0}))}renderPostLocationPrimaryOptions(){const{activeGraphicDetails:{geometry:{type:t}},intl:e,sketchPostType:a}=this;return i(s,null,i("calcite-action-group",null,i("calcite-action",{icon:"check",onClick:this.handlePostPendingGraphic,text:e.t(`prompt.add.${a}`),"text-enabled":!0})),i("calcite-action-group",null,i("calcite-action",{icon:"point"===t?"move":"pencil",onClick:this.handleEditActiveGraphic,text:e.t(`prompt.edit.${t}`),"text-enabled":!0}),i("calcite-action",{icon:"trash",onClick:this.handleDeleteActiveGraphic,text:e.t(`prompt.remove.${t}`),"text-enabled":!0})))}renderPostLocationEditOptions(){const{intl:t}=this;return i("calcite-action-pad",{"expand-disabled":!0,layout:"horizontal"},i("calcite-action",{icon:"pencil",onClick:this.handleEditActiveGraphic,text:t.t("prompt.location.edit")}),i("calcite-action",{icon:"trash",onClick:this.handleDeleteActiveGraphic,text:t.t("prompt.location.delete")}))}renderMapDiscussion(){const{activeMapDiscussion:t,context:e,discussion:s,isHub:a,entityId:r,entity:n,entityType:o}=this;return this.preview?i("arcgis-hub-discussions-map-preview",{channelId:t.channelId,context:e,discussion:s,locationId:t.locationId,parentId:t.postId?t.parentId:void 0,postId:t.postId||t.parentId,ref:t=>{this.onMapDiscussionsPreviewRef=t}}):i("arcgis-hub-discussions",{channelId:t.channelId,context:e,disableNavigation:!t.locationId,discussion:s,dismissible:!0,enableGoTo:!0,entity:n,entityId:r,entityType:o,hasMap:!0,isHub:a,locationId:t.locationId,parentId:t.parentId,postId:t.postId,ref:t=>{this.onMapDiscussionsRef=t}})}render(){const{activeMapDiscussion:t,styles:e,view:s,mapActionNoticeActive:r}=this;return i(a,{"data-element":"discussions-map-integrator",style:e},t&&this.renderMapDiscussion(),s&&r&&i("arcgis-hub-discussions-map-action-notice",{view:s}))}static get assetsDirs(){return["locales"]}get element(){return r(this)}static get watchers(){return{context:["initialize"],view:["attachView"],discussionsRef:["attachdiscussionsRef"],drawRef:["handleDrawRefUpdate"],preview:["calculateOffsets"],previewHeight:["calculateOffsets"]}}};V([w({when(t){return this.eventTargetIsDiscussionsRef(t)}})],U.prototype,"handleGeometryGoTo",null),V([w({when(t){return this.eventTargetIsDiscussionsRef(t)}})],U.prototype,"handleGeometryFeature",null),V([w({when(t){return this.eventTargetIsDiscussionsRef(t)}})],U.prototype,"handleGeometryFeatureDeleted",null),V([w({when(t){return this.eventTargetIsDiscussionsRef(t)}})],U.prototype,"handleGeometryFeatureSelect",null),V([w({when(t){return this.eventTargetIsDiscussionsRef(t)}})],U.prototype,"handleGeometryFeatureHighlight",null),V([w({when(t){return this.eventTargetIsDiscussionsRef(t)}})],U.prototype,"handleFeatureRemove",null),V([w({when(t){return this.eventTargetIsDiscussionsRef(t)}})],U.prototype,"handleGeometryDrawCreate",null),V([w({when(t){return this.eventTargetIsDiscussionsRef(t)}})],U.prototype,"handleGeometryDrawTypeSelect",null),V([w({when(t){return t.target===this.drawRef}})],U.prototype,"handleActiveToolChange",null),V([w({when(t){return this.eventTargetIsDiscussionsRef(t)}})],U.prototype,"handleGeometryDrawEdit",null),V([w({when(t){return this.eventTargetIsDiscussionsRef(t)}})],U.prototype,"handlePostEditorReady",null),V([w({when(t){return this.eventTargetIsDiscussionsRef(t)}})],U.prototype,"handleGeometryDrawEditCancel",null),V([w({when(t){return t.target===this.drawRef}})],U.prototype,"handleDrawGraphicsChange",null),V([w({when(t){return this.eventTargetIsDiscussionsRef(t)}})],U.prototype,"handleGeometryDrawReset",null),V([w({when(t){return this.eventTargetIsDiscussionsRef(t)}})],U.prototype,"handleGeometryClearAll",null),V([w({when(t){return this.eventTargetIsDiscussionsRef(t)}})],U.prototype,"handleDiscussionsClose",null),V([y({timeout:50})],U.prototype,"setLocationEditPopover",null),V([w({when:t=>t}),y({timeout:50})],U.prototype,"refreshFeatures",null),V([w({when(){return this.geometryGraphicsLayer}})],U.prototype,"getGraphicById",null),V([w({when(){return this.highlightGraphicsLayer}})],U.prototype,"clearHoverActiveGraphics",null),V([w({when(){return this.drawRef}})],U.prototype,"saveInitialDrawOptions",null),V([w({when(){return this.drawRef&&this.initialDrawOptions}})],U.prototype,"restoreInitialDrawOptions",null),V([w({when(){return this.currentDiscussionsRef}})],U.prototype,"resetStagedFeatures",null),V([w({when(){return!this.mapActionNoticeActive}})],U.prototype,"handleMapClickDiscussions",null),V([y({timeout:50})],U.prototype,"handleViewSizeChange",null),V([y({timeout:15})],U.prototype,"handlePointerMove",null),V([w({when(){return Boolean(this.drawRef&&!this.drawRef.geometry)}})],U.prototype,"renderPostLocationPrimaryOptions",null),V([w({when(){return Boolean(this.drawRef&&!this.drawRef.geometry)}})],U.prototype,"renderPostLocationEditOptions",null),U.style=".sc-arcgis-hub-discussions-map-integrator-h{display:block}@media only screen and (min-width: 640px){arcgis-hub-discussions.sc-arcgis-hub-discussions-map-integrator{position:absolute}arcgis-hub-discussions.sc-arcgis-hub-discussions-map-integrator{z-index:10}arcgis-hub-discussions.sc-arcgis-hub-discussions-map-integrator{width:25rem}arcgis-hub-discussions.sc-arcgis-hub-discussions-map-integrator{padding:0px}arcgis-hub-discussions.sc-arcgis-hub-discussions-map-integrator{--tw-shadow:0 6px 20px -4px rgba(0, 0, 0, 0.1), 0 4px 12px -2px rgba(0, 0, 0, 0.08);--tw-shadow-colored:0 6px 20px -4px var(--tw-shadow-color), 0 4px 12px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}arcgis-hub-discussions.sc-arcgis-hub-discussions-map-integrator{top:calc(var(--top-offset) + 4.5rem);left:calc(var(--left-offset) - 5rem - 25rem);max-height:calc(var(--panel-height) - 6rem)}arcgis-hub-discussions-map-preview.sc-arcgis-hub-discussions-map-integrator{position:absolute}arcgis-hub-discussions-map-preview.sc-arcgis-hub-discussions-map-integrator{z-index:10}arcgis-hub-discussions-map-preview.sc-arcgis-hub-discussions-map-integrator{width:25rem}arcgis-hub-discussions-map-preview.sc-arcgis-hub-discussions-map-integrator{top:calc(var(--top-offset));left:calc(var(--left-offset))}}@media only screen and (max-width: 640px){arcgis-hub-discussions.sc-arcgis-hub-discussions-map-integrator{position:absolute}arcgis-hub-discussions.sc-arcgis-hub-discussions-map-integrator{z-index:10}arcgis-hub-discussions.sc-arcgis-hub-discussions-map-integrator{width:calc(var(--panel-width) + 0.05rem);top:calc(var(--top-offset) + var(--panel-height) * .5);max-height:calc(var(--panel-height) * .5);height:calc(var(--panel-height) * .5);left:0.95rem}arcgis-hub-discussions-map-preview.sc-arcgis-hub-discussions-map-integrator{position:absolute}arcgis-hub-discussions-map-preview.sc-arcgis-hub-discussions-map-integrator{z-index:10}arcgis-hub-discussions-map-preview.sc-arcgis-hub-discussions-map-integrator{width:calc(var(--panel-width) - 0.95rem);top:calc(var(--panel-height) + 3.2rem);left:0.5rem}}";var W=function(t,e,i,s){var a,r=arguments.length,n=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(n=(r<3?a(n):r>3?a(e,i,n):a(e,i))||n);return r>3&&n&&Object.defineProperty(e,i,n),n};const N=class{constructor(e){t(this,e),this.context=void 0,this.entity=void 0,this.entityId=void 0,this.entityType=void 0,this.isHub=void 0,this.isMobile=void 0,this.channel=void 0,this.channelId=void 0,this.allowedChannelIds=void 0,this.intl=void 0,this.pending=!0,this.postCount=void 0}async componentWillLoad(){await this.loadTranslations(),this.loadDependencies()}async loadTranslations(){this.intl=await f.loadIntlForComponent(this.element)}loadDependencies(){if(this.context)return this.pending=!0,this.fetchDependencies().then((t=>{Object.assign(this,t,{pending:!1})}))}fetchDependencies(){return this._fetchDependencies()}handleContextChanged(t,e){var i,s;(null===(i=null==t?void 0:t.currentUser)||void 0===i?void 0:i.username)!==(null===(s=null==e?void 0:e.currentUser)||void 0===s?void 0:s.username)&&this.loadDependencies()}async _fetchDependencies(){var t;const{entity:e,entityId:i,entityType:s,context:a,isHub:r,channel:n}=this;let{channelId:o,allowedChannelIds:h}=this;const[c,l]=await Promise.all([H({isHub:r},a.hubRequestOptions),T({entity:e,entityId:i,entityType:s,discussionType:"board"},a.hubRequestOptions)]);let d;n||o||(({allowedChannelIds:h}=void 0===h?await z(l.entity.id,a.hubRequestOptions):{allowedChannelIds:h}),o=null==h?void 0:h[0]);let u=0;return(n||o)&&([d,{total:u}]=await Promise.all([E({channelId:o,channel:n},a.hubRequestOptions),_(Object.assign({data:{channels:[null!==(t=null==n?void 0:n.id)&&void 0!==t?t:o],discussion:l.discussion,num:1,parents:[]}},a.hubRequestOptions))])),Object.assign(Object.assign(Object.assign(Object.assign({},c),l),d),{postCount:u})}get isOpenForSubmissions(){return Boolean(this.channel&&this.entity)&&S(this.entity)}get dateRange(){const t=new Date;return[new Date((new Date).setDate(t.getDate()-30)).toISOString(),t.toISOString()]}renderHeader(){var t,e,s,a,r,n;const{entity:o,isOpenForSubmissions:h,context:c,intl:l}=this;return i("div",{class:"entity-view-header"},i("div",{class:"entity-view-header__hero"},i("div",{class:"entity-view-header__thumbnail"},i("arcgis-hub-image",{alt:l.t("image"),corners:M.round,fallback:"https://static.arcgis.com/images/discussion.png",src:null==o?void 0:o.thumbnailUrl})),i("div",{class:"entity-view-header__details"},i("div",{class:"entity-view-header__status"},l.t(h?"statusOpen":"statusClosed")),i("header",{class:"entity-view-header__title"},null==o?void 0:o.title),i("div",{class:"entity-view-header__avatar"},i("calcite-avatar",{fullName:null===(t=null==o?void 0:o.ownerUser)||void 0===t?void 0:t.fullName,scale:"l",thumbnail:(null===(e=null==o?void 0:o.ownerUser)||void 0===e?void 0:e.thumbnail)&&A(c.session.portal,null==o?void 0:o.ownerUser,c.session.token),userId:null===(s=null==o?void 0:o.ownerUser)||void 0===s?void 0:s.id,username:null===(a=null==o?void 0:o.ownerUser)||void 0===a?void 0:a.username}),i("div",{class:"entity-view-header__avatar-details"},i("div",{class:"entity-view-header__avatar-name"},null===(r=null==o?void 0:o.ownerUser)||void 0===r?void 0:r.fullName),i("div",{class:"entity-view-header__avatar-org"},null===(n=null==o?void 0:o.org)||void 0===n?void 0:n.name))))))}renderMain(){const{entity:t,intl:e}=this;return i("div",{class:"entity-view-body entity-view-main"},(null==t?void 0:t.summary)&&i("div",{class:"entity-view-main__summary"},i("h2",null,e.t("summary")),i("div",null,t.summary)),(null==t?void 0:t.description)&&i("div",{class:"entity-view-main__description"},i("h2",null,e.t("description")),i("div",null,t.description)))}renderMetadata(){const{context:t,entity:e,intl:s,isOpenForSubmissions:a}=this;return i("div",{class:"entity-view-side-bar__metadata"},i("h2",null,s.t("details")),i("arcgis-hub-entity-metadata",{context:t,entity:e,entityType:"discussion",exclude:["owner"]},i("calcite-block",{description:s.t("discussionBoard"),heading:s.t("discussion")},i("calcite-icon",{icon:"speech-bubble",slot:"icon"})),i("calcite-block",{description:s.t(a?"statusOpen":"statusClosed"),heading:s.t(a?"titleOpen":"titleClosed")},i("calcite-icon",{icon:"mega-phone",slot:"icon"}))))}renderMetrics(){const{context:t,postCount:e,dateRange:s,intl:a}=this;return i("div",{class:"entity-view-side-bar__metrics"},i("h2",null,a.t("metrics")),i("div",{class:"entity-view-metric"},i("calcite-icon",{icon:"graph-bar"}),i("div",null,i("div",{class:"heading"},a.t("metric.pageViews")),i("arcgis-telemetry-report",{contentId:`portal:${this.entityId}`,context:t,endDate:s[1],reportTitle:a.t("metric.pageViews"),startDate:s[0],telemetryEvent:"page-views",type:"value"}))),i("div",{class:"entity-view-metric"},i("calcite-icon",{icon:"speech-bubbles"}),i("div",null,i("div",{class:"heading"},a.t("metric.postCount")),i("div",null,a.formatNumber(e)))))}renderTags(){var t;const{entity:e,intl:s}=this;return i("div",{class:"entity-view-side-bar__tags"},i("h2",null,s.t("tags")),null===(t=null==e?void 0:e.tags)||void 0===t?void 0:t.map((t=>{const e=encodeURIComponent(t.toLowerCase());return i("calcite-chip",{key:t,value:t},i("calcite-link",{href:`/search?tags=${e}`,target:"_self"},t))})))}renderCategories(){var t;const{entity:e,intl:s}=this;return i("div",{class:"entity-view-side-bar__categories"},i("h2",null,s.t("categories")),null===(t=null==e?void 0:e.categories)||void 0===t?void 0:t.map((t=>{const e=encodeURIComponent(t.toLowerCase());return i("calcite-chip",{key:t,value:t},i("calcite-link",{href:`/search?categories=${e}`,target:"_self"},t))})))}renderSidebar(){return i("div",{class:"entity-view-body entity-view-side-bar"},this.renderMetadata(),this.renderMetrics(),this.renderTags(),this.renderCategories())}renderSkeleton(){return i(s,null,i("div",{class:"entity-view-header"},i("div",{class:"entity-view-header__hero"},i("arcgis-skeleton-loader",{active:!0,rows:0,showHeading:!1,showThumbnail:!this.isMobile}),i("arcgis-skeleton-loader",{active:!0,rows:4,showHeading:!1}))),i("div",{class:"entity-view-body skeleton"},i("arcgis-skeleton-loader",{active:!0,rows:2,showHeading:!0}),i("arcgis-skeleton-loader",{active:!0,rows:4,showHeading:!0})),i("div",{class:"entity-view-body entity-view-side-bar skeleton"},i("arcgis-skeleton-loader",{active:!0,rows:10,showHeading:!0}),i("arcgis-skeleton-loader",{active:!0,rows:4,showHeading:!0}),i("arcgis-skeleton-loader",{active:!0,rows:1,showHeading:!0}),i("arcgis-skeleton-loader",{active:!0,rows:1,showHeading:!0})))}renderView(){return i(s,null,this.renderHeader(),this.renderMain(),this.renderSidebar())}render(){return i(a,{"data-element":"discussions-view"},i("div",{class:"entity-view"+(this.isMobile?"-mobile":"")},this.pending?this.renderSkeleton():this.renderView()))}static get assetsDirs(){return["locales"]}get element(){return r(this)}static get watchers(){return{context:["handleContextChanged"]}}};W([L({delay:300})],N.prototype,"fetchDependencies",null),W([w({when(){var t,e;return null===(e=null===(t=this.entity)||void 0===t?void 0:t.tags)||void 0===e?void 0:e.filter((t=>t.length)).length}})],N.prototype,"renderTags",null),W([w({when(){var t,e;return null===(e=null===(t=this.entity)||void 0===t?void 0:t.categories)||void 0===e?void 0:e.filter((t=>t.length)).length}})],N.prototype,"renderCategories",null),N.style=':host{display:block}.entity-view{display:grid;column-gap:4rem;grid-template-columns:2fr 1fr;grid-template-areas:"header header"\n    "main sideBar"}.entity-view-mobile{display:block}h2{margin-top:0.5rem;margin-bottom:0.5rem;font-size:var(--calcite-font-size-2);line-height:1.5rem;color:var(--calcite-ui-text-1)}div{font-size:var(--calcite-font-size-0);line-height:1.25rem;color:var(--calcite-ui-text-1)}.entity-view-header{grid-area:header;margin-bottom:1rem}.entity-view-body{margin-top:1rem}.entity-view-body>div:not(:last-child){margin-bottom:1rem}.entity-view-main{grid-area:main}.entity-view-side-bar{grid-area:sideBar}arcgis-hub-image{width:100%}header.entity-view-header__title{margin-bottom:1rem;font-size:var(--calcite-font-size-4);line-height:2.5rem;font-weight:var(--calcite-font-weight-bold);color:var(--calcite-ui-text-1)}.entity-view-header__hero{display:grid;align-items:center;column-gap:1.5rem;grid-template-columns:1fr 2fr;grid-template-rows:1fr}.entity-view-header__status{font-size:var(--calcite-font-size-2);line-height:1.5rem;font-weight:var(--calcite-font-weight-medium);text-transform:uppercase}.entity-view-header__avatar{display:grid;column-gap:1rem;grid-template-columns:44px auto;grid-template-rows:1fr}.entity-view-header__avatar-name{font-weight:var(--calcite-font-weight-bold)}calcite-chip{margin-right:0.5rem;margin-top:0.5rem;border-radius:0px}calcite-link{color:var(--calcite-ui-text-1)}.entity-view-metric{margin-top:0.5rem;display:grid;align-items:center;column-gap:0.5rem;grid-template-columns:1.50rem auto}.entity-view-metric .heading{font-weight:var(--calcite-font-weight-bold);color:var(--calcite-ui-text-2)}.skeleton>arcgis-skeleton-loader{margin-bottom:1.5rem}calcite-block{border-block-end-width:0px;--calcite-ui-text-3:var(--calcite-ui-text-2);--calcite-font-size--1:var(--calcite-font-size--0);--calcite-font-size--2:var(--calcite-font-size--0);--calcite-font-weight-medium:var(--calcite-font-weight-bold);margin-bottom:-1rem;margin-left:-0.75rem;background-color:transparent}@media only screen and (max-width: 768px){:host{display:block}.entity-view{display:block}.entity-view-header__thumbnail{display:none}.entity-view-body{margin:0px}.entity-view-side-bar{margin-top:2.5rem}.entity-view-header__hero{display:block}}.entity-view-mobile,.entity-view-mobile .entity-view-header__hero{display:block}.entity-view-mobile .entity-view-header__thumbnail{display:none}';export{U as arcgis_hub_discussions_map_integrator,N as arcgis_hub_discussions_view}